riot.tag("weather",'<div class="w-header"> <span class="y-icon icon-location" onclick="{changeLocation}" ga_event="mh_change_city">&nbsp;{options.city}</span> <span class="wind">{options.wind}</span> <span class="air" riot-style="background: {options.level}">{options.air}</span> </div> <ul class="y-box days-weather {show: options.weather_show}"> <li class="y-left day"> <span class="title">今天</span> <div title="{options.weather.current_condition}" class="weather-icon weather-icon-{options.weather.weather_icon_id}"></div> <span class="temperature"> <em>{options.weather.low_temperature}</em>&#176; &#47; <em>{options.weather.high_temperature}</em>&#176; </span> </li> <li class="y-left day"> <span class="title">明天</span> <div title="{options.weather.tomorrow_condition}" class="weather-icon weather-icon-{options.weather.tomorrow_weather_icon_id}"></div> <span class="temperature"> <em>{options.weather.tomorrow_low_temperature}</em>&#176; &#47; <em>{options.weather.tomorrow_high_temperature}</em>&#176; </span> </li> <li class="y-left day"> <span class="title">后天</span> <div title="{options.weather.dat_condition}" class="weather-icon weather-icon-{options.weather.dat_weather_icon_id}"></div> <span class="temperature"> <em>{options.weather.dat_low_temperature}</em>&#176; &#47; <em>{options.weather.dat_high_temperature}</em>&#176; </span> </li> </ul> <div class="y-box city-select {show: !options.weather_show}"> <div class="y-box"> <div class="y-left select-style"> <p class="y-box"> <span class="y-left name">{options.current_province}</span> <span class="y-right y-icon icon-more" onclick="{showProvinces}"></span> </p> <div class="y-box province-list {show: options.province_show}"> <a class="y-left item" href="javascript:;" each="{item, i in options.locations}" onclick="{changeProvince}"> {item} </a> </div> </div> <div class="y-right select-style"> <p class="y-box"> <span class="y-left name">{options.current_city}</span> <span class="y-right y-icon icon-more" onclick="{showCities}"></span> </p> <div class="y-box city-list {show: options.city_show}"> <a class="y-left item" href="javascript:;" each="{item, i in options.cities}" onclick="{changeCity}"> {item} </a> </div> </div> </div> <div class="y-box action"> <a href="javascript:;" class="y-left ok-btn" onclick="{onSubmitClick}">确定</a> <a href="javascript:;" class="y-right cancel-btn" onclick="{onCancelClick}">取消</a> </div> </div>','class="y-weather"',function(){function t(t){var e=!0;return t>=0&&50>=t?{c:e?"#5cbf4c":"#5c8828",t:"优"}:t>=51&&100>=t?{c:e?"#5cbf4c":"#5c8828",t:"良"}:t>=101&&150>=t?{c:e?"#ff9f2d":"#c58120",t:"轻度污染"}:t>=151&&200>=t?{c:e?"#ff9f2d":"#c58120",t:"中度污染"}:t>=201&&300>=t?{c:e?"#ff5f5f":"#cf3d3d",t:"重度污染"}:t>=301?{c:e?"#ff5f5f":"#cf3d3d",t:"严重污染"}:{c:"rgba( 214, 117, 3, 0.8 )",t:"其他"}}this.options={current_province:"北京",current_city:"北京",province_show:!1,city_show:!1,weather_show:!0},riot.observable(this),this.on("weatherChange",function(t){this._renderWeather(t)}),this.init=function(){this._getCities()}.bind(this),this.showProvinces=function(){this.options.city_show=!1,this.options.province_show=!this.options.province_show}.bind(this),this.showCities=function(){this.options.province_show=!1,this.options.city_show=!this.options.city_show}.bind(this),this.changeLocation=function(){this.options.weather_show=!1}.bind(this),this.changeProvince=function(t){this.options.city_show=!1,this.options.province_show=!1,this.options.current_province=t.item.item,this._renderCities(t.item.item)}.bind(this),this.changeCity=function(t){this.options.city_show=!1,this.options.province_show=!1,this.options.current_city=t.item.item}.bind(this),this.onSubmitClick=function(){var t=this;this.options.weather_show=!0,this._getWeather({city:t.options.current_city})}.bind(this),this.onCancelClick=function(){this.options.weather_show=!0}.bind(this),this._getWeather=function(t){var e=this;http({url:"/stream/widget/local_weather/data/",method:"GET",data:t,success:function(t){t=t||{},"success"===t.message&&(e._renderWeather(t.data.weather),Cookies.set("WEATHER_CITY",t.data.city,{expires:100}),e.parent&&e.parent.trigger("weatherChange",t.data.weather))}})}.bind(this),this._renderWeather=function(e){this.options.weather=e,this.options.city=e.city_name,this.options.wind=e.wind_direction+e.wind_level+"级",this.options.air=e.quality_level+" "+e.aqi,this.options.level=t(e.aqi).c,this.update()}.bind(this),this._getCities=function(){var t=this;http({url:"/stream/widget/local_weather/city/",method:"GET",success:function(e){e=e||{},"success"===e.message&&(t.options.locations=e.data,t._renderCities(t.options.current_province))}})}.bind(this),this._renderCities=function(t){this.options.cities=this.options.locations[t];for(var e in this.options.cities){this.options.current_city=e;break}this.update()}.bind(this),this.on("mount",function(){this.init()})}),riot.tag("nav",'<div class="nav"> <ul class="y-box nav-list" ga_event="mh_channel"> <li each="{options.navItem}" class="y-left nav-item"> <a class="nav-link {active: location.pathname == url}" href="{url}" target="_blank" ga_event="mh_channel_{en}">{name}</a> </li> <li class="y-left nav-item nav-more"> <a class="nav-link" href="javascript:;"> 更多<i class="y-icon icon-more"></i> </a> <div class="nav-layer"> <ul class="nav-more-list"> <li each="{options.navMore}" class="nav-more-item"> <a href="{url}" target="_blank" ga_event="mh_channel_{en}">{name}</a> </li> </ul> </div> </li> </ul> </div>',function(){this.options={navItem:[{name:"推荐",url:"/",en:"recommend"},{name:"热点",url:"/news_hot/",en:"hot"},{name:"视频",url:"/video/",en:"video"},{name:"图片",url:"/news_image/",en:"image"},{name:"段子",url:"/essay_joke/",en:"essay"},{name:"社会",url:"/news_society/",en:"society"},{name:"娱乐",url:"/news_entertainment/",en:"entertainment"},{name:"科技",url:"/news_tech/",en:"tech"},{name:"汽车",url:"/news_car/",en:"car"},{name:"体育",url:"/news_sports/",en:"sports"},{name:"财经",url:"/news_finance/",en:"finance"},{name:"军事",url:"/news_military/",en:"military"},{name:"国际",url:"/news_world/",en:"world"},{name:"时尚",url:"/news_fashion/",en:"fashion"},{name:"旅游",url:"/news_travel/",en:"travel"}],navMore:[{name:"探索",url:"/news_discovery/",en:"discovery"},{name:"育儿",url:"/news_baby/",en:"baby"},{name:"养生",url:"/news_regimen/",en:"regimen"},{name:"故事",url:"/news_story/",en:"story"},{name:"美文",url:"/news_essay/",en:"essay"},{name:"游戏",url:"/news_game/",en:"game"},{name:"历史",url:"/news_history/",en:"history"},{name:"美食",url:"/news_food/",en:"food"}]}}),riot.tag("wsearch",'<div name="searchBox" class="wsearch"> <form name="searchForm" action="/search/" method="get" target="_blank" onsubmit="{onSearchClick}"> <div name="inputbox" class="y-box input-group"> <input class="y-left input-text" name="keyword" value="{options.keyword}" autocomplete="off" ga_event="mh_search" type="text" placeholder="请输入关键字" onclick="{onSearchInputClick}" onfocus="{onFocus}" onblur="{onBlur}"> <div class="y-right btn-submit"> <button type="submit" href="javascript:;"> <i class="y-icon icon-search" ga_event="mh_search"></i> </button> </div> </div> </form> <div class="layer {layer-show: options.layershow}" if="{options.hotwords.length > 0}"> <div class="layer-inner"> <ul ga_event="mh_search"> <li each="{item, i in options.hotwords}" class="search-item" onclick="{onSearchItemClick}"> <a href="javascript:;"> <i class="search-no search-no-{i+1}">{i + 1}</i> <span class="search-txt">{item}</span> </a> </li> </ul> </div> </div> </div>',function(){this.options={hotwords:[],keyword:"",searchTip:"大家都在搜：",layershow:!1},this.init=function(){this._getHotWords()}.bind(this),this._getHotWords=function(){var t=this;http({url:"/hot_words/",method:"GET",success:function(e){e=e.hot_words||e||[],_.isArray(e)&&0!==e.length&&(t.options.hotwords=e,t.options.keyword=t.options.searchTip+e[0],t.update())}})}.bind(this),this.onFocus=function(){this.inputbox.style["border-color"]="#ed4040",this.options.keyword="",this.options.layershow=!0}.bind(this),this.onBlur=function(){this.inputbox.style["border-color"]="#e8e8e8",this.options.layershow=!1}.bind(this),this.onSearchClick=function(){var t,e=this.keyword.value;return e?(t=e.slice(0,6),t!==this.options.searchTip||(this.options.keyword=e.slice(6),this.options.keyword)?!0:(this.keyword.focus(),!1)):(this.keyword.focus(),!1)}.bind(this),this.onSearchItemClick=function(t){this.options.keyword=t.item.item,this.update(),this.searchForm.submit()}.bind(this),this.on("mount",function(){this.init()})}),riot.tag("wtopbar",'<div class="y-box wtopbar"> <ul class="y-left" if="{opts.home}"> <li class="tb-item"> <a class="tb-link" href="http://app.toutiao.com/news_article/" target="_blank" ga_event="mh_nav_others">下载APP</a> </li> <li class="tb-item weather" if="{opts.home}"> <a class="tb-link" href="javascript:;"> <span>&nbsp;{ options.city }</span> <span class="city_state">{ options.state }</span> <span class="city_temperature"> <em>{options.low}</em>&#176; &nbsp;&#47;&nbsp; <em>{options.top}</em>&#176; </span> <i class="y-icon icon-more"></i> </a> <div class="weather-box"> <div riot-tag="weather"></div> </div> </li> </ul> <div class="y-left y-nav-topbar" riot-tag="nav" if="{!opts.home}"></div> <ul class="y-right"> <li class="tb-item userbox"> <div riot-tag="wuserbox" userinfo="{opts.userInfo}" abtype="{opts.abType}" pageid="{opts.pageId}"></div> </li> <li class="tb-item"> <a class="tb-link" href="https://wenda.toutiao.com" target="_blank" ga_event="mh_nav_others">问答</a> </li> <li class="tb-item"> <a class="tb-link" href="https://mp.toutiao.com/" target="_blank" ga_event="mh_nav_others">头条号</a> </li> <li class="tb-item"> <a class="tb-link" href="https://tuchong.com/" target="_blank" ga_event="mh_nav_others">图虫</a> </li> <li class="tb-item"> <a onclick="{feedbackClick}" class="tb-link" href="javascript:void(0)">反馈</a> </li> <li class="tb-item more"> <a class="tb-link" href="/about/">更多</a> <div class="layer"> <ul> <li> <a href="/articles_news_society/" class="layer-item">头条简版</a> </li> <li> <a href="/about/" class="layer-item" rel="nofollow">关于头条</a> </li> <li> <a href="/join/" class="layer-item" rel="nofollow">加入头条</a> </li> <li> <a href="/report/" class="layer-item" rel="nofollow">媒体报道</a> </li> <li> <a href="/media_partners/" class="layer-item" rel="nofollow">媒体合作</a> </li> <li> <a href="/cooperation/" class="layer-item" rel="nofollow">产品合作</a> </li> <li> <a href="/media_cooperation/" class="layer-item" rel="nofollow">合作说明</a> </li> <li> <a href="https://ad.toutiao.com/e/" class="layer-item" target="_blank" rel="nofollow">广告投放</a> </li> <li> <a href="/contact/" class="layer-item" rel="nofollow">联系我们</a> </li> <li> <a href="/user_agreement/" class="layer-item" rel="nofollow">用户协议</a> </li> <li> <a href="/complain/" class="layer-item" rel="nofollow">投诉指引</a> </li> <li> <a href="/corrupt_report/" class="layer-item" rel="nofollow">廉洁举报</a> </li> </ul> </div> </li> </ul> <div riot-tag="userFeedback"></div> </div>',function(t){this.options={city:"",state:"",top:0,low:0,userInfo:t.userInfo},this.userFeedbackShow=!1;var e=this.tags.weather,i=this.tags.userFeedback;this.init=function(){if(this.opts.home){var t=Cookies.get("WEATHER_CITY")||"";this._getWeather({city:t})}}.bind(this),this._getWeather=function(t){var i=this;http({url:"/stream/widget/local_weather/data/",method:"GET",data:t,success:function(t){t=t||{},"success"===t.message&&(i._renderWeather(t.data.weather),e&&e.trigger("weatherChange",t.data.weather))}})}.bind(this),this._renderWeather=function(t){this.options.weather=t,this.options.city=t.city_name,this.options.state=t.current_condition,this.options.top=t.high_temperature,this.options.low=t.low_temperature,this.update()}.bind(this),this.init(),this.on("weatherChange",function(t){this._renderWeather(t)}),this.feedbackClick=function(){i.trigger("userFeedShow",this.userFeedbackShow),this.userFeedbackShow=!this.userFeedbackShow}.bind(this)}),riot.tag("wuserbox",'<div class="y-box wuserbox"> <a if="{options.id && options.isPgc}" class="y-left new-article" href="http://mp.toutiao.com/new_article/" ga_event="mh_write">发文</a> <div if="{options.id}" class="y-right username"> <a ga_event="mh_nav_user" class="user-head" href="//web.toutiao.com/user/{options.id}/pin/" rel="nofollow"> <div class="user-image"> <img onload="this.style.opacity=1;" riot-src="{options.avatarUrl}"> </div> <span>{options.name}</span> </a> <div class="user-layer"> <ul ga_event="mh_nav_user"> <li><a href="http://web.toutiao.com/user/{options.id}/pin/" class="layer-item" rel="nofollow">我的收藏</a></li> <li><a href="http://web.toutiao.com/user/{options.id}/subscribe/" class="layer-item" rel="nofollow">我的订阅</a></li> <li><a href="http://web.toutiao.com/user/{options.id}/followers/" class="layer-item" rel="nofollow">我的粉丝</a></li> <li><a href="http://web.toutiao.com/user/{options.id}/followings/" class="layer-item" rel="nofollow">我的关注</a></li> <li>  <a href="https://sso.toutiao.com/logout/" class="layer-item" rel="nofollow">退出</a> </li> </ul> </div> </div> <div if="{!options.id}" class="nav-login"> <a ga_event="nav_login" href="javascript:;" onclick="{onLoginClick}"> <span>登录</span> </a> <div if="{options.alertMsg}" class="y-box login-layer"> <div class="y-left login-alert-icon"></div> <div class="y-right"> <p>手机号登录上线啦！！！</p> <p>登录同步头条App阅读兴趣，推荐更精准！</p> </div> <span onclick="{msgCloseClick}"> <i class="y-icon icon-dislikenewfeed"></i> </span> </div> </div> </div>',function(t){var e=this,i=t.pageid,n=(t.abtype,"Toutiao_login_msg");this.options={id:t.userinfo.id,name:t.userinfo.name,avatarUrl:t.userinfo.avatarUrl,isPgc:t.userinfo.isPgc||!1,alertMsg:!1},this.on("mount",function(){var t=Cookies.get(n);t||"/"!=i||this.options.id||(this.options.alertMsg=!0,Cookies.set(n,1,{expires:7}))}),this.msgCloseClick=function(){this.options.alertMsg=!1,Cookies.set(n,1,{expires:7})}.bind(this),this.onLoginClick=function(){window.location.href="https://sso.toutiao.com/login/"}.bind(this),window.on("userChange",function(t){t&&(e.options.id=t.user_id,e.options.name=t.name,e.options.avatarUrl=t.avatar_url,e._isPgc(),e.update())}),this._isPgc=function(){var t=this;http({url:"/user/pgc_info/",method:"get",cache:!1,success:function(e){e=e||{},"success"===e.message&&e.data.is_pgc_author&&(t.options.isPgc=!0,t.update())}})}.bind(this)}),riot.tag("login",'<div class="login-dialog {hide: options.hide}"> <a class="btn" href="javascript:;" onclick="{hide}"> <i class="icon icon-close"></i> </a> <div class="login-dialog-header"> <h3>邮箱登录</h3> </div> <div class="login-dialog-inner" data-node="inner"> <div class="login-pannel bottom-line"> <form action="/auth/login/" method="POST" onsubmit="{onFormSubmit}"> <ul> <li> <div class="input-group"> <div class="input"> <label>邮箱</label> <input class="name" name="name_or_email" type="text" placeholder="请使用您的注册邮箱" autocomplete="off" spellcheck="false"> </div> </div> </li> <li> <div class="input-group"> <div class="input"> <label>密码</label> <input class="password" name="password" type="password" data-node="password" placeholder="密码" autocomplete="off" spellcheck="false"> </div> </div> </li> <li class="captcha-box {show: options.captchaImg}"> <div class="input-group"> <div class="input"> <input class="password" name="captcha" type="text" data-node="captcha" placeholder="验证码" autocomplete="off" spellcheck="false"> <img name="captchaImg" riot-src="{options.captchaImg}"> </div> </div> </li> <li> <div class="input-group"> <input type="checkbox" name="remember_me" checked="" style="vertical-align:top"> <label for="remember_me" class="label">记住账号</label> </div> </li> <li> <div class="input-group" style="text-align: center;"> <input type="submit" class="submit-btn" value="登录"> <p class="{error: options.errorMsg}">{options.errorMsg}</p> </div> </li> </ul> </form> </div> <div class="login-dialog-header"> <h3>合作网站帐号登录</h3> </div> <div class=""> <ul class="y-box sns_login_list" onclick="{onSnsLoginClick}"> <li class="sinaweibo"> <a href="javascript:;" data-pid="sina_weibo" ga_event="login_sina_weibo"> <i class="icon"></i> 新浪微博 </a> </li> <li class="qqweibo"> <a href="javascript:;" data-pid="qq_weibo" ga_event="login_tencnet_weibo"> <i class="icon"></i> 腾讯微博 </a> </li> <li class="qzone"> <a href="javascript:;" data-pid="qzone_sns" ga_event="login_qqzone"> <i class="icon"></i> QQ空间 </a> </li> <li class="renren"> <a href="javascript:;" data-pid="renren_sns" ga_event="login_renren"> <i class="icon"></i> 人人网 </a> </li> <li class="weixin"> <a href="javascript:;" style="margin-right:0;" data-pid="weixin" ga_event="login_wechat"> <i class="icon"></i> 微信 </a> </li> </ul> </div> </div> </div> <div class="mask {hide: options.hide}"></div>',function(t){var e=this;riot.observable(this),this.options={hide:!0,errorMsg:"",captchaImg:""},this.curSpec={successCb:t.successCb||function(){},errorCb:t.errorCb||function(){}},this.hide=function(){this.options.hide=!0,this.update()}.bind(this),this.onFormSubmit=function(t){t.preventDefault();var e=this,i=http.serialize(t.currentTarget);user.loginByLoc({data:i,successCb:function(t){"function"==typeof e.curSpec.successCb&&e.curSpec.successCb(t),e.hide()},errorCb:function(t){e.password.value="",t=t||{};var i=t.data||{};e.options.errorMsg=i.description||"登录失败",i.captcha?(e.captcha.value="",e.options.captchaImg="data:image/gif;base64,"+i.captcha):(e.captcha.value="",e.options.captchaImg=""),"function"==typeof e.curSpec.errorCb&&e.curSpec.errorCb(t),e.update()}})}.bind(this),this.onSnsLoginClick=function(t){var e=utils.getTarget(t),i=utils.getAttribute(e,"data-pid")||utils.getAttribute(e.parentNode,"data-pid");this.hide(),user.loginByOther(i,this.curSpec)}.bind(this),window.on("login",function(t){e.options.hide=!1,t=t||{},e.curSpec={successCb:t.successCb||function(){},errorCb:t.errorCb||function(){}},e.update()})}),riot.tag("userFeedback",'<div class="feedback_dialog"> <div class="dialog-header"> <h3>意见反馈</h3> </div> <div class="dialog-inner"> <div class="feedback_panel"> <form onsubmit="{onFormSubmit}"> <p class="label">联系方式（必填）</p> <div class="input-group"> <input class="email" placeholder="您的邮箱/QQ号" type="text" name="feedback-email"> </div> <p class="label">您的意见（必填）</p> <div class="input-group"> <textarea style="height:100px;" name="feedback-content" class="content" maxlength="140" placeholder="请填写您的意见，不超过140字"></textarea> </div> <div class="input-group"> <input type="submit" class="{submit-btn:true,disabled:disabled}" value="提交" __disabled="{disabled}"> <span class="error">{msg}</span> <a class="close" href="javascript:void(0);" onclick="{hide}">[关闭]</a> </div> </form> </div> </div> </div>','class="userFeedback" show="{userFeedShow}"',function(){this.message={success:"已提交,感谢您的意见",fail:"提交错误,请稍后重试",mail_error:"请输入正确的联系方式",content_error:"请输入您的意见",content_length_error:"意见长度超出限制"};var t=this;this.userFeedShow=!1,this.msg="",this.disabled=!1,riot.observable(this),this.on("userFeedShow",function(e){e?t.hide():t.show()}),this.showMessage=function(t){this.msg=this.message[t],this.update()}.bind(this),this.show=function(){this.userFeedShow=!0,this.update()}.bind(this),this.hide=function(){this.userFeedShow=!1,this.msg="",this.update()}.bind(this),this.onFormSubmit=function(){var e=this["feedback-email"],i=this["feedback-content"];return e.value.length<5?(e.focus(),this.showMessage("mail_error")):""===i.value?(i.focus(),this.showMessage("content_error")):(this.msg="",this.disabled=!0,this.update(),void http({headers:{"X-CSRFToken":Cookies.get("csrftoken")},url:"/post_message/",method:"post",data:{appkey:"web",uuid:e.value,content:"["+window.location.host+"]"+i.value},success:function(n){return"success"!==n.message?t.showMessage("fail"):(e.value="",i.value="",t.disabled=!1,t.showMessage("success"),void setTimeout(function(){t.hide()},2e3))},error:function(){t.disabled=!1,t.update(),t.showMessage("fail")}}))}.bind(this)}),riot.tag("toast",'<div name="toast" class="toast-inner" style="opacity: 10; filter:alpha(opacity=1000);"> <span>{opts.msg}</span> </div>','class="toast"',function(){var t=this;this.on("mount",function(){var e=this.toast,i=e.clientWidth,n=e.clientHeight,o=new TAnimation;e.style.cssText+="margin-top:-"+n/2+"px;margin-left:-"+i/2+"px",o.animate({el:e,prop:"opacity",to:0,transitionDuration:2e3},function(){t.unmount(!0)})})}),riot.tag("raw","",function(t){this.root.innerHTML=t.content}),!function(t){var e={};e.getHoney=function(){var t=Math.floor((new Date).getTime()/1e3),e=t.toString(16).toUpperCase(),i=md5(t).toString().toUpperCase();if(8!=e.length)return{as:"479BB4B7254C150",cp:"7E0AC8874BB0985"};for(var n=i.slice(0,5),o=i.slice(-5),s="",a=0;5>a;a++)s+=n[a]+e[a];for(var r="",c=0;5>c;c++)r+=e[c+3]+o[c];return{as:"A1"+s+e.slice(-3),cp:e.slice(0,3)+r+"E1"}},t.ascp=e}(window,document),!function(t,e){function i(t){var i,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(i=e.cookie.match(n))?unescape(i[2]):null}function n(){return(new Date).getTime()}function o(t,e,i){var o,s,a,r,c=0;i||(i={});var l=function(){c=i.leading===!1?0:n(),o=null,r=t.apply(s,a),o||(s=a=null)},u=function(){var u=n();c||i.leading!==!1||(c=u);var d=e-(u-c);return s=this,a=arguments,0>=d||d>e?(o&&(clearTimeout(o),o=null),c=u,r=t.apply(s,a),o||(s=a=null)):o||i.trailing===!1||(o=setTimeout(l,d)),r};return u.cancel=function(){clearTimeout(o),c=0,o=s=a=null},u}function s(t,e,i){if(t.addEventListener)return t.addEventListener(e,i,!1),i;if(t.attachEvent){var n=function(){var e=window.event;e.target=e.srcElement,i.call(t,e)};return t.attachEvent("on"+e,n),n}}function a(t,e){if(!t)return"";var i=t.getAttribute(e);return i?i:""}function r(t,e,i){t&&t.setAttribute(e,i)}function c(){return window.innerHeight&&window.innerWidth?{winWidth:window.innerWidth,winHeight:window.innerHeight}:document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth?{winWidth:document.documentElement.clientWidth,winHeight:document.documentElement.clientHeight}:void 0}function l(t){var e=t.getBoundingClientRect();return e.top+16<v.winHeight&&e.bottom>16}function u(t){var e=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=(t.type||"get").toUpperCase(),n=t.url,o=t.data;if(n){var s=[];for(var a in o)s.push(a+"="+o[a]);"GET"===i?(n=n+"?"+s.join("&")+"&_="+Math.random(),e.open(i,n,!0),e.send()):(e.open(i,n,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(s.join("&"))),e.onload=function(){(e.status>=200&&e.status<300||304==e.status)&&t.success&&t.success.call(e,e.responseText)}}}function d(t){u({url:g,type:"POST",data:{value:t.value,tag:"embeded_ad",label:t.label,is_ad_event:"1",log_extra:t.extra,category:"web",utm_source:i("utm_source"),csrfmiddlewaretoken:i("csrftoken")},success:function(){}}),taAnalysis&&taAnalysis.send("event",{ev:"feed_ad_"+t.label})}function p(t){var e=new Image;e.src=t}function h(){for(var t,e=0,i=f.length;i>e;e++){var n=f[e];l(n)?1!=a(n,"ad_show")&&(r(n,"ad_show",1),t={value:a(n,"ad_id"),extra:a(n,"ad_extra")||m(n),label:"show",track:a(n,"ad_track")},t.track&&p(t.track),d(t)):r(n,"ad_show",0)}}function m(t){if(!t)return"";var e=t.querySelectorAll("#ad_extra")[0];return e.innerText||""}var g="/action_log/",f=[],v=c(),_={};_.setAds=function(t){f=t,h()},_.sendMsg=function(t){d(t)},s(t,"scroll",o(function(){h()},150)),s(t,"resize",o(function(){v=c()},150)),t.tAdMonitor=_}(window,document),riot.tag("comment",'<div class="c-header"> <em>{opts.comments_count}&nbsp;</em>条评论 </div> <div riot-tag="inputBox" ismain="true" avatar="{opts.userInfo.avatarUrl}" group_id="{opts.group_id}" item_id="{opts.item_id}"></div> <ul> <li class="c-item" each="{item, i in options.list}"> <a href="/user/{item.user.user_id}/" target="_blank" class="avatar-wrap"> <img if="{item.user.avatar_url}" riot-src="{item.user.avatar_url}" alt=""> </a> <div class="c-content"> <div class="c-user-info"> <a href="/user/{item.user.user_id}/" class="c-user-name" target="_blank">{item.user.name}</a> <span class="c-create-time">{item.timeAgo}</span> </div> <p>{item.text}</p> <div class="c-footer-action"> <span class="c-reply" onclick="{onReplyClick}" ga_event="click_reply_comment">回复</span> <span if="{item.reply_count>0&&!item.is_reply_expanded}" class="c-reply-count" onclick="{onReplyExpandClick}" ga_event="click_expand_reply" >&nbsp;&sdot;&nbsp;{item.reply_count}条回复<i class="y-icon icon-more"></i></span> <span if="{item.is_reply_expanded}" class="c-reply-count" onclick="{onReplyCollapseClick}" >&nbsp;&sdot;&nbsp;收起回复<i class="y-icon icon-more-up"></i></span> <span class="y-right c-report" onclick="{onReportClick}" title="举报"><i class="y-icon icon-report"></i></span> <span class="y-right c-digg {c-digg-active: item.user_digg}" onclick="{onDiggClick}" title="点赞" ga_event="click_good_comment">{item.diggNum}&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_{i}"></div> <div each="{subItem, j in item.reply_data.reply_list}" class="c-reply-comment"> <a href="/user/{subItem.user.user_id}/" target="_blank" class="avatar-wrap"> <img if="{subItem.user.avatar_url}" riot-src="{subItem.user.avatar_url}" alt=""> </a> <div class="c-content"> <div class="c-user-info"> <a href="/user/{subItem.user.user_id}/" target="_blank" class="c-user-name">{subItem.user.name}</a> <span class="c-create-time">{subItem.timeAgo}</span> </div> <p>{subItem.text}</p> <div class="c-footer-action"> <span class="c-reply" onclick="{onReplyClick}" ga_event="click_reply_comment">回复</span> <span class="y-right c-digg {c-digg-active: subItem.user_digg}" onclick="{onDiggClick}" title="点赞" ga_event="click_good_comment">{subItem.diggNum}&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_{i}_{j}"></div> </div> </div> <div if="{item.reply_data.hasMore}" class="c-load-more r-load-more" onclick="{onRLoadMore}" ga_event="click_loadmore_reply">查看更多回复</div> </div> </li> </ul> <div if="{options.hasMore}" class="c-load-more" onclick="{onCLoadMore}" ga_event="click_loadmore_comment">查看更多评论</div> <div id="J_report"></div>','id="comment"',function(t){function e(t){r.options.isLoading||(r.options.isLoading=!0,http({url:"/api/comment/list/",data:r.params,method:"get",success:function(e){"success"==e.message&&(r.options.hasMore=e.data.has_more,r.options.list=r.options.list.concat(e.data.comments),n(),r.params.offset+=r.params.count,r.update(),r.options.isLoading=!1),"first"===t&&(r.params.count=10,window.trigger("commentReady"))}}))}function i(t,e){a&&a.unmount(!0),void 0===t.reply_data.offset&&(t.reply_data.offset=0),http({url:"/api/comment/get_reply/",data:{comment_id:t.id,dongtai_id:t.dongtai_id,offset:t.reply_data.offset,count:20},method:"get",success:function(i){"success"==i.message&&(t.is_reply_expanded=!0,t.reply_data.hasMore=!!i.data.has_more,t.reply_data.offset+=20,o(i.data.data,e),0===t.reply_data.offset&&(t.reply_data.reply_list=[]),t.reply_data.reply_list=t.reply_data.reply_list.concat(i.data.data),r.update())}})}function n(){for(var t=0,e=r.options.list.length;e>t;t++){var i=r.options.list[t];i.timeAgo=utils.timeAgo(i.create_time),i.diggNum=utils.numFormat(i.digg_count,1),o(i.reply_data.reply_list,t)}}function o(t,e){for(var i=0,n=t.length;n>i;i++){var o=t[i];o.parent=e,o.timeAgo=utils.timeAgo(o.create_time),o.diggNum=utils.numFormat(o.digg_count,1)}}riot.observable(this);var s,a,r=this,c=t.group_id,l=t.item_id,u=t.comment_load_count||5;this.options={list:[],hasMore:!1,isLoading:!1},this.params={group_id:c,item_id:l,offset:0,count:u},this.on("mount",function(){0==t.ban_comment&&this.init()}),this.init=function(){s=this.tags.inputBox,e("first")}.bind(this),this.onCLoadMore=function(){e()}.bind(this),this.onRLoadMore=function(t){i(t.item.item,t.item.i)}.bind(this),this.onReplyExpandClick=function(t){i(t.item.item,t.item.i)}.bind(this),this.onReplyCollapseClick=function(t){var e=t.item.item;e.is_reply_expanded=!1,e.reply_data.offset=0,e.reply_data.hasMore=!1,e.reply_data.reply_list=[]}.bind(this),this.onReplyClick=function(t){var e,i,n=t.item,o=-1,r=-1,u="#comment .J_input_",d=0,p=0;n.item?(o=n.i,u+=o,e=n.item.user.name,i=n.item.text,d=n.item.id,p=n.item.dongtai_id):(o=n.subItem.parent,r=n.j,u=u+o+"_"+r,e=n.subItem.user.name,i=n.subItem.text,d=n.subItem.id,p=n.subItem.dongtai_id),s.trigger("blur");var h=function(){a&&a.unmount(!0),a=riot.mount(u,"inputBox",{group_id:c,item_id:l,comment_id:d,dongtai_id:p,pIndex:o,subIndex:r,sourceName:e,sourceText:i})[0]};user.checkLogin({successCb:function(){h()},errorCb:function(){window.trigger("login",{successCb:function(){window.location.reload()}})}})}.bind(this),this.onReportClick=function(t){var e=t.item,i=e.item;i&&riot.mount("#comment #J_report","report",{user_id:i.user.user_id,comment_id:i.id,group_id:c,item_id:l})}.bind(this),this.onDiggClick=function(t){var e,i,n,o=t.item;if(o.item?(o=o.item,e=o.id,i=o.dongtai_id,n="/api/comment/digg/"):(o=o.subItem,e=o.id,i=o.dongtai_id,n="/api/comment/reply_digg/"),!o.user_digg){var s={comment_id:e,dongtai_id:i,group_id:c,item_id:l,action:"digg"},a=function(){http({url:n,headers:{"X-CSRFToken":Cookies.get("csrftoken")},data:s,method:"POST",success:function(t){"success"==t.message&&(o.user_digg=1,o.digg_count+=1,o.diggNum=utils.numFormat(o.digg_count,1),r.update())}})};user.checkLogin({successCb:function(){a()},errorCb:function(){window.trigger("login",{successCb:function(){window.location.reload()}})}})}}.bind(this),window.on("commentInsert",function(e){var i=Math.floor((new Date).getTime()/1e3),o={avatar_url:t.userInfo.avatarUrl,user_id:t.userInfo.id,name:t.userInfo.name},s={text:e.text,id:e.id,dongtai_id:e.dongtai_id,create_time:i,user:o,reply_data:{reply_list:[]},digg_count:0,reply_count:0};if(e.isMain)r.options.list.unshift(s);else{for(var c=0,l=r.options.list.length;l>c;c++)if(c===e.pIndex){var u=r.options.list[c].reply_data.reply_list;u.splice(e.subIndex+1,0,s);break}a&&a.unmount(!0)}n(),r.update()})}),riot.tag("inputBox",'<div class="inputBox"> <div class="y-box"> <div if="{options.isMain}" class="avatar-wrap avatar-wrap-center"> <img if="{opts.avatar}" riot-src="{opts.avatar}" alt=""> </div> <div class="input-wrap {focus: options.isFocus} {not-main: !options.isMain}"> <div class="c-textarea" ga_event="click_input_comment"> <textarea name="inputText" placeholder="写下您的{options.commitText}..." onfocus="{inputFocusClick}"></textarea> </div> <div class="c-action" ga_event="click_publish_comment"> <div class="c-submit" onclick="{onCommentClick}">{options.commitText}</div> </div> </div> </div> </div>',function(t){var e=this,i=t.group_id||0,n=t.item_id||0,o=(t.comment_id||0,t.dongtai_id||0),s=t.avatar||"",a=t.ismain||!1,r=a?"/api/comment/post_comment/":"/api/article/post_reply/";this.options={isFocus:!1,isMain:a,avatarUrl:s,commitText:a?"评论":"回复"},this.params={pIndex:t.pIndex,subIndex:t.subIndex,sourceName:t.sourceName,sourceText:t.sourceText,dongtai_id:o,isMain:a},this.on("blur",function(){this.options.isFocus=!1}),this.inputFocusClick=function(){this.options.isMain&&window.trigger("comment-mainFocus"),this.options.isFocus=!0}.bind(this),this.onCommentClick=function(){var t=this.inputText.value,s={},c={},l=function(){if(0===t.replace(/\s*/gi,"").length){var l=a?"评论":"回复";return void riot.mount("#toast","toast",{msg:l+"内容不能为空！"})}!a&&e.params.subIndex>-1&&(t=t+"//@"+e.params.sourceName+"："+e.params.sourceText),c={status:t,content:t,group_id:i,item_id:n,id:o,format:"json",aid:24},http({url:r,headers:{"X-CSRFToken":Cookies.get("csrftoken")},method:"post",data:c,success:function(i){"success"==i.message&&(s=_.extend({},e.params,{text:t,id:a?i.comment.id:i.data.comment.id}),window.trigger("commentInsert",s),e.inputText.value="",e.options.isFocus=!1,e.update())}})};user.checkLogin({successCb:function(){l()},errorCb:function(){window.trigger("login",{successCb:function(){window.location.reload()}})}})}.bind(this),window.on("comment-mainFocus",function(){e.options.isMain||e.unmount(!0)})}),riot.tag("report",'<div class="report"> <div class="report-header"> <h3>举报此人</h3> </div> <div class="report-content" onclick="{onOptionClick}"> <div class="report-option" rtype="1"> <input type="radio" name="report" id="radio-forbidden" value="0"> <label for="radio-forbidden">淫秽色情</label> </div> <div class="report-option" rtype="2"> <input type="radio" name="report" id="radio-market" value="0"> <label for="radio-market">营销广告</label> </div> <div class="report-option" rtype="3"> <input type="radio" name="report" id="radio-hostile" value="0"> <label for="radio-hostile">恶意攻击谩骂</label> </div> <div class="report-option" rtype="0"> <input type="radio" name="report" id="radio-complain" value="0"> <label for="radio-complain">我有话要说</label> </div> <textarea name="complaintext" class="complain-text" if="{params.report_type == 0}"></textarea> </div> <div class="y-box report-action"> <div class="y-left btn" onclick="{onOkClick}">确认</div> <div class="y-right btn cancel" onclick="{onCancelClick}">取消</div> </div> </div> <div class="mask"></div>',function(t){var e=this;
this.params={user_id:t.user_id,comment_id:t.comment_id,group_id:t.group_id,item_id:t.item_id,aid:13,report_type:-1},this.onOptionClick=function(t){var i=utils.getTarget(t),n=i.tagName.toLocaleLowerCase();return("input"===n||"label"===n)&&(e.params.report_type=+utils.getAttribute(i.parentNode,"rtype")),!0}.bind(this),this.onOkClick=function(){return-1==this.params.report_type?void riot.mount("#toast","toast",{msg:"请选择投诉原因！"}):0==this.params.report_type&&(this.params.content=this.complaintext.value.trim(),""==this.params.content)?void riot.mount("#toast","toast",{msg:"请填写投诉原因"}):void http({url:"/report_user/",headers:{"X-CSRFToken":Cookies.get("csrftoken")},data:e.params,method:"post",success:function(t){var i="投诉失败！";"success"==t.message&&(i="投诉成功！"),riot.mount("#toast","toast",{msg:i}),e.unmount(!0)}})}.bind(this),this.onCancelClick=function(){this.unmount(!0)}.bind(this)}),riot.tag("snsbox",'<div class="snsbox" name="snsbox"> <a href="#comment_area" class="share-count" ga_event="click_comment_anchor"> <i class="y-icon icon-comments"></i> <span>{opts.comments_count}</span> </a> <div class="share-hr"></div> <div class="share-box" onclick="{tsinaClick}" ga_event="click_share_weibo"><i class="y-icon icon-sina"></i><span>微博</span></div> <div class="share-box" onclick="{qzoneClick}" ga_event="click_share_qzone"><i class="y-icon icon-qzone"></i><span>Qzone</span></div> <div class="share-box share-weixin" onmouseenter="{weixinshare}" ga_event="click_share_weixin"> <i class="y-icon icon-wechat"></i><span>微信</span> <div class="share-qrcode"> <div></div> </div> </div> </div>',function(t){this.qzoneClick=function(){var e={url:t.share_url,text:"【（分享来自 @今日头条）"+t.abstract+"...",desc:"来自头条 http://toutiao.com"};bdshare("qzone",e)}.bind(this),this.tsinaClick=function(){var e={url:t.share_url,text:"【（分享来自 @今日头条）"+t.abstract+"...",desc:"来自头条 http://toutiao.com"};bdshare("tsina",e)}.bind(this),this.weixinshare=function(e){var i=e.target,n=t.share_url,o=qrCode(5,"M");o.addData(n),o.make(),i.getElementsByTagName("div")[1].innerHTML=o.createTableTag()}.bind(this),this.on("mount",function(){var e=this.snsbox,i=document.getElementById("J_content"),n=0;t.fix&&utils.on(window,"scroll",_.throttle(function(){var t=utils.scrollTop(),o=utils.offset(i).top,s=e.clientHeight,a=i.clientHeight;n=utils.offset(e).top>n?utils.offset(e).top:n,t>=n-20&&o+a-s-20>t?utils.addClass(e,"snsbox-fixed"):utils.removeClass(e,"snsbox-fixed")},10))})}),riot.tag("hotPicture",'<div class="module-head pic-head"><a href="/news_image/" target="_blank">精彩图片</a></div> <ul> <li class="hot-item" each="{ items }"> <a href="{article_url}" class="hot-link" target="_blank"> <div if="{gallary_flag === 1}" class="pic-style style_1"> <div class="module-pic pic-big"><img riot-src="{image_list[0].url}" alt=""></div> </div> <div if="{gallary_flag === 2}" class="pic-style style_2"> <div class="module-pic pic-middle"><img riot-src="{image_list[0].url}" alt=""></div> <div class="module-pic pic-small"><img riot-src="{image_list[1].url}" alt=""></div> <div class="module-pic pic-small"><img riot-src="{image_list[2].url}" alt=""></div> </div> <div if="{gallary_flag === 3}" class="pic-style style_3"> <div class="module-pic pic-middle"><img riot-src="{image_list[1].url}" alt=""></div> <div class="module-pic pic-small"><img riot-src="{image_list[0].url}" alt=""></div> <div class="module-pic pic-small"><img riot-src="{image_list[2].url}" alt=""></div> </div> <i if="{gallery_image_count}" class="hot-tag pic-tag"> <span>{gallery_image_count}图</span> </i> <p class="hot-title module-title">{title}</p> </a> </li> </ul>','class="hotPicture module" if="{items.length !== 0}" ga_event="click_pictures_recommend"',function(){var t=this;this.items=[],this.init=function(){this.getData()}.bind(this),this.getData=function(){http({url:"/api/pc/hot_gallery/",method:"get",data:{},success:function(e){"success"===e.message&&0!==e.data.length&&(t.items=e.data,t.update())}})}.bind(this),this.init()}),riot.tag("hotVideo",'<div class="module-head video-head"><a href="/video/" target="_blank">热门视频</a></div> <ul> <li class="hot-item" each="{ items }"> <a class="hot-link" href="{display_url}" target="_blank"> <div class="module-pic video-image"> <img riot-src="{pc_image_url}" onload="this.style.opacity=1"> </div> <i class="hot-tag video-tag"> <span>{video_duration_format}</span> </i> <p class="hot-title module-title">{title}</p> </a> </li> </ul>','class="hotVideo module" if="{items.length !== 0}" ga_event="click_video_recommend"',function(){var t=this;this.items=[],this.init=function(){this.getData()}.bind(this),this.getData=function(){http({url:"/api/pc/hot_video/",method:"get",data:{},success:function(e){this.loading=!1,"success"===e.message&&0!==e.data.length&&(t.items=e.data,t.show=!0,t.update())}})}.bind(this),this.init()}),!function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define("static/js/lib/qrcode",[],i):e[t]=i()}("qrCode",this,function(){function t(e,i){if("undefined"==typeof e.length)throw new Error(e.length+"/"+i);var n=function(){for(var t=0;t<e.length&&0==e[t];)t+=1;for(var n=new Array(e.length-t+i),o=0;o<e.length-t;o+=1)n[o]=e[o+t];return n}(),o={};return o.get=function(t){return n[t]},o.getLength=function(){return n.length},o.multiply=function(e){for(var i=new Array(o.getLength()+e.getLength()-1),n=0;n<o.getLength();n+=1)for(var s=0;s<e.getLength();s+=1)i[n+s]^=a.gexp(a.glog(o.get(n))+a.glog(e.get(s)));return t(i,0)},o.mod=function(e){if(o.getLength()-e.getLength()<0)return o;for(var i=a.glog(o.get(0))-a.glog(e.get(0)),n=new Array(o.getLength()),s=0;s<o.getLength();s+=1)n[s]=o.get(s);for(var s=0;s<e.getLength();s+=1)n[s]^=a.gexp(a.glog(e.get(s))+i);return t(n,0).mod(e)},o}var e=function(e,i){var o=236,a=17,u=e,d=n[i],p=null,g=0,f=null,v=new Array,_={},b=function(t,e){g=4*u+17,p=function(t){for(var e=new Array(t),i=0;t>i;i+=1){e[i]=new Array(t);for(var n=0;t>n;n+=1)e[i][n]=null}return e}(g),w(0,0),w(g-7,0),w(0,g-7),C(),k(),T(t,e),u>=7&&x(t),null==f&&(f=B(u,d,v)),M(f,e)},w=function(t,e){for(var i=-1;7>=i;i+=1)if(!(-1>=t+i||t+i>=g))for(var n=-1;7>=n;n+=1)-1>=e+n||e+n>=g||(p[t+i][e+n]=i>=0&&6>=i&&(0==n||6==n)||n>=0&&6>=n&&(0==i||6==i)||i>=2&&4>=i&&n>=2&&4>=n?!0:!1)},y=function(){for(var t=0,e=0,i=0;8>i;i+=1){b(!0,i);var n=s.getLostPoint(_);(0==i||t>n)&&(t=n,e=i)}return e},k=function(){for(var t=8;g-8>t;t+=1)null==p[t][6]&&(p[t][6]=t%2==0);for(var e=8;g-8>e;e+=1)null==p[6][e]&&(p[6][e]=e%2==0)},C=function(){for(var t=s.getPatternPosition(u),e=0;e<t.length;e+=1)for(var i=0;i<t.length;i+=1){var n=t[e],o=t[i];if(null==p[n][o])for(var a=-2;2>=a;a+=1)for(var r=-2;2>=r;r+=1)p[n+a][o+r]=-2==a||2==a||-2==r||2==r||0==a&&0==r?!0:!1}},x=function(t){for(var e=s.getBCHTypeNumber(u),i=0;18>i;i+=1){var n=!t&&1==(e>>i&1);p[Math.floor(i/3)][i%3+g-8-3]=n}for(var i=0;18>i;i+=1){var n=!t&&1==(e>>i&1);p[i%3+g-8-3][Math.floor(i/3)]=n}},T=function(t,e){for(var i=d<<3|e,n=s.getBCHTypeInfo(i),o=0;15>o;o+=1){var a=!t&&1==(n>>o&1);6>o?p[o][8]=a:8>o?p[o+1][8]=a:p[g-15+o][8]=a}for(var o=0;15>o;o+=1){var a=!t&&1==(n>>o&1);8>o?p[8][g-o-1]=a:9>o?p[8][15-o-1+1]=a:p[8][15-o-1]=a}p[g-8][8]=!t},M=function(t,e){for(var i=-1,n=g-1,o=7,a=0,r=s.getMaskFunction(e),c=g-1;c>0;c-=2)for(6==c&&(c-=1);;){for(var l=0;2>l;l+=1)if(null==p[n][c-l]){var u=!1;a<t.length&&(u=1==(t[a]>>>o&1));var d=r(n,c-l);d&&(u=!u),p[n][c-l]=u,o-=1,-1==o&&(a+=1,o=7)}if(n+=i,0>n||n>=g){n-=i,i=-i;break}}},A=function(e,i){for(var n=0,o=0,a=0,r=new Array(i.length),c=new Array(i.length),l=0;l<i.length;l+=1){var u=i[l].dataCount,d=i[l].totalCount-u;o=Math.max(o,u),a=Math.max(a,d),r[l]=new Array(u);for(var p=0;p<r[l].length;p+=1)r[l][p]=255&e.getBuffer()[p+n];n+=u;var h=s.getErrorCorrectPolynomial(d),m=t(r[l],h.getLength()-1),g=m.mod(h);c[l]=new Array(h.getLength()-1);for(var p=0;p<c[l].length;p+=1){var f=p+g.getLength()-c[l].length;c[l][p]=f>=0?g.get(f):0}}for(var v=0,p=0;p<i.length;p+=1)v+=i[p].totalCount;for(var _=new Array(v),b=0,p=0;o>p;p+=1)for(var l=0;l<i.length;l+=1)p<r[l].length&&(_[b]=r[l][p],b+=1);for(var p=0;a>p;p+=1)for(var l=0;l<i.length;l+=1)p<c[l].length&&(_[b]=c[l][p],b+=1);return _},B=function(t,e,i){for(var n=r.getRSBlocks(t,e),l=c(),u=0;u<i.length;u+=1){var d=i[u];l.put(d.getMode(),4),l.put(d.getLength(),s.getLengthInBits(d.getMode(),t)),d.write(l)}for(var p=0,u=0;u<n.length;u+=1)p+=n[u].dataCount;if(l.getLengthInBits()>8*p)throw new Error("code length overflow. ("+l.getLengthInBits()+">"+8*p+")");for(l.getLengthInBits()+4<=8*p&&l.put(0,4);l.getLengthInBits()%8!=0;)l.putBit(!1);for(;!(l.getLengthInBits()>=8*p)&&(l.put(o,8),!(l.getLengthInBits()>=8*p));)l.put(a,8);return A(l,n)};return _.addData=function(t){var e=l(t);v.push(e),f=null},_.isDark=function(t,e){if(0>t||t>=g||0>e||e>=g)throw new Error(t+","+e);return p[t][e]},_.getModuleCount=function(){return g},_.make=function(){b(!1,y())},_.createTableTag=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+='">',i+="<tbody>";for(var n=0;n<_.getModuleCount();n+=1){i+="<tr>";for(var o=0;o<_.getModuleCount();o+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+t+"px;",i+=" height: "+t+"px;",i+=" background-color: ",i+=_.isDark(n,o)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return i+="</tbody>",i+="</table>"},_.createImg=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var i=_.getModuleCount()*t+2*e,n=e,o=i-e,s=h(i,i,function(e,i){if(e>=n&&o>e&&i>=n&&o>i){var s=Math.floor((e-n)/t),a=Math.floor((i-n)/t);return _.isDark(a,s)?0:1}return 1});return{width:i,height:i,src:s}},_.createImgTag=function(t,e){var i=this.createImg(t,e);return m(i.width,i.height,i.src)},_};e.stringToBytes=function(t){for(var e=new Array,i=0;i<t.length;i+=1){var n=t.charCodeAt(i);e.push(255&n)}return e},e.createStringToBytes=function(t,e){var i=function(){for(var i=d(t),n=function(){var t=i.read();if(-1==t)throw new Error;return t},o=0,s={};;){var a=i.read();if(-1==a)break;var r=n(),c=n(),l=n(),u=String.fromCharCode(a<<8|r),p=c<<8|l;s[u]=p,o+=1}if(o!=e)throw new Error(o+" != "+e);return s}(),n="?".charCodeAt(0);return function(t){for(var e=new Array,o=0;o<t.length;o+=1){var s=t.charCodeAt(o);if(128>s)e.push(s);else{var a=i[t.charAt(o)];"number"==typeof a?(255&a)==a?e.push(a):(e.push(a>>>8),e.push(255&a)):e.push(n)}}return e}};var i={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},o={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},s=function(){var e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=1335,s=7973,r=21522,c={},l=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e};return c.getBCHTypeInfo=function(t){for(var e=t<<10;l(e)-l(n)>=0;)e^=n<<l(e)-l(n);return(t<<10|e)^r},c.getBCHTypeNumber=function(t){for(var e=t<<12;l(e)-l(s)>=0;)e^=s<<l(e)-l(s);return t<<12|e},c.getPatternPosition=function(t){return e[t-1]},c.getMaskFunction=function(t){switch(t){case o.PATTERN000:return function(t,e){return(t+e)%2==0};case o.PATTERN001:return function(t){return t%2==0};case o.PATTERN010:return function(t,e){return e%3==0};case o.PATTERN011:return function(t,e){return(t+e)%3==0};case o.PATTERN100:return function(t,e){return(Math.floor(t/2)+Math.floor(e/3))%2==0};case o.PATTERN101:return function(t,e){return t*e%2+t*e%3==0};case o.PATTERN110:return function(t,e){return(t*e%2+t*e%3)%2==0};case o.PATTERN111:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw new Error("bad maskPattern:"+t)}},c.getErrorCorrectPolynomial=function(e){for(var i=t([1],0),n=0;e>n;n+=1)i=i.multiply(t([1,a.gexp(n)],0));return i},c.getLengthInBits=function(t,e){if(e>=1&&10>e)switch(t){case i.MODE_NUMBER:return 10;case i.MODE_ALPHA_NUM:return 9;case i.MODE_8BIT_BYTE:return 8;case i.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case i.MODE_NUMBER:return 12;case i.MODE_ALPHA_NUM:return 11;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case i.MODE_NUMBER:return 14;case i.MODE_ALPHA_NUM:return 13;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},c.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,n=0;e>n;n+=1)for(var o=0;e>o;o+=1){for(var s=0,a=t.isDark(n,o),r=-1;1>=r;r+=1)if(!(0>n+r||n+r>=e))for(var c=-1;1>=c;c+=1)0>o+c||o+c>=e||(0!=r||0!=c)&&a==t.isDark(n+r,o+c)&&(s+=1);s>5&&(i+=3+s-5)}for(var n=0;e-1>n;n+=1)for(var o=0;e-1>o;o+=1){var l=0;t.isDark(n,o)&&(l+=1),t.isDark(n+1,o)&&(l+=1),t.isDark(n,o+1)&&(l+=1),t.isDark(n+1,o+1)&&(l+=1),(0==l||4==l)&&(i+=3)}for(var n=0;e>n;n+=1)for(var o=0;e-6>o;o+=1)t.isDark(n,o)&&!t.isDark(n,o+1)&&t.isDark(n,o+2)&&t.isDark(n,o+3)&&t.isDark(n,o+4)&&!t.isDark(n,o+5)&&t.isDark(n,o+6)&&(i+=40);for(var o=0;e>o;o+=1)for(var n=0;e-6>n;n+=1)t.isDark(n,o)&&!t.isDark(n+1,o)&&t.isDark(n+2,o)&&t.isDark(n+3,o)&&t.isDark(n+4,o)&&!t.isDark(n+5,o)&&t.isDark(n+6,o)&&(i+=40);for(var u=0,o=0;e>o;o+=1)for(var n=0;e>n;n+=1)t.isDark(n,o)&&(u+=1);var d=Math.abs(100*u/e/e-50)/5;return i+=10*d},c}(),a=function(){for(var t=new Array(256),e=new Array(256),i=0;8>i;i+=1)t[i]=1<<i;for(var i=8;256>i;i+=1)t[i]=t[i-4]^t[i-5]^t[i-6]^t[i-8];for(var i=0;255>i;i+=1)e[t[i]]=i;var n={};return n.glog=function(t){if(1>t)throw new Error("glog("+t+")");return e[t]},n.gexp=function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return t[e]},n}(),r=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],e=function(t,e){var i={};return i.totalCount=t,i.dataCount=e,i},i={},o=function(e,i){switch(i){case n.L:return t[4*(e-1)+0];case n.M:return t[4*(e-1)+1];case n.Q:return t[4*(e-1)+2];case n.H:return t[4*(e-1)+3];default:return void 0}};return i.getRSBlocks=function(t,i){var n=o(t,i);if("undefined"==typeof n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+i);for(var s=n.length/3,a=new Array,r=0;s>r;r+=1)for(var c=n[3*r+0],l=n[3*r+1],u=n[3*r+2],d=0;c>d;d+=1)a.push(e(l,u));return a},i}(),c=function(){var t=new Array,e=0,i={};return i.getBuffer=function(){return t},i.get=function(e){var i=Math.floor(e/8);return 1==(t[i]>>>7-e%8&1)},i.put=function(t,e){for(var n=0;e>n;n+=1)i.putBit(1==(t>>>e-n-1&1))},i.getLengthInBits=function(){return e},i.putBit=function(i){var n=Math.floor(e/8);t.length<=n&&t.push(0),i&&(t[n]|=128>>>e%8),e+=1},i},l=function(t){var n=i.MODE_8BIT_BYTE,o=e.stringToBytes(t),s={};return s.getMode=function(){return n},s.getLength=function(){return o.length},s.write=function(t){for(var e=0;e<o.length;e+=1)t.put(o[e],8)},s},u=function(){var t=new Array,e={};return e.writeByte=function(e){t.push(255&e)},e.writeShort=function(t){e.writeByte(t),e.writeByte(t>>>8)},e.writeBytes=function(t,i,n){i=i||0,n=n||t.length;for(var o=0;n>o;o+=1)e.writeByte(t[o+i])},e.writeString=function(t){for(var i=0;i<t.length;i+=1)e.writeByte(t.charCodeAt(i))},e.toByteArray=function(){return t},e.toString=function(){var e="";e+="[";for(var i=0;i<t.length;i+=1)i>0&&(e+=","),e+=t[i];return e+="]"},e},d=function(t){var e=t,i=0,n=0,o=0,s={};s.read=function(){for(;8>o;){if(i>=e.length){if(0==o)return-1;throw new Error("unexpected end of file./"+o)}var t=e.charAt(i);if(i+=1,"="==t)return o=0,-1;t.match(/^\s$/)||(n=n<<6|a(t.charCodeAt(0)),o+=6)}var s=n>>>o-8&255;return o-=8,s};var a=function(t){if(t>=65&&90>=t)return t-65;if(t>=97&&122>=t)return t-97+26;if(t>=48&&57>=t)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw new Error("c:"+t)};return s},p=function(t,e){var i=t,n=e,o=new Array(t*e),s={};s.setPixel=function(t,e,n){o[e*i+t]=n},s.write=function(t){t.writeString("GIF87a"),t.writeShort(i),t.writeShort(n),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(i),t.writeShort(n),t.writeByte(0);var e=2,o=r(e);t.writeByte(e);for(var s=0;o.length-s>255;)t.writeByte(255),t.writeBytes(o,s,255),s+=255;t.writeByte(o.length-s),t.writeBytes(o,s,o.length-s),t.writeByte(0),t.writeString(";")};var a=function(t){var e=t,i=0,n=0,o={};return o.write=function(t,o){if(t>>>o!=0)throw new Error("length over");for(;i+o>=8;)e.writeByte(255&(t<<i|n)),o-=8-i,t>>>=8-i,n=0,i=0;n=t<<i|n,i+=o},o.flush=function(){i>0&&e.writeByte(n)},o},r=function(t){for(var e=1<<t,i=(1<<t)+1,n=t+1,s=c(),r=0;e>r;r+=1)s.add(String.fromCharCode(r));s.add(String.fromCharCode(e)),s.add(String.fromCharCode(i));var l=u(),d=a(l);d.write(e,n);var p=0,h=String.fromCharCode(o[p]);for(p+=1;p<o.length;){var m=String.fromCharCode(o[p]);p+=1,s.contains(h+m)?h+=m:(d.write(s.indexOf(h),n),s.size()<4095&&(s.size()==1<<n&&(n+=1),s.add(h+m)),h=m)}return d.write(s.indexOf(h),n),d.write(i,n),d.flush(),l.toByteArray()},c=function(){var t={},e=0,i={};return i.add=function(n){if(i.contains(n))throw new Error("dup key:"+n);t[n]=e,e+=1},i.size=function(){return e},i.indexOf=function(e){return t[e]},i.contains=function(e){return"undefined"!=typeof t[e]},i};return s},h=function(t,e,i){for(var n=p(t,e),o=0;e>o;o+=1)for(var s=0;t>s;s+=1)n.setPixel(s,o,i(s,o));var a=u();n.write(a);var r=a.toByteArray(),c=new Buffer(r);return"data:image/gif;base64,"+c.toString("base64")},m=function(t,e,i,n){var o="";return o+="<img",o+=' src="',o+=i,o+='"',o+=' width="',o+=t,o+='"',o+=' height="',o+=e,o+='"',n&&(o+=' alt="',o+=n,o+='"'),o+="/>"};return e}),!function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define("static/js/lib/bdshare",[],i):e[t]=i()}("bdshare",this,function(){var t="6649976",e="http://s.share.baidu.com/",i=function(){var t=(new Date).getTime(),e=(new Date).getTime()+1e3,i=(new Date).getTime()+3e3;return t.toString(32)+e.toString(32)+i.toString(32)},n=function(t,e){for(var i=t.length,n="",o=1;e>=o;o++){var s=Math.floor(i*Math.random());n+=t.charAt(s)}return n},o=function(){var t=(new Date).toString(36),e=n("0123456789abcdefghijklmnopqrstuvwxyz",3);return t+e},s=function(n,s){s=s||{};var a=i(),r=0,c="",l=document.title,u=s.wbuid||"",d=o(),p=(window.isAppPage?"app":"detail/list",encodeURIComponent(s.pic||"")),h=encodeURIComponent(s.url||""),m=encodeURIComponent(s.comment||""),g=encodeURIComponent(s.desc||"");"tsina"===n?l=(s.text||l)+(s.weibotext||c):("tqq"===n&&(s.text=s.text.replace("@今日头条","@headlineapp")),l=s.text||l),l=encodeURIComponent(l.substring(0,300));var f="?click=1&url="+h+"&uid="+t+"&to="+n+"&type=text&relateUid="+u+"&pic="+p+"&title="+l+"&key=&sign=on&desc="+g+"&comment="+m+"&searchPic=0&l="+a+"&linkid="+d+"&sloc=&apiType=0&buttonType="+r,v=e+f,_=e+"commit"+f+"&t="+Math.random(),b=function(){var t=[];return function(e){var i=t.push(new Image)-1;t[i].onload=function(){t[i]=t[i].onload=null},t[i].src=e}}();setTimeout(function(){b(_)},1500),window.open(v,"_blank","height=500,width=700,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no")};return s}),riot.tag("actionBox",'<div class="repin " onclick="{sendRequest}" > <i class="y-icon icon-favorite {repin: options.repin}"></i><span>收藏</span> </div> <a href="javascript:;" class="areport" onclick="{onReportClick}"> <i class="y-icon icon-report"></i><span>举报</span> </a> <div id="J_articleReport"></div>','class="actionBox"',function(t){var e=t.group_id;this.options={repin:t.repin},this.sendRequest=function(){var e=this,i=1==e.options.repin?"unrepin":"repin",n="/group/article/"+t.group_id+"/"+i+"/",o=function(){http({headers:{"X-CSRFToken":Cookies.get("csrftoken")},url:n,method:"post",success:function(t){"success"==t.message&&(e.options.repin="repin"==i?1:0),e.update()}})};user.checkLogin({successCb:function(){o()},errorCb:function(){window.trigger("login",{successCb:function(t){window.trigger("userChange",t),o()}})}})}.bind(this),this.onReportClick=function(){user.checkLogin({successCb:function(){riot.mount(".actionBox #J_articleReport","articleReport",{group_id:e})},errorCb:function(){window.trigger("login",{successCb:function(t){window.trigger("userChange",t),riot.mount(".actionBox #J_articleReport","articleReport",{group_id:e})}})}})}.bind(this)}),riot.mount("actionBox",{group_id:group.id,repin:group.repin}),function(){for(var t=document.querySelectorAll(".article-content p"),e=0,i=t.length;i>e;e++){var n=t[e],o=n.innerHTML,s=o.length;o=o.replace(/&nbsp/g," ").trim(),s!==o.length&&(n.innerHTML=o)}}(window,document),riot.tag("subscribe",'<div class="subscribe" ga_event="follow_pgc"> <div if="{opts.like == true}" class="article-subscribe left-arrow" onclick="{subscribe}"> <i class="y-icon icon-check"></i><span>已关注</span> </div> <div if="{opts.like == false}" class="article-unsubscribe left-arrow" onclick="{unsubscribe}"> <span>立即关注</span> </div> </div>',function(t){this.sendRequest=function(e){var i=this,n=t.media_id,o="/pgc/"+e+"/",s=function(){http({headers:{"X-CSRFToken":Cookies.get("csrftoken")},url:o,method:"post",data:{media_id:n},success:function(n){"success"===n.message&&(t.like="like"==e?!0:!1,i.update())}})};user.checkLogin({successCb:function(){s()},errorCb:function(){window.trigger("login",{successCb:function(t){window.trigger("userChange",t),s()}})}})}.bind(this),this.subscribe=function(){this.sendRequest("unlike")}.bind(this),this.unsubscribe=function(){this.sendRequest("like")}.bind(this)}),riot.mount("subscribe",{media_id:media.id,like:media.like}),riot.tag("articleReport",'<div class="articleReport"> <div class="header"> 举报文章问题 <span onclick="{onReportCloseClick}"><i class="y-icon icon-close-popover"></i></span> </div> <div class="content"> <div class="option"> <label for="c-1">广告</label> <input type="checkbox" name="report" id="c-1" rtype="23" value="0"> </div> <div class="option"> <label for="c-2">重复、旧闻</label> <input type="checkbox" name="report" id="c-2" rtype="1" value="0"> </div> <div class="option"> <label for="c-3">格式问题</label> <input type="checkbox" name="report" id="c-3" rtype="3" value="0"> </div> <div class="option"> <label for="c-4">低俗</label> <input type="checkbox" name="report" id="c-4" rtype="14" value="0"> </div> <div class="option"> <label for="c-4">标题夸张</label> <input type="checkbox" name="report" id="c-5" rtype="15" value="0"> </div> <div class="option"> <label for="c-4">与事实不符</label> <input type="checkbox" name="report" id="c-6" rtype="17" value="0"> </div> <div class="option"> <label for="c-4">疑似抄袭</label> <input type="checkbox" name="report" id="c-7" rtype="18" value="0"> </div> <div class="option"> <p class="{active: options.complain}" onclick="{onExpandClick}">其他问题，我要吐槽<i class="y-icon icon-more"></i></p> <textarea if="{options.complain}" name="complaintext"></textarea> </div> <div class="ok-btn" onclick="{onOkClick}">确定</div> </div> </div> <div class="mask"></div>',function(t){var e=this;this.options={complain:!1};var i={group_id:t.group_id||0,app_name:"toutiao_web",aid:24,report_type:"",report_content:""};this.onReportCloseClick=function(){this.unmount(!0)}.bind(this),this.onExpandClick=function(){this.options.complain=!this.options.complain}.bind(this),this.onOkClick=function(){for(var t,n=document.querySelectorAll(".articleReport .option input"),o=[],s=0,a=n.length;a>s;s++)t=n[s],t.checked&&o.push(utils.getAttribute(t,"rtype"));return this.options.complain&&""!=this.complaintext.value.trim()&&(o.push(0),i.report_content=this.complaintext.value.trim()),0==o.length?void riot.mount("#toast","toast",{msg:"请填写投诉原因"}):(i.report_type=o.join(","),void http({url:"/api/article/report/",headers:{"X-CSRFToken":Cookies.get("csrftoken")},data:i,method:"post",success:function(t){var i="投诉失败！";"success"==t.message&&(i="投诉成功！"),riot.mount("#toast","toast",{msg:i}),e.unmount(!0)}}))}.bind(this)}),riot.tag("relatedChannel",'<div name="relatedChannel" class="relatedChannel {relatedChannel-fixed: options.isSuspendion}" ga_event="related_channel_click"> <h2 class="relatedChannel-header">相关推荐</h2> <ul class="relatedChannel-list"> <li each="{item, i in options.navItem}" onclick="{onItemClick}"> <a class="relatedChannel-item {active: item.tag == options.tag}" href="javacript:;"> <i show="{options.abType==1}" class="y-icon icon-refreshfeed {channel-refresh: options.isRefresh}"></i><span>{item.name}</span> </a> </li> </ul> </div>',function(t){var e=this;this.options={navItem:[{name:"推荐",tag:"__all__"},{name:"热点",tag:"news_hot"},{name:"社会",tag:"news_society"},{name:"娱乐",tag:"news_entertainment"},{name:"科技",tag:"news_tech"},{name:"体育",tag:"news_sports"}],isSuspendion:!1,tag:t.tag,isRefresh:!1},this.onItemClick=function(t){var e=t.item.item;e.tag!==this.options.tag&&(this.options.tag=e.tag,window.trigger("feedTagChange",e.tag))}.bind(this),window.on("commentReady",function(){var t=document.getElementById("J_cut_line");utils.on(window,"scroll",_.throttle(function(){var i=utils.scrollTop(),n=utils.offset(t).top;e.options.isSuspendion=i>n-20?!0:!1,e.update()},10))})}),riot.tag("loading",'<div if="{options.cssAnimation}" class="loading ball-pulse"> <div></div> <div></div> <div></div> <span>{options.msg}&sdot;&sdot;&sdot;</span> </div> <div if="{!options.cssAnimation}" class="loading loading-normal"> <img src="//s3b.pstatp.com/toutiao/resource/toutiao_web/static/style/image/loading_50c5e3e.gif" alt=""> <span>{options.msg}&sdot;&sdot;&sdot;</span> </div>',function(t){var e=utils.cssAnimationSupport();this.options={cssAnimation:e,msg:t.msg||"推荐中"}}),riot.tag("relatedFeed",'<div class="relatedFeed"> <ul> <li class="item {item-hidden: item.honey} {J_add: item.ad_id}" each="{item, i in opts.list}" ga_event="{item.article_genre}_item_click" ad_id="{item.ad_id}" ad_track="{item.ad_track_url}" onclick="{onItemClick}"> <span id="ad_extra" style="display:none;">{item.log_extra}</span> <div if="{!item.feedMsg}" class="item-inner y-box"> <div class="normal {rbox: item.single_mode} {no-image: !item.single_mode&&!item.has_gallery}"> <div class="rbox-inner"> <div class="title-box" ga_event="{item.article_genre}_title_click"> <a class="link title" href="{item.source_url}" target="_blank"> {item.title} </a> </div> <div if="{item.has_gallery}" class="img-list y-box" ga_event="{item.article_genre}_img_click"> <a each="{imgItem, j in item.image_list}" class="img-wrap" href="{item.source_url}" target="_blank"> <img riot-src="{imgItem.url}" alt=""> </a> <a if="{item.image_list.length < 4}" class="img-wrap" href="{item.source_url}" target="_blank"> <span class="add-info">查看详情&nbsp;<i class="y-icon icon-next-page"></i></span> </a> <span if="{!item.ad_id}" class="img-num">{item.gallary_image_count}图</span> </div> <div class="y-box footer"> <div class="y-left"> <div class="y-left" if="{!item.media_url}"> <a class="lbtn media-avatar avatar-bg-{parent.sourceFlag(item.source, i)}" href="/search/?keyword={item.source}" ga_event="{item.article_genre}_avatar_click" target="_blank">{parent.sourceHandle(item.source)}</a> <a class="lbtn source" href="http://www.toutiao.com/search/?keyword={item.source}" ga_event="{item.article_genre}_name_click" target="_blank">&nbsp;{item.source}&nbsp;</a> </div> <div class="y-left" if="{item.media_url}"> <a class="lbtn media-avatar" ga_event="{item.article_genre}_avatar_click" href="{item.media_url}" target="_blank"> <img riot-src="{item.media_avatar_url}" alt=""> </a> <a class="lbtn source" ga_event="{item.article_genre}_name_click" href="{item.media_url}" target="_blank">&nbsp;{item.source}&nbsp;</a> </div> <a class="lbtn comment" ga_event="{item.article_genre}_comment_click" href="{item.source_url}/#comment_area" target="_blank">&sdot;&nbsp;{item.comments_count}评论&nbsp;</a> <span if="{item.timeago}" class="lbtn">&sdot;&nbsp;{item.timeago}</span> <span if="{item.is_related}" class="lbtn recommend">相关</span> <span if="{item.hot}" class="lbtn tag-hot">热</span> <span if="{item.ad_id}" class="lbtn recommend">{item.ad_label}</span> </div> <div class="y-right"> <span class="dislike" data-groupid="{item.group_id}" ga_event="{item.article_genre}_dislike_click" onclick="{onDislikeClick}"> 不感兴趣 <i class="y-icon icon-dislikenewfeed"></i> </span> </div> </div> </div> </div> <div if="{item.single_mode}" class="lbox" ga_event="{item.article_genre}_img_click"> <a class="img-wrap" href="{item.source_url}" target="_blank"> <img riot-src="{item.image_url}" alt=""> <i if="{item.has_video && item.video_duration_str}" class="ftype video"> <span>{item.video_duration_str}</span> </i> </a> </div> </div> </li> </ul> </div>',function(t){var e=this,i=(t.abtype,{});this.onDislikeClick=function(t){user.checkLogin({successCb:function(){e._dislike(t.item)},errorCb:function(){window.trigger("login",{successCb:function(i){window.trigger("userChange",i),e._dislike(t.item)}})}})}.bind(this),this._dislike=function(i){http({url:"/api/dislike/",data:{group_id:i.item.group_id,action:"dislike",app_name:"toutiao_web"},method:"post",success:function(n){"success"===n.message&&(t.list.splice(i.i,1),e.update())}})}.bind(this),this.onItemClick=function(t){var e=t.item.item;return e.ad_id&&tAdMonitor&&tAdMonitor.sendMsg({label:"click",value:e.ad_id,extra:e.log_extra}),e.is_diversion_page&&taAnalysis&&taAnalysis.send("event",{ev:"diversion_page_click"}),!0}.bind(this),this.sourceFlag=function(t,e){return(t=t.replace(/\s*/gi,""))?(void 0===i[t]&&(i[t]=e%6),i[t]):0}.bind(this),this.sourceHandle=function(t){return t=t.replace(/\s*/gi,""),t?t.slice(0,1):""}.bind(this),this.on("updated",function(){if(tAdMonitor){var t=document.querySelectorAll(".relatedFeed .J_add");t&&tAdMonitor.setAds(t)}})}),riot.tag("feedBox",'<div class="feedBox" name="feedbox"> <div class="tt-declare">以下内容由今日头条提供</div> <div class="tt-related-title">相关推荐</div> <div if="{options.isRefresh}" riot-tag="loading"></div> <div riot-tag="relatedFeed" list="{options.list}"></div> <div if="{options.isLoadmore}" riot-tag="loading"></div>  </div>',function(t){function e(){var t=a.options.siblingList.length;t>0&&(a.options.list=a.options.siblingList,o(),a.update()),5>=t&&a.loadMoreClick()}function i(t,e){if(!r){r=!0;var i=n();http({url:c,method:"get",data:i,type:l,success:function(i){"success"===i.message&&("refresh"===t&&(a.options.list=[]),a.options.list=a.options.list.concat(i.data),o(),a.params.max_behot_time=i.next&&i.next.max_behot_time||0),r=!1,e&&e(i),a.update()}})}}function n(){var t,e=ascp.getHoney();return t=_.extend({},a.params,{as:e.as,cp:e.cp})}function o(){for(var t=0;t<a.options.list.length;t++){var e=a.options.list[t];e.timeago=utils.timeAgo(e.behot_time)}}function s(){var t=a.feedbox,e=utils.offset(t).top;window.scrollTo(0,e-20)}riot.observable(this);var a=this,r=!1,c="/api/pc/feed/",l="json";this.options={siblingList:t.siblingList,list:[],isRefresh:!1,isLoadmore:!1},this.params={category:"__all__",utm_source:"toutiao",max_behot_time:0,widen:1},this.on("mount",function(){t.group_id&&(c="http://www.toutiao.com/api/article/related/",l="jsonp",this.params.group_id=t.group_id),e(),!t.group_id&&utils.on(window,"scroll",_.throttle(function(){var t=utils.scrollTop(),e=a.feedbox.clientHeight,i=utils.offset(a.feedbox).top,n=window.screen.height;
600>e+i-t-n&&a.loadMoreClick()},350))}),window.on("feedTagChange",function(t){a.params.category=t,a.params.max_behot_time=0,s(),"__all__"===t?e():(a.options.isRefresh=!0,a.update(),i("refresh",function(){a.options.isRefresh=!1}))}),this.loadMoreClick=function(){a.options.isLoadmore=!0,a.update(),i("loadmore",function(){a.options.isLoadmore=!1})}.bind(this)}),riot.tag("feedback",'<ul> <li class="tool-item" onclick="{goTop}" ga_event="go_top_click"> <a href="javascript:;"> <i class="y-icon icon-backtotopfeed"></i> </a> </li> </ul>','class="feedback" if="{options.toolShow}"',function(){var t=this;this.options={toolShow:!1},this.goTop=function(){window.scrollTo(0,0)}.bind(this),utils.on(window,"scroll",_.throttle(function(){var e=utils.scrollTop();t.options.toolShow=e>180?!0:!1,t.update()},80))}),function(){var t,e=document.getElementById("J_cut_line"),i=function(){var t=e.getBoundingClientRect(),i=utils.getWinSize();return t.bottom<=20||t.top+20<i.winHeight?(riot.mount("feedBox",{siblingList:siblingList||[]}),!0):!1};i()||(t=utils.on(window,"scroll",_.throttle(function(){i()&&utils.off(window,"scroll",t)},50)));var n=document.getElementById("adindexhover"),o=document.getElementById("J_rindex");roffsetTop=utils.offset(o).top,utils.on(window,"scroll",_.throttle(function(){var t=o.clientHeight,e=utils.scrollTop();n.style.display=t+roffsetTop+20>e?"none":"block"},100))}();