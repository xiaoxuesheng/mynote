<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0043)http://love398146779.iteye.com/blog/2123802 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客</title>
    <meta name="description" content="一、创建一个maven的webproject，叫file-manager:mvnarchetype:create-DgroupId=platform.activity.filemanager-DartifactId=file-manager-DarchetypeArtifactId=maven-archetype-webapp 二、定义一个fastDFS的客户端文件fdfs_client.conf： ...">
    <meta name="keywords" content=" fastdfs使用实战（Java实例篇）">
    <link rel="shortcut icon" href="http://love398146779.iteye.com/images/favicon.ico" type="image/x-icon">
    <link rel="search" type="application/opensearchdescription+xml" href="http://love398146779.iteye.com/open_search.xml" title="ITeye">
    <link href="http://love398146779.iteye.com/rss" rel="alternate" title="张守磊" type="application/rss+xml">
    <link href="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/blog.css" media="screen" rel="stylesheet" type="text/css">
<link href="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/blue.css" media="screen" rel="stylesheet" type="text/css">
    <script type="text/javascript" async="" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/pr.js.下载"></script><script type="text/javascript" async="" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/hlfjifjlzidblrbfjzb.js.下载"></script><script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/ca-pub-8990951720398508.js.下载"></script><script type="text/javascript" async="" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tccm"></script><script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/push.js.下载"></script><script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/hm.js.下载"></script><script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/application.js.下载" type="text/javascript"></script>    
    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?e19a8b00cf63f716d774540875007664";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);


        //自动推送工具代码
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>



      <link href="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/SyntaxHighlighter.css" media="screen" rel="stylesheet" type="text/css">
  <script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/shCoreCommon.js.下载" type="text/javascript"></script>
<script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/hotkey.js.下载" type="text/javascript"></script>
  <script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/code_favorites.js.下载" type="text/javascript"></script>
<script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/weiboshare.js.下载" type="text/javascript"></script>

    <!-- 请置于所有广告位代码之前 -->
    <script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/ds.js.下载"></script>

  <link rel="preload" href="https://adservice.google.com.hk/adsid/integrator.js?domain=love398146779.iteye.com" as="script"><script type="text/javascript" src="https://adservice.google.com.hk/adsid/integrator.js?domain=love398146779.iteye.com"></script><link rel="preload" href="https://adservice.google.com/adsid/integrator.js?domain=love398146779.iteye.com" as="script"><script type="text/javascript" src="https://adservice.google.com/adsid/integrator.js?domain=love398146779.iteye.com"></script><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style><link rel="prefetch" href="https://securepubads.g.doubleclick.net/static/3p_cookie.html"></head>
  <body><div id="BAIDU_DUP_fp_wrapper" style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;"><iframe id="BAIDU_DUP_fp_iframe" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/o.html" style="width: 0px; height: 0px; visibility: hidden; display: none;"></iframe></div>
    <div id="header">
	      <div id="blog_site_nav">
  <a href="http://www.iteye.com/" class="homepage">首页</a>
  <a href="http://www.iteye.com/news">资讯</a>
  <a href="http://www.iteye.com/magazines">精华</a>
  <a href="http://www.iteye.com/forums">论坛</a>
  <a href="http://www.iteye.com/ask">问答</a>
  <a href="http://www.iteye.com/blogs">博客</a>
  <a href="http://www.iteye.com/blogs/subjects">专栏</a>
  <a href="http://www.iteye.com/groups">群组</a>
  <a href="http://love398146779.iteye.com/blog/2123802#" onclick="return false;" id="msna"><u>更多</u> <small>▼</small></a>
  <div class="quick_menu" style="display:none;">
    <a target="_blank" href="http://job.iteye.com/iteye">知识库</a>
    <a href="http://www.iteye.com/search">搜索</a>
  </div>
</div>

	      <div id="user_nav">

      <a href="http://love398146779.iteye.com/login" class="welcome" title="登录">您还未登录 !</a>
    <a href="http://love398146779.iteye.com/login">登录</a>
    <a href="http://love398146779.iteye.com/signup" class="nobg">注册</a>
    <!--<a href="http://passport.csdn.net/account/mobileregister?from=http://www.iteye.com">注册</a>-->
  </div>

	    
    </div>

    <div id="page">
        <div id="branding" class="clearfix" style="overflow: hidden;background: none;padding:0 0 2px;">
          <script type="text/javascript">
            /*Iteye博客内页顶部通栏-960*90，创建于 2016-08-01*/
            var cpro_id = "u2720131";
          </script>
          <script type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/c.js.下载"></script><div id="BAIDU_SSP__wrapper_u2720131_0"><iframe id="iframeu2720131_0" name="iframeu2720131_0" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tccm.html" width="960" height="90" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0;vertical-align:bottom;margin:0;width:960px;height:90px" allowtransparency="true"></iframe></div>
        </div>
      <div id="branding" class="clearfix">
        <div id="blog_name">
          <h1><a href="http://love398146779.iteye.com/">张守磊</a></h1>
        </div>
        <div id="fd"></div>
        <div id="blog_navbar">
          <ul>
            <li class="blog_navbar_for"><a href="http://love398146779.iteye.com/"><strong>博客</strong></a></li>
            <li><a href="http://love398146779.iteye.com/weibo">微博</a></li>
            <li><a href="http://love398146779.iteye.com/album">相册</a></li>
            <li><a href="http://love398146779.iteye.com/link">收藏</a></li>
            <li><a href="http://love398146779.iteye.com/blog/guest_book">留言</a></li>
            <li><a href="http://love398146779.iteye.com/blog/profile">关于我</a></li>
          </ul>
    
          <div class="search">
            <form action="http://love398146779.iteye.com/blog/search" method="get">
              <input class="search_text" id="query" name="query" style="margin-left: 10px;width: 110px;" type="text" value="">
              <input class="submit_search" type="submit" value="">
            </form>
          </div> 
          <div id="fd"></div>         
        </div>
      </div>
      
      <div id="content" class="clearfix">
        <div id="main">
          



          


<div class="h-entry" style="display:none">
  <a href="http://love398146779.iteye.com/" class="p-author" target="_blank">love398146779</a>
</div>


<div class="blog_main">
  <div class="blog_title">
    <h3>
      <a href="http://love398146779.iteye.com/blog/2123802">fastdfs使用实战（Java实例篇）</a>
      <em class="actions">      </em>
    </h3>
    <ul class="blog_categories"><strong>博客分类：</strong> <li><a href="http://love398146779.iteye.com/category/229935">工具类应用及新技术</a></li> </ul>
        <div class="news_tag">&nbsp;</div>
    	  
    	
    	
  		
      </div>

  <div id="blog_content" class="blog_content">
    一、创建一个maven的webproject，叫file-manager:mvnarchetype:create-DgroupId=platform.activity.filemanager-DartifactId=file-manager-DarchetypeArtifactId=maven-archetype-webapp
<br>二、定义一个fastDFS的客户端文件fdfs_client.conf：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=connect_timeout%20%3D%202%0Anetwork_timeout%20%3D%2030%0Acharset%20%3D%20UTF-8%0Ahttp.tracker_http_port%20%3D%208080%0Ahttp.anti_steal_token%20%3D%20no%0Ahttp.secret_key%20%3D%20FastDFS1234567890%0A%0Atracker_server%20%3D%20192.168.1.156%3A22122%0A%23tracker_server%20%3D%20192.168.1.188%3A22122%0A%0A%23storage_server%20%3D%20192.168.1.155%3A23000%20%23no%20need%20here%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span>connect_timeout&nbsp;=&nbsp;</span><span class="number">2</span><span>&nbsp;&nbsp;</span></span></li><li><span>network_timeout&nbsp;=&nbsp;<span class="number">30</span><span>&nbsp;&nbsp;</span></span></li><li><span>charset&nbsp;=&nbsp;UTF-<span class="number">8</span><span>&nbsp;&nbsp;</span></span></li><li><span>http.tracker_http_port&nbsp;=&nbsp;<span class="number">8080</span><span>&nbsp;&nbsp;</span></span></li><li><span>http.anti_steal_token&nbsp;=&nbsp;no&nbsp;&nbsp;</span></li><li><span>http.secret_key&nbsp;=&nbsp;FastDFS1234567890&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>tracker_server&nbsp;=&nbsp;<span class="number">192.168</span><span>.</span><span class="number">1.156</span><span>:</span><span class="number">22122</span><span>&nbsp;&nbsp;</span></span></li><li><span>#tracker_server&nbsp;=&nbsp;<span class="number">192.168</span><span>.</span><span class="number">1.188</span><span>:</span><span class="number">22122</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>#storage_server&nbsp;=&nbsp;<span class="number">192.168</span><span>.</span><span class="number">1.155</span><span>:</span><span class="number">23000</span><span>&nbsp;#no&nbsp;need&nbsp;here&nbsp;&nbsp;</span></span></li></ol></div><pre class="java" name="code" codeable_id="" codeable_type="BlogComment" source_url="http://love398146779.iteye.com/blog/2123802#" pre_index="0" title="fastdfs使用实战（Java实例篇）" style="display: none;">connect_timeout = 2
network_timeout = 30
charset = UTF-8
http.tracker_http_port = 8080
http.anti_steal_token = no
http.secret_key = FastDFS1234567890

tracker_server = 192.168.1.156:22122
#tracker_server = 192.168.1.188:22122

#storage_server = 192.168.1.155:23000 #no need here
</pre>
<br>三、定义一个配置接口：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F**%0A%20*%20%0A%20*%2F%0Apackage%20com.chuanliu.platform.activity.fm.manager%3B%0A%0Aimport%20java.io.Serializable%3B%0A%0A%2F**%0A%20*%20%40author%20Josh%20Wang(Sheng)%0A%20*%0A%20*%20%40email%20%20josh_wang23%40hotmail.com%0A%20*%2F%0Apublic%20interface%20FileManagerConfig%20extends%20Serializable%20%7B%0A%0A%09public%20static%20final%20String%20FILE_DEFAULT_WIDTH%20%09%3D%20%22120%22%3B%0A%09public%20static%20final%20String%20FILE_DEFAULT_HEIGHT%20%09%3D%20%22120%22%3B%0A%09public%20static%20final%20String%20FILE_DEFAULT_AUTHOR%20%09%3D%20%22Diandi%22%3B%0A%09%0A%09public%20static%20final%20String%20PROTOCOL%20%3D%20%22http%3A%2F%2F%22%3B%0A%09public%20static%20final%20String%20SEPARATOR%20%3D%20%22%2F%22%3B%0A%09%0A%09public%20static%20final%20String%20TRACKER_NGNIX_PORT%20%09%3D%20%228080%22%3B%0A%09%0A%09public%20static%20final%20String%20CLIENT_CONFIG_FILE%20%20%20%3D%20%22fdfs_client.conf%22%3B%0A%09%0A%09%0A%7D%0A%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">package</span><span>&nbsp;com.chuanliu.platform.activity.fm.manager;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.Serializable;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@author&nbsp;Josh&nbsp;Wang(Sheng)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@email&nbsp;&nbsp;josh_wang23@hotmail.com</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">interface</span><span>&nbsp;FileManagerConfig&nbsp;</span><span class="keyword">extends</span><span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;FILE_DEFAULT_WIDTH&nbsp;&nbsp;&nbsp;=&nbsp;</span><span class="string">"120"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;FILE_DEFAULT_HEIGHT&nbsp;&nbsp;=&nbsp;</span><span class="string">"120"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;FILE_DEFAULT_AUTHOR&nbsp;&nbsp;=&nbsp;</span><span class="string">"Diandi"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;PROTOCOL&nbsp;=&nbsp;</span><span class="string">"http://"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;SEPARATOR&nbsp;=&nbsp;</span><span class="string">"/"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;TRACKER_NGNIX_PORT&nbsp;&nbsp;&nbsp;=&nbsp;</span><span class="string">"8080"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;CLIENT_CONFIG_FILE&nbsp;&nbsp;&nbsp;=&nbsp;</span><span class="string">"fdfs_client.conf"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_id="" codeable_type="BlogComment" source_url="http://love398146779.iteye.com/blog/2123802#" pre_index="1" title="fastdfs使用实战（Java实例篇）" style="display: none;">/**
 * 
 */
package com.chuanliu.platform.activity.fm.manager;

import java.io.Serializable;

/**
 * @author Josh Wang(Sheng)
 *
 * @email  josh_wang23@hotmail.com
 */
public interface FileManagerConfig extends Serializable {

	public static final String FILE_DEFAULT_WIDTH 	= "120";
	public static final String FILE_DEFAULT_HEIGHT 	= "120";
	public static final String FILE_DEFAULT_AUTHOR 	= "Diandi";
	
	public static final String PROTOCOL = "http://";
	public static final String SEPARATOR = "/";
	
	public static final String TRACKER_NGNIX_PORT 	= "8080";
	
	public static final String CLIENT_CONFIG_FILE   = "fdfs_client.conf";
	
	
}

</pre>
<br>
<br>
<br>四、封装一个FastDFS文件Bean
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F**%0A%20*%20%0A%20*%2F%0Apackage%20com.chuanliu.platform.activity.fm.manager%3B%0A%0A%0A%2F**%0A%20*%20%40author%20Josh%20Wang(Sheng)%0A%20*%0A%20*%20%40email%20%20josh_wang23%40hotmail.com%0A%20*%2F%0Apublic%20class%20FastDFSFile%20implements%20FileManagerConfig%20%7B%0A%0A%09private%20static%20final%20long%20serialVersionUID%20%3D%20-996760121932438618L%3B%0A%0A%09private%20String%20name%3B%0A%09%0A%09private%20byte%5B%5D%20content%3B%0A%09%0A%09private%20String%20ext%3B%0A%09%0A%09private%20String%20height%20%3D%20FILE_DEFAULT_HEIGHT%3B%0A%09%0A%09private%20String%20width%20%3D%20FILE_DEFAULT_WIDTH%3B%0A%09%0A%09private%20String%20author%20%3D%20FILE_DEFAULT_AUTHOR%3B%0A%09%0A%09public%20FastDFSFile(String%20name%2C%20byte%5B%5D%20content%2C%20String%20ext%2C%20String%20height%2C%0A%09%09%09String%20width%2C%20String%20author)%20%7B%0A%09%09super()%3B%0A%09%09this.name%20%3D%20name%3B%0A%09%09this.content%20%3D%20content%3B%0A%09%09this.ext%20%3D%20ext%3B%0A%09%09this.height%20%3D%20height%3B%0A%09%09this.width%20%3D%20width%3B%0A%09%09this.author%20%3D%20author%3B%0A%09%7D%0A%09%0A%09public%20FastDFSFile(String%20name%2C%20byte%5B%5D%20content%2C%20String%20ext)%20%7B%0A%09%09super()%3B%0A%09%09this.name%20%3D%20name%3B%0A%09%09this.content%20%3D%20content%3B%0A%09%09this.ext%20%3D%20ext%3B%0A%09%7D%0A%0A%09public%20byte%5B%5D%20getContent()%20%7B%0A%09%09return%20content%3B%0A%09%7D%0A%0A%09public%20void%20setContent(byte%5B%5D%20content)%20%7B%0A%09%09this.content%20%3D%20content%3B%0A%09%7D%0A%0A%09public%20String%20getExt()%20%7B%0A%09%09return%20ext%3B%0A%09%7D%0A%0A%09public%20void%20setExt(String%20ext)%20%7B%0A%09%09this.ext%20%3D%20ext%3B%0A%09%7D%0A%0A%09public%20String%20getHeight()%20%7B%0A%09%09return%20height%3B%0A%09%7D%0A%0A%09public%20void%20setHeight(String%20height)%20%7B%0A%09%09this.height%20%3D%20height%3B%0A%09%7D%0A%0A%09public%20String%20getWidth()%20%7B%0A%09%09return%20width%3B%0A%09%7D%0A%0A%09public%20void%20setWidth(String%20width)%20%7B%0A%09%09this.width%20%3D%20width%3B%0A%09%7D%0A%0A%09public%20String%20getAuthor()%20%7B%0A%09%09return%20author%3B%0A%09%7D%0A%0A%09public%20void%20setAuthor(String%20author)%20%7B%0A%09%09this.author%20%3D%20author%3B%0A%09%7D%0A%0A%09public%20String%20getName()%20%7B%0A%09%09return%20name%3B%0A%09%7D%0A%0A%09public%20void%20setName(String%20name)%20%7B%0A%09%09this.name%20%3D%20name%3B%0A%09%7D%0A%09%0A%7D%0A%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">package</span><span>&nbsp;com.chuanliu.platform.activity.fm.manager;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@author&nbsp;Josh&nbsp;Wang(Sheng)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@email&nbsp;&nbsp;josh_wang23@hotmail.com</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;FastDFSFile&nbsp;</span><span class="keyword">implements</span><span>&nbsp;FileManagerConfig&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;serialVersionUID&nbsp;=&nbsp;-996760121932438618L;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;content;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;ext;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;height&nbsp;=&nbsp;FILE_DEFAULT_HEIGHT;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;width&nbsp;=&nbsp;FILE_DEFAULT_WIDTH;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;author&nbsp;=&nbsp;FILE_DEFAULT_AUTHOR;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;FastDFSFile(String&nbsp;name,&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;content,&nbsp;String&nbsp;ext,&nbsp;String&nbsp;height,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;width,&nbsp;String&nbsp;author)&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">super</span><span>();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.name&nbsp;=&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.content&nbsp;=&nbsp;content;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.ext&nbsp;=&nbsp;ext;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.height&nbsp;=&nbsp;height;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.width&nbsp;=&nbsp;width;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.author&nbsp;=&nbsp;author;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;FastDFSFile(String&nbsp;name,&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;content,&nbsp;String&nbsp;ext)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">super</span><span>();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.name&nbsp;=&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.content&nbsp;=&nbsp;content;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.ext&nbsp;=&nbsp;ext;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;getContent()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;content;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setContent(</span><span class="keyword">byte</span><span>[]&nbsp;content)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.content&nbsp;=&nbsp;content;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getExt()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;ext;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setExt(String&nbsp;ext)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.ext&nbsp;=&nbsp;ext;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getHeight()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;height;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setHeight(String&nbsp;height)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.height&nbsp;=&nbsp;height;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getWidth()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;width;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setWidth(String&nbsp;width)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.width&nbsp;=&nbsp;width;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getAuthor()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;author;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setAuthor(String&nbsp;author)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.author&nbsp;=&nbsp;author;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getName()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.name&nbsp;=&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_id="" codeable_type="BlogComment" source_url="http://love398146779.iteye.com/blog/2123802#" pre_index="2" title="fastdfs使用实战（Java实例篇）" style="display: none;">/**
 * 
 */
package com.chuanliu.platform.activity.fm.manager;


/**
 * @author Josh Wang(Sheng)
 *
 * @email  josh_wang23@hotmail.com
 */
public class FastDFSFile implements FileManagerConfig {

	private static final long serialVersionUID = -996760121932438618L;

	private String name;
	
	private byte[] content;
	
	private String ext;
	
	private String height = FILE_DEFAULT_HEIGHT;
	
	private String width = FILE_DEFAULT_WIDTH;
	
	private String author = FILE_DEFAULT_AUTHOR;
	
	public FastDFSFile(String name, byte[] content, String ext, String height,
			String width, String author) {
		super();
		this.name = name;
		this.content = content;
		this.ext = ext;
		this.height = height;
		this.width = width;
		this.author = author;
	}
	
	public FastDFSFile(String name, byte[] content, String ext) {
		super();
		this.name = name;
		this.content = content;
		this.ext = ext;
	}

	public byte[] getContent() {
		return content;
	}

	public void setContent(byte[] content) {
		this.content = content;
	}

	public String getExt() {
		return ext;
	}

	public void setExt(String ext) {
		this.ext = ext;
	}

	public String getHeight() {
		return height;
	}

	public void setHeight(String height) {
		this.height = height;
	}

	public String getWidth() {
		return width;
	}

	public void setWidth(String width) {
		this.width = width;
	}

	public String getAuthor() {
		return author;
	}

	public void setAuthor(String author) {
		this.author = author;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
	
}

</pre>
<br>
<br>五、定义核心的FileManager类，里面包含有上传、删除、获取文件的方法：
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F**%0A%20*%20%0A%20*%2F%0Apackage%20com.chuanliu.platform.activity.fm.manager%3B%0A%0Aimport%20java.io.File%3B%0Aimport%20java.io.IOException%3B%0A%0Aimport%20org.apache.log4j.Logger%3B%0Aimport%20org.csource.common.NameValuePair%3B%0Aimport%20org.csource.fastdfs.ClientGlobal%3B%0Aimport%20org.csource.fastdfs.FileInfo%3B%0Aimport%20org.csource.fastdfs.ServerInfo%3B%0Aimport%20org.csource.fastdfs.StorageClient%3B%0Aimport%20org.csource.fastdfs.StorageServer%3B%0Aimport%20org.csource.fastdfs.TrackerClient%3B%0Aimport%20org.csource.fastdfs.TrackerServer%3B%0A%0Aimport%20com.chuanliu.platform.activity.basic.util.LoggerUtils%3B%0A%0A%2F**%0A%20*%20File%20Manager%20used%20to%20provide%20the%20services%20to%20upload%20%2F%20download%20%2F%20delete%20the%20files%0A%20*%20from%20FastDFS.%0A%20*%20%0A%20*%20%3Cnote%3EIn%20this%20version%2C%20FileManager%20only%20support%20single%20tracker%2C%20will%20enhance%20this%20later...%3C%2Fnote%3E%0A%20*%20%0A%20*%20%40author%20Josh%20Wang(Sheng)%0A%20*%0A%20*%20%40email%20%20josh_wang23%40hotmail.com%0A%20*%2F%0Apublic%20class%20FileManager%20implements%20FileManagerConfig%20%7B%0A%09%0A%09private%20static%20final%20long%20serialVersionUID%20%3D%201L%3B%0A%0A%09private%20static%20Logger%20logger%20%20%3D%20Logger.getLogger(FileManager.class)%3B%0A%09%0A%09private%20static%20TrackerClient%20%20trackerClient%3B%0A%09private%20static%20TrackerServer%20%20trackerServer%3B%0A%09private%20static%20StorageServer%20%20storageServer%3B%0A%09private%20static%20StorageClient%20%20storageClient%3B%0A%0A%09static%20%7B%20%2F%2F%20Initialize%20Fast%20DFS%20Client%20configurations%0A%09%09%0A%09%09try%20%7B%0A%09%09%09String%20classPath%20%3D%20new%20File(FileManager.class.getResource(%22%2F%22).getFile()).getCanonicalPath()%3B%0A%09%09%09%0A%09%09%09String%20fdfsClientConfigFilePath%20%3D%20classPath%20%2B%20File.separator%20%2B%20CLIENT_CONFIG_FILE%3B%0A%09%09%09%0A%09%09%09logger.info(%22Fast%20DFS%20configuration%20file%20path%3A%22%20%2B%20fdfsClientConfigFilePath)%3B%0A%09%09%09ClientGlobal.init(fdfsClientConfigFilePath)%3B%0A%09%09%09%0A%09%09%09trackerClient%20%3D%20new%20TrackerClient()%3B%0A%09%09%09trackerServer%20%3D%20trackerClient.getConnection()%3B%0A%09%09%09%0A%09%09%09storageClient%20%3D%20new%20StorageClient(trackerServer%2C%20storageServer)%3B%0A%09%09%09%0A%09%09%7D%20catch%20(Exception%20e)%20%7B%0A%09%09%09LoggerUtils.error(logger%2C%20%20e)%3B%0A%09%09%09%0A%09%09%7D%0A%09%7D%0A%09%0A%09%0A%09%0A%09public%20static%20String%20upload(FastDFSFile%20file)%20%7B%0A%09%09LoggerUtils.info(logger%2C%20%22File%20Name%3A%20%22%20%2B%20file.getName()%20%2B%20%22%09%09File%20Length%3A%20%22%20%2B%20file.getContent().length)%3B%0A%09%09%0A%09%09NameValuePair%5B%5D%20meta_list%20%3D%20new%20NameValuePair%5B3%5D%3B%0A%09%20%20%20%20meta_list%5B0%5D%20%3D%20new%20NameValuePair(%22width%22%2C%20%22120%22)%3B%0A%09%20%20%20%20meta_list%5B1%5D%20%3D%20new%20NameValuePair(%22heigth%22%2C%20%22120%22)%3B%0A%09%20%20%20%20meta_list%5B2%5D%20%3D%20new%20NameValuePair(%22author%22%2C%20%22Diandi%22)%3B%0A%09%09%0A%09%20%20%20%20long%20startTime%20%3D%20System.currentTimeMillis()%3B%0A%09%09String%5B%5D%20uploadResults%20%3D%20null%3B%0A%09%09try%20%7B%0A%09%09%09uploadResults%20%3D%20storageClient.upload_file(file.getContent()%2C%20file.getExt()%2C%20meta_list)%3B%0A%09%09%7D%20catch%20(IOException%20e)%20%7B%0A%09%09%09logger.error(%22IO%20Exception%20when%20uploadind%20the%20file%3A%20%22%20%2B%20file.getName()%2C%20e)%3B%0A%09%09%7D%20catch%20(Exception%20e)%20%7B%0A%09%09%09logger.error(%22Non%20IO%20Exception%20when%20uploadind%20the%20file%3A%20%22%20%2B%20file.getName()%2C%20e)%3B%0A%09%09%7D%0A%09%09logger.info(%22upload_file%20time%20used%3A%20%22%20%2B%20(System.currentTimeMillis()%20-%20startTime)%20%2B%20%22%20ms%22)%3B%0A%09%09%0A%09%09if%20(uploadResults%20%3D%3D%20null)%20%7B%0A%09%09%09LoggerUtils.error(logger%2C%20%22upload%20file%20fail%2C%20error%20code%3A%20%22%20%2B%20storageClient.getErrorCode())%3B%0A%09%09%7D%0A%09%09%0A%09%09String%20groupName%20%09%09%3D%20uploadResults%5B0%5D%3B%0A%09%09String%20remoteFileName%20%20%20%3D%20uploadResults%5B1%5D%3B%0A%09%09%0A%09%09String%20fileAbsolutePath%20%3D%20PROTOCOL%20%2B%20trackerServer.getInetSocketAddress().getHostName()%20%0A%09%09%09%09%2B%20SEPARATOR%0A%09%09%09%09%2B%20TRACKER_NGNIX_PORT%0A%09%09%09%09%2B%20SEPARATOR%20%0A%09%09%09%09%2B%20groupName%20%0A%09%09%09%09%2B%20SEPARATOR%20%0A%09%09%09%09%2B%20remoteFileName%3B%0A%09%09%0A%09%09%0A%09%09LoggerUtils.info(logger%2C%20%22upload%20file%20successfully!!!%20%20%22%20%2B%22group_name%3A%20%22%20%2B%20groupName%20%2B%20%22%2C%20remoteFileName%3A%22%0A%09%09%09%09%2B%20%22%20%22%20%2B%20remoteFileName)%3B%0A%09%09%0A%09%09return%20fileAbsolutePath%3B%0A%09%09%0A%09%7D%0A%09%0A%09public%20static%20FileInfo%20getFile(String%20groupName%2C%20String%20remoteFileName)%20%7B%0A%09%09try%20%7B%0A%09%09%09return%20storageClient.get_file_info(groupName%2C%20remoteFileName)%3B%0A%09%09%7D%20catch%20(IOException%20e)%20%7B%0A%09%09%09logger.error(%22IO%20Exception%3A%20Get%20File%20from%20Fast%20DFS%20failed%22%2C%20e)%3B%0A%09%09%7D%20catch%20(Exception%20e)%20%7B%0A%09%09%09logger.error(%22Non%20IO%20Exception%3A%20Get%20File%20from%20Fast%20DFS%20failed%22%2C%20e)%3B%0A%09%09%7D%0A%09%09return%20null%3B%0A%09%7D%0A%09%0A%09public%20static%20void%20deleteFile(String%20groupName%2C%20String%20remoteFileName)%20throws%20Exception%20%7B%0A%09%09storageClient.delete_file(groupName%2C%20remoteFileName)%3B%0A%09%7D%0A%09%0A%09public%20static%20StorageServer%5B%5D%20getStoreStorages(String%20groupName)%20throws%20IOException%20%7B%0A%09%09return%20trackerClient.getStoreStorages(trackerServer%2C%20groupName)%3B%0A%09%7D%0A%09%0A%09public%20static%20ServerInfo%5B%5D%20getFetchStorages(String%20groupName%2C%20String%20remoteFileName)%20throws%20IOException%20%7B%0A%09%09return%20trackerClient.getFetchStorages(trackerServer%2C%20groupName%2C%20remoteFileName)%3B%0A%09%7D%0A%7D%0A%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">package</span><span>&nbsp;com.chuanliu.platform.activity.fm.manager;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.File;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.IOException;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;org.apache.log4j.Logger;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.common.NameValuePair;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.ClientGlobal;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.FileInfo;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.ServerInfo;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.StorageClient;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.StorageServer;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.TrackerClient;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.TrackerServer;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;com.chuanliu.platform.activity.basic.util.LoggerUtils;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;File&nbsp;Manager&nbsp;used&nbsp;to&nbsp;provide&nbsp;the&nbsp;services&nbsp;to&nbsp;upload&nbsp;/&nbsp;download&nbsp;/&nbsp;delete&nbsp;the&nbsp;files</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;from&nbsp;FastDFS.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;&lt;note&gt;In&nbsp;this&nbsp;version,&nbsp;FileManager&nbsp;only&nbsp;support&nbsp;single&nbsp;tracker,&nbsp;will&nbsp;enhance&nbsp;this&nbsp;later...&lt;/note&gt;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@author&nbsp;Josh&nbsp;Wang(Sheng)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@email&nbsp;&nbsp;josh_wang23@hotmail.com</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;FileManager&nbsp;</span><span class="keyword">implements</span><span>&nbsp;FileManagerConfig&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;serialVersionUID&nbsp;=&nbsp;1L;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;Logger&nbsp;logger&nbsp;&nbsp;=&nbsp;Logger.getLogger(FileManager.</span><span class="keyword">class</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;TrackerClient&nbsp;&nbsp;trackerClient;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;TrackerServer&nbsp;&nbsp;trackerServer;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;StorageServer&nbsp;&nbsp;storageServer;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;StorageClient&nbsp;&nbsp;storageClient;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;{&nbsp;</span><span class="comment">//&nbsp;Initialize&nbsp;Fast&nbsp;DFS&nbsp;Client&nbsp;configurations</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;classPath&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;File(FileManager.</span><span class="keyword">class</span><span>.getResource(</span><span class="string">"/"</span><span>).getFile()).getCanonicalPath();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fdfsClientConfigFilePath&nbsp;=&nbsp;classPath&nbsp;+&nbsp;File.separator&nbsp;+&nbsp;CLIENT_CONFIG_FILE;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span class="string">"Fast&nbsp;DFS&nbsp;configuration&nbsp;file&nbsp;path:"</span><span>&nbsp;+&nbsp;fdfsClientConfigFilePath);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClientGlobal.init(fdfsClientConfigFilePath);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trackerClient&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;TrackerClient();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trackerServer&nbsp;=&nbsp;trackerClient.getConnection();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storageClient&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;StorageClient(trackerServer,&nbsp;storageServer);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(Exception&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtils.error(logger,&nbsp;&nbsp;e);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;String&nbsp;upload(FastDFSFile&nbsp;file)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtils.info(logger,&nbsp;<span class="string">"File&nbsp;Name:&nbsp;"</span><span>&nbsp;+&nbsp;file.getName()&nbsp;+&nbsp;</span><span class="string">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;Length:&nbsp;"</span><span>&nbsp;+&nbsp;file.getContent().length);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NameValuePair[]&nbsp;meta_list&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;NameValuePair[</span><span class="number">3</span><span>];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_list[<span class="number">0</span><span>]&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;NameValuePair(</span><span class="string">"width"</span><span>,&nbsp;</span><span class="string">"120"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_list[<span class="number">1</span><span>]&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;NameValuePair(</span><span class="string">"heigth"</span><span>,&nbsp;</span><span class="string">"120"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta_list[<span class="number">2</span><span>]&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;NameValuePair(</span><span class="string">"author"</span><span>,&nbsp;</span><span class="string">"Diandi"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;startTime&nbsp;=&nbsp;System.currentTimeMillis();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;uploadResults&nbsp;=&nbsp;<span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uploadResults&nbsp;=&nbsp;storageClient.upload_file(file.getContent(),&nbsp;file.getExt(),&nbsp;meta_list);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(IOException&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">"IO&nbsp;Exception&nbsp;when&nbsp;uploadind&nbsp;the&nbsp;file:&nbsp;"</span><span>&nbsp;+&nbsp;file.getName(),&nbsp;e);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(Exception&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">"Non&nbsp;IO&nbsp;Exception&nbsp;when&nbsp;uploadind&nbsp;the&nbsp;file:&nbsp;"</span><span>&nbsp;+&nbsp;file.getName(),&nbsp;e);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span class="string">"upload_file&nbsp;time&nbsp;used:&nbsp;"</span><span>&nbsp;+&nbsp;(System.currentTimeMillis()&nbsp;-&nbsp;startTime)&nbsp;+&nbsp;</span><span class="string">"&nbsp;ms"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(uploadResults&nbsp;==&nbsp;</span><span class="keyword">null</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtils.error(logger,&nbsp;<span class="string">"upload&nbsp;file&nbsp;fail,&nbsp;error&nbsp;code:&nbsp;"</span><span>&nbsp;+&nbsp;storageClient.getErrorCode());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;groupName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;uploadResults[<span class="number">0</span><span>];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;remoteFileName&nbsp;&nbsp;&nbsp;=&nbsp;uploadResults[<span class="number">1</span><span>];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fileAbsolutePath&nbsp;=&nbsp;PROTOCOL&nbsp;+&nbsp;trackerServer.getInetSocketAddress().getHostName()&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;SEPARATOR&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;TRACKER_NGNIX_PORT&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;SEPARATOR&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;groupName&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;SEPARATOR&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;remoteFileName;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtils.info(logger,&nbsp;<span class="string">"upload&nbsp;file&nbsp;successfully!!!&nbsp;&nbsp;"</span><span>&nbsp;+</span><span class="string">"group_name:&nbsp;"</span><span>&nbsp;+&nbsp;groupName&nbsp;+&nbsp;</span><span class="string">",&nbsp;remoteFileName:"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"&nbsp;"</span><span>&nbsp;+&nbsp;remoteFileName);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;fileAbsolutePath;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;FileInfo&nbsp;getFile(String&nbsp;groupName,&nbsp;String&nbsp;remoteFileName)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;storageClient.get_file_info(groupName,&nbsp;remoteFileName);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(IOException&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">"IO&nbsp;Exception:&nbsp;Get&nbsp;File&nbsp;from&nbsp;Fast&nbsp;DFS&nbsp;failed"</span><span>,&nbsp;e);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(Exception&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">"Non&nbsp;IO&nbsp;Exception:&nbsp;Get&nbsp;File&nbsp;from&nbsp;Fast&nbsp;DFS&nbsp;failed"</span><span>,&nbsp;e);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;deleteFile(String&nbsp;groupName,&nbsp;String&nbsp;remoteFileName)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storageClient.delete_file(groupName,&nbsp;remoteFileName);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;StorageServer[]&nbsp;getStoreStorages(String&nbsp;groupName)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;trackerClient.getStoreStorages(trackerServer,&nbsp;groupName);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;ServerInfo[]&nbsp;getFetchStorages(String&nbsp;groupName,&nbsp;String&nbsp;remoteFileName)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;trackerClient.getFetchStorages(trackerServer,&nbsp;groupName,&nbsp;remoteFileName);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_id="" codeable_type="BlogComment" source_url="http://love398146779.iteye.com/blog/2123802#" pre_index="3" title="fastdfs使用实战（Java实例篇）" style="display: none;">/**
 * 
 */
package com.chuanliu.platform.activity.fm.manager;

import java.io.File;
import java.io.IOException;

import org.apache.log4j.Logger;
import org.csource.common.NameValuePair;
import org.csource.fastdfs.ClientGlobal;
import org.csource.fastdfs.FileInfo;
import org.csource.fastdfs.ServerInfo;
import org.csource.fastdfs.StorageClient;
import org.csource.fastdfs.StorageServer;
import org.csource.fastdfs.TrackerClient;
import org.csource.fastdfs.TrackerServer;

import com.chuanliu.platform.activity.basic.util.LoggerUtils;

/**
 * File Manager used to provide the services to upload / download / delete the files
 * from FastDFS.
 * 
 * &lt;note&gt;In this version, FileManager only support single tracker, will enhance this later...&lt;/note&gt;
 * 
 * @author Josh Wang(Sheng)
 *
 * @email  josh_wang23@hotmail.com
 */
public class FileManager implements FileManagerConfig {
	
	private static final long serialVersionUID = 1L;

	private static Logger logger  = Logger.getLogger(FileManager.class);
	
	private static TrackerClient  trackerClient;
	private static TrackerServer  trackerServer;
	private static StorageServer  storageServer;
	private static StorageClient  storageClient;

	static { // Initialize Fast DFS Client configurations
		
		try {
			String classPath = new File(FileManager.class.getResource("/").getFile()).getCanonicalPath();
			
			String fdfsClientConfigFilePath = classPath + File.separator + CLIENT_CONFIG_FILE;
			
			logger.info("Fast DFS configuration file path:" + fdfsClientConfigFilePath);
			ClientGlobal.init(fdfsClientConfigFilePath);
			
			trackerClient = new TrackerClient();
			trackerServer = trackerClient.getConnection();
			
			storageClient = new StorageClient(trackerServer, storageServer);
			
		} catch (Exception e) {
			LoggerUtils.error(logger,  e);
			
		}
	}
	
	
	
	public static String upload(FastDFSFile file) {
		LoggerUtils.info(logger, "File Name: " + file.getName() + "		File Length: " + file.getContent().length);
		
		NameValuePair[] meta_list = new NameValuePair[3];
	    meta_list[0] = new NameValuePair("width", "120");
	    meta_list[1] = new NameValuePair("heigth", "120");
	    meta_list[2] = new NameValuePair("author", "Diandi");
		
	    long startTime = System.currentTimeMillis();
		String[] uploadResults = null;
		try {
			uploadResults = storageClient.upload_file(file.getContent(), file.getExt(), meta_list);
		} catch (IOException e) {
			logger.error("IO Exception when uploadind the file: " + file.getName(), e);
		} catch (Exception e) {
			logger.error("Non IO Exception when uploadind the file: " + file.getName(), e);
		}
		logger.info("upload_file time used: " + (System.currentTimeMillis() - startTime) + " ms");
		
		if (uploadResults == null) {
			LoggerUtils.error(logger, "upload file fail, error code: " + storageClient.getErrorCode());
		}
		
		String groupName 		= uploadResults[0];
		String remoteFileName   = uploadResults[1];
		
		String fileAbsolutePath = PROTOCOL + trackerServer.getInetSocketAddress().getHostName() 
				+ SEPARATOR
				+ TRACKER_NGNIX_PORT
				+ SEPARATOR 
				+ groupName 
				+ SEPARATOR 
				+ remoteFileName;
		
		
		LoggerUtils.info(logger, "upload file successfully!!!  " +"group_name: " + groupName + ", remoteFileName:"
				+ " " + remoteFileName);
		
		return fileAbsolutePath;
		
	}
	
	public static FileInfo getFile(String groupName, String remoteFileName) {
		try {
			return storageClient.get_file_info(groupName, remoteFileName);
		} catch (IOException e) {
			logger.error("IO Exception: Get File from Fast DFS failed", e);
		} catch (Exception e) {
			logger.error("Non IO Exception: Get File from Fast DFS failed", e);
		}
		return null;
	}
	
	public static void deleteFile(String groupName, String remoteFileName) throws Exception {
		storageClient.delete_file(groupName, remoteFileName);
	}
	
	public static StorageServer[] getStoreStorages(String groupName) throws IOException {
		return trackerClient.getStoreStorages(trackerServer, groupName);
	}
	
	public static ServerInfo[] getFetchStorages(String groupName, String remoteFileName) throws IOException {
		return trackerClient.getFetchStorages(trackerServer, groupName, remoteFileName);
	}
}

</pre>
<br>
<br>
<br>六、Unit Test测试类
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=package%20manager%3B%0A%2F**%0A%20*%20%0A%20*%2F%0A%0A%0Aimport%20java.io.File%3B%0Aimport%20java.io.FileInputStream%3B%0A%0Aimport%20org.csource.fastdfs.FileInfo%3B%0Aimport%20org.csource.fastdfs.ServerInfo%3B%0Aimport%20org.csource.fastdfs.StorageServer%3B%0Aimport%20org.junit.Test%3B%0Aimport%20org.springframework.util.Assert%3B%0A%0Aimport%20com.chuanliu.platform.activity.fm.manager.FastDFSFile%3B%0Aimport%20com.chuanliu.platform.activity.fm.manager.FileManager%3B%0A%0A%2F**%0A%20*%20%40author%20Josh%20Wang(Sheng)%0A%20*%0A%20*%20%40email%20%20josh_wang23%40hotmail.com%0A%20*%2F%0Apublic%20class%20TestFileManager%20%7B%0A%0A%09%40Test%0A%09public%20void%20upload()%20throws%20Exception%20%7B%0A%09%09File%20content%20%3D%20new%20File(%22C%3A%5C%5C520.jpg%22)%3B%0A%09%09%0A%09%09FileInputStream%20fis%20%3D%20new%20FileInputStream(content)%3B%0A%09%20%20%20%20byte%5B%5D%20file_buff%20%3D%20null%3B%0A%09%20%20%20%20if%20(fis%20!%3D%20null)%20%7B%0A%09%20%20%20%20%09int%20len%20%3D%20fis.available()%3B%0A%09%20%20%20%20%09file_buff%20%3D%20new%20byte%5Blen%5D%3B%0A%09%20%20%20%20%09fis.read(file_buff)%3B%0A%09%20%20%20%20%7D%0A%09%09%0A%09%09FastDFSFile%20file%20%3D%20new%20FastDFSFile(%22520%22%2C%20file_buff%2C%20%22jpg%22)%3B%0A%09%09%0A%09%09String%20fileAbsolutePath%20%3D%20FileManager.upload(file)%3B%0A%09%09System.out.println(fileAbsolutePath)%3B%0A%09%09fis.close()%3B%0A%09%7D%0A%09%0A%09%40Test%0A%09public%20void%20getFile()%20throws%20Exception%20%7B%0A%09%09FileInfo%20file%20%3D%20FileManager.getFile(%22group1%22%2C%20%22M00%2F00%2F00%2FwKgBm1N1-CiANRLmAABygPyzdlw073.jpg%22)%3B%0A%09%09Assert.notNull(file)%3B%0A%09%09String%20sourceIpAddr%20%3D%20file.getSourceIpAddr()%3B%0A%09%20%20%20%20long%20size%20%3D%20file.getFileSize()%3B%0A%09%20%20%20%20System.out.println(%22ip%3A%22%20%2B%20sourceIpAddr%20%2B%20%22%2Csize%3A%22%20%2B%20size)%3B%0A%09%7D%0A%09%0A%09%40Test%0A%09public%20void%20getStorageServer()%20throws%20Exception%20%7B%0A%09%09StorageServer%5B%5D%20ss%20%3D%20FileManager.getStoreStorages(%22group1%22)%3B%0A%09%09Assert.notNull(ss)%3B%0A%09%09%0A%09%09for%20(int%20k%20%3D%200%3B%20k%20%3C%20ss.length%3B%20k%2B%2B)%7B%0A%09%09%09System.err.println(k%20%2B%201%20%2B%20%22.%20%22%20%2B%20ss%5Bk%5D.getInetSocketAddress().getAddress().getHostAddress()%20%2B%20%22%3A%22%20%2B%20ss%5Bk%5D.getInetSocketAddress().getPort())%3B%0A%09%20%20%20%20%7D%0A%09%7D%0A%09%0A%09%40Test%0A%09public%20void%20getFetchStorages()%20throws%20Exception%20%7B%0A%09%09ServerInfo%5B%5D%20servers%20%3D%20FileManager.getFetchStorages(%22group1%22%2C%20%22M00%2F00%2F00%2FwKgBm1N1-CiANRLmAABygPyzdlw073.jpg%22)%3B%0A%09%09Assert.notNull(servers)%3B%0A%09%09%0A%09%09for%20(int%20k%20%3D%200%3B%20k%20%3C%20servers.length%3B%20k%2B%2B)%20%7B%0A%20%20%20%20%09%09System.err.println(k%20%2B%201%20%2B%20%22.%20%22%20%2B%20servers%5Bk%5D.getIpAddr()%20%2B%20%22%3A%22%20%2B%20servers%5Bk%5D.getPort())%3B%0A%20%20%20%20%09%7D%0A%09%7D%0A%09%0A%7D%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/spinner.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="keyword">package</span><span>&nbsp;manager;&nbsp;&nbsp;</span></span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.File;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.FileInputStream;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.FileInfo;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.ServerInfo;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.csource.fastdfs.StorageServer;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.junit.Test;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;org.springframework.util.Assert;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;com.chuanliu.platform.activity.fm.manager.FastDFSFile;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;com.chuanliu.platform.activity.fm.manager.FileManager;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@author&nbsp;Josh&nbsp;Wang(Sheng)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@email&nbsp;&nbsp;josh_wang23@hotmail.com</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;TestFileManager&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Test</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;upload()&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;content&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;File(</span><span class="string">"C:\\520.jpg"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;fis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;FileInputStream(content);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;file_buff&nbsp;=&nbsp;</span><span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(fis&nbsp;!=&nbsp;</span><span class="keyword">null</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len&nbsp;=&nbsp;fis.available();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_buff&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[len];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fis.read(file_buff);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FastDFSFile&nbsp;file&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;FastDFSFile(</span><span class="string">"520"</span><span>,&nbsp;file_buff,&nbsp;</span><span class="string">"jpg"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fileAbsolutePath&nbsp;=&nbsp;FileManager.upload(file);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(fileAbsolutePath);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fis.close();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Test</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;getFile()&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInfo&nbsp;file&nbsp;=&nbsp;FileManager.getFile(<span class="string">"group1"</span><span>,&nbsp;</span><span class="string">"M00/00/00/wKgBm1N1-CiANRLmAABygPyzdlw073.jpg"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.notNull(file);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;sourceIpAddr&nbsp;=&nbsp;file.getSourceIpAddr();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;size&nbsp;=&nbsp;file.getFileSize();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string">"ip:"</span><span>&nbsp;+&nbsp;sourceIpAddr&nbsp;+&nbsp;</span><span class="string">",size:"</span><span>&nbsp;+&nbsp;size);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Test</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;getStorageServer()&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StorageServer[]&nbsp;ss&nbsp;=&nbsp;FileManager.getStoreStorages(<span class="string">"group1"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.notNull(ss);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;k&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;k&nbsp;&lt;&nbsp;ss.length;&nbsp;k++){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(k&nbsp;+&nbsp;<span class="number">1</span><span>&nbsp;+&nbsp;</span><span class="string">".&nbsp;"</span><span>&nbsp;+&nbsp;ss[k].getInetSocketAddress().getAddress().getHostAddress()&nbsp;+&nbsp;</span><span class="string">":"</span><span>&nbsp;+&nbsp;ss[k].getInetSocketAddress().getPort());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Test</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;getFetchStorages()&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerInfo[]&nbsp;servers&nbsp;=&nbsp;FileManager.getFetchStorages(<span class="string">"group1"</span><span>,&nbsp;</span><span class="string">"M00/00/00/wKgBm1N1-CiANRLmAABygPyzdlw073.jpg"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.notNull(servers);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;k&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;k&nbsp;&lt;&nbsp;servers.length;&nbsp;k++)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(k&nbsp;+&nbsp;<span class="number">1</span><span>&nbsp;+&nbsp;</span><span class="string">".&nbsp;"</span><span>&nbsp;+&nbsp;servers[k].getIpAddr()&nbsp;+&nbsp;</span><span class="string">":"</span><span>&nbsp;+&nbsp;servers[k].getPort());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_id="" codeable_type="BlogComment" source_url="http://love398146779.iteye.com/blog/2123802#" pre_index="4" title="fastdfs使用实战（Java实例篇）" style="display: none;">package manager;
/**
 * 
 */


import java.io.File;
import java.io.FileInputStream;

import org.csource.fastdfs.FileInfo;
import org.csource.fastdfs.ServerInfo;
import org.csource.fastdfs.StorageServer;
import org.junit.Test;
import org.springframework.util.Assert;

import com.chuanliu.platform.activity.fm.manager.FastDFSFile;
import com.chuanliu.platform.activity.fm.manager.FileManager;

/**
 * @author Josh Wang(Sheng)
 *
 * @email  josh_wang23@hotmail.com
 */
public class TestFileManager {

	@Test
	public void upload() throws Exception {
		File content = new File("C:\\520.jpg");
		
		FileInputStream fis = new FileInputStream(content);
	    byte[] file_buff = null;
	    if (fis != null) {
	    	int len = fis.available();
	    	file_buff = new byte[len];
	    	fis.read(file_buff);
	    }
		
		FastDFSFile file = new FastDFSFile("520", file_buff, "jpg");
		
		String fileAbsolutePath = FileManager.upload(file);
		System.out.println(fileAbsolutePath);
		fis.close();
	}
	
	@Test
	public void getFile() throws Exception {
		FileInfo file = FileManager.getFile("group1", "M00/00/00/wKgBm1N1-CiANRLmAABygPyzdlw073.jpg");
		Assert.notNull(file);
		String sourceIpAddr = file.getSourceIpAddr();
	    long size = file.getFileSize();
	    System.out.println("ip:" + sourceIpAddr + ",size:" + size);
	}
	
	@Test
	public void getStorageServer() throws Exception {
		StorageServer[] ss = FileManager.getStoreStorages("group1");
		Assert.notNull(ss);
		
		for (int k = 0; k &lt; ss.length; k++){
			System.err.println(k + 1 + ". " + ss[k].getInetSocketAddress().getAddress().getHostAddress() + ":" + ss[k].getInetSocketAddress().getPort());
	    }
	}
	
	@Test
	public void getFetchStorages() throws Exception {
		ServerInfo[] servers = FileManager.getFetchStorages("group1", "M00/00/00/wKgBm1N1-CiANRLmAABygPyzdlw073.jpg");
		Assert.notNull(servers);
		
		for (int k = 0; k &lt; servers.length; k++) {
    		System.err.println(k + 1 + ". " + servers[k].getIpAddr() + ":" + servers[k].getPort());
    	}
	}
	
}
</pre>
<br>
<br>文章来自: 程序员俱乐部(www.cxyclub.cn) 详文参考：http://www.cxyclub.cn/n/44103/
  </div>

  

  
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-8990951720398508";
      /* iteye博客内页Banner-728*90 */
      google_ad_slot = "8267689356/1918544322";
      google_ad_width = 728;
      google_ad_height = 90;
      //-->
      </script>
      <script type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/show_ads.js.下载">
      </script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/saved_resource.html"></iframe></ins></ins>
  



  <div id="bottoms" class="clearfix">
    
    <div id="share_weibo">分享到：
      <a data-type="sina" href="javascript:;" title="分享到新浪微博"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/sina.jpg"></a>
      <a data-type="qq" href="javascript:;" title="分享到腾讯微博"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tec.jpg"></a>
    </div>
  </div>

  <div class="blog_nav">
    <div class="pre_next">
      <a href="http://love398146779.iteye.com/blog/2124123" class="next" title="redis的操作">redis的操作</a>
      |
      <a href="http://love398146779.iteye.com/blog/2123791" class="pre" title="集合竞价算法">集合竞价算法</a>
    </div>
  </div>
  <div class="blog_bottom">
    <ul>
      <li>2014-09-29 18:11</li>
      <li>浏览 14127</li>
      <li><a href="http://love398146779.iteye.com/blog/2123802#comments">评论(0)</a></li>
      
      
      <li>分类:<a href="http://www.iteye.com/blogs/category/industry">行业应用</a></li>      
      <li class="last"><a href="http://www.iteye.com/wiki/blog/2123802" target="_blank" class="more">查看更多</a></li>
    </ul>    
  </div>

	
    
    
<div class="boutique-curr-box blog_comment">
	  <div class="boutique-curr clearfix">
	    <h5 class="h3titles">相关资源推荐</h5>
			<ul style="margin-top: 15px">
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/u011433684/9391407" target="_blank" title="Python Crash Course">Python Crash Course</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://blog.csdn.net/u012124438/article/details/77618861" target="_blank" title="Java数据结构与算法解析(一)——表">Java数据结构与算法解析(一)——表</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://blog.csdn.net/baiyuzhong2012/article/details/53321895" target="_blank" title="关注CSDN程序人生公众号，轻松获得下载积分">关注CSDN程序人生公众号，轻松获得下载积分</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://blog.csdn.net/xiaoxiaoxiao_lu/article/details/73200850" target="_blank" title="微信小程序 VS 原生App">微信小程序 VS 原生App</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/ybj20081212_521/9992248" target="_blank" title="操作系统OEM DIY工具">操作系统OEM DIY工具</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://edu.csdn.net/course/detail/5079" target="_blank" title="一小时学会搭建网站">一小时学会搭建网站</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/chenxh/5" target="_blank" title="迅捷全站功能模块">迅捷全站功能模块</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/u013057728/6664873" target="_blank" title="P2P3.01局域网管理软件">P2P3.01局域网管理软件</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/chenxh/2" target="_blank" title="聊天机器人2002">聊天机器人2002</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/big_bigtree/1695102" target="_blank" title="深讯信科 行业短信网关EP端应用程序API(smgp3.03版)使用说明">深讯信科 行业短信网关EP端应用程序API(smgp3.03版)使用说明</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/u013345244/9039241" target="_blank" title="卫星技术在地震行业中的综合应用">卫星技术在地震行业中的综合应用</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/qq_30077825/8928963" target="_blank" title="AutoCAD 全行业应用宝典全套系列教程索引">AutoCAD 全行业应用宝典全套系列教程索引</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/piaoyang2001/9442677" target="_blank" title="浅谈激光跟踪仪在机床行业测量中的应用">浅谈激光跟踪仪在机床行业测量中的应用</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/ecxidu/5355393" target="_blank" title="MES在钢铁行业中的应用">MES在钢铁行业中的应用</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/u012646285/7039639" target="_blank" title="仿微盟 最新微信源码行业应用版">仿微盟 最新微信源码行业应用版</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/chinese915/6250299" target="_blank" title="行业应用解决方案——由 IBM、OEM、ISV 和 SI 提供的优化业务解决方案">行业应用解决方案——由 IBM、OEM、ISV 和 SI 提供的优化业务解决方案</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/s110start/8830433" target="_blank" title="云计算大数据智能交通行业应用论坛—大数据时代城市交通的思考分析决策—杨东援">云计算大数据智能交通行业应用论坛—大数据时代城市交通的思考分析决策—杨东援</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/qqkzq/5055476" target="_blank" title="u8 电机行业应用方案">u8 电机行业应用方案</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/ca_sslvpn/2891345" target="_blank" title="教育行业应用安全解决方案---身份认证、电子签名、电子印章">教育行业应用安全解决方案---身份认证、电子签名、电子印章</a>
						</li>
				
						<li style="width: 50%;float: left;margin: 0;line-height: 25px;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
							<a href="http://download.csdn.net/download/aguai370993809/2640848" target="_blank" title="【教育行业】Web安全解决方案-铱迅web应用防护系统">【教育行业】Web安全解决方案-铱迅web应用防护系统</a>
						</li>
				
			</ul>
	  </div>
</div>

		
<div class="boutique-curr-box blog_comment">
	  <div class="boutique-curr clearfix">
	    <h5 class="h3titles">参考知识库</h5>
	    
	    <dl class="dlnewlist">
	    
          <dd><a target="_blank" href="http://lib.csdn.net/base/android"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/1455589744328_328.jpg" width="58" height="58" alt=""></a></dd>
          <dt>
              <a target="_blank" href="http://lib.csdn.net/base/android" classs="title">Android知识库</a>
              <span>
                 <em>37863</em>&nbsp;&nbsp;关注 <i>|</i> <em>3162</em>&nbsp;&nbsp;收录                  
              </span>
          </dt>
      
	    </dl>
	    
	    <dl class="dlnewlist">
	    
          <dd><a target="_blank" href="http://lib.csdn.net/base/react"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/1465887837340_340.jpg" width="58" height="58" alt=""></a></dd>
          <dt>
              <a target="_blank" href="http://lib.csdn.net/base/react" classs="title">React知识库</a>
              <span>
                 <em>3620</em>&nbsp;&nbsp;关注 <i>|</i> <em>393</em>&nbsp;&nbsp;收录                  
              </span>
          </dt>
      
	    </dl>
	    
	    <dl class="dlnewlist">
	    
          <dd><a target="_blank" href="http://lib.csdn.net/base/ai"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/1479972981201_201.jpg" width="58" height="58" alt=""></a></dd>
          <dt>
              <a target="_blank" href="http://lib.csdn.net/base/ai" classs="title">人工智能基础知识库</a>
              <span>
                 <em>16765</em>&nbsp;&nbsp;关注 <i>|</i> <em>212</em>&nbsp;&nbsp;收录                  
              </span>
          </dt>
      
	    </dl>
	    
	    <dl class="dlnewlist">
	    
          <dd><a target="_blank" href="http://lib.csdn.net/base/java"><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/1453701371636_636.jpg" width="58" height="58" alt=""></a></dd>
          <dt>
              <a target="_blank" href="http://lib.csdn.net/base/java" classs="title">Java 知识库</a>
              <span>
                 <em>35328</em>&nbsp;&nbsp;关注 <i>|</i> <em>3748</em>&nbsp;&nbsp;收录                  
              </span>
          </dt>
      
	    </dl>
	    
	  </div>
</div>

      
  <div class="blog_comment">
    <h5>评论</h5>
    <a id="comments" name="comments"></a>
    
    
    
  </div>

  <div class="blog_comment">
    <h5>发表评论</h5>
            <p style="text-align:center; margin-top:30px;margin-bottom:0px;"><a href="http://love398146779.iteye.com/login" style="background-color:white;"> <img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/login_icon.png" style="vertical-align:middle; margin-right: 10px;"></a><a href="http://love398146779.iteye.com/login">  您还没有登录,请您登录后再发表评论 </a></p>
      </div>
</div>


<script type="text/javascript">
  dp.SyntaxHighlighter.HighlightAll('code', true, true);

  $$('#main .blog_content pre[name=code]').each(function(pre, index){ // blog content
    var post_id = 2123802;
    var location = window.location;
    source_url = location.protocol + "//" + location.host + location.pathname + location.search;
    pre.writeAttribute('codeable_id', post_id);
    pre.writeAttribute('codeable_type', "Blog");
    pre.writeAttribute('source_url', source_url);
    pre.writeAttribute('pre_index', index);
    pre.writeAttribute('title', 'fastdfs使用实战（Java实例篇）');
  });

  fix_image_size($$('div.blog_content img'), 700);

  function processComment() {
    $$('#main .blog_comment > div').each(function(comment){// comment
      var post_id = comment.id.substr(2);
      $$("#"+comment.id+" pre[name=code]").each(function(pre, index){
        var location = window.location;
        source_url = location.protocol + "//" + location.host + location.pathname + location.search;
        source_url += "#" + comment.id;
        pre.writeAttribute('codeable_id', post_id);
        pre.writeAttribute('codeable_type', "BlogComment");
        pre.writeAttribute('source_url', source_url);
        pre.writeAttribute('pre_index', index);
        pre.writeAttribute('title', 'fastdfs使用实战（Java实例篇）');
      });
    });
  }

  function quote_comment(id) {
    new Ajax.Request('/editor/quote', {
      parameters: {'id':id, 'type':'BlogComment'},
      onSuccess:function(response){editor.bbcode_editor.textarea.insertAfterSelection(response.responseText);
        Element.scrollTo(editor.bbcode_editor.textarea.element);}
    });
  }

  code_favorites_init();
  processComment();
  new WeiboShare({share_buttons: $('share_weibo'), img_scope: $('blog_content')});
</script>




        </div>

        <div id="local">
          <div class="local_top"></div>
          <div id="blog_owner">
  <div id="blog_owner_logo"><a href="http://love398146779.iteye.com/"><img alt="love398146779的博客" class="logo" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/ed308b97-1beb-35de-905e-a86f5fe6e050.jpg" title="love398146779的博客: 张守磊" width=""></a></div>
  <div id="blog_owner_name">love398146779</div>
</div>

          <div id="blog_actions">
            <ul>
              <li>浏览: 393347 次</li>
              <li>性别: <img alt="Icon_minigender_1" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/icon_minigender_1.gif" title="男"></li>
              <li>来自: 天津</li>
              <li><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/offline.gif"></li>
              
            </ul>
          </div>
          <div id="user_visits" class="clearfix">
            <h5>最近访客 <span style="font-weight:normal;font-size:12px;padding-left:30px;"><a href="http://love398146779.iteye.com/blog/user_visits">更多访客&gt;&gt;</a></span></h5>
            
              <div class="user_visit">
                <div class="logo"><a href="http://jinianjun.iteye.com/" target="_blank"><img alt="jinianjun的博客" class="logo" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/user-logo-thumb.gif" title="jinianjun的博客: " width="48px"></a></div>
                <div class="left"><a href="http://jinianjun.iteye.com/" target="_blank" title="jinianjun">jinianjun</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://omeweb.iteye.com/" target="_blank"><img alt="omeweb的博客" class="logo" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/user-logo-thumb.gif" title="omeweb的博客: omeweb" width="48px"></a></div>
                <div class="left"><a href="http://omeweb.iteye.com/" target="_blank" title="omeweb">omeweb</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://2300133823.iteye.com/" target="_blank"><img alt="雪域雄狮lj的博客" class="logo" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/user-logo-thumb.gif" title="雪域雄狮lj的博客: " width="48px"></a></div>
                <div class="left"><a href="http://2300133823.iteye.com/" target="_blank" title="雪域雄狮lj">雪域雄狮lj</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://yfqsdie.iteye.com/" target="_blank"><img alt="yfqsdie的博客" class="logo" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/user-logo-thumb.gif" title="yfqsdie的博客: " width="48px"></a></div>
                <div class="left"><a href="http://yfqsdie.iteye.com/" target="_blank" title="yfqsdie">yfqsdie</a></div>
              </div>
            
          </div>

          

                      <div id="blog_menu">
              <h5>文章分类</h5>
              <ul>
                <li><a href="http://love398146779.iteye.com/">全部博客 (442)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137378">中间件 (20)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137380">hibernate (13)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137381">spring (20)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137384">数据库 (78)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137386">struts (8)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137387">ibatis (4)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137388">前端 (61)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137390">linux，windows (21)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/137392">it大环境 (32)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/138149">IDE工具 (36)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/157486">感悟 (6)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/158994">java基础 (40)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/170732">经典面试题 (10)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/176964">exception总结 (14)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/210649">软件设计 (8)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/229935">工具类应用及新技术 (48)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/308571">php (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/309109">微信 (1)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/309421">设计模式 (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/313452">重构 (3)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/313599">管理 (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/313834">工作笔记 (1)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/319539">jmx (1)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/320479">算法 (4)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/320968">多线程同步 (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/321370">代码管理工具 (5)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/324074">代码检测及测试 (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/324212">缓存服务 (1)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/325652">SOA及ROA (5)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/332631">groovy (1)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/332707">网络编程 (2)</a></li>
                
                  <li><a href="http://love398146779.iteye.com/category/345601">大数据 (6)</a></li>
                
              </ul>
            </div>
            <div id="month_blogs">
              <h5>社区版块</h5>
              <ul>
                <li><a href="http://love398146779.iteye.com/blog/news">我的资讯</a> (0)</li>
                <li>
                  <a href="http://love398146779.iteye.com/blog/post">我的论坛</a> (0)
                </li>
                <li><a href="http://love398146779.iteye.com/blog/answered_problems">我的问答</a> (15)</li>
              </ul>
            </div>
            <div id="month_blogs">
              <h5>存档分类</h5>
              <ul>
                
                  <li><a href="http://love398146779.iteye.com/blog/monthblog/2017-10">2017-10</a> (1)</li>
                
                  <li><a href="http://love398146779.iteye.com/blog/monthblog/2017-01">2017-01</a> (1)</li>
                
                  <li><a href="http://love398146779.iteye.com/blog/monthblog/2016-12">2016-12</a> (1)</li>
                
                <li><a href="http://love398146779.iteye.com/blog/monthblog_more">更多存档...</a></li>
              </ul>
            </div>
            
            

            <div id="guest_books">
              <h5>最新评论</h5>
              <ul>
                
                <li>
                  <a href="http://love398146779.iteye.com/" target="_blank" title="love398146779">love398146779</a>： 
                  我当然不能全写上面了，这只是其中一部分https连接。<br>
                  <a href="http://love398146779.iteye.com/blog/2065423#bc2391455">java 建立 https连接</a>
                </li>
                
                <li>
                  <a href="http://yuenkin.iteye.com/" target="_blank" title="yuenkin">yuenkin</a>： 
                  大哥，这是双向认证吗？<br>
                  <a href="http://love398146779.iteye.com/blog/2065423#bc2388432">java 建立 https连接</a>
                </li>
                
                <li>
                  <a href="http://issu.iteye.com/" target="_blank" title="issu">issu</a>： 
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如以下代码能遍历字符串"Tom:Mi ...<br>
                  <a href="http://love398146779.iteye.com/blog/953972#bc2384498">&lt;c:forTokens&gt;标签delims截取字符</a>
                </li>
                
                <li>
                  <a href="http://love398146779.iteye.com/" target="_blank" title="love398146779">love398146779</a>： 
                  2*3*5=30，是30个以上的请求才拒绝呀。<br>
                  <a href="http://love398146779.iteye.com/blog/1735995#bc2383135">tomcat的maxThreads、acceptCount（最大线程数、最大排队数） </a>
                </li>
                
                <li>
                  <a href="http://love398146779.iteye.com/" target="_blank" title="love398146779">love398146779</a>： 
                  2台跟1台一样的效果。<br>
                  <a href="http://love398146779.iteye.com/blog/2099208#bc2383134">zookeeper与activemq最新存储replicatedLevelDB整合</a>
                </li>
                
              </ul>
            </div>

            <div class="local_bottom"></div>
          
        </div>

        <div id="nav_show_top_stop" style="height: 500px;z-index:1000;margin-top: 10px;float: left;clear: left;">
          <div>
            <div id="_lp9m6oqoeht" style=""><iframe width="200" frameborder="0" height="200" scrolling="no" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/s.html"></iframe></div><script type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/sncoctctcqum.js.下载"></script>
          </div>
          <div>
            <div id="_y5yjccc8qfl" style=""><p style="display:none;margin-right:0px;"></p><iframe width="200" frameborder="0" height="200" scrolling="no" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/s(1).html"></iframe></div><script type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/dyqegnhxubfhnqu.js.下载"></script>
          </div>
        </div>
        <script>

            setTimeout(function () {
                var naviga_offsetTop = 0;

                function onload_function() {
                    naviga_offsetTop = jQuery("#nav_show_top_stop").position().top;
                    jQuery(window).bind("scroll", naviga_stay_top);
                    jQuery(window).bind("mousewheel", naviga_stay_top);
                    jQuery(document).bind("scroll", naviga_stay_top);
                    jQuery(document).bind("mousewheel", naviga_stay_top);
                }
                function naviga_stay_top() {

                    var scrollTop = jQuery(document).scrollTop();
                    console.log(naviga_offsetTop - scrollTop);
                    if (scrollTop > (naviga_offsetTop+250)) {
                        jQuery("#nav_show_top_stop").css({ "position": "fixed" });
                        jQuery("#nav_show_top_stop").css({ "top": "0px" });
                    } else {
                        jQuery("#nav_show_top_stop").css({ "position": "fixed" });
                        jQuery("#nav_show_top_stop").css({ "top": naviga_offsetTop+250 - scrollTop + "px" }); }
                }
                jQuery(document).ready(onload_function());
            }, 200);

        </script>
      </div>    

      <div id="footer" class="clearfix">
        <div id="copyright">
          <hr>
          声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。<br>
          © 2003-2017 ITeye.com.   All rights reserved.  [ 京ICP证110151号  京公网安备110105010620 ]
        </div>
        <div style="position: fixed;bottom:0px;right:0px;line-height:0px;z-index:1000;">
          <!-- 广告位：PC端-iteye博客详情右侧弹窗-300*250 -->
          <script>
              (function() {
                  var s = "_" + Math.random().toString(36).slice(2);
                  document.write('<div id="' + s + '"></div>');
                  (window.slotbydup=window.slotbydup || []).push({
                      id: '4756560',
                      container: s,
                      size: '300,250',
                      display: 'inlay-fix'
                  });
              })();
          </script><div id="_c60w2llvqqo"><iframe id="iframe4756560_0" name="iframe4756560_0" onload="BAIDU_SSP_renderFrame(&#39;4756560_0&#39;, this);" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/saved_resource(1).html" width="300" height="250" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0;vertical-align:bottom;margin:0;width:300px;height:250px" allowtransparency="true"></iframe></div><script charset="utf-8" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tccm(1)"></script>
        </div>
      </div>
    </div>
    <script type="text/javascript">
  document.write("<img src='http://stat.iteye.com/?url="+ encodeURIComponent(document.location.href) + "&referrer=" + encodeURIComponent(document.referrer) + "&user_id=' width='0' height='0' />");
</script><img src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/saved_resource" width="0" height="0">

<script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tracking.js.下载" type="text/javascript"></script>

    
<script type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tongji.js.下载"></script>
      
    
    <script language="javascript" type="text/javascript" src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/async_new.js.下载"></script>
<script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/jquery-1.11.1.min.js.下载" type="text/javascript"></script>
<script type="text/javascript">var $csdn_iteye_jq = jQuery.noConflict();// 解决jq与prototype.js命名空间冲突的问题</script>
<script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/tracking.js(1).下载" type="text/javascript"></script>
    
	    
	    <script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/web-storage-cache.min.js.下载" type="text/javascript"></script>
	    <script src="./fastdfs使用实战（Java实例篇） - 张守磊 - ITeye博客_files/replace.min.js.下载" type="text/javascript"></script>
    
    
  

</body></html>