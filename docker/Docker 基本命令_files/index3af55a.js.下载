define("pages/music_player.js",["biz_wap/utils/mmversion.js","pages/report.js","biz_common/dom/event.js","biz_wap/jsapi/core.js","pages/version4video.js","biz_common/utils/monitor.js"],function(t){
"use strict";
function e(){
A.hasInit||(A.hasInit=!0,p(),l(),u());
}
function o(t){
e(),this._o={
plugins:[],
protocal:"",
wxIndex:0,
type:0,
src:"",
jsapi2Src:"",
mid:"",
autoPlay:!1,
duration:0,
needVioceMutex:!0,
title:"",
allowPause:!1,
singer:"",
epname:"",
coverImgUrl:"",
webUrl:"",
fileSize:0,
onStatusChange:function(){},
onTimeupdate:function(){},
onError:function(){},
onUpdateSeekRange:function(){}
},this._extend(t),this._status=-1,this._g={
mutexKey:"",
jsapiSrcId:"",
hasCheckPlay:!1,
playTimeoutId:null,
stateChangeCallback:{},
_blockPlugin:{},
hasInitH5Event:!1,
h5Event:{},
totalPlayTime:0
},this._initPlugins(),this._fixAndroidSizeLimit(),0!==A.surportType&&(this._initData(),
this._synPlayStatus());
}
function i(t){
v.invoke("musicPlay",{
app_id:"a",
title:"微信公众平台",
singer:"微信公众平台",
epname:"微信公众平台",
coverImgUrl:"http://res.wx.qq.com/mpres/htmledition/images/favicon.ico",
dataUrl:A.ev,
lowbandUrl:A.ev,
webUrl:"http://mp.weixin.qq.com/s?"
},function(e){
"function"==typeof t&&t(e);
});
}
function n(t){
a({
cur:t,
stopCur:!1
});
}
function a(t){
function e(){
if(A.mutexCount==s&&(s=0,A.mutexCount=0,"function"==typeof n)){
var t=0;
1==A.surportType?t=2e3:3==A.surportType&&(t=0),setTimeout(function(){
n();
},t);
}
}
if(0!=A.mutexCount)return void setTimeout(function(){
a(t);
},200);
var o=t.cur,i=t.stopCur===!0?!0:!1,n=t.callback,s=0;
for(var r in A.mutexPlayers)for(var u=0,p=A.mutexPlayers[r].length;p>u;u++)s++;
for(var r in A.mutexPlayers)for(var u=0,p=A.mutexPlayers[r].length;p>u;u++){
var c=A.mutexPlayers[r][u];
if(c&&c!==o){
var l=c.getSurportType(),d="";
2!=l||1!=c._status&&4!=c._status?1!=l&&3!=l||1!=c._status&&2!=c._status&&4!=c._status||(d="stop"):d=c._o.allowPause?"pause":"stop",
d&&"function"==typeof c[d]?c[d](i,function(){
A.mutexCount++,e();
}):(A.mutexCount++,e());
}else A.mutexCount++,e();
}
}
function s(){
return A.surportType;
}
function r(t){
return new o(t);
}
function u(){
A.surportType>0&&A.isAndroidLow&&window.addEventListener("canplay",function(t){
t.target&&"function"==typeof t.target.play&&t.target.play();
},!0);
}
function p(){
A.jsapiGlobalEvent={
error:d,
pause:h,
stop:_,
play:y,
preempted:_,
waiting:g
};
}
function c(t){
return"&"+A.wxtag+"="+t;
}
function l(){
v.on("onBackgroundAudioStateChange",function(t){
if(!!A.debug&&console.log("onBackgroundAudioStateChange log:"+JSON.stringify(t||{})),
t.src&&t.state){
var e=m(A.wxtag,t.src)||"";
e&&(e=c(e));
var o=A.mutexPlayers[t.src]||A.mutexPlayers2[t.src]||A.mutexPlayers[e];
if(o){
var i;
if(t.srcId)for(var n=0,a=o.length;a>n;n++)o[n]._g.jsapiSrcId==t.srcId&&(i=o[n]);else if(1==o.length)i=o[0];else for(var n=0,a=o.length;a>n;n++)if(-1!=o[n]._status&&0!=o[n]._status&&3!=o[n]._status){
i=o[n];
break;
}
if(i&&i._g.stateChangeCallback){
var s=t.state;
"ended"==s&&(s="stop"),"wait"==s&&(s="waiting");
var r=!1;
if("error"==s)for(var u in i._g.stateChangeCallback)i._g.stateChangeCallback.hasOwnProperty(u)&&"function"==typeof i._g.stateChangeCallback[u]&&(r=!0,
i._g.stateChangeCallback[u](-1,t.errMsg||""),i._g.stateChangeCallback[u]=null);else"function"==typeof i._g.stateChangeCallback[s]&&(A.debug&&console.log("excute stateChangeCallback :"+s),
r=!0,i._g.stateChangeCallback[s](0),i._g.stateChangeCallback[s]=null);
r||"function"!=typeof A.jsapiGlobalEvent[s]||A.jsapiGlobalEvent[s](t,i);
}
}
}
});
}
function d(t,e){
e.stop(!1),e._trigger("jsapi2PlayingErr");
}
function _(t,e){
e.stop(!1);
}
function h(t,e){
e.pause(!1,null,!0);
}
function y(t,e){
1!=e._status&&e.resume(!1,null,!0);
}
function g(t,e){
e.onload();
}
function f(){
for(var t in A.mutexPlayers)if(A.mutexPlayers.hasOwnProperty(t))for(var e=0,o=A.mutexPlayers[t].length;o>e;e++){
var i=A.mutexPlayers[t][e];
if(i&&1==i._status&&(1==i._surportType||3==i._surportType)){
i._trigger("unloadPlaying");
break;
}
}
}
function m(t){
var e=arguments[1]||window.location.search,o=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=e.substr(e.indexOf("?")+1).match(o);
return null!=i?i[2]:"";
}
function P(t,e,o){
function i(t,e){
for(;A.synPlayStatusArr.length>0;){
var o=A.synPlayStatusArr.shift();
o&&"function"==typeof o[t]&&o[t](e);
}
}
A.synPlayStatusArr.push({
_t:t,
onSuccess:e,
onError:o
}),A.synPlayStatusId&&clearTimeout(A.synPlayStatusId),A.synPlayStatusId=setTimeout(function(){
t._jsapi_getMusicPlayerState({
onSuccess:function(t){
i("onSuccess",t);
},
onError:function(t){
i("onError",t);
}
});
},0);
}
document.domain="qq.com";
var T=t("biz_wap/utils/mmversion.js"),v=(t("pages/report.js"),t("biz_common/dom/event.js"),
t("biz_wap/jsapi/core.js")),S=t("pages/version4video.js"),A=(t("biz_common/utils/monitor.js"),
{
hasInit:!1,
synPlayStatusId:null,
synPlayStatusArr:[],
inWechat:!S.device.inWechat||S.device.inWindowWechat||S.device.inMacWechat?!1:!0,
mutexCount:0,
ev:0!=window._empty_v.indexOf(window.location.protocol)?"http:"+window._empty_v:window._empty_v,
debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1?!0:!1,
_playtype:1*m("_playtype")||0,
isAndroidLow:/android\s2\.3/i.test(navigator.userAgent),
isAndroid:T.isAndroid,
surportType:"addEventListener"in window?2:0,
mutexPlayers:{},
mutexPlayers2:{},
wxtag:"__wxtag__"
});
return o.prototype._initPlugins=function(){
for(var t=this._o.plugins,e=0,o=t.length;o>e;++e){
var i=t[e];
i.setPlayer(this),!!i.init&&i.init();
}
},o.prototype._trigger=function(t,e){
var o=this._o,i=this._g,n=o.plugins,a=i._blockPlugin[t]||i._blockPlugin.all,s=0;
if(a&&"function"==typeof a.recv&&(s|=a.recv(t,e),1&s))return!1;
for(var r=0,u=n.length;u>r&&(s|=n[r].recv(t,e),!(2&s));++r);
if(!(4&s)){
var p=this["__"+t+"Handler"];
p&&p.call(this,e);
}
8&s||this.__triggerOutside(t,e);
},o.prototype.__triggerOutside=function(){
var t=arguments,e=t[0];
if(e){
e=e.substr(0,1).toUpperCase()+e.substr(1);
var o=this._o["on"+e];
"function"==typeof o&&o.apply(this,t);
}
},o.prototype._setBlockPlugin=function(t,e){
this._g._blockPlugin[t]=e;
},o.prototype._synPlayStatus=function(){
function t(t){
if(a&&clearTimeout(a),n.hasCheckPlay!==!0&&(n.hasCheckPlay=!0,o._surportType=3,A.surportType=3,
!!A.debug&&console.log("_synPlayStatus mutexKey:"+n.mutexKey),t.src&&(i.src==t.src||t.src.indexOf(n.mutexKey)>=0))){
if(t.srcId){
if(t.srcId!=n.jsapiSrcId)return;
}else if(A.mutexPlayers[n.mutexKey].length>1&&A.mutexPlayers[n.mutexKey][0]!==o)return;
o._initJsapiData({
curTime:t.currentTime,
bufferedPercent:t.bufferedPercent,
starTime:+new Date-1e3*t.currentTime
}),o._trigger("jsapi2Begin2Play",t);
var e=o.jsApiData;
t.paused?(o._onTimeupdate(null,e.curTime),o._onPause()):(o._onPlay(),o._analogUpdateTime()),
o._getMusicPlayerState();
}
}
function e(){
a&&clearTimeout(a),n.hasCheckPlay!==!0&&(n.hasCheckPlay=!0,o._o.autoPlay&&o.play());
}
var o=this,i=this._o,n=this._g;
if(!A.inWechat||1*A._playtype>0)return n.hasCheckPlay=!0,void(o._o.autoPlay&&o.play());
var a;
P(o,t,e),a=setTimeout(function(){
e();
},5e3);
},o.prototype._fixAndroidSizeLimit=function(){
if(!(1*A._playtype>0)&&A.isAndroid){
var t=this._o;
!t.fileSize||t.fileSize>300||T.gtVersion("6.3.28",!0)||(this._trigger("androidForceH5"),
this._g._playtype=2);
}
},o.prototype._createAutoAndPlay=function(){
function t(){
e._trigger("h5Begin2Play"),e._h5Audio=document.createElement("audio"),e._initH5Data(!0),
e._H5bindEvent(!0),e._h5Audio.setAttribute("style","height:0;width:0;display:none"),
e._h5Audio.setAttribute("autoplay",""),e._status=0,e._onLoading(),A.isAndroidLow?(e._h5Audio.src=e._o.src,
document.body.appendChild(e._h5Audio),e._h5Audio.load()):(document.body.appendChild(e._h5Audio),
setTimeout(function(){
e._h5Audio.src=e._o.src,e._h5Audio.play();
},0)),e._surportType=2;
}
var e=this;
A.inWechat?this._stopJsapiPlay(!0,function(){
t();
}):t();
},o.prototype._destoryH5Audio=function(){
this._h5Audio&&(-1!=this._status&&"function"==typeof this._h5Audio.pause&&this._h5Audio.pause(),
document.body.removeChild(this._h5Audio),this._h5Audio=null,this._status=-1);
},o.prototype._onLoading=function(t){
this._status=4;
try{
n(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime();
},o.prototype._onPlay=function(t){
this._status=1;
try{
n(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._startCountTime();
},o.prototype._onPause=function(t){
this._status=2,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime();
},o.prototype._onEnd=function(t){
this._status=3,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),
this._endCountTime();
},o.prototype._onLoadedmetadata=function(t){
"function"==typeof this._o.onLoadedmetadata&&this._o.onLoadedmetadata.call(this,t||{});
},o.prototype._onUpdateSeekRange=function(t){
this.surportSeekRange()&&(t=Math.max(t,0),t=Math.min(t,100),"function"==typeof this._o.onUpdateSeekRange&&this._o.onUpdateSeekRange.call(this,t));
},o.prototype._onTimeupdate=function(t,e){
"function"==typeof this._o.onTimeupdate&&this._o.onTimeupdate.call(this,t||{},e),
e>0&&this._startCountTime();
},o.prototype._onError=function(t,e){
this._status=-1,"function"==typeof this._o.onError&&this._o.onError.call(this,t||{},e);
},o.prototype._initH5Event=function(){
var t=this,e=this._o,o=this._g;
if(!t._g.hasInitH5Event){
t._g.hasInitH5Event=!0;
var i=o.h5Event;
i.canplaythrough=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 canplaythrough"),t._h5Data.firstCanplaythrough=!0,
t._onPlay(e),t._onUpdateSeekRange(t._h5Data.downloadDuration||0));
},i.play=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 "+e.type),t._h5Data.firstCanplaythrough===!0&&(t._onPlay(e),
t._onUpdateSeekRange(t._h5Data.downloadDuration||0)));
},i.ended=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 ended"),t._onUpdateSeekRange(t._h5Data.downloadDuration),
t._onEnd(e));
},i.pause=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 pause"),t._o.allowPause!==!0||0==t._h5Audio.currentTime?t._onEnd(e):t._onPause(e));
},i.waiting=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 "+e.type),(1==t._status||2==t._status||4==t._status)&&t._onLoading(e));
};
var n,a=100;
i.seeking=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 "+e.type),(1==t._status||2==t._status||4==t._status)&&t._onLoading(e),
n=setTimeout(function(){
!!A.debug&&console.log("seek loading Timeout excute"),n=null,t._trigger("seekNeed2Load");
},a));
},i.seeked=function(e){
t._h5Audio&&(!!A.debug&&console.log("h5 seeked"),(1==t._status||2==t._status||4==t._status)&&(t._onPlay(e),
t._h5Audio.play()),n&&(clearTimeout(n),n=null,t._trigger("seekNotNeed2Load")));
},i.error=function(e){
var o=1*e.target.error.code||5;
(1>o||o>5)&&(o=5),t._trigger("h5Error",{
code:o
}),t._onError(e,{
type:1,
code:o
}),t._destoryH5Audio();
},i.timeupdate=function(o){
t._h5Audio&&((1==t._status||4==t._status)&&t._onUpdateSeekRange(t._getH5DownloadDuration()),
1==t._status&&t._onTimeupdate(o,t._h5Audio.currentTime),"undefined"!=typeof e.duration&&1*e.duration>0&&t._h5Audio.currentTime>=e.duration&&t._h5Stop());
},i.loadedmetadata=function(e){
t._h5Audio&&t._onLoadedmetadata(e);
};
}
},o.prototype._H5bindEvent=function(t){
var e=(this._o,this._g),o={
canplaythrough:"canplaythrough",
play:"play",
playing:"play",
ended:"ended",
pause:"pause",
seeking:"seeking",
waiting:"waiting",
seeked:"seeked",
error:"error"
};
try{
for(var i in o)o.hasOwnProperty(i)&&this._h5Audio.removeEventListener(i,e.h5Event[o[i]]);
this._h5Audio.removeEventListener("timeupdate",e.h5Event.timeupdate),this._h5Audio.removeEventListener("loadedmetadata",e.h5Event.loadedmetadata);
}catch(n){}
if(t){
for(var i in o)o.hasOwnProperty(i)&&this._h5Audio.addEventListener(i,e.h5Event[o[i]],!1);
"function"==typeof this._o.onTimeupdate&&this._h5Audio.addEventListener("timeupdate",e.h5Event.timeupdate,!1),
"function"==typeof this._o.onLoadedmetadata&&this._h5Audio.addEventListener("loadedmetadata",e.h5Event.loadedmetadata,!1);
}
},o.prototype._initData=function(){
var t=this._o;
this._createMutexKey(),A.mutexPlayers[this._g.mutexKey]?A.mutexPlayers[this._g.mutexKey].push(this):A.mutexPlayers[this._g.mutexKey]=[this],
t.jsapi2Src&&t.jsapi2Src!=t.src&&(A.mutexPlayers2[t.jsapi2Src]?A.mutexPlayers2[t.jsapi2Src].push(this):A.mutexPlayers2[t.jsapi2Src]=[this]),
this._initH5Event();
},o.prototype._createMutexKey=function(){
var t=this._o.mid||"";
this._o.src?(this._g.mutexKey=this._o.src,this._g.jsapiSrcId=A.wxtag+"_"+this._o.wxIndex):(this._g.mutexKey=c(t),
this._g.jsapiSrcId=this._g.mutexKey+"_"+this._o.wxIndex);
},o.prototype._extend=function(t){
for(var e in t)this._o[e]=t[e];
},o.prototype._initH5Data=function(t){
this._h5Data={
firstCanplaythrough:t===!0?!1:!0,
downloadDuration:0,
lastPlaytime:null
};
},o.prototype._initJsapiData=function(t){
t=t||{},this.jsApiData&&(this.jsApiData.updateTimeoutId&&clearTimeout(this.jsApiData.updateTimeoutId),
this.jsApiData.getStatusId&&clearTimeout(this.jsApiData.getStatusId)),this.jsApiData={
getStatusId:null,
getStatusTime:t.getStatusTime||2500,
updateTimeoutId:null,
seeking:!1,
starTime:t.starTime||+new Date,
curTime:t.curTime||0,
bufferedPercent:t.bufferedPercent||0,
duration:this._o.duration||void 0,
lastPlaytime:null
};
},o.prototype._getMusicPlayerState=function(){
var t=this,e=t._o,o=t.jsApiData;
o&&o.getStatusId&&clearTimeout(o.getStatusId),t._jsapi_getMusicPlayerState({
onSuccess:function(i){
i.src==e.src&&(o.curTime=i.currentTime,o.starTime=+new Date-1e3*i.currentTime,o.bufferedPercent=i.bufferedPercent,
(1==t._status||2==t._status)&&(o.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},o.getStatusTime)),t._onUpdateSeekRange(o.bufferedPercent),1==i.paused&&1==t._status?(A.debug&&console.log("_getMusicPlayerState force syn"),
t._pauseJsapiPlay(!1)):0==i.paused&&2==t._status&&(A.debug&&console.log("_getMusicPlayerState force syn"),
t._resumeJsapiPlay(!1))),t._o.onMusicPlayerInfo&&t._o.onMusicPlayerInfo(i);
},
onError:function(){
o.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},o.getStatusTime);
}
});
},o.prototype._analogUpdateTime=function(){
var t=this,e=t.jsApiData;
if(e){
if(e.updateTimeoutId&&clearTimeout(e.updateTimeoutId),1==t._status){
if(e.curTime=1*((+new Date-e.starTime)/1e3).toFixed(2),e.curTime>=e.duration)return t._stopJsapiPlay(!1),
!0;
t._onTimeupdate(null,e.curTime);
}
return e.updateTimeoutId=setTimeout(function(){
t._analogUpdateTime();
},1e3),!1;
}
},o.prototype._jsapi_getMusicPlayerState=function(t){
var e=this._o;
v.invoke("getBackgroundAudioState",{},function(o){
if(!!A.debug&&console.log("getBackgroundAudioState log:"+JSON.stringify(o||{})),
/:ok$/.test(o.err_msg)){
if(o.paused=1*o.paused,o.currentTime=o.currentTime?(1*o.currentTime).toFixed(2):0,
o.buffered){
var i=Math.floor(o.buffered/e.duration*100);
i=Math.max(i,0),i=Math.min(i,100),o.bufferedPercent=i;
}else o.bufferedPercent=0;
"function"==typeof t.onSuccess&&t.onSuccess(o);
}else"function"==typeof t.onError&&t.onError(o);
});
},o.prototype._jsapi_musicPlay=function(t){
if(this._h5Audio&&this._destoryH5Audio(),2==A._playtype)return void("function"==typeof t.onError&&t.onError({}));
var e=this,o=this._o;
v.invoke("musicPlay",{
app_id:"a",
title:o.title,
singer:o.singer,
epname:o.epname,
coverImgUrl:o.coverImgUrl,
dataUrl:o.src,
lowbandUrl:o.src,
webUrl:o.webUrl
},function(i){
!!A.debug&&console.log("playlog:"+JSON.stringify(i||{})),i.err_msg.indexOf("ok")>=0?(e._trigger("jsapi1Begin2Play"),
e._surportType=1,A.surportType=1,e._initJsapiData(),e._onPlay(),"undefined"!=typeof o.duration&&1*o.duration>0&&e._analogUpdateTime(),
e._onUpdateSeekRange(0),"function"==typeof t.onSuccess&&t.onSuccess(i)):"function"==typeof t.onError&&t.onError(i);
});
},o.prototype._jsapi_setBackgroundAudioState=function(t){
if(this._h5Audio&&this._destoryH5Audio(),console.log("_playtype",A._playtype),1*A._playtype>0){
if("function"==typeof t.onError){
var e={};
e.err_code=1,t.onError(e);
}
}else{
var o=this,i=this._o,n=o._g;
console.log("invoke set setBackgroundAudioState with param",i),v.invoke("setBackgroundAudioState",{
protocol:i.protocal||"",
src:i.jsapi2Src||i.src,
lowbandUrl:i.jsapi2Src||i.src,
title:i.title,
epname:i.epname,
singer:i.singer,
srcId:n.jsapiSrcId,
coverImgUrl:i.coverImgUrl,
webUrl:i.webUrl,
musicbar_url:i.musicbar_url||i.webUrl
},function(e){
!!A.debug&&console.log("setBackgroundAudioState log:"+JSON.stringify(e||{})),e.err_msg.indexOf("ok")>=0?("function"==typeof t.onSuccess&&t.onSuccess("waiting"),
n.stateChangeCallback.play=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("play"):0!=e&&"function"==typeof t.onError&&t.onError({
err_code:2,
err_msg:o||""
});
}):"function"==typeof t.onError&&(e=e||{},e.err_code=1,t.onError(e));
});
}
},o.prototype._jsapi_operateBackgroundAudio=function(t){
var e=this,o=(this._o,e._g),i=1*t.position||0;
v.invoke("operateBackgroundAudio",{
operationType:t.type,
currentTime:i
},function(e){
if(!!A.debug&&console.log("operateBackgroundAudio "+t.type+",position:"+i+", log:"+JSON.stringify(e||{})),
e.err_msg.indexOf("ok")>=0){
var n=t.type;
"seek"==n?(o.stateChangeCallback.seeking=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeking"):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
},o.stateChangeCallback.seeked=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeked"):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
}):o.stateChangeCallback[n]=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess():0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
};
}else"function"==typeof t.onError&&t.onError(e);
});
},o.prototype._jsapiPlay=function(){
{
var t=this;
this._o;
}
console.log("supporttype",A.surportType),1==A.surportType?this._jsapi_musicPlay({
onError:function(){
t._h5Play();
}
}):this._jsapi_setBackgroundAudioState({
onSuccess:function(e){
"waiting"===e?(t._trigger("jsapi2Begin2Play",e),t._initJsapiData(),t._surportType=3,
A.surportType=3,t._onLoading()):"play"===e&&(t._initJsapiData(),t._onPlay(),t._analogUpdateTime(),
t._getMusicPlayerState(),t._trigger("jsapi2PlaySuccess"));
},
onError:function(e){
e&&1==e.err_code?t._jsapi_musicPlay({
onError:function(){
t._h5Play();
}
}):(t._h5Play(),t._trigger("jsapi2Begin2PlayErr"));
}
});
},o.prototype._getJsapiDownloadSec=function(){
this._getMusicPlayerState();
var t=Math.floor(this._o.duration*this.jsApiData.bufferedPercent/100);
return!!A.debug&&console.log("downloadSec:"+t),t;
},o.prototype._jsapiSeek=function(t){
function e(){
n.seeking=!1,o._onPlay(),n.starTime=+new Date-1e3*a,o._analogUpdateTime(),o._getMusicPlayerState();
}
var o=this,i=this._g,n=(this._o,this.jsApiData),a=parseInt(t,10);
this._o.duration&&a>=this._o.duration&&(a=this._o.duration-1),n.getStatusId&&clearTimeout(n.getStatusId),
n.updateTimeoutId&&clearTimeout(n.updateTimeoutId),n.seekWaitId&&clearTimeout(n.seekWaitId),
n.seeking=!0;
var s,r,u=100;
this._jsapi_operateBackgroundAudio({
type:"seek",
position:a,
onError:function(){
o._trigger("seekErr"),!!A.debug&&console.log("seek callback fail"),n.seeking=!1,
o._analogUpdateTime(),o._getMusicPlayerState();
},
onSuccess:function(t){
console.log("jsapi seek res is ",t),"seeking"==t?(!!A.debug&&console.log("seeking callback success"),
n.seeking=!0,o._onLoading(),i.stateChangeCallback.play=function(){
!!A.debug&&console.log("seeked to play"),s&&clearTimeout(s),e();
},r=setTimeout(function(){
!!A.debug&&console.log("seek loading Timeout excute"),r=null,o._trigger("seekNeed2Load");
},u)):"seeked"==t&&(!!A.debug&&console.log("seeked callback success"),(2==o._status||4==o._status)&&T.cpVersion("6.6.0",-1)&&(s=setTimeout(function(){
!!A.debug&&console.log("setTimeout to play"),i.stateChangeCallback.play=null,o._resumeJsapiPlay(!0);
},1e3)),r&&(clearTimeout(r),r=null,o._trigger("seekNotNeed2Load")));
}
}),o._getMusicPlayerState();
},o.prototype._resumeJsapiPlay=function(t,e){
function o(t){
var e=i.jsApiData;
e.starTime=+new Date-1e3*e.curTime,i._onPlay(),i._analogUpdateTime(),i._getMusicPlayerState(),
"function"==typeof t&&t();
}
var i=this;
1==this._surportType?this._jsapiPlay():3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"play",
onError:function(){
i._stopJsapiPlay(!1,function(){
i.play();
});
},
onSuccess:function(){
o(e);
}
}):o(e));
},o.prototype._pauseJsapiPlay=function(t,e,o){
function i(t){
var e=n.jsApiData;
n._analogUpdateTime(),n._getMusicPlayerState(),e&&e.updateTimeoutId&&clearTimeout(e.updateTimeoutId),
e.updateTimeoutId=null,t===!0&&e&&e.getStatusId&&clearTimeout(e.getStatusId),1==n._status&&n._onPause();
}
var n=this;
return 2==n._status?(i(e),void("function"==typeof o&&o())):void(1==this._surportType?this._stopJsapiPlay(t,o):3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"pause",
onSuccess:function(){
i(e),"function"==typeof o&&o();
},
onError:function(){
n._stopJsapiPlay(!0,o);
}
}):(i(e),"function"==typeof o&&o())));
},o.prototype._stopJsapiPlay=function(t,e){
function o(t){
n._onTimeupdate(null,0),n._onUpdateSeekRange(0),n._onEnd(),n._initJsapiData(),"function"==typeof t&&t();
}
{
var n=this;
n.jsApiData;
}
t?1==n._surportType?i(function(){
o(e);
}):n._jsapi_operateBackgroundAudio({
type:"stop",
onSuccess:function(){
o(e);
},
onError:function(){
o(e);
}
}):o(e);
},o.prototype._getH5DownloadSec=function(){
var t=Math.floor(this._o.duration*this._getH5DownloadDuration()/100);
return!!A.debug&&console.log("h5 downloadSec:"+t),t;
},o.prototype._getH5DownloadDuration=function(){
if(!this._h5Audio)return 0;
if(this._h5Data.downloadDuration>=100)return 100;
var t=this._h5Audio.buffered,e=t.end(t.length-1);
return this._h5Data.downloadDuration=parseInt(e/this._o.duration*100,10),this._h5Data.downloadDuration;
},o.prototype._h5Play=function(){
0!==A.surportType&&(this._h5Audio?(this._h5Audio.ended||this._h5Audio.paused)&&(this._trigger("h5Begin2Play"),
this._initH5Data(),this._onLoading(),this._H5bindEvent(!0),this._h5Audio.currentTime=0):this._createAutoAndPlay());
},o.prototype._h5Resume=function(){
this._h5Audio&&this._h5Audio.play();
},o.prototype._h5Stop=function(){
this._h5Audio&&(this._onUpdateSeekRange(0),this._onEnd(),this._H5bindEvent(!1),this._h5Audio.pause(),
this._h5Audio.currentTime=0,this._initH5Data());
},o.prototype._h5Seek=function(t){
if(this._h5Audio){
var e=(this._h5Data,parseInt(t,10));
e=Math.min(e,this._o.duration),!!A.debug&&console.log("h5 seek position:"+e),this._h5Audio.currentTime=e;
}
},o.prototype._startCountTime=function(){
1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio&&this._h5Data&&null===this._h5Data.lastPlaytime&&(this._h5Data.lastPlaytime=this._h5Audio.currentTime):null===this.jsApiData.lastPlaytime&&(this.jsApiData.lastPlaytime=this.jsApiData.curTime);
},o.prototype._endCountTime=function(){
if(1!=this._surportType&&3!=this._surportType||!this.jsApiData){
if(this._h5Audio&&this._h5Data){
var t=this._h5Audio,e=this._h5Data;
t.currentTime>0&&t.currentTime>e.lastPlaytime&&null!==e.lastPlaytime&&(this._g.totalPlayTime+=t.currentTime-e.lastPlaytime),
e.lastPlaytime=null;
}
}else{
var o=this.jsApiData;
o.curTime>0&&o.curTime>o.lastPlaytime&&null!==o.lastPlaytime&&(this._g.totalPlayTime+=o.curTime-o.lastPlaytime),
o.lastPlaytime=null;
}
},o.prototype._delMutexPlayers=function(){
var t=this._o,e=this._g.mutexKey,o=A.mutexPlayers[e];
if(o){
for(var i=0,n=o.length;n>i;i++)if(o[i]===this){
o.splice(i,1);
break;
}
if(0==o.length)try{
delete A.mutexPlayers[e];
}catch(a){}
}
if(t.jsapi2Src&&A.mutexPlayers2[t.jsapi2Src]){
for(var s=A.mutexPlayers2[t.jsapi2Src],i=0,n=s.length;n>i;i++)if(s[i]===this){
s.splice(i,1);
break;
}
if(0==s.length)try{
delete A.mutexPlayers2[t.jsapi2Src];
}catch(a){}
}
},o.prototype.resetPlayTotalTime=function(){
this._g.totalPlayTime=0;
},o.prototype.getPlayTotalTime=function(){
return this._endCountTime(),this._g.totalPlayTime;
},o.prototype.surportSeekRange=function(){
return 1==A._playtype?!1:2==this._surportType||3==this._surportType?!0:!1;
},o.prototype.setSrc=function(t){
-1==t.indexOf("?")&&(t+="?"),t+=c(this._o.mid),this._o.src=t,this._delMutexPlayers(),
this._g.mutexKey=this._o.src,A.mutexPlayers[this._g.mutexKey]?A.mutexPlayers[this._g.mutexKey].push(this):A.mutexPlayers[this._g.mutexKey]=[this];
},o.prototype.getSrc=function(){
return this._o.src||"";
},o.prototype.setDuration=function(t){
this._o.duration=t||0;
},o.prototype.getSurportType=function(){
return this._surportType||0;
},o.prototype.getPlayStatus=function(){
return this._status;
},o.prototype.getCurTime=function(){
return 1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio?this._h5Audio.currentTime:0:this.jsApiData.curTime||0;
},o.prototype.getDuration=function(){
return this._o.duration||void 0;
},o.prototype.pause=function(t,e,o){
return o===!0||this._o.allowPause?void(1==this._surportType||3==this._surportType?this._pauseJsapiPlay(t===!1?!1:!0,!1,function(){
"function"==typeof e&&e();
},function(){
"function"==typeof e&&e();
}):2==this._surportType&&this._h5Audio&&"function"==typeof this._h5Audio.pause&&(this._h5Audio.pause(),
"function"==typeof e&&e())):void this.stop(t,e);
},o.prototype.stop=function(t,e){
return 1==this._surportType||3==this._surportType?void this._stopJsapiPlay(t===!1?!1:!0,e):(2==this._surportType&&this._h5Audio&&this._h5Stop(),
void("function"==typeof e&&e()));
},o.prototype.destory=function(){
this.stop(),this._h5Audio&&(document.body.removeChild(this._h5Audio),this._h5Audio=null),
this._delMutexPlayers();
},o.prototype.resume=function(t,e,o){
(o===!0||2==this._status&&this._o.allowPause)&&(2==this._surportType&&this._h5Audio?this._h5Resume():A.inWechat&&this._resumeJsapiPlay(t===!1?!1:!0));
},o.prototype.onload=function(){
this._onLoading();
},o.prototype.play=function(){
var t=this,e=this._g;
if(t._o.src)return console.log("before play status is",t._status,e.hasCheckPlay),
2==t._status&&t._o.allowPause?void t.resume():(e.playTimeoutId&&clearTimeout(e.playTimeoutId),
e.hasCheckPlay?void(A.inWechat?(console.log("jsapi play"),this._jsapiPlay()):0!=A.surportType&&this._h5Play()):void(e.playTimeoutId=setTimeout(function(){
t.play();
},1e3)));
},o.prototype.seek=function(t){
{
var e=this;
this._g;
}
return 1!=e._status&&2!=e._status?void console.log("player status is",e._status):(console.log("support type is",this._surportType),
3==this._surportType?(this._endCountTime(),void this._jsapiSeek(t)):2==this._surportType&&this._h5Audio?(this._endCountTime(),
void this._h5Seek(t)):void 0);
},o.prototype.getBackgroundAudioState=function(t){
t||(t={}),v.invoke("getBackgroundAudioState",{},function(e){
/:ok$/.test(e.err_msg)?(e.paused=1*e.paused,t.success&&t.success(e)):t.error&&t.error(e);
});
},o.prototype.setOption=function(t){
this._extend(t),t.duration&&this.jsApiData&&(this.jsApiData.duration=t.duration);
},{
init:r,
triggerUnloadPlaying:f,
isAndroid:A.isAndroid,
getSurportType:s,
getQuery:m
};
});define("appmsg/weapp_common.js",["biz_wap/utils/ajax.js","biz_wap/jsapi/core.js"],function(e,n,p,a){
"use strict";
function o(){
var e=navigator.userAgent.match(/MicroMessenger\/(\d+)\.(\d+)\.(\d+)/);
if(e){
var n=Number(e[1]),p=Number(e[2]),a=Number(e[3]);
n>6?g.canJumpOnTap=!0:6===n&&p>5?g.canJumpOnTap=!0:6===n&&5===p&&a>=3&&(g.canJumpOnTap=!0);
}else navigator.userAgent.match(/MicroMessenger\//)||(g.isNonWechat=!0);
t();
}
function t(){
try{
g.appidSnInfo=JSON.parse(window.weapp_sn_arr_json).weapp_card_list;
}catch(e){
g.appidSnInfo=[];
}
if(!g.appidSnInfo||0==g.appidSnInfo.length)return g.getInfoState=1,void r();
for(var n={
__biz:window.biz||"",
mid:window.mid||"",
idx:window.idx||"",
uin:window.uin||"",
key:window.key||"",
pass_ticket:window.pass_ticket||"",
weapp_num:g.appidSnInfo.length
},p=0;p<n.weapp_num;p++)n["weapp_appid_"+p]=g.appidSnInfo[p].appid,n["weapp_sn_"+p]=g.appidSnInfo[p].sn;
var a="/mp/appmsg_weapp?action=batch_get_weapp";
for(var o in n)a+="&"+o+"="+encodeURIComponent(n[o]);
d({
url:a,
type:"GET",
dataType:"json",
async:!0,
success:function(e){
try{
if(g.appidInfoResp=e,e.base_resp.ret)throw new Error("Fetch weapp info but get ret="+e.base_resp.ret);
g.data={
infoMap:{},
appid:e.appid||"",
appmsg_compact_url:e.appmsg_compact_url||"",
pathArgs:"appid="+encodeURIComponent(e.appid)+(e.appmsg_compact_url?"&appmsg_compact_url="+encodeURIComponent(e.appmsg_compact_url):"")
};
for(var n=e.weapp_info,p=0;p<n.length;p++)g.data.infoMap[n[p].weapp_appid]=n[p];
g.getInfoState=4;
}catch(a){
g.getInfoState=3,g.appidInfoCatchErr=a;
}
r();
},
error:function(){
g.getInfoState=2,r();
}
});
}
function r(){
if(1==g.getInfoState||2==g.getInfoState)for(var e=0,n=g.appInfoErrQueue.length;n>e;e++){
var p=g.appInfoErrQueue[e];
"function"==typeof p&&p({
code:g.getInfoState
});
}else if(3==g.getInfoState)for(var e=0,n=g.appInfoErrQueue.length;n>e;e++){
var p=g.appInfoErrQueue[e];
"function"==typeof p&&p({
code:g.getInfoState,
resp:g.appidInfoResp,
catchErr:g.appidInfoCatchErr
});
}else if(4==g.getInfoState)for(var e=0,n=g.appInfoSucQueue.length;n>e;e++){
var p=g.appInfoSucQueue[e];
"function"==typeof p&&p({
resp:g.appidInfoResp,
data:g.data
});
}
g.appInfoErrQueue=[],g.appInfoSucQueue=[];
}
function i(e){
1!=g.getInfoState&&2!=g.getInfoState||"function"!=typeof e.onError?3==g.getInfoState&&"function"==typeof e.onError?e.onError({
code:g.getInfoState,
resp:g.appidInfoResp,
catchErr:g.appidInfoCatchErr
}):4==g.getInfoState&&"function"==typeof e.onSuccess?e.onSuccess({
resp:g.appidInfoResp,
data:g.data
}):("function"==typeof e.onSuccess&&g.appInfoSucQueue.push(e.onSuccess),"function"==typeof e.onError&&g.appInfoErrQueue.push(e.onError)):e.onError({
code:g.getInfoState
});
}
function c(e){
if(!e||!g.data)return"";
var n="",p=e.indexOf("?");
return n=p>=0?e.slice(0,p)+(p>0?".html":"")+e.slice(p)+"&"+g.data.pathArgs:e+(""!==e?".html?":"?")+g.data.pathArgs;
}
function f(e){
e=e||{};
var n;
if(e.options)n=e.options;else if(e.appid&&g.data){
var p=g.data.infoMap[e.appid];
p&&(n={
userName:p.weapp_username,
scene:e.scene,
sceneNote:e.sceneNote,
relativeURL:c(e.path)
},void 0!==p.app_version&&(n.appVersion=p.app_version));
}
n&&(n.scene=e.scene||1058,g.canJumpOnTap?I.invoke("openWeApp",n,function(n){
"system:function_not_exist"===n.err_msg?g.isNonWechat?("function"!=typeof e.beforeNonWechatWarn||e.beforeNonWechatWarn()!==!1)&&s():("function"!=typeof e.beforeJumpBackupPage||e.beforeJumpBackupPage()!==!1)&&u(e.appid):"function"==typeof e.onJsapiCallback&&e.onJsapiCallback(n);
}):g.isNonWechat?("function"!=typeof e.beforeNonWechatWarn||e.beforeNonWechatWarn()!==!1)&&s():("function"!=typeof e.beforeJumpBackupPage||e.beforeJumpBackupPage()!==!1)&&u(e.appid));
}
function u(e){
location.href="https://mp.weixin.qq.com/mp/waerrpage?type=upgrade&appid="+encodeURIComponent(e)+"#wechat_redirect";
}
function s(){
setTimeout(function(){
a("请在微信内打开小程序");
},0);
}
var d=e("biz_wap/utils/ajax.js"),I=e("biz_wap/jsapi/core.js"),g={
canJumpOnTap:!1,
isNonWechat:!1,
data:null,
appidInfoResp:null,
appidInfoCatchErr:null,
appInfoSucQueue:[],
appInfoErrQueue:[],
appidSnInfo:[],
getInfoState:0
};
return o(),{
canJumpOnTap:g.canJumpOnTap,
isNonWechat:g.isNonWechat,
getAppidInfo:i,
appidSnInfo:g.appidSnInfo,
getRelativeURL:c,
jumpUrl:f
};
});define("pages/voice_component.js",["biz_common/dom/event.js","biz_common/tmpl.js","pages/music_player.js","pages/player_adaptor.js","biz_common/dom/class.js","pages/report.js","biz_common/utils/monitor.js","pages/music_report_conf.js","pages/qqmusic_ctrl.js","pages/kugoumusic_ctrl.js"],function(e,t,o,a){
"use strict";
function r(){
C.hasInit||(p(),s(),c(),C.hasInit=!0);
}
function n(e){
r(),this._o={
protocal:"",
wxIndex:0,
type:0,
comment_id:"",
src:"",
jsapi2Src:"",
mid:"",
songId:"",
otherid:"",
albumid:"",
autoPlay:!1,
duration:0,
needVioceMutex:!0,
appPlay:!0,
title:"",
allowPause:!1,
singer:"",
epname:"",
coverImgUrl:"",
webUrl:[location.protocol,"//mp.weixin.qq.com/s?referFrom=#referFrom#&songid=#songId#&__biz=",window.biz,"&mid=",window.mid,"&idx=",window.idx,"&sn=",window.sn,"#wechat_redirect"].join(""),
playingCss:"",
pauseCss:"",
playCssDom:"",
playArea:"",
progress:"",
detailUrl:"",
detailArea:"",
fileSize:0,
playtimeDom:"",
loadingDom:"",
bufferDom:"",
playdotDom:"",
seekRange:"",
seekContainer:""
},this._init(e),C.allComponent.push(this);
}
function i(e,t,o,a){
C.num++,t.musicSupport=C.musicSupport,t.show_not_support=!1,C.musicSupport||1!=C.num||(t.show_not_support=!0);
var r=document.createElement("div"),n="";
if(n=h.tmpl(e,t),r.innerHTML=n,a===!0)o.appendChild(r.children[0]);else{
var i=o.parentNode;
if(!i)return;
i.lastChild===o?i.appendChild(r.children[0]):i.insertBefore(r.children[0],o.nextSibling);
}
}
function s(){
C.hasInit||v.inQMClient&&l("QMClient_pv",1);
}
function p(){
window.reportMid=[],window.reportVoiceid=[];
for(var e in I)if(I.hasOwnProperty(e)){
var t=I[e],o=t.split("_");
C.reportData2[e]={
id:o[0],
key:o[1],
count:0
};
}
}
function l(e,t){
C.reportData2[e]&&(t=t||1,C.reportData2[e].count+=t,C.debug&&console.log("addpv:"+e+" count:"+C.reportData2[e].count));
}
function c(){
f.on(window,"unload",d);
}
function d(){
D.triggerUnloadPlaying(),u();
for(var e=0,t=C.allComponent.length;t>e;e++){
var o=C.allComponent[e];
o.player&&"function"==typeof o.player.getPlayTotalTime&&(C.reportData[o._o.type].play_last_time[o._g.posIndex]=parseInt(1e3*o.player.getPlayTotalTime()));
}
for(var e in C.reportData)x.musicreport({
data:C.reportData[e]
});
p();
for(var e=0,t=C.allComponent.length;t>e;e++){
var o=C.allComponent[e];
o&&"function"==typeof o._initReportData&&o._initReportData(),o.player&&"function"==typeof o.player.resetPlayTotalTime&&o.player.resetPlayTotalTime();
}
}
function u(){
for(var e in C.reportData2)if(C.reportData2.hasOwnProperty(e)){
var t=C.reportData2[e];
t.count>0&&w.setSum(t.id,t.key,t.count);
}
w.send();
}
function g(e){
return new n(e);
}
function _(e){
if(isNaN(e))return"00:00";
e=Math.floor(e);
var t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),a=e-3600*t-60*o;
return 0!=t?(10>t&&(t="0"+t),t+=":"):t="",10>o&&(o="0"+o),10>a&&(a="0"+a),t+o+":"+a;
}
function y(e){
return e=(e||"").replace(/&#96;/g,"`").replace(/&#61;/g,"=").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");
}
function m(e){
return e=(e||"").replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/=/g,"&#61;").replace(/`/g,"&#96;");
}
var f=e("biz_common/dom/event.js"),h=e("biz_common/tmpl.js"),D=e("pages/music_player.js"),v=e("pages/player_adaptor.js"),k=e("biz_common/dom/class.js"),x=e("pages/report.js"),w=e("biz_common/utils/monitor.js"),I=e("pages/music_report_conf.js"),C={
allComponent:[],
hasInit:!1,
reportId:"28306",
musicSupport:D.getSurportType(),
debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1?!0:!1,
reportData:{},
posIndex:{},
num:0,
reportData2:{},
adapter:{
m:e("pages/qqmusic_ctrl.js"),
k:e("pages/kugoumusic_ctrl.js")
}
};
return n.prototype._init=function(e){
this._extend(e),this._g={
posIndex:void 0,
tag:"",
canDragBar:!1,
barDraging:!1,
canGoDetail:!0
},this._g.tag=5==this._o.type||6==this._o.type?"k":this._o.type>=2&&this._o.type<=4?"v":7==this._o.type?"a":"m",
this._initData(),this._initQQmusicLyric(),this._initReportData(),this._initPlayer();
},n.prototype._initData=function(){},n.prototype._initQQmusicLyric=function(){
var e=this._o,t=this._g;
e.webUrl="m"==t.tag?e.webUrl.replace("#songId#",e.songId||"").replace("#referFrom#","music.qq.com"):e.webUrl.replace("#songId#","").replace("#referFrom#","");
},n.prototype._initReportData=function(){
var e=this._o,t=this._g;
"v"==t.tag?window.reportVoiceid.push(e.songId):"m"==t.tag&&window.reportMid.push(e.songId),
"undefined"==typeof C.reportData[e.type]&&(C.reportData[e.type]=x.getMusicReportData(e),
C.posIndex[e.type]=0),"undefined"==typeof t.posIndex&&(t.posIndex=C.posIndex[e.type]++);
var o=C.reportData[e.type];
o.musicid[t.posIndex]=e.songId,o.commentid[t.posIndex]=e.comment_id,o.hasended[t.posIndex]=0,
o.mtitle[t.posIndex]=e.title,o.detail_click[t.posIndex]=0,o.duration2[t.posIndex]=parseInt(1e3*e.duration),
o.errorcode[t.posIndex]=0,o.play_duration2[t.posIndex]=0,o.seek[t.posIndex]=0,o.seek_position[t.posIndex]=[],
o.play_last_time[t.posIndex]=0,o.local_time[t.posIndex]=0,o.seek_loaded[t.posIndex]=[];
},n.prototype._initPlayer=function(){
if(C.musicSupport){
var e=this,t=this._o,o=this._g.tag;
t.onStatusChange=this._statusChangeCallBack(),t.onTimeupdate=this._timeupdateCallBack(),
t.onError=this._errorCallBack(),t.onUpdateSeekRange=this._onUpdateSeekRange(),t.onAndroidForceH5=function(){
l("force_h5",1);
},t.onH5Begin2Play=function(){
l(o+"_pv",1),l(o+"_h5_pv",1);
},t.onH5Error=function(t,a){
l(o+"_h5_err_total",1),l(o+"_h5_err_"+a.code,1),e._reportH5Error({
type:1,
code:a.code
});
},t.onJsapi1Begin2Play=function(){
l(o+"_pv",1),l(o+"_wx_pv",1),l(o+"_wx_pv_1",1);
},t.onJsapi2Begin2Play=function(e,a){
l(o+"_pv",1),l(o+"_wx_pv",1),l(o+"_wx_pv_2",1),t.jsapi2Src&&t.jsapi2Src!=t.src&&l("aac_pv",1),
t.musicPlayerOnJsapi2Begin2Play&&t.musicPlayerOnJsapi2Begin2Play(a);
},t.onJsapi2PlaySuccess=function(e,o){
t.musicPlayerOnJsapi2PlaySuccess&&t.musicPlayerOnJsapi2PlaySuccess(o);
},t.onJsapi2Begin2PlayErr=function(){
if(l(o+"_wx_err_1",1),t.jsapi2Src&&t.jsapi2Src!=t.src){
var e="acc_start_error;type:#type#;uin:"+(top.window.user_uin||"")+";playurl:"+t.jsapi2Src+";pageurl:"+top.location.href;
D.isAndroid?(x.logReport("",e.replace("#type#","android"),"ajax"),l("android_aac_err_1",1)):(x.logReport("",e.replace("#type#","ios"),"ajax"),
l("ios_aac_err_1",1));
}
},t.onJsapi2PlayingErr=function(){
if(l(o+"_wx_err_2",1),t.jsapi2Src&&t.jsapi2Src!=t.src){
var e="acc_ing_error;type:#type#;uin:"+(top.window.user_uin||"")+";playurl:"+t.jsapi2Src+";pageurl:"+top.location.href;
D.isAndroid?(x.logReport("",e.replace("#type#","android"),"ajax"),l("android_aac_err_2",1)):(x.logReport("",e.replace("#type#","ios"),"ajax"),
l("ios_aac_err_2",1));
}
},t.onSeekErr=function(){
if(l(o+"_seek_err",1),t.jsapi2Src&&t.jsapi2Src!=t.src){
var e="acc_seek_error;type:#type#;uin:"+(top.window.user_uin||"")+";playurl:"+t.jsapi2Src+";pageurl:"+top.location.href;
D.isAndroid?(x.logReport("",e.replace("#type#","android"),"ajax"),l("android_aac_err_3",1)):(x.logReport("",e.replace("#type#","ios"),"ajax"),
l("ios_aac_err_3",1));
}
},t.onUnloadPlaying=function(){
l(o+"_unload_wx_pv",1);
},t.onQMClientPlay=function(){
l("QMClient_play",1);
},t.onSeekNeed2Load=function(){
if(e.player&&e.player.surportSeekRange()&&t.playdotDom){
var o=C.reportData[e._o.type],a=o.seek_position[e._g.posIndex].length;
a>0&&(o.seek_loaded[e._g.posIndex][a-1]=1);
}
},t.onSeekNotNeed2Load=function(){
if(e.player&&e.player.surportSeekRange()&&t.playdotDom){
var o=C.reportData[e._o.type],a=o.seek_position[e._g.posIndex].length;
a>0&&(o.seek_loaded[e._g.posIndex][a-1]=0);
}
},v.create(this._o,{
callback:function(t){
e.player=t,e.afterCreatePlayer();
}
});
}
},n.prototype.afterCreatePlayer=function(){
this._playEvent();
},n.prototype.isInSeekrang=function(e){
var t=this._o.seekRange;
if(!t)return!1;
if(t===e)return!0;
for(var o=t.getElementsByTagName("*"),a=0,r=o.length;r>a;a++)if(o[a]===e)return!0;
return!1;
},n.prototype._playEvent=function(){
var e=this,t=this._o,o=this._g;
if(t.detailUrl&&t.detailArea&&f.on(t.detailArea,"click",function(r){
if(!o.barDraging&&o.canGoDetail){
var n=r.target||r.srcElement;
n&&e.isInSeekrang(n)||("v"==o.tag?(C.reportData[t.type].detail_click[o.posIndex]=1,
window.location.href=t.detailUrl):("m"==o.tag||"k"==o.tag)&&C.adapter[o.tag].getPlayUrl(t,{
callback:function(e){
e.canplay?(C.reportData[t.type].detail_click[o.posIndex]=1,window.location.href=t.detailUrl):e.msg&&setTimeout(function(){
a(e.msg);
},0);
}
}));
}
}),C.musicSupport){
var r=0,n=4,i=5;
2==t.type?r=3:3==t.type?r=6:4==t.type?r=7:7==t.type?r=11:"m"==o.tag?r=1:"k"==o.tag&&(r=10);
var s="";
s=t.allowPause?t.pauseCss||t.playingCss:t.playingCss,f.tap(t.playArea,function(){
return console.log("click playArea",k.hasClass(t.playCssDom,s)),k.hasClass(t.playCssDom,s)?(t.allowPause?e.player.pause():e.player.stop(),
x.report({
type:r,
comment_id:t.comment_id,
voiceid:t.songId,
action:i
})):"v"==o.tag||"a"==o.tag?e._playMusic(r,n):C.adapter[o.tag].getPlayUrl(t,{
callback:function(i){
i.canplay&&i.play_url?(i.duration&&(t.duration=i.duration,e.player.setDuration(t.duration),
C.reportData[t.type].duration2[o.posIndex]=parseInt(1e3*t.duration)),e.player.setSrc(i.play_url),
e._playMusic(r,n)):i.msg&&setTimeout(function(){
a(i.msg);
},0);
}
}),!1;
}),e._dragEvent();
}
},n.prototype._dragEvent=function(){
var e=this,t=this._o,o=this._g,a=t.seekRange;
if(a){
var r=0,n=a,i=!1,s=window.__zoom||1;
for(1!=s&&(i=!0);n&&n!=document.body;)r+=i?n.offsetLeft*s:n.offsetLeft,"page-content"==n.id&&(i=!1),
n=n.offsetParent;
var p=e.player.getDuration();
o.seekData={
zoom:s,
offsetLeft:r,
duration:p,
rangeWidth:a.offsetWidth,
startTime:0,
dragTime:0,
downX:0,
moveX:0
},f.on(a,"mousedown",function(t){
o.canDragBar&&(e._pointerDownHandler({
x:t.pageX||t.clientX
}),t.preventDefault());
}),f.on(t.seekContainer,"mousemove",function(t){
o.canDragBar&&o.barDraging&&(e._pointerMoveHandler({
x:t.pageX||t.clientX
}),t.preventDefault(),t.stopPropagation());
}),f.on(document.body,"mouseup",function(t){
return o.canDragBar&&o.barDraging?(e._pointerUpHandler({
x:t.pageX||t.clientX
}),t.preventDefault(),t.stopPropagation(),!1):void 0;
}),f.on(a,"touchstart",function(t){
o.canDragBar&&(e._pointerDownHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault());
}),f.on(a,"touchmove",function(t){
return o.canDragBar&&o.barDraging?(e._pointerMoveHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault(),void t.stopPropagation()):void console.log("no can drag",o.canDragBar,o.barDraging);
}),f.on(a,"touchend",function(t){
return o.canDragBar&&o.barDraging?(e._pointerUpHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault(),t.stopPropagation(),!1):void console.log("no can drag",o.canDragBar,o.barDraging);
});
}
},n.prototype._pointerDownHandler=function(e){
var t=this._g;
t.barDraging=!0,t.canGoDetail=!1,t.seekData.downX=e.x,t.seekData.startTime=this.player.getCurTime();
},n.prototype._pointerMoveHandler=function(e){
var t=this._g,o=t.seekData;
o.moveX=e.x;
var a=(o.moveX-o.offsetLeft)/o.zoom/o.rangeWidth;
a=Math.min(a,1),a=Math.max(a,0),o.dragTime=a*o.duration,o.dragTime!=o.startTime&&this._updateProgressBar(o.dragTime);
},n.prototype._pointerUpHandler=function(e){
var t=this._g,o=t.seekData;
o.dragTime||this._pointerMoveHandler({
x:e.x
}),t.barDraging=!1,this.player.seek(o.dragTime),C.reportData[this._o.type].seek[t.posIndex]=1,
C.reportData[this._o.type].seek_position[t.posIndex].push(parseInt(1e3*o.startTime)+","+parseInt(1e3*o.dragTime));
var a=C.reportData[this._o.type].seek_position[t.posIndex].length;
C.reportData[this._o.type].seek_loaded[t.posIndex][a-1]=0,t.seekData.startTime=0,
t.seekData.dragTime=0,t.seekData.downX=0,t.seekData.moveX=0,setTimeout(function(){
t.canGoDetail=!0;
},1e3);
},n.prototype._playMusic=function(e,t){
var o=this._o,a=this._g;
this.player.play(),C.reportData[o.type].hasended[a.posIndex]=1,0==C.reportData[o.type].local_time[a.posIndex]&&(C.reportData[o.type].local_time[a.posIndex]=parseInt(+new Date/1e3)),
x.report({
type:e,
comment_id:o.comment_id,
voiceid:o.songId,
action:t
});
},n.prototype._extend=function(e){
for(var t in e)this._o[t]=e[t];
},n.prototype._onUpdateSeekRange=function(){
var e=this,t=e._o,o=e._g;
return function(e){
this.surportSeekRange()&&t.bufferDom&&t.playdotDom?(o.canDragBar=!0,t.playdotDom.style.display="block",
t.bufferDom.style.width=1*e+"%"):(o.canDragBar=!1,t.playdotDom&&(t.playdotDom.style.display="none"));
};
},n.prototype._statusChangeCallBack=function(){
var e=this;
return function(t,o){
e._updatePlayerCss(this,o),e._o.musicPlayerStatusChange&&e._o.musicPlayerStatusChange(o);
};
},n.prototype._timeupdateCallBack=function(){
var e=this,t=this._o,o=this._g;
return function(a,r){
e._updateProgress(r),0!=r&&(C.reportData[t.type].play_duration2[o.posIndex]=parseInt(1e3*r));
};
},n.prototype._errorCallBack=function(){
var e=this,t=this._o,o=this._g;
return function(a,r){
C.reportData[t.type].errorcode[o.posIndex]=r.code,e._updatePlayerCss(this,3);
};
},n.prototype._reportH5Error=function(e){
if("mp.weixin.qq.com"==location.host&&1==e.type||C.debug){
var t=["code:",e.code,";type:",this._o.type,";url:",window.location.href];
this.player&&t.push(";src:"+this.player.getSrc());
var o=new Image;
o.src=["https://badjs.weixinbridge.com/badjs?level=4&id=112&msg=",encodeURIComponent(t.join("")),"&uin=",window.uin||"","&from=",this._o.type].join("");
}
},n.prototype._updatePlayerCss=function(e,t){
!!C.debug&&console.log("status:"+t);
{
var o=this._o,a=o.playCssDom;
o.progress;
}
2==t?(k.removeClass(a,o.playingCss),o.pauseCss&&k.removeClass(a,o.pauseCss),o.playdotDom&&(e.surportSeekRange()?(o.playdotDom.style.display="block",
this._g.canDragBar=!0):(o.playdotDom.style.display="none",this._g.canDragBar=!1))):3==t?(k.removeClass(a,o.playingCss),
o.pauseCss&&k.removeClass(a,o.pauseCss),o.playdotDom&&(o.playdotDom.style.display="none",
this._g.canDragBar=!1),this._updateProgress(0)):(1==t||4==t)&&(o.allowPause?k.addClass(a,o.pauseCss||o.playingCss):k.addClass(a,o.playingCss),
o.playdotDom&&(e.surportSeekRange()?(o.playdotDom.style.display="block",this._g.canDragBar=!0):(o.playdotDom.style.display="none",
this._g.canDragBar=!1))),o.loadingDom&&(o.loadingDom.style.display=4==t?"block":"none");
},n.prototype._updateProgress=function(e){
return this._g.barDraging?void console.log("no dragging return",e):void this._updateProgressBar(e);
},n.prototype._updateProgressBar=function(e){
var t=this._o,o=this.player,a=o.getDuration();
if(a){
var r=this._countProgress(a,e);
t.progress&&(t.progress.style.width=r),t.playtimeDom&&e>0&&(t.playtimeDom.innerHTML=_(e)),
t.playdotDom&&(t.playdotDom.style.left=r);
}
},n.prototype._countProgress=function(e,t){
return Math.min(t/e*100,100)+"%";
},n.prototype.destory=function(){
this.player&&this.player.destory();
},n.prototype.setOption=function(e){
e.duration&&(this._g.seekData.duration=e.duration),this._extend(e);
},n.prototype.setMusicPlayerOption=function(e){
e.duration&&this._g&&this._g.seekData&&(this._g.seekData.duration=e.duration),this.player&&this.player.setOption(e);
},n.prototype.getBackgroundAudioState=function(e){
return this.player.getBackgroundAudioState(e);
},{
init:g,
renderPlayer:i,
formatTime:_,
decodeStr:y,
encodeStr:m
};
});define("a/a.js",["biz_wap/utils/mmversion.js","biz_common/dom/event.js","biz_common/utils/url/parse.js","a/a_report.js","biz_wap/utils/ajax.js","biz_wap/utils/position.js","a/card.js","a/wxopen_card.js","a/mpshop.js","biz_wap/jsapi/core.js","biz_common/tmpl.js","a/a_tpl.html.js","a/sponsor_a_tpl.html.js","a/cpc_a_tpl.html.js","biz_common/utils/report.js","biz_common/dom/class.js","biz_wap/utils/storage.js","appmsg/log.js","appmsg/cdn_img_lib.js","a/profile.js","a/android.js","a/ios.js","a/app_card.js","a/sponsor.js"],function(require,exports,module,alert){
"use strict";
function report(e,a){
Report("http://mp.weixin.qq.com/mp/ad_report?action=follow&type="+e+a);
}
function getWindowHeight(){
return"CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body.clientHeight;
}
function checkNeedAds(){
var is_need_ad=1,_adInfo=null,screen_num=0,inwindowwx=-1!=navigator.userAgent.indexOf("WindowsWechat");
if(!document.getElementsByClassName||-1==navigator.userAgent.indexOf("MicroMessenger")||inwindowwx)is_need_ad=0,
js_sponsor_ad_area.style.display="none",js_bottom_ad_area.style.display="none",js_cpc_area&&js_cpc_area.style&&(js_cpc_area.style.display="none");else{
var adLS=new LS("ad");
if(window.localStorage)try{
var key=[biz,sn,mid,idx].join("_"),_ad=adLS.get(key);
_adInfo=_ad.info;
try{
_adInfo=eval("("+_adInfo+")");
}catch(e){
_adInfo=null;
}
var _adInfoSaveTime=_ad.time,_now=+new Date;
_adInfo&&18e4>_now-1*_adInfoSaveTime&&1*_adInfo.advertisement_num>0?is_need_ad=0:adLS.remove(key),
log("[Ad] is_need_ad: "+is_need_ad+" , adData:"+JSON.stringify(_ad));
}catch(e){
is_need_ad=1,_adInfo=null;
}
}
return{
is_need_ad:is_need_ad,
both_ad:0,
_adInfo:_adInfo
};
}
function afterGetAdData(e,a){
var t={},i=e.is_need_ad,o=e._adInfo;
if(0==i)t=o,t||(t={
advertisement_num:0
});else{
if(a.advertisement_num>0&&a.advertisement_info){
var p=a.advertisement_info;
t.advertisement_info=saveCopy(p);
}
t.advertisement_num=a.advertisement_num;
}
1==i&&(window._adRenderData=t),t=t||{
advertisement_num:0
};
var n=!1;
if(!t.flag&&t.advertisement_num>0){
var r=t.advertisement_num,_=t.advertisement_info;
window.adDatas.num=r;
for(var d=0;r>d;++d){
var s=null,c=_[d];
if(c.exp_info=c.exp_info||{},c.is_cpm=c.is_cpm||0,c.biz_info=c.biz_info||{},c.app_info=c.app_info||{},
c.pos_type=c.pos_type||0,c.logo=c.logo||"",100==c.pt||115==c.pt){
for(var l=c.exp_info.exp_value||[],m=!1,u=0,f=0;f<l.length;++f){
var g=l[f]||{};
if(1==g.exp_type&&(u=g.comm_attention_num,m=u>0),2==g.exp_type){
m=!1,u=0;
break;
}
}
c.biz_info.show_comm_attention_num=m,c.biz_info.comm_attention_num=u,s={
usename:c.biz_info.user_name,
pt:c.pt,
url:c.url,
traceid:c.traceid,
adid:c.aid,
ticket:c.ticket,
is_appmsg:!0
};
}else if(102==c.pt)s={
appname:c.app_info.app_name,
versioncode:c.app_info.version_code,
pkgname:c.app_info.apk_name,
androiddownurl:c.app_info.apk_url,
md5sum:c.app_info.app_md5,
signature:c.app_info.version_code,
rl:c.rl,
traceid:c.traceid,
pt:c.pt,
ticket:c.ticket,
type:c.type,
adid:c.aid,
is_appmsg:!0
};else if(101==c.pt)s={
appname:c.app_info.app_name,
app_id:c.app_info.app_id,
icon_url:c.app_info.icon_url,
appinfo_url:c.app_info.appinfo_url,
rl:c.rl,
traceid:c.traceid,
pt:c.pt,
ticket:c.ticket,
type:c.type,
adid:c.aid,
is_appmsg:!0
};else if(103==c.pt||104==c.pt||2==c.pt&&c.app_info){
var y=c.app_info.down_count||0,v=c.app_info.app_size||0,h=c.app_info.app_name||"",w=c.app_info.category,j=["万","百万","亿"];
if(y>=1e4){
y/=1e4;
for(var x=0;y>=10&&2>x;)y/=100,x++;
y=y.toFixed(1)+j[x]+"次";
}else y=y.toFixed(1)+"次";
v=formSize(v),w=w?w[0]||"其他":"其他",h=formName(h),c.app_info._down_count=y,c.app_info._app_size=v,
c.app_info._category=w,c.app_info.app_name=h,s={
appname:c.app_info.app_name,
app_rating:c.app_info.app_rating||0,
icon_url:c.app_info.icon_url,
app_id:c.app_info.app_id,
channel_id:c.app_info.channel_id,
md5sum:c.app_info.app_md5,
rl:c.rl,
pkgname:c.app_info.apk_name,
url_scheme:c.app_info.url_scheme,
androiddownurl:c.app_info.apk_url,
versioncode:c.app_info.version_code,
appinfo_url:c.app_info.appinfo_url,
traceid:c.traceid,
pt:c.pt,
url:c.url,
ticket:c.ticket,
type:c.type,
adid:c.aid,
is_appmsg:!0
};
}else if(105==c.pt){
var k=c.card_info.card_id||"",b=c.card_info.card_ext||"";
b=b.htmlDecode();
try{
b=JSON.parse(b),b.outer_str=c.card_info.card_outer_id||"",b=JSON.stringify(b);
}catch(I){
b="{}";
}
s={
card_id:k,
card_ext:b,
pt:c.pt,
ticket:c.ticket||"",
url:c.url,
rl:c.rl,
tid:c.traceid,
traceid:c.traceid,
type:c.type,
adid:c.aid,
is_appmsg:!0
};
}else if(106==c.pt){
var C=c.mp_shop_info.pid||"",E=c.mp_shop_info.outer_id||"";
s={
pid:C,
outer_id:E,
pt:c.pt,
url:c.url,
rl:c.rl,
tid:c.traceid,
traceid:c.traceid,
type:c.type,
adid:c.aid,
is_appmsg:!0
};
}else if(108==c.pt||109==c.pt||110==c.pt||116==c.pt||117==c.pt)s={
pt:c.pt,
ticket:c.ticket||"",
url:c.url,
traceid:c.traceid,
adid:c.aid,
is_appmsg:!0
},c.video_info&&(s.displayWidth=c.video_info.displayWidth,s.displayHeight=c.video_info.displayHeight,
s.thumbUrl=c.video_info.thumbUrl,s.videoUrl=c.video_info.videoUrl,s.rl=c.rl);else if(111==c.pt||113==c.pt||114==c.pt||112==c.pt||121==c.pt||122==c.pt){
var v=c.app_info.app_size||0,h=c.app_info.app_name||"";
v=formSize(v),h=formName(h),c.app_info.app_size=v,c.app_info.app_name=h,s={
appname:c.app_info.app_name,
app_rating:c.app_info.app_rating||0,
app_id:c.app_info.app_id,
icon_url:c.app_info.icon_url,
channel_id:c.app_info.channel_id,
md5sum:c.app_info.app_md5,
rl:c.rl,
pkgname:c.app_info.apk_name,
url_scheme:c.app_info.url_scheme,
androiddownurl:c.app_info.apk_url,
versioncode:c.app_info.version_code,
appinfo_url:c.app_info.appinfo_url,
traceid:c.traceid,
pt:c.pt,
url:c.url,
ticket:c.ticket,
type:c.type,
adid:c.aid,
source:source||"",
is_appmsg:!0
};
}else 118==c.pt?(s=c,n=!0,console.log("?#$:"),Wxopen_card.startConnect(c)):(119==c.pt||120==c.pt)&&(s=c,
Wxopen_card.startConnect(c));
var q=c.image_url;
require("appmsg/cdn_img_lib.js"),q&&q.isCDN()&&(q=q.replace(/\/0$/,"/640"),q=q.replace(/\/0\?/,"/640?"),
c.image_url=ParseJs.addParam(q,"wxfrom","50",!0)),adDatas.ads["pos_"+c.pos_type]={
a_info:c,
adData:s
},localStorage&&localStorage.setItem&&c.app_info&&c.app_info.url_scheme&&localStorage.setItem("__WXLS__a_url_schema_"+c.traceid,c.app_info.url_scheme);
}
c.has_installed=!1,c&&(104==c.pt||113==c.pt||114==c.pt||2==c.pt||122==c.pt)&&c.app_info.url_scheme&&JSAPI.invoke("getInstallState",{
packageName:c.app_info.apk_name
},function(e){
var a=e.err_msg;
a.indexOf("get_install_state:yes")>-1&&(c.has_installed=!0,document.getElementById("js_promotion_tag")&&(document.getElementById("js_promotion_tag").innerHTML="进入应用"));
});
var z=function(){
var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,a=document.documentElement.clientHeight||window.innerHeight;
js_sponsor_ad_area.offsetTop<e+a&&(Class.addClass(document.getElementById("js_ad_area"),"show"),
DomEvent.off(window,"scroll",z));
},T=adDatas.ads;
for(var A in T)if(0==A.indexOf("pos_")){
var s=T[A],c=!!s&&s.a_info;
if(s&&c){
if(0==c.pos_type){
if(c.new_appmsg=window.new_appmsg,js_bottom_ad_area.innerHTML=TMPL.tmpl(a_tpl,c),
111==c.pt||112==c.pt||113==c.pt||114==c.pt){
var D=document.getElementsByClassName("js_download_app_card")[0],B=D.offsetWidth,S=Math.floor(B/2.875);
S>0&&(D.style.height=S+"px");
}
}else if(3==c.pos_type){
var D=document.createElement("div");
D.appendChild(document.createTextNode(c.image_url)),c.image_url=D.innerHTML.replace(/&amp;/g,"&"),
c.new_appmsg=window.new_appmsg,js_sponsor_ad_area.innerHTML=TMPL.tmpl(sponsor_a_tpl,c),
js_sponsor_ad_area.style.display="block";
var O=js_sponsor_ad_area.clientWidth;
108==c.pt||109==c.pt||110==c.pt?document.getElementById("js_main_img").style.height=O/1.77+"px":116==c.pt||117==c.pt,
DomEvent.on(window,"scroll",z),z(0);
}else 4==c.pos_type&&_checkShowCpc()&&(c=_parseExpCpc(c),js_cpc_area.innerHTML=TMPL.tmpl(cpc_a_tpl,c));
lazyLoadAdImg({
aid:c.aid,
type:c.pt
}),checkAdImg(c);
}
}
mmversion.isIOS&&c.app_info&&c.app_info.url_scheme&&(document.getElementById("js_promotion_tag")&&(document.getElementById("js_promotion_tag").innerHTML="查看应用"),
document.getElementsByClassName("js_ad_btn")&&document.getElementsByClassName("js_ad_btn").length>0&&(document.getElementsByClassName("js_ad_btn")[0].innerHTML="查看")),
bindAdOperation();
}
is_temp_url&&document.getElementsByTagName("mpcpc").length>0&&_checkShowCpc()&&!n&&(js_cpc_area.innerHTML=TMPL.tmpl(cpc_a_tpl,{
type:"",
ticket:"",
url:"",
rl:"",
aid:"",
pt:"",
traceid:"",
group_id:"",
apurl:"",
is_cpm:"",
image_url:"https://mmbiz.qlogo.cn/mmbiz_png/cVgP5bCElFiaPhsbHe4ctnlUllMCDCEIJib69wX3BUX42XagNypd2JcgyEiaoFRu4KicKF3avfRgVnWPABVTjtPRwQ/0?wx_fmt=png"
}));
}
function _parseExpCpc(e){
var a={
icon_pos:"",
btn_text:"去逛逛",
price:"",
sale_text:""
};
if(5==e.watermark_type&&(a.btn_text="查看详情"),e.cpc_exp_info&&e.cpc_exp_info.exp_content){
var t=e.cpc_exp_info.exp_content;
try{
for(var i=JSON.parse(t.replace(/&quot;/g,'"')),o=-1,p=0;p<i.aid_list.length;p++)i.aid_list[p].aid==e.aid&&(o=p);
o>-1&&(a.icon_pos=i.icon_pos||"",a.btn_text=i.btn_text||a.btn_text,a.price=i.aid_list[o].price,
a.sale_text=i.aid_list[o].sale_text,window.__addIdKeyReport("68064",15));
}catch(n){
window.__addIdKeyReport("68064",16);
}
}
return e.exp_obj=a,e;
}
function _checkShowCpc(){
if(js_cpc_area){
var e=(document.documentElement.clientHeight||window.innerHeight)/2,a=js_cpc_area.offsetTop,t=document.getElementById("js_content").offsetHeight;
return e>a||e>t-a?!1:!0;
}
}
function lazyLoadAdImg(e){
for(var a=document.getElementsByClassName("js_alazy_img"),t=0;t<a.length;t++){
var i=a[t];
a[t].onload=function(){
window.__addIdKeyReport("28307",54),i.src.indexOf("retry")>-1&&window.__addIdKeyReport("28307",69);
},a[t].onerror=function(){
if(-1==i.src.indexOf("retry"))i.src=ParseJs.addParam(i.src,"retry",1);else{
window.__addIdKeyReport("28307",98);
var a="other";
mmversion.isIOS?a="iphone":mmversion.isAndroid&&(a="android"),window.setTimeout(function(){
var t=window.networkType||"unknow";
ajax({
url:"http://mp.weixin.qq.com/tp/datacenter/report?cmd=report&id=900023&os="+a+"&uin=777&aid="+e.aid+"&image_url="+encodeURIComponent(i.src)+"&type="+e.type+"&network="+t,
type:"GET",
async:!0
});
},500);
}
window.__addIdKeyReport("28307",57);
},a[t].src=a[t].dataset.src;
}
}
function getHost(e){
if(!e)return"";
var a=document.createElement("a");
return a.href=e,a.hostname;
}
function checkAdImg(e){
if(e){
var a=["wximg.qq.com","wximg.gtimg.com","pgdt.gtimg.cn","mmsns.qpic.cn","mmbiz.qpic.cn","vweixinthumb.tc.qq.com","pp.myapp.com","wx.qlog.cn","mp.weixin.qq.com"],t=e.image_url||"",i=getHost(t);
return void(i&&-1==a.indexOf(i)&&window.__addIdKeyReport("28307",58));
}
}
function saveCopyArr(e){
for(var a=[],t=0;t<e.length;++t){
var i=e[t],o=typeof i;
i="string"==o?i.htmlDecode():i,"object"==o&&(i="[object Array]"==Object.prototype.toString.call(i)?saveCopyArr(i):saveCopy(i)),
a.push(i);
}
return a;
}
function saveCopy(e){
var a={};
for(var t in e)if(e.hasOwnProperty(t)){
var i=e[t],o=typeof i;
i="string"==o?i.htmlDecode():i,"object"==o&&(i="[object Array]"==Object.prototype.toString.call(i)?saveCopyArr(i):saveCopy(i)),
a[t]=i;
}
return a;
}
function formName(e){
for(var a=[" ","-","(",":",'"',"'","：","（","—","－","“","‘"],t=-1,i=0,o=a.length;o>i;++i){
var p=a[i],n=e.indexOf(p);
-1!=n&&(-1==t||t>n)&&(t=n);
}
return-1!=t&&(e=e.substring(0,t)),e;
}
function formSize(e){
return"number"!=typeof e?e:(e>=1024?(e/=1024,e=e>=1024?(e/1024).toFixed(2)+"MB":e.toFixed(2)+"KB"):e=e.toFixed(2)+"B",
e);
}
function seeAds(){
function debounce(e,a,t){
var i;
return function(){
var o=this,p=arguments,n=function(){
i=null,t||e.apply(o,p);
},r=t&&!i;
clearTimeout(i),i=setTimeout(n,a),r&&e.apply(o,p);
};
}
var adDatas=window.adDatas;
if(adDatas&&adDatas.num>0){
var onScroll=debounce(function(){
for(var scrollTop=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,i=0;total_pos_type>i;++i)!function(i){
var pos_key="pos_"+i,gdt_a=gdt_as[pos_key];
if(gdt_a=!!gdt_a&&gdt_a[0],gdt_a&&gdt_a.dataset&&gdt_a.dataset.apurl){
var gid=gdt_a.dataset.gid,tid=gdt_a.dataset.tid,aid=gdt_a.dataset.aid,apurl=gdt_a.dataset.apurl,is_cpm=1*gdt_a.dataset.is_cpm,ads=adDatas.ads,a_info=ads[pos_key].a_info||{},exp_info=a_info.exp_info||{},exp_id=exp_info.exp_id||"",exp_value=exp_info.exp_value||[],pos_type=adDatas.ads[pos_key].a_info.pos_type,gdt_area=el_gdt_areas[pos_key],offsetTop=gdt_area.offsetTop,adHeight=gdt_a.clientHeight,adOffsetTop=offsetTop+gdt_a.offsetTop,gh_id="",pt=adDatas.ads[pos_key].a_info.pt;
adDatas.ads[pos_key]&&adDatas.ads[pos_key].a_info&&adDatas.ads[pos_key].a_info.weapp_info&&adDatas.ads[pos_key].a_info.weapp_info.original_id&&(gh_id=adDatas.ads[pos_key].a_info.weapp_info.original_id),
adDatas.ads[pos_key].ad_engine=0;
try{
exp_value=JSON.stringify(exp_value);
}catch(e){
exp_value="[]";
}
if(-1!=apurl.indexOf("ad.wx.com")&&(adDatas.ads[pos_key].ad_engine=1),!ping_apurl[pos_key]&&scrollTop+innerHeight>offsetTop){
ping_apurl[pos_key]=!0;
var report_arg="trace_id="+tid+"&product_type="+pt+"&logtype=2&url="+encodeURIComponent(location.href)+"&apurl="+encodeURIComponent(apurl);
tid&&mmversion.gtVersion("6.3.22",!0)&&JSAPI.invoke("adDataReport",{
ad_info:report_arg
},function(){}),log("[Ad] seeAd, tid="+tid+", aid="+aid+", pos_type="+pos_type),
ajax({
url:"/mp/advertisement_report?report_type=1&tid="+tid+"&aid="+aid+"&gh_id="+gh_id+"&adver_group_id="+gid+"&apurl="+encodeURIComponent(apurl)+"&__biz="+biz+"&ascene="+encodeURIComponent(window.ascene||-1)+"&pos_type="+pos_type+"&exp_id="+exp_id+"&exp_value="+exp_value+"&r="+Math.random(),
success:function(res){
log("[Ad] seeAd report success, tid="+tid+", aid="+aid+", pos_type="+pos_type);
try{
res=eval("("+res+")");
}catch(e){
res={};
}
res&&0!=res.ret?ping_apurl[pos_key]=!1:ping_apurl.pos_0&&ping_apurl.pos_1;
},
error:function(){
log("[Ad] seeAd report error, tid="+tid+", aid="+aid+", pos_type="+pos_type),(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_27_1";
},
async:!0
});
}
var ping_cpm_apurl_obj=ping_cpm_apurl[pos_key];
if(is_cpm&&!ping_cpm_apurl_obj.hasPing){
var rh=.5;
scrollTop+innerHeight>=adOffsetTop+adHeight*rh&&adOffsetTop+adHeight*(1-rh)>=scrollTop?3==pos_type?(ping_cpm_apurl_obj.hasPing=!0,
ajax({
url:"/mp/advertisement_report?report_type=1&tid="+tid+"&aid="+aid+"&gh_id="+gh_id+"&adver_group_id="+gid+"&apurl="+encodeURIComponent(apurl+"&viewable=true")+"&__biz="+biz+"&ascene="+encodeURIComponent(window.ascene||-1)+"&pos_type="+pos_type+"&r="+Math.random(),
mayAbort:!0,
success:function(res){
try{
res=eval("("+res+")");
}catch(e){
res={};
}
res&&0!=res.ret&&(ping_cpm_apurl_obj.hasPing=!1);
},
async:!0
})):ping_cpm_apurl_obj.clk||(ping_cpm_apurl_obj.clk=setTimeout(function(){
ping_cpm_apurl_obj.hasPing=!0,ajax({
url:"/mp/advertisement_report?report_type=1&tid="+tid+"&aid="+aid+"&gh_id="+gh_id+"&adver_group_id="+gid+"&apurl="+encodeURIComponent(apurl+"&viewable=true")+"&__biz="+biz+"&ascene="+encodeURIComponent(window.ascene||-1)+"&pos_type="+pos_type+"&exp_id="+exp_id+"&exp_value="+exp_value+"&r="+Math.random(),
mayAbort:!0,
success:function(res){
try{
res=eval("("+res+")");
}catch(e){
res={};
}
res&&0!=res.ret&&(ping_cpm_apurl_obj.hasPing=!1);
},
async:!0
});
},1001)):3!=pos_type&&ping_cpm_apurl_obj.clk&&(clearTimeout(ping_cpm_apurl_obj.clk),
ping_cpm_apurl_obj.clk=null);
}
var allReport=!0;
if(107==pt||108==pt||110==pt||116==pt||117==pt)for(var i=0;i<see_ad_detail_report.length;i++)if(see_ad_detail_report[i])allReport=!1;else{
var report_url=location.protocol+"//mp.weixin.qq.com/mp/ad_report?action=see_report&aid="+aid+"&tid="+tid;
if((0==i&&scrollTop+innerHeight>offsetTop+1||1==i&&scrollTop+innerHeight>offsetTop+.5*adHeight||2==i&&scrollTop+innerHeight>offsetTop+adHeight)&&((new Image).src=report_url+"&seepos="+(i+1)+"&report_type=0",
see_ad_detail_report[i]=!0),i>=3)if(scrollTop+innerHeight>offsetTop&&offsetTop+adHeight>scrollTop){
if(see_ad_detail_first_see_time>0){
var t=0;
3==i&&(t=250),4==i&&(t=500),5==i&&(t=750),6==i&&(t=1e3),7==i&&(t=2e3),8==i&&(t=3e3),
+new Date-see_ad_detail_first_see_time>t?((new Image).src=report_url+"&seetime="+t+"&report_type=1",
see_ad_detail_report[i]=!0):window.setTimeout(function(){
seeAds();
},t);
}
0==see_ad_detail_first_see_time&&(see_ad_detail_first_see_time=+new Date);
}else see_ad_detail_first_see_time=0;
}
}
}(i);
},500);
DomEvent.on(window,"scroll",onScroll),onScroll();
}
}
function imgReport(e){
(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_"+e+"_1&r="+Math.random();
}
function imgReportBadJs(e){
var a=Math.random();
.5>a&&((new Image).src="https://badjs.weixinbridge.com/badjs?id=102&level=4&from="+encodeURIComponent(location.host)+"&msg="+encodeURIComponent(e));
}
function ad_click(e,a,t,i,o,p,n,r,_,d,s,c,l,m,u,f,g){
if(!has_click[o]){
has_click[o]=!0;
var y=document.getElementById("loading_"+o);
y&&(y.style.display="inline");
var v=g.exp_info||{},h=v.exp_id||"",w=v.exp_value||[];
try{
w=JSON.stringify(w);
}catch(j){
w="[]";
}
var x="";
c&&c.weapp_info&&c.weapp_info.original_id&&(x=c.weapp_info.original_id),AdClickReport({
click_pos:1,
report_type:2,
type:e,
exp_id:h,
exp_value:w,
url:encodeURIComponent(a),
tid:o,
aid:r,
rl:encodeURIComponent(t),
__biz:biz,
pos_type:d,
pt:_,
pos_x:l,
pos_y:m,
ad_w:u,
ad_h:f,
gh_id:x
},function(){
if(has_click[o]=!1,y&&(y.style.display="none"),"5"==e)location.href="/mp/profile?source=from_ad&tousername="+a+"&ticket="+p+"&uin="+uin+"&key="+key+"&__biz="+biz+"&mid="+mid+"&idx="+idx+"&tid="+o;else{
if("105"==_&&c)return void Card.openCardDetail(c.card_id,c.card_ext,c);
if("106"==_&&c)return void(location.href=ParseJs.join(a,{
outer_id:c.outer_id
}));
if("118"==_||"119"==_||"120"==_)return void Wxopen_card.openWxopen(c);
if(g&&g.has_installed&&("104"==_||"113"==_||"114"==_||"122"==_||"2"==_&&-1==a.indexOf("itunes.apple.com"))&&g.app_info.url_scheme)return void JSAPI.invoke("launchApplication",{
schemeUrl:g.app_info.url_scheme
},function(e){
-1==e.err_msg.indexOf("ok")&&(location.href=g.app_info.url_scheme);
});
if(0==a.indexOf("https://itunes.apple.com/")||0==a.indexOf("http://itunes.apple.com/"))return g.app_info&&g.app_info.url_scheme&&mmversion.gtVersion("6.5.6",!0)?JSAPI.invoke("launchApplication",{
schemeUrl:g.app_info.url_scheme
},function(e){
-1==e.err_msg.indexOf("ok")&&(location.href=a);
}):JSAPI.invoke("downloadAppInternal",{
appUrl:a
},function(e){
e.err_msg&&-1!=e.err_msg.indexOf("ok")||(location.href="http://"+location.host+"/mp/ad_redirect?url="+encodeURIComponent(a)+"&ticket="+p+"#wechat_redirect");
}),!1;
if(-1==a.indexOf("mp.weixin.qq.com"))a="http://mp.weixinbridge.com/mp/wapredirect?url="+encodeURIComponent(a);else if(-1==a.indexOf("mp.weixin.qq.com/s")&&-1==a.indexOf("mp.weixin.qq.com/mp/appmsg/show")){
var t={
source:4,
tid:o,
idx:idx,
mid:mid,
appuin:biz,
pt:_,
aid:r,
ad_engine:s,
pos_type:d
},i=window.__report;
if(("104"==_||"113"==_||"114"==_||"122"==_)&&c||-1!=a.indexOf("mp.weixin.qq.com/mp/ad_app_info")){
var n="",l="";
c&&(n=c.pkgname&&c.pkgname.replace(/\./g,"_"),l=c.channel_id||""),t={
source:4,
tid:o,
traceid:o,
mid:mid,
idx:idx,
appuin:biz,
pt:_,
channel_id:l,
aid:r,
engine:s,
pos_type:d,
pkgname:n
};
}
a=URL.join(a,t),(0==a.indexOf("http://mp.weixin.qq.com/promotion/")||0==a.indexOf("https://mp.weixin.qq.com/promotion/"))&&(a=URL.join(a,{
traceid:o,
aid:r,
engine:s
})),!r&&i&&i(80,a);
}
location.href=a;
}
});
}
}
function bindAdOperation(){
seeAds();
for(var e=0;total_pos_type>e;++e)!function(e){
var a="pos_"+e,t=el_gdt_areas[a];
if(!t)return!1;
if(!t.getElementsByClassName&&t.style)return t.style.display="none",!1;
var i=t.getElementsByClassName("js_ad_link")||[],o=adDatas.ads[a];
if(o){
for(var p=o.adData,n=o.a_info,r=n.pos_type,_=o.ad_engine,d=0,s=i.length;s>d;++d)!function(e,a){
var t=i[e],o=t.dataset;
if(o&&3!=n.pos_type){
var p=o.type,d=o.url,s=o.rl,c=o.apurl,l=o.tid,m=o.ticket,u=o.group_id,f=o.aid,g=o.pt;
DomEvent.on(t,"click",function(e){
var t=!!e&&e.target;
if(!t||!t.className||-1==t.className.indexOf("js_ad_btn")&&-1==t.className.indexOf("js_btn_process")){
if(a){
a.adid=window.adid||a.adid;
var i="&tid="+a.traceid+"&uin="+uin+"&key="+key+"&ticket="+(a.ticket||"")+"&__biz="+biz+"&source="+source+"&scene="+scene+"&appuin="+biz+"&aid="+a.adid+"&ad_engine="+_+"&pos_type="+r+"&r="+Math.random();
n&&n.has_installed&&("104"==a.pt||"113"==a.pt||"114"==a.pt||"2"==a.pt)?report(114,i):"103"==a.pt||"111"==a.pt||"112"==a.pt?report(23,i):("104"==a.pt||"113"==a.pt||"114"==a.pt)&&report(25,i);
}
var o,y,v,h;
return o=position.getX(t,"js_ad_link")+e.offsetX,y=position.getY(t,"js_ad_link")+e.offsetY,
v=document.getElementsByClassName("js_ad_link")[0]&&document.getElementsByClassName("js_ad_link")[0].clientWidth,
h=document.getElementsByClassName("js_ad_link")[0]&&document.getElementsByClassName("js_ad_link")[0].clientHeight,
ad_click(p,d,s,c,l,m,u,f,g,r,_,a,o,y,v,h,n),log("[Ad] ad_click: type="+p+", url="+d+", rl="+s+", apurl="+c+", traceid="+l+", ticket="+m+", group_id="+u+", aid="+f+", pt="+g+", pos_type="+r+", ad_engine="+_),
!1;
}
},!0);
}
}(d,p);
if(p){
p.adid=window.adid||p.adid;
var c=n.exp_info||{},l=c.exp_id||"",m=c.exp_value||[];
try{
m=JSON.stringify(m);
}catch(u){
m="[]";
}
var f="&tid="+p.traceid+"&uin="+uin+"&key="+key+"&ticket="+(p.ticket||"")+"&__biz="+biz+"&source="+source+"&scene="+scene+"&appuin="+biz+"&aid="+p.adid+"&ad_engine="+_+"&pos_type="+r+"&exp_id="+l+"&exp_value="+m+"&r="+Math.random();
if(p.report_param=f,"100"==p.pt||"115"==p.pt){
var g=require("a/profile.js");
return void new g({
btnViewProfile:document.getElementById("js_view_profile_"+r),
btnAddContact:document.getElementById("js_add_contact_"+r),
adData:p,
pos_type:r,
report_param:f,
aid:p.adid,
ad_engine:_
});
}
if("102"==p.pt){
var y=require("a/android.js"),v=15,h=p.pkgname&&p.pkgname.replace(/\./g,"_");
return void new y({
btn:document.getElementById("js_app_action_"+r),
adData:p,
report_param:f,
task_ext_info:[p.adid,p.traceid,h,source,v,_].join("."),
via:[p.traceid,p.adid,h,source,v,_].join(".")
});
}
if("101"==p.pt){
var w=require("a/ios.js");
return void new w({
btn:document.getElementById("js_app_action_"+r),
adData:p,
ticket:p.ticket,
report_param:f
});
}
if("105"==p.pt)return void new Card({
btn:document.getElementById("js_card_action_"+r),
adData:p,
report_param:f,
pos_type:r
});
if("106"==p.pt)return void new MpShop({
btn:document.getElementById("js_shop_action_"+r),
adData:p,
report_param:f,
pos_type:r
});
if("103"==p.pt||"104"==p.pt||"111"==p.pt||"112"==p.pt||"113"==p.pt||"114"==p.pt||"121"==p.pt||"122"==p.pt){
var j=require("a/app_card.js"),v=15,h=p.pkgname&&p.pkgname.replace(/\./g,"_");
return void new j({
btn:document.getElementById("js_appdetail_action_"+r),
js_app_rating:document.getElementById("js_app_rating_"+r),
adData:p,
report_param:f,
pos_type:r,
url_scheme:p.url_scheme,
via:[p.traceid,p.adid,h,source,v,_].join("."),
ticket:p.ticket,
appdetail_params:["&aid="+p.adid,"traceid="+p.traceid,"pkgname="+h,"source="+source,"type="+v,"engine="+_,"appuin="+biz,"pos_type="+r,"ticket="+p.ticket,"scene="+scene].join("&"),
engine:_
});
}
if("108"==p.pt||"109"==p.pt||"110"==p.pt||"116"==p.pt||"117"==p.pt){
var x=require("a/sponsor.js");
new x({
adDetailBtn:document.getElementById("js_ad_detail"),
adMoreBtn:document.getElementById("js_ad_more"),
adAbout:document.getElementById("js_btn_about"),
adImg:document.getElementById("js_main_img"),
adMessage:document.getElementById("js_ad_message"),
adVideo:document.getElementById("js_video_container"),
adData:p,
a_info:n,
pos_type:r,
report_param:f
});
}
"118"==n.pt&&(p.report_param=f);
}
}
}(e);
}
var mmversion=require("biz_wap/utils/mmversion.js"),js_bottom_ad_area=document.getElementById("js_bottom_ad_area"),js_sponsor_ad_area=document.getElementById("js_sponsor_ad_area"),js_cpc_area=document.getElementsByTagName("mpcpc"),gdt_pos_4={};
js_cpc_area.length>0?(js_cpc_area=document.getElementsByTagName("mpcpc")[0],gdt_pos_4=js_cpc_area.getElementsByClassName("js_ad_link")):js_cpc_area=void 0;
var pos_type=window.pos_type||0,__report=window.__report,total_pos_type=5,el_gdt_areas={
pos_4:js_cpc_area,
pos_3:js_sponsor_ad_area,
pos_0:js_bottom_ad_area
},gdt_as={
pos_4:gdt_pos_4,
pos_3:js_sponsor_ad_area.getElementsByClassName("js_ad_link"),
pos_0:js_bottom_ad_area.getElementsByClassName("js_ad_link")
},isScroll=!1,isSee=!1;
window.adDatas={
ads:{},
num:0
};
var adDatas=window.adDatas,has_click={},DomEvent=require("biz_common/dom/event.js"),URL=require("biz_common/utils/url/parse.js"),AReport=require("a/a_report.js"),AdClickReport=AReport.AdClickReport,ajax=require("biz_wap/utils/ajax.js"),position=require("biz_wap/utils/position.js"),Card=require("a/card.js"),Wxopen_card=require("a/wxopen_card.js"),MpShop=require("a/mpshop.js"),JSAPI=require("biz_wap/jsapi/core.js"),ParseJs=require("biz_common/utils/url/parse.js"),TMPL=require("biz_common/tmpl.js"),a_tpl=require("a/a_tpl.html.js"),sponsor_a_tpl=require("a/sponsor_a_tpl.html.js"),cpc_a_tpl=require("a/cpc_a_tpl.html.js"),Report=require("biz_common/utils/report.js"),Class=require("biz_common/dom/class.js"),LS=require("biz_wap/utils/storage.js"),ParseJs=require("biz_common/utils/url/parse.js"),log=require("appmsg/log.js"),ping_apurl={
pos_0:!1,
pos_1:!1,
pos_3:!1,
pos_4:!1
},ping_cpm_apurl={
pos_0:{},
pos_1:{},
pos_3:{},
pos_4:{}
},ping_test_apurl={
pos_0:[],
pos_1:[],
pos_3:[],
pos_4:[]
},see_ad_detail_report=new Array(9),see_ad_detail_first_see_time=0,ping_test_apurl_random=Math.random()<.3,innerHeight=window.innerHeight||document.documentElement.clientHeight,innerHeight_new=getWindowHeight(),ad_engine=0,keyOffset="https:"==top.location.protocol?5:0;
return{
checkNeedAds:checkNeedAds,
afterGetAdData:afterGetAdData
};
});define("appmsg/fereport.js",["biz_wap/utils/wapsdk.js","biz_common/utils/http.js","appmsg/log.js"],function(e){
"use strict";
function i(){
var e=window.performance||window.msPerformance||window.webkitPerformance;
if(e&&e.timing){
var i,s=e.timing,d=0,a=0,m=window.location.protocol,p=Math.random(),r=1>2*p,l=1>25*p,w=1>100*p,u=1>250*p,c=1>1e3*p,g=1>1e4*p,_=!0;
"https:"==m?(d=18,a=27,_=!1):"http:"==m&&(d=9,a=19);
var S=window.__wxgspeeds||{};
if(S&&S.moonloadtime&&S.moonloadedtime){
var v=S.moonloadedtime-S.moonloadtime;
i=localStorage&&JSON.parse(localStorage.getItem("__WXLS__moonarg"))&&"fromls"==JSON.parse(localStorage.getItem("__WXLS__moonarg")).method?21:22,
o.saveSpeeds({
sample:21==i||22==i&&c?1:0,
uin:uin,
pid:d,
speeds:{
sid:i,
time:v
}
});
}
S&&S.mod_downloadtime&&o.saveSpeeds({
uin:uin,
pid:d,
speeds:{
sid:24,
time:S.mod_downloadtime
}
});
var f=s.domContentLoadedEventStart-s.navigationStart;
if(f>3e3&&(o.setBasicTime({
sample:w&&_||l&&!_?1:0,
uin:uin,
pid:a
}),(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_28_1&lc=1&log0="+encodeURIComponent(location.href)),
o.setBasicTime({
sample:u&&_||w&&!_?1:0,
uin:uin,
pid:d
}),n.htmlSize){
var h=n.htmlSize/(s.responseEnd-s.connectStart);
o.saveSpeeds({
sample:c,
uin:uin,
pid:d,
speeds:{
sid:25,
time:Math.round(h)
}
});
}
if(S&&S.combo_times)for(var j=1;j<S.combo_times.length;j++)o.saveSpeeds({
sample:u,
uin:uin,
pid:d,
speeds:{
sid:26,
time:S.combo_times[j]-S.combo_times[j-1]
}
});
if(S&&S.mod_num){
var b=S.hit_num/S.mod_num;
o.saveSpeeds({
sample:u,
uin:uin,
pid:d,
speeds:[{
sid:27,
time:Math.round(100*b)
},{
sid:28,
time:Math.round(1e3*b)
}]
});
}
var B=window.logs.pagetime.jsapi_ready_time-s.navigationStart;
o.saveSpeeds(156==d||155==d?{
sample:r,
uin:uin,
pid:d,
speeds:{
sid:31,
time:B
}
}:{
sample:c,
uin:uin,
pid:d,
speeds:{
sid:31,
time:B
}
}),o.send(),window.setTimeout(function(){
window.__moonclientlog&&t("[moon] "+window.__moonclientlog.join(" ^^^ "));
},250),window.setTimeout(function(){
window.onBridgeReadyTime&&(o.saveSpeeds(top.window.WeixinJSBridge&&top.window.WeixinJSBridge._createdByScriptTag?{
sample:w,
uin:uin,
pid:d,
speeds:{
sid:33,
time:window.onBridgeReadyTime-s.navigationStart
}
}:{
sample:g,
uin:uin,
pid:d,
speeds:{
sid:32,
time:window.onBridgeReadyTime-s.navigationStart
}
}),o.send());
},5e3);
}
}
var o=e("biz_wap/utils/wapsdk.js"),n=e("biz_common/utils/http.js"),t=e("appmsg/log.js");
i();
});define("appmsg/weapp.js",["biz_common/utils/string/html.js","pages/weapp_tpl.html.js","biz_wap/utils/ajax.js","biz_common/dom/event.js","biz_common/tmpl.js","biz_common/dom/class.js","appmsg/weapp_common.js"],function(e){
"use strict";
function t(e,t,n){
var i=new Image;
i.src=("http://mp.weixin.qq.com/mp/jsreport?1=1&key=106&content="+n+",biz:"+biz+",mid:"+mid+",uin:"+uin+"[key1]"+encodeURIComponent(t.toString())+"&r="+Math.random()).substr(0,1024),
console&&t&&console.error(t);
}
function n(e,t,n,i,a,o,p){
s({
url:"/mp/appmsgreport?action=appmsg_weapp_report",
data:{
__biz:window.biz||"",
mid:window.mid||"",
idx:window.idx||"",
weapp_appid:e||"",
weapp_pos:t||0,
weapp_title:i||0,
weapp_nickname:n||0,
type:a||0,
scene:window.source||-1,
weapp_type:o,
is_confirm:p||0,
ascene:window.ascene||-1
},
type:"POST",
dataType:"json",
async:!0,
success:function(){}
});
}
function i(){
var e=m("js_content");
if(!e)return!1;
w=e.getElementsByTagName("mp-weapp")||[],f=e.getElementsByTagName("mp-miniprogram")||[],
h=[];
for(var t=e.getElementsByTagName("a"),n=0,i=t.length;i>n;n++){
var a=t[n],o=a.getAttribute("data-miniprogram-appid");
o&&h.push(a);
}
return w.length<=0&&f.length<=0&&0==h.length?!1:j&&0!=j.length?!0:!1;
}
function a(e){
return e=e||"",e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}
function o(e,t,i,a,o){
n(e,t,i,a,4,o),window.__addIdKeyReport&&window.__addIdKeyReport("28307",103);
}
function p(e,t,i,a,o){
n(e,t,i,a,5,o);
}
function r(){
window.reportWeappid=[];
for(var e=0;e<j.length;e++)window.reportWeappid.push(j[e].appid);
var i=function(){};
c.on(document.getElementById("js_minipro_dialog_ok"),"click",function(){
i&&i(),document.getElementById("js_minipro_dialog").style.display="none";
}),c.on(document.getElementById("js_minipro_dialog_cancel"),"click",function(){
var e=document.getElementById("js_minipro_dialog");
e.style.display="none",n(e._appid,e._i,e._nickname,e._title,3,1,1),window.__addIdKeyReport&&window.__addIdKeyReport("28307",116);
}),u.getAppidInfo({
onSuccess:function(r){
var d=r.data.infoMap;
if(d){
for(e=0;e<b.length;e++)(function(e){
var r=b[e].appid,m=b[e].path,s=b[e].imageUrl,w=b[e].title,f=b[e].elem,h=d[r];
if(h){
var y=f.tagName.toLowerCase(),j=f.firstChild&&1==f.firstChild.nodeType&&"IMG"===f.firstChild.tagName;
if(j=j||f.firstElementChild&&"IMG"===f.firstElementChild.tagName,"a"!=y)f.innerHTML=_.tmpl(l,{
imageUrl:a(s),
title:a(w),
nickname:a(h.nickname),
avatar:a(h.logo_url)
});else{
if(j){
var I=f.firstChild;
I&&g.addClass(f,"weapp_image_link");
}else g.addClass(f,"weapp_text_link");
f.href="javascript:void(0);";
}
c.on(f,"a"==y?"click":"tap",function(){
if(i=function(){
var i=j?1:"a"==y?2:0;
return u.jumpUrl({
sceneNote:encodeURIComponent(location.href),
appid:r,
path:m,
scene:1058,
beforeNonWechatWarn:function(){
p(r,e,h.nickname,w,i);
},
beforeJumpBackupPage:function(){
o(r,e,h.nickname,w,i);
},
onJsapiCallback:function(e){
"openWeApp:ok"===e.err_msg&&window.__addIdKeyReport&&window.__addIdKeyReport("28307",102),
t(107,new Error(e.err_msg),"");
}
}),window.__addIdKeyReport&&window.__addIdKeyReport("28307",100),n(r,e,h.nickname,w,3,i,j?2:0),
j&&window.__addIdKeyReport&&window.__addIdKeyReport("28307",115),!1;
},j&&wxa_img_alert){
document.getElementById("js_minipro_dialog_name").innerText=h.nickname;
var a=document.getElementById("js_minipro_dialog");
return a.style.display="block",a._appid=r,a._i=e,a._nickname=h.nickname,a._title=w,
n(r,e,h.nickname,w,3,1,0),u.canJumpOnTap&&window.__addIdKeyReport&&window.__addIdKeyReport("28307",114),
!1;
}
return i();
},"a"==y);
}
})(e);
var m=null,s=function(){
m=null;
for(var e=window.innerHeight||document.documentElement.clientHeight,t=0;t<I.length;t++){
var i=I[t].elem,a=i.tagName.toLowerCase(),o=i.firstChild&&1==i.firstChild.nodeType,p=o?1:"a"==a?2:0,r=I[t].elem.getBoundingClientRect();
r.top<e&&r.bottom>0&&(setTimeout(function(){
window.__addIdKeyReport&&window.__addIdKeyReport("28307",101);
},0),n(I[t].appid,t,d[I[t].appid].nickname,I[t].title,2,p),I.splice(t--,1));
}
};
s(),c.on(window,"scroll",function(){
m||(m=setTimeout(s,100));
});
}
},
onError:function(e){
3==e.code&&t(106,e.catchErr,"parsing weapp info error");
}
});
}
function d(){
for(var e=0;e<f.length+w.length;e++){
var t=e<f.length,n=t?f[e]:w[e-f.length],i=n.getAttribute(t?"data-miniprogram-appid":"data-weapp-appid")||"",a=n.getAttribute(t?"data-miniprogram-path":"data-weapp-path")||"",o=n.getAttribute(t?"data-miniprogram-imageUrl":"data-weapp-imageUrl")||"",p=n.getAttribute(t?"data-miniprogram-title":"data-weapp-title")||"",r=document.createElement("span");
n.setAttribute("class",""),r.setAttribute("class","weapp_display_element js_weapp_display_element"),
b.push({
appid:i,
path:a,
imageUrl:o,
title:p,
elem:r
}),I.push({
appid:i,
elem:r,
title:p
}),n.parentNode.insertBefore(r,n.nextSibling);
}
for(var e=0;e<h.length;e++){
var d=h[e];
b.push({
appid:d.getAttribute("data-miniprogram-appid"),
path:d.getAttribute("data-miniprogram-path")||"",
elem:d
});
}
}
function m(e){
return document.getElementById(e);
}
e("biz_common/utils/string/html.js");
var l=e("pages/weapp_tpl.html.js"),s=e("biz_wap/utils/ajax.js"),c=e("biz_common/dom/event.js"),_=e("biz_common/tmpl.js"),g=e("biz_common/dom/class.js"),u=e("appmsg/weapp_common.js"),w=null,f=null,h=null,y={},b=[],j=u.appidSnInfo,I=[];
return i()?(d(),r(),y):void 0;
});define("appmsg/weproduct.js",["appmsg/weapp_common.js","biz_common/dom/event.js","biz_wap/utils/ajax.js","biz_common/utils/url/parse.js","biz_common/utils/monitor.js"],function(t){
"use strict";
function e(){
if("function"==typeof document.getElementsByClassName){
var t=document.getElementsByClassName("js_product_container");
t&&t.length>0&&r.getAppidInfo({
onSuccess:function(e){
l.data=e.data,n(t);
}
}),a();
}
}
function n(t){
for(var e=0,n=t.length;n>e;e++)!function(t,e){
c.on(t,"tap",".js_product_loop_content",function(t){
var n=t.delegatedTarget,o=n.getAttribute("data-wxaappid"),a=n.getAttribute("data-wxapath"),c=n.getAttribute("data-pid");
return r.jumpUrl({
appid:o,
path:a,
scene:1091,
sceneNote:encodeURIComponent(location.href)+":"+encodeURIComponent(c),
beforeNonWechatWarn:function(){},
beforeJumpBackupPage:function(){},
onJsapiCallback:function(t){
"openWeApp:ok"===t.err_msg&&c&&i({
wxa_appid:o,
pid:c,
type:2,
absolute_order:e+1,
templateid:n.getAttribute("data-templateid")||"",
relative_order:1*n.getAttribute("data-order"),
packid:n.getAttribute("data-packid")||""
});
}
}),!1;
});
}(t[e],e);
var a=document.getElementsByClassName("js_product_loop_content");
if(a&&a.length>0&&l.innerHeight){
for(var e=0;e<a.length;e++)l.pvele.push(a[e]);
o(),c.on(window,"scroll",o);
}
}
function o(){
l.checkInScreenId&&clearTimeout(l.checkInScreenId),l.checkInScreenId=setTimeout(function(){
l.checkInScreenId=null;
for(var t=[],e=0;e<l.pvele.length;e++){
var n=l.pvele[e],a=n.getBoundingClientRect(),r=a.rect||a.bottom-a.top;
if(r>0&&a.top<l.innerHeight-r/2&&a.bottom>r/2){
var d=n.getAttribute("data-pid");
d&&t.push({
wxa_appid:n.getAttribute("data-wxaappid"),
pid:d,
type:1,
absolute_order:e+1,
templateid:n.getAttribute("data-templateid")||"",
relative_order:1*n.getAttribute("data-order"),
packid:n.getAttribute("data-packid")||""
}),l.pvele.splice(e--,1);
}
}
i(t),0==l.pvele.length&&(c.off(window,"scroll",o),o=null);
},100);
}
function a(){
setTimeout(function(){
var t=document.getElementsByClassName("js_product_loop_content").length,e=document.getElementsByClassName("js_product_err_container").length;
u.setSum("64469","15",t+e),u.setSum("64469","16",t),u.setSum("64469","18",e),u.send();
},0);
}
function i(t){
if(t&&0!=t.length){
for(var e={
batch_no:p.getQuery("batch_no")||"",
bizuin:window.biz||"",
mid:window.mid||"",
idx:window.idx||"",
uin:window.uin||"",
total:t.length
},n=0;n<t.length;n++){
var o=t[n],a=n+1;
for(var i in o)o.hasOwnProperty(i)&&(e[i+""+a]=o[i]);
}
d({
url:"/mp/productreport?",
type:"POST",
data:e,
dataType:"json",
async:!0
});
}
}
var r=t("appmsg/weapp_common.js"),c=t("biz_common/dom/event.js"),d=t("biz_wap/utils/ajax.js"),p=t("biz_common/utils/url/parse.js"),u=t("biz_common/utils/monitor.js"),l={
pvele:[],
innerHeight:window.innerHeight||document.documentElement.clientHeight,
checkInScreenId:null,
reportRandom:Math.random()
};
e();
});define("appmsg/autoread.js",["biz_common/utils/string/html.js","biz_common/dom/event.js","pages/voice_tpl.html.js","pages/voice_component.js","biz_wap/utils/ajax.js"],function(e){
"use strict";
function i(){
var e=d("autoread");
e&&(e.innerHTML='<p><label>朗读类型：</label>                                <select id="autoreadSelect">                                <option selected="true" value="0">女1</option>                                <option value="1">女2</option>                                <option value="2">男1</option>                                <option value="6">男2</option>                                </select></p><p id="autoread_voice"></p>',
r.on(d("autoreadSelect"),"change",function(){
p.player&&(p.player.destory(),p.player=null),p.checkAudioId&&(clearTimeout(p.checkAudioId),
p.checkAudioId=null);
var e=d("autoreadSelect");
d("autoread_voice").innerHTML="",o(e.value);
}),o(0));
}
function o(e){
var i=d("autoread_voice");
p._oMusic={
voiceid:p.voiceid,
duration_str:"",
posIndex:p.posIndex,
title:"文章朗读体验（"+p.voiceType[e||0]+"）",
nickname:window.nickname||"公众号"
},s.renderPlayer(u,p._oMusic,i,!0),d("voice_author_"+p.key).innerHTML="来自"+p._oMusic.nickname+"（创建音频中）",
c(e);
}
function n(e,i){
var o=p._oMusic;
d("voice_author_"+p.key).innerHTML="来自"+o.nickname,d("voice_duration_"+p.key).innerHTML=s.formatTime(1*i),
p.player=s.init({
protocal:"hls",
wxIndex:o.posIndex,
type:2,
songId:e,
src:a("https://mp.weixin.qq.com/mp/msgvoice?action=get_voice&media="+e),
allowPause:!0,
autoPlay:!0,
duration:i,
title:o.title,
singer:o.nickname?o.nickname+"的语音":"公众号语音",
epname:"来自文章",
coverImgUrl:window.__appmsgCgiData.hd_head_img,
playingCss:"share_audio_playing",
playCssDom:d("voice_main_"+p.key),
playArea:d("voice_play_"+p.key),
progress:d("voice_progress_"+p.key),
fileSize:o.fileSize,
playtimeDom:d("voice_playtime_"+p.key),
bufferDom:d("voice_buffer_"+p.key),
playdotDom:d("voice_playdot_"+p.key),
seekRange:d("voice_seekRange_"+p.key),
seekContainer:d("voice_main_"+p.key),
loadingDom:d("voice_loading_"+p.key)
});
}
function t(e){
p.curNum+=1;
var i=1e3;
p.curNum>p.maxNum&&(i=2e3);
var o=["/mp/msgvoice?action=get_media&mid=",window.mid||"","&idx=",window.idx||"","&biz=",window.biz||"","&type=",e||0].join("");
m({
url:o,
type:"GET",
dataType:"json",
async:!0,
success:function(o){
o.mediaid&&o.duration?n(o.mediaid,o.duration):p.checkAudioId=setTimeout(function(){
t(e);
},i);
},
error:function(){
p.checkAudioId=setTimeout(function(){
t(e);
},i);
}
});
}
function a(e){
return e+=["&mid=",window.mid||"","&idx=",window.idx||"","&biz=",window.biz||"","&uin=",window.uin||"","&key=",window.key||"","&pass_ticket=",window.pass_ticket||"","&clientversion=",window.clientversion||"","&devicetype=",window.devicetype||"","&wxtoken=",window.wxtoken||""].join("");
}
function c(e){
p.curNum=0;
var i=["/mp/msgvoice?action=tts&mid=",window.mid||"","&idx=",window.idx||"","&biz=",window.biz||"","&type=",e||0].join("");
m({
url:i,
type:"GET",
dataType:"json",
async:!0,
success:function(i){
i&&i.base_resp&&0==i.base_resp.ret?t(e):d("voice_author_"+p.key).innerHTML="来自"+window.nickname+"（失败）";
},
error:function(){
d("voice_author_"+p.key).innerHTML="来自"+window.nickname+"（失败）";
}
});
}
function d(e){
return document.getElementById(e);
}
e("biz_common/utils/string/html.js");
var r=e("biz_common/dom/event.js"),u=e("pages/voice_tpl.html.js"),s=e("pages/voice_component.js"),m=e("biz_wap/utils/ajax.js"),p={
checkId:"",
voiceid:"autoread",
posIndex:0,
key:"autoread_0",
voiceType:{
0:"女1",
1:"女2",
2:"男1",
6:"男2"
},
maxNum:5,
curNum:0
};
i();
});define("appmsg/review_image.js",["biz_common/dom/event.js","biz_wap/jsapi/core.js","biz_common/utils/url/parse.js","appmsg/log.js","biz_wap/utils/ajax.js","biz_wap/utils/mmversion.js","appmsg/cdn_img_lib.js"],function(t){
"use strict";
function e(t,e){
r.invoke("imagePreview",{
current:t,
urls:e
},function(){
window.__addIdKeyReport&&window.__addIdKeyReport("28307","2");
}),o("[Appmsg] click image, src: "+t);
}
function a(t,e){
p({
url:"/mp/rewardappmsgreport",
data:{
__biz:window.biz||"",
mid:window.mid||"",
idx:window.idx||"",
oper:e||"",
cdn_url:t||"",
ascene:window.ascene||-1
},
type:"POST",
dataType:"json",
async:!0
});
}
function i(t){
var i=[],r=t.container,o=t.imgs||[];
if(r)for(var p=r.getElementsByTagName("img")||[],d=0,m=p.length;m>d;d++)o.push(p.item(d));
for(var g=c.isIOS&&1==window._copyright_stat&&1==window.is_need_reward,u=0,d=0,m=o.length;m>d;d++){
var w=o[d],_=w.getAttribute("data-src")||w.getAttribute("src"),l=w.getAttribute("data-type");
if(_&&!_.isGif()&&0!=_.indexOf("data:")){
for(;-1!=_.indexOf("?tp=webp");)_=_.replace("?tp=webp","");
w.dataset&&w.dataset.s&&_.isCDN()&&(_=_.replace(/\/640$/,"/0"),_=_.replace(/\/640\?/,"/0?")),
_.isCDN()&&(_=n.addParam(_,"wxfrom","3",!0)),_=t.is_https_res?_.http2https():_.https2http(),
l&&(_=n.addParam(_,"wxtype",l,!0)),i.push(_),"1"!=w.getAttribute("data-nopreviewclick")&&!function(t){
s.on(w,"click",function(s){
s&&s.target&&s.target.className&&s.target.className.indexOf("img_loadederror")>-1||(e(t,i),
g&&0==u&&a(s.target.src,2));
});
}(_),w.removeAttribute("data-nopreviewclick");
}
}
if(g){
var b=document.getElementById("js_content"),f=0,j=0;
s.on(b,"touchstart",function(t){
return t&&t.target&&t.target.tagName&&"string"==typeof t.target.tagName&&"IMG"==t.target.tagName.toString().toUpperCase()?(u=+new Date,
f=t.touches[0].pageX,void(j=t.touches[0].pageY)):void(u=0);
}),s.on(b,"touchmove",function(t){
var e=t.touches[0].pageX,a=t.touches[0].pageY;
Math.abs(e-f)>10&&Math.abs(a-j)>10&&(u=0);
}),s.on(b,"touchend",function(t){
0!=u&&(+new Date-u>800&&+new Date-u<6e3?a(t.target.src,1):u=0);
});
}
}
var s=t("biz_common/dom/event.js"),r=t("biz_wap/jsapi/core.js"),n=t("biz_common/utils/url/parse.js"),o=t("appmsg/log.js"),p=t("biz_wap/utils/ajax.js"),c=t("biz_wap/utils/mmversion.js");
return t("appmsg/cdn_img_lib.js"),i;
});define("appmsg/async.js",["biz_common/utils/string/html.js","pages/video_ctrl.js","biz_common/utils/url/parse.js","biz_common/dom/class.js","appmsg/img_copyright_tpl.html.js","appmsg/share_tpl.html.js","biz_common/dom/event.js","biz_wap/utils/ajax.js","biz_wap/jsapi/core.js","biz_common/tmpl.js","biz_wap/utils/storage.js","appmsg/log.js","rt/appmsg/getappmsgext.rt.js","a/a.js","biz_wap/utils/mmversion.js","pages/version4video.js","appmsg/like.js","appmsg/comment.js","appmsg/reward_entry.js","a/testdata.js","appmsg/iframe.js"],function(e,t,r,n){
"use strict";
function i(e,t){
var r=w.getQuery("vid",t);
if(r&&e){
var n=e.parentNode;
if(n){
for(var i=[],a=0,s=n.children.length;s>a;a++){
var d=n.children[a];
d.className.indexOf("img_loading")>=0&&d.getAttribute("data-vid")==r&&i.push(d);
}
for(var a=0,s=i.length;s>a;a++)n.removeChild(i[a]);
e.style.display="block";
}
}
}
function a(e){
if(e&&e.img_copy_info&&e.img_copy_info.list){
for(var t={},r=e.img_copy_info.list,n=window.__appmsgCgiData.copyright_stat,i=window.__appmsgCgiData.source_biz,a=0,s=r.length;s>a;a++){
var d=r[a];
if(2==d.type){
if(2==n&&i==d.source_uin)continue;
t[d.img_url]={
source_nickname:d.source_nickname,
source_uin:d.source_uin,
source_encode_biz:d.source_encode_biz||""
};
}
}
for(var o=document.getElementsByTagName("img"),a=0,s=o.length;s>a;a++){
var d=o[a],_=d.getAttribute("data-src")||d.getAttribute("data-backsrc")||"";
if(t[_]){
var m=document.createElement("div");
m.innerHTML=I.tmpl(u,t[_]);
{
var c=m.children[0],p=d.parentNode,l=p.insertBefore(c,d),w=l.children[0];
(function(e,t){
v.on(t,"click",function(){
var t="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz="+e.source_encode_biz+"&scene=112#wechat_redirect";
return-1!=navigator.userAgent.indexOf("WindowsWechat")||-1!=navigator.userAgent.indexOf("Mac OS")?(location.href=t,
!1):(k.invoke("openUrlWithExtraWebview",{
url:t,
openType:1
},function(e){
-1==e.err_msg.indexOf("ok")&&(location.href=t);
}),!1);
});
})(t[_],w);
}
l.insertBefore(d,w);
}
}
}
}
function s(e){
if(M&&M.length>0)for(var t,r,n,i=0,a=M.length;a>i;++i)t=M[i],r=t.iframe,n=t.src,
e&&(n=n.replace(/\&encryptVer=[^\&]*/gi,""),n=n.replace(/\&platform=[^\&]*/gi,""),
n=n.replace(/\&cKey=[^\&]*/gi,""),n=n+"&encryptVer=6.0&platform=61001&cKey="+e),
r.setAttribute("src",n);
}
function d(t){
var r=t.appmsgstat||{};
window.appmsgstat||(window.appmsgstat=r),r.show&&(!function(){
var e=document.getElementById("js_read_area3"),t=document.getElementById("like3");
e.style.display="block",t.style.display="inline",r.liked=window.is_temp_url?window.liked:r.liked,
r.liked&&b.addClass(t,"praised"),t.setAttribute("like",r.liked?"1":"0");
var n=document.getElementById("likeNum3"),i=document.getElementById("readNum3"),a=window.is_temp_url?window.read_num:r.read_num,s=window.is_temp_url?window.like_num:r.like_num;
a||(a=1),s||(s="赞"),parseInt(a)>1e5?a="100000+":"",parseInt(s)>1e5?s="100000+":"",
i&&(i.innerHTML=a),n&&(n.innerHTML=s);
}(),e("appmsg/like.js"));
var i=document.getElementById("js_share_appmsg");
if(t.share_redirect_url&&i&&(window._share_redirect_url=t.share_redirect_url,i.innerHTML=I.tmpl(y,{
url:t.share_redirect_url
})),1==t.comment_enabled&&(window.can_fans_comment_only=t.only_fans_can_comment,
e("appmsg/comment.js")),window._has_comment||0!=window.adDatas.num||window._share_redirect_url||g.addClass(document.body,"rich_media_empty_extra"),
-1==f.indexOf("WindowsWechat")&&-1!=f.indexOf("MicroMessenger"))if(E.isIOS){
if(1==t.reward.can_reward&&1==t.reward.user_can_reward)if(1==t.reward.is_ios_reward_open){
document.getElementById("js_reward_qrcode")&&(document.getElementById("js_reward_qrcode").style.display="block");
var a=document.getElementById("js_reward_qrcode_img"),s="/wap/rewardqrcode?sn="+sn+"&t="+t.reward.reward_qrcode_ticket+"&pass_ticket="+pass_ticket;
a&&a.setAttribute("src",s);
}else document.getElementById("js_reward_close")&&(document.getElementById("js_reward_close").style.display="block");
}else c=e("appmsg/reward_entry.js"),c.handle(t.reward,_());
1==t.reward_entrance_enable_for_preview&&(E.isIOS?1==t.is_ios_reward_open?(document.getElementById("js_preview_reward_qrcode")&&(document.getElementById("js_preview_reward_qrcode").style.display="block"),
t.reward_wording&&document.getElementById("js_preview_reward_ios_wording")&&(document.getElementById("js_preview_reward_ios_wording").innerText=t.reward_wording,
document.getElementById("js_preview_reward_ios_wording").style.display="block")):document.getElementById("js_preview_reward_close")&&(document.getElementById("js_preview_reward_close").style.display="block"):(document.getElementById("js_preview_reward")&&(document.getElementById("js_preview_reward").style.display="block"),
t.reward_wording&&document.getElementById("js_preview_reward_wording")&&(document.getElementById("js_preview_reward_wording").innerText=t.reward_wording,
document.getElementById("js_preview_reward_wording").style.display="block"),v.on(document.getElementById("js_preview_reward_link"),"tap",function(e){
e.preventDefault(),n("预览状态下无法操作。");
}))),t.comment_entrance_enable_for_preview&&(document.getElementById("js_preview_cmt")&&(document.getElementById("js_preview_cmt").style.display="block"),
v.on(document.getElementById("js_preview_cmt_write"),"tap",function(e){
e.preventDefault(),n("预览状态下无法操作。");
}));
}
function o(){
var t="";
M&&M.length>0&&(t="&is_need_ticket=1");
var r=B.checkNeedAds(),n=r.is_need_ad,i=(r._adInfo,r.both_ad),o=-1!=location.href.indexOf("mock_ad=");
o&&(r.is_need_ad=n=1),x("[Appmsg] start get asycn data, is_need_ad:"+n);
var m=window.new_appmsg&&1==_copyright_stat?1:0;
j({
url:"/mp/getappmsgext?__biz="+biz+"&appmsg_type="+appmsg_type+"&mid="+mid+"&sn="+sn+"&idx="+idx+"&scene="+source+"&title="+encodeURIComponent(msg_title.htmlDecode())+"&ct="+ct+"&abtest_cookie="+abtest_cookie+"&devicetype="+devicetype.htmlDecode()+"&version="+version.htmlDecode()+"&f=json&r="+Math.random()+t+"&is_need_ad="+n+"&comment_id="+comment_id+"&is_need_reward="+is_need_reward+"&both_ad="+i+"&reward_uin_count="+(is_need_reward?3*_():0)+(window.send_time?"&send_time="+send_time:"")+"&msg_daily_idx="+msg_daily_idx+"&is_original="+m,
data:{
is_only_read:is_only_read,
req_id:window.req_id||"",
pass_ticket:pass_ticket,
is_temp_url:window.is_temp_url||0
},
type:"POST",
dataType:"json",
rtId:"27613",
rtKey:"50",
rtDesc:z,
async:!0,
success:function(t){
if(x("[Appmsg] success get async data"),t){
try{
if(o){
var n=e("a/testdata.js");
t.advertisement_info=n.getAd(),t.advertisement_num=t.advertisement_info.length;
}
if(t&&t.base_resp&&t.base_resp.wxtoken&&(window.wxtoken=t.base_resp.wxtoken),window.fromWeixinCached&&e("appmsg/iframe.js"),
s(t.appmsgticket?t.appmsgticket.ticket:""),a(t),t.ret)return;
B.afterGetAdData(r,t),window.wx_user_can_reward=t.user_can_reward,d({
appmsgstat:t.appmsgstat,
comment_enabled:t.comment_enabled,
only_fans_can_comment:t.only_fans_can_comment,
reward:{
reward_total:t.reward_total_count,
reward_head_imgs:t.reward_head_imgs||[],
can_reward:t.can_reward,
user_can_reward:t.user_can_reward,
reward_qrcode_ticket:t.reward_qrcode_ticket,
is_ios_reward_open:t.is_ios_reward_open,
timestamp:t.timestamp
},
reward_entrance_enable_for_preview:t.reward_entrance_enable_for_preview,
reward_wording:t.reward_wording,
is_ios_reward_open:t.is_ios_reward_open,
comment_entrance_enable_for_preview:t.comment_entrance_enable_for_preview,
share_redirect_url:t.share_redirect_url||""
});
}catch(i){
x("[Appmsg] error parse async data, biz="+biz+", mid="+mid);
var _=new Image;
return _.src=("http://mp.weixin.qq.com/mp/jsreport?1=1&key=1&content=biz:"+biz+",mid:"+mid+",uin:"+uin+"[key1]"+encodeURIComponent(i.toString())+"&r="+Math.random()).substr(0,1024),
void(console&&console.error(i));
}
x("[Appmsg] success get async data, async data is: "+JSON.stringify(t));
}
},
error:function(){
x("[Appmsg] error get async data, biz="+biz+", mid="+mid);
var e=new Image;
e.src="http://mp.weixin.qq.com/mp/jsreport?1=1&key=2&content=biz:"+biz+",mid:"+mid+",uin:"+uin+"[key2]ajax_err&r="+Math.random();
}
});
}
function _(){
return v.on(window,"resize",function(){
m(),c&&c.render(_());
}),m();
}
function m(){
var e=window.innerWidth||document.documentElement.clientWidth;
try{
var t=document.getElementById("page-content").getBoundingClientRect();
t.width&&(e=t.width);
}catch(r){}
var n=30,i=34,a=Math.floor(.9*(e-n)/i);
return window.new_appmsg&&(a=Math.floor(.8*(e-60)/i)),document.getElementById("js_reward_inner")&&(document.getElementById("js_reward_inner").style.width=a*i+"px"),
_=function(){
return a;
},a;
}
e("biz_common/utils/string/html.js");
var c,p,l=e("pages/video_ctrl.js"),w=e("biz_common/utils/url/parse.js"),g=e("biz_common/dom/class.js"),u=e("appmsg/img_copyright_tpl.html.js"),y=e("appmsg/share_tpl.html.js"),f=navigator.userAgent,h=-1!=f.indexOf("MicroMessenger"),v=(-1!=navigator.userAgent.indexOf("WindowsWechat"),
e("biz_common/dom/event.js")),j=e("biz_wap/utils/ajax.js"),b=e("biz_common/dom/class.js"),k=e("biz_wap/jsapi/core.js"),I=e("biz_common/tmpl.js"),x=(e("biz_wap/utils/storage.js"),
e("appmsg/log.js")),z=e("rt/appmsg/getappmsgext.rt.js"),B=e("a/a.js"),E=e("biz_wap/utils/mmversion.js"),A=document.getElementsByTagName("iframe"),q=document.getElementById("js_content"),M=[],O=q.offsetWidth,W=O/l.getRatio();
window.logs.video_cnt=0;
for(var T=0,D=A.length;D>T;++T){
p=A[T];
var C=p.getAttribute("data-src")||"",N=p.getAttribute("src")||C;
if(N){
var R=e("pages/version4video.js");
if(0==N.indexOf("http://z.weishi.com/weixin/player.html"))N=N.replace(/width=\d+/g,"width="+O),
N=N.replace(/height=\d+/g,"height="+W),p.width=O,p.height=W,p.style.setProperty&&(p.style.setProperty("width",O+"px","important"),
p.style.setProperty("height",W+"px","important")),p.setAttribute("src",N),window.__addIdKeyReport&&window.__addIdKeyReport("28307",10),
window.logs.video_cnt++;else if(/http(s)*\:\/\/v\.qq\.com\/iframe\/(preview|player)\.html\?/.test(N)){
R.isShowMpVideo()||(!function(e,t){
e.onload=function(){
i(this,t);
};
}(p,N),h?M.push({
iframe:p,
src:N
}):p.setAttribute("src",N),window.__addIdKeyReport&&window.__addIdKeyReport("28307",10)),
window.logs.video_cnt++;
continue;
}
}
}
o();
});define("biz_wap/ui/lazyload_img.js",["biz_wap/utils/mmversion.js","biz_common/dom/event.js","biz_common/dom/attr.js","biz_common/ui/imgonepx.js"],function(t){
"use strict";
function i(){
var t=this.images;
if(!t||t.length<=0)return!1;
var i=window.pageYOffset||document.documentElement.scrollTop,e=window.innerHeight||document.documentElement.clientHeight,o=e+40,a=this.offset||20,s=0;
if("wifi"==window.networkType){
var m={
bottom:1,
top:1
};
this.lazyloadHeightWhenWifi&&(m=this.lazyloadHeightWhenWifi()),a=Math.max(m.bottom*e,a),
s=Math.max(m.top*e,s);
}
for(var c=+new Date,d=[],g=this.sw,u=this,p=-1,w=0,A=t.length;A>w;w++)!function(t,e){
var m=n(t.el),c=t.src;
if(c){
(c.match(/\:\/\/[^\/]+\/mmbiz\//)&&c.indexOf("wx_fmt=gif")>-1||c.match(/\:\/\/[^\/]+\/mmbiz_gif\//))&&p++;
var u=s,w=a;
(c.match(/\:\/\/[^\/]+\/mmbiz\//)&&c.indexOf("wx_fmt=gif")>-1||c.match(/\:\/\/[^\/]+\/mmbiz_gif\//))&&f&&(u=0,
w=20),!t.show&&(i>=m&&i<=m+t.height+u||m>i&&i+o+w>m)&&(e.inImgRead&&(i>=m&&i<=m+t.height||m>i&&i+o>m)&&e.inImgRead(c,networkType),
e.changeSrc&&(c=e.changeSrc(t.el,c,p)),t.el.onerror=function(){
var i=this;
!!e.onerror&&e.onerror(t.el.src,i);
},t.el.onload=function(){
var i=this;
if("data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="!=i.src){
var o=i.getAttribute("data-forceheight");
o?(i.removeAttribute("data-forceheight"),l(i,"height",o,"important")):l(i,"height","auto","important"),
i.getAttribute("_width")?l(i,"width",i.getAttribute("_width"),"important"):l(i,"width","auto","important"),
!!e.onload&&e.onload(t.el.src,i);
}
},h(t.el,"src",c),d.push(c),t.show=!0,l(t.el,"visibility","visible","important")),
r.isWp&&1*t.el.width>g&&(t.el.width=g);
}
}(t[w],u);
d.length>0&&this.detect&&this.detect({
time:c,
loadList:d,
scrollTop:i
});
}
function e(){
var t=document.getElementsByTagName("img"),e=[],o=this.container,a=this.attrKey||"data-src",n=o.offsetWidth,r=0,s=this.imgOccupied||!1;
o.currentStyle?r=o.currentStyle.width:"undefined"!=typeof getComputedStyle&&(r=getComputedStyle(o).width),
this.sw=1*r.replace("px","");
for(var m=0,d=t.length;d>m;m++){
var f=t.item(m),g=h(f,a),u=h(f,"src");
if(g&&!(u&&u.indexOf("data:image/gif;base64")<0)){
var p=100;
if(f.dataset&&f.dataset.ratio){
var w=1*f.dataset.ratio,A=1*f.dataset.w||n;
"number"==typeof w&&w>0?(A=n>=A?A:n,p=A*w,s||(f.style.width&&f.setAttribute("_width",f.style.width),
l(f,"width",A+"px","important"),l(f,"visibility","visible","important"),f.setAttribute("src",c))):l(f,"visibility","hidden","important");
}else l(f,"visibility","hidden","important");
s||l(f,"height",p+"px","important"),e.push({
el:f,
src:g,
height:p,
show:!1
});
}
}
this.images=e,i.call(this);
}
function o(t){
var e=this,o=e.timer;
clearTimeout(o),this.__called_first_time?(i.call(e,t),this.__called_first_time=!1):e.timer=setTimeout(function(){
i.call(e,t);
},300);
}
function a(t){
s.on(window,"scroll",function(i){
o.call(t,i);
}),setTimeout(function(){
e.call(t,{});
},0),s.on(document,"touchmove",function(i){
o.call(t,i);
}),t.__called_first_time=!0,o.call(t,{});
}
function n(t){
for(var i=t.offsetTop;t=t.offsetParent;)i+=t.offsetTop;
return i>=111&&(i-=111),i;
}
var r=t("biz_wap/utils/mmversion.js"),s=t("biz_common/dom/event.js"),m=t("biz_common/dom/attr.js"),h=m.attr,l=m.setProperty,c=t("biz_common/ui/imgonepx.js"),d=new Date,f=(d.getHours(),
!0);
return a;
});define("appmsg/share.js",["biz_common/utils/string/html.js","appmsg/cdn_img_lib.js","biz_common/dom/event.js","biz_common/utils/url/parse.js","biz_wap/utils/mmversion.js","biz_wap/utils/ajax.js","biz_wap/jsapi/core.js"],function(e){
"use strict";
function i(e,i){
var n="",o="";
try{
""!=tid&&(o="tid="+tid+"&aid=54");
var t=e.split("?")[1]||"";
if(t=t.split("#")[0],""==t);else{
var s=[t,"mpshare=1","scene="+i,"srcid="+srcid];
""!=o&&s.push(o),t=s.join("&"),n=e.split("?")[0]+"?"+t+"#"+(e.split("#")[1]||"");
}
}catch(m){
n="";
}
return n||(n=location.href+"#wechat_redirect",(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_47_1&lc=1&log0=[share_link]["+encodeURIComponent(location.href)+"]["+encodeURIComponent(e)+"]["+encodeURIComponent(msg_link)+"]"),
n;
}
function n(e,i,n){
var o=e.split("?").pop();
if(o=o.split("#").shift(),""!=o){
var t=[o,"action=share","action_type="+n,"scene="+window.source,"ascene="+(window.ascene||-1),"req_id="+(window.req_id||""),"vid="+("undefined"!=typeof window.reportVid?window.reportVid.join(";"):""),"musicid="+("undefined"!=typeof window.reportMid?window.reportMid.join(";"):""),"voiceid="+("undefined"!=typeof window.reportVoiceid?window.reportVoiceid.join(";"):""),"weappid="+("undefined"!=typeof window.reportWeappid?window.reportWeappid.join(";"):"")].join("&");
m({
url:"/mp/appmsgreport",
type:"POST",
data:t
});
}
}
function o(e,i){
return e.isCDN()&&(e=t.addParam(e,"wxfrom",i,!0)),e;
}
e("biz_common/utils/string/html.js"),e("appmsg/cdn_img_lib.js");
var t=(e("biz_common/dom/event.js"),e("biz_common/utils/url/parse.js")),s=e("biz_wap/utils/mmversion.js"),m=e("biz_wap/utils/ajax.js"),r={
90041:"此标题包含夸大误导信息",
20012:"此标题包含低俗恶俗性内容"
},a={
90041:"标题使用夸大、煽动、低俗等词语造成误导或引人不适。",
20012:"标题使用低俗或恶俗性词语造成不正当影响或引人不适。"
},c=e("biz_wap/jsapi/core.js");
c.call("hideToolbar"),c.call("showOptionMenu");
var d=msg_title.htmlDecode(),l=(msg_source_url.htmlDecode(),""),u=msg_cdn_url||ori_head_img_url||round_head_img,p=u,_=msg_link.htmlDecode(),d=msg_title.htmlDecode(),h=msg_desc.htmlDecode();
h=h||_,h=h.replace(/<br\/>/g,"\n"),idx>1&&document.getElementById("js_content")&&1446652800>ct&&(h=document.getElementById("js_content").innerHTML.replace(/<\/?[^>]*\/?>/g,"").htmlDecode().replace(/^(\s*)|(\s*)$/g,"").substr(0,54)),
u.isCDN()&&(u=u.replace(/\/0$/,"/300"),u=u.replace(/\/0\?/,"/300?")),p.isCDN()&&(p=p.replace(/\/0$/,"/640"),
p=p.replace(/\/0\?/,"/640?")),malicious_title_reason_id&&(d=r[malicious_title_reason_id],
h=a[malicious_title_reason_id],u="https://mmbiz.qlogo.cn/mmbiz_png/cVgP5bCElFiayFgbgEB9iaDt7hLicfz9RrXGM0LpaQ0TUic2gP7lbbqU3jCD8ibonicgIa3p99yjx1f1P26HChraeRUg/0?wx_fmt=png"),
"1"==is_limit_user&&c.call("hideOptionMenu"),window.is_temp_url&&c.invoke("hideMenuItems",{
menuList:["menuItem:share:timeline","menuItem:share:qq","menuItem:share:weiboApp","menuItem:share:facebook","menuItem:share:qzone","menuitem:share:weibo","menuItem:share:WeiboApp","menuItem:share:QZone","menuitem:facebook","menuItem:copyUrl","menuItem:share:email","menuitem:copy_url"]
},function(){}),c.on("menu:share:appmessage",function(e){
var t=1,s=o(u,"1");
e&&"favorite"==e.scene&&(t=24,s=o(u,"4")),c.invoke("sendAppMessage",{
appid:l,
img_url:s,
img_width:"640",
img_height:"640",
link:i(_,t),
desc:h,
title:d
},function(){
n(_,fakeid,t);
});
}),c.on("menu:share:timeline",function(){
var e=u;
s.isIOS||(e=o(u,"2")),n(_,fakeid,2),c.invoke("shareTimeline",{
img_url:e,
img_width:"640",
img_height:"640",
link:i(_,2),
desc:h,
title:d
},function(){});
});
c.on("menu:share:weiboApp",function(){
c.invoke("shareWeiboApp",{
img_url:u,
link:i(_,3),
title:d
},function(){
n(_,fakeid,3);
});
}),c.on("menu:share:facebook",function(){
n(_,fakeid,7),c.invoke("shareFB",{
img_url:p,
img_width:"640",
img_height:"640",
link:i(_,43),
desc:h,
title:d
},function(){});
}),c.on("menu:share:QZone",function(){
var e=o(u,"6");
n(_,fakeid,5),c.invoke("shareQZone",{
img_url:e,
img_width:"640",
img_height:"640",
link:i(_,22),
desc:h,
title:d
},function(){});
}),c.on("menu:share:qq",function(){
var e=o(u,"7");
n(_,fakeid,5),c.invoke("shareQQ",{
img_url:e,
img_width:"640",
img_height:"640",
link:i(_,23),
desc:h,
title:d
},function(){});
}),c.on("menu:share:email",function(){
n(_,fakeid,5),c.invoke("sendEmail",{
content:i(_,5),
title:d
},function(){});
}),c.on("onArticleReadingBtnClicked",function(e){
console.log("argv",e),location.href="https://mp.weixin.qq.com/mp/msgvoice?action=ttspage&vconsole=1&__biz="+window.biz+"&mid="+window.mid+"&idx="+window.idx+"&sn="+window.sn+"#wechat_redirect";
}),1==window.show_msg_voice&&c.invoke("showMenuItems",{
menuList:["menuItem:readArticle"]
},function(e){
console.log("showMenuItems call",e);
}),c.on("sys:record",function(){
c.invoke("recordHistory",{
link:_,
title:d,
source:nickname,
img_url:u
},function(){});
});
});define("biz_wap/jsapi/core.js",[],function(e,n,o,i){
"use strict";
document.domain="qq.com";
var t=window.__moon_report||function(){},d=8,r={
ready:function(e){
var n=function(){
try{
e&&(window.onBridgeReadyTime=window.onBridgeReadyTime||+new Date,e());
}catch(n){
throw t([{
offset:d,
log:"ready",
e:n
}]),n;
}
};
"undefined"!=typeof top.window.WeixinJSBridge&&top.window.WeixinJSBridge.invoke?n():top.window.document.addEventListener?top.window.document.addEventListener("WeixinJSBridgeReady",n,!1):top.window.document.attachEvent&&(top.window.document.attachEvent("WeixinJSBridgeReady",n),
top.window.document.attachEvent("onWeixinJSBridgeReady",n));
},
invoke:function(e,n,o){
this.ready(function(){
return"object"!=typeof top.window.WeixinJSBridge?(i("请在微信中打开此链接！"),!1):void top.window.WeixinJSBridge.invoke(e,n,function(n){
try{
if(o){
o.apply(window,arguments);
var i=n&&n.err_msg?", err_msg-> "+n.err_msg:"";
console.info("[jsapi] invoke->"+e+i);
}
}catch(r){
throw t([{
offset:d,
log:"invoke;methodName:"+e,
e:r
}]),r;
}
});
});
},
call:function(e){
this.ready(function(){
if("object"!=typeof top.window.WeixinJSBridge)return!1;
try{
top.window.WeixinJSBridge.call(e);
}catch(n){
throw t([{
offset:d,
log:"call;methodName:"+e,
e:n
}]),n;
}
});
},
on:function(e,n){
this.ready(function(){
return"object"==typeof top.window.WeixinJSBridge&&top.window.WeixinJSBridge.on?void top.window.WeixinJSBridge.on(e,function(){
try{
n&&n.apply(window,arguments);
}catch(o){
throw t([{
offset:d,
log:"on;eventName:"+e,
e:o
}]),o;
}
}):!1;
});
}
};
return r;
});define("appmsg/index.js",["biz_common/utils/string/html.js","biz_wap/utils/device.js","biz_common/dom/class.js","appmsg/log.js","biz_wap/utils/ajax.js","biz_common/dom/attr.js","appmsg/max_age.js","biz_wap/utils/mmversion.js","appmsg/test.js","biz_common/dom/event.js","biz_wap/jsapi/core.js","page/appmsg_new/combo.css","page/appmsg_new/not_in_mm.css","page/appmsg/page_mp_article_improve_combo.css","page/appmsg/not_in_mm.css","biz_common/utils/url/parse.js","appmsg/cdn_img_lib.js","appmsg/share.js","biz_common/log/jserr.js","biz_wap/ui/lazyload_img.js","appmsg/async.js","appmsg/copyright_report.js","appmsg/outer_link.js","appmsg/review_image.js","appmsg/product.js","appmsg/iframe.js","appmsg/qqmusic.js","appmsg/voice.js","appmsg/autoread.js","appmsg/weproduct.js","appmsg/weapp.js","appmsg/new_index.js","appmsg/wxtopic.js","appmsg/cdn_speed_report.js","appmsg/page_pos.js","appmsg/report_and_source.js","appmsg/report.js","appmsg/fereport.js","biz_wap/safe/mutation_observer_report.js","sougou/index.js"],function(e){
"use strict";
function o(){
function o(e,o){
var t={
lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",
lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",
alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",
animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"
},n=new Image;
n.onload=function(){
var t=n.width>0&&n.height>0;
o(e,t);
},n.onerror=function(){
o(e,!1);
},n.src="data:image/webp;base64,"+t[e];
}
function a(){
var e=window.performance||window.msPerformance||window.webkitPerformance;
if(e.timing){
var o=e.timing;
i("[Appmsg] dns:"+(o.domainLookupEnd-o.domainLookupStart)+"^^^ ssl:"+(0==o.secureConnectionStart?0:o.connectEnd-o.secureConnectionStart)+"^^^ tcp:"+(o.connectEnd-o.connectStart)+"^^^ request:"+(o.responseStart-o.requestStart)+"^^^ getPackageTime:"+(o.responseEnd-o.responseStart)+"^^^ domCententLoaded:"+(o.domContentLoadedEventStart-o.domLoading)+"^^^ domComplete:"+(o.domComplete-o.domLoading)+"^^^ firstViewTime:"+(real_show_page_time-o.navigationStart)+"^^^ interactiveTime:"+(page_endtime-o.navigationStart))+"^^^ ua:"+window.navigator.userAgent,
setTimeout(function(){
o.loadEventEnd&&i("[Appmsg] onload:"+(o.loadEventEnd-o.loadEventStart));
},100);
}
"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){
return this.replace(/^\s+|\s+$/g,"");
}),""==document.getElementById("js_content").innerHTML.trim()&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=24729_94_1");
var t=Math.random();
.001>t&&document.getElementById("js_read_area3")&&document.getElementById("js_read_area3").innerText&&document.getElementById("js_read_area3").innerText.indexOf("Pageview")>-1&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=24729_95_1"),
window.__wxjs_is_wkwebview&&window.__addIdKeyReport("28307",67);
}
var _=document.getElementsByTagName("body");
if(!_||!_[0])return!1;
_=_[0],function(){
var e=(new Date).getHours(),o=function(e,o){
o=o||"",window.isSg?(o=["uin:sougou","resp:"+o].join("|"),(new Image).src="/mp/jsreport?key="+e+"&content="+o+"&r="+Math.random()+"&from=sougou"):(o=["uin:"+top.window.user_uin,"resp:"+o].join("|"),
(new Image).src="/mp/jsreport?key="+e+"&content="+o+"&r="+Math.random());
},t=function(e,o,t){
var n=e+"_"+o;
t=t||1,window.logs.idkeys[n]||(window.logs.idkeys[n]={
val:0
}),window.logs.idkeys[n].val+=t;
},n=e>=11&&17>=e&&Math.random()<1,i=function(e,t){
n&&o(e,t);
};
window.__report=o,window.__commonVideoReport=i,window.__addIdKeyReport=t;
}();
var w=/^http(s)?:\/\/mp\.weixin\.qq\.com\//g;
try{
if(top!=window&&(!top||top&&top.location.href&&w.test(top.location.href))&&!window.isSg)throw new Error("in iframe");
}catch(h){
var A="",v=new Image;
v.src=("http://mp.weixin.qq.com/mp/jsreport?key=4&content=biz:"+biz+",mid:"+mid+",uin:"+uin+"[key4]"+A+"&r="+Math.random()).substr(0,1024);
}
if(window.isInWeixinApp()&&/#rd$/.test(location.href)&&!window.isWeixinCached){
var y=-1!=location.href.indexOf("?")?"&":"?";
location.replace(location.href.replace(/#rd$/,y+"rd2werd=1#wechat_redirect"));
}
var b=e("biz_common/utils/url/parse.js");
e("appmsg/cdn_img_lib.js"),window.page_endtime=+new Date;
{
var j=!p.isWp&&-1==navigator.userAgent.indexOf("MicroMessenger");
-1!=navigator.userAgent.indexOf("WindowsWechat");
}
if(e("appmsg/share.js"),window.isSg||"mp.weixin.qq.com"==location.host){
var I=e("biz_common/log/jserr.js");
I({
key:0,
reporturl:"http://mp.weixin.qq.com/mp/jsreport?1=1",
replaceStr:/http(s)?:(.*?)js\//g
});
}
window.logs.webplog={
lossy:0,
lossless:0,
alpha:0,
animation:0,
total:0
};
var x=-1!=navigator.userAgent.indexOf("TBS/"),R=function(e,t){
o(e,function(e,o){
if(window.logs.webplog[e]=o?1:0,window.logs.webplog.total++,4==window.logs.webplog.total){
var n=window.logs.webplog,i=Math.random();
x&&1>=i&&(n.lossy=n.lossless=n.alpha=1,window.logs.webplog=n);
var r=n.lossy&n.lossless&n.alpha;
t(!!r);
}
});
},q=function(e){
for(var o=document.getElementsByTagName("img"),t=!1,n=0,i=o.length;i>n;n++){
var r=o[n].getAttribute("data-src");
r&&r.isGif()&&(t=!0);
}
(u||navigator.userAgent.indexOf("Br_trunk")>-1)&&t&&p.isIOS&&p.gtVersion("6.5.13",!0)?(console.log("当前版本可以启用img代理"),
l.invoke("imageProxyInit",{},function(o){
console.log(o),o.err_msg.indexOf(":ok")>-1?(f=o.serverUrl,window.__addIdKeyReport("28307",117)):o.err_msg.indexOf(":fail")>-1&&window.__addIdKeyReport("28307",118),
e();
})):e();
},z=function(e){
R("lossy",e),R("lossless",e),R("alpha",e),R("animation",e);
};
window.webp=!1,q(function(){
z(function(o){
function t(e){
e.width<40||e.height<40||-1==e.className.indexOf("img_loading")&&(e.className+=" img_loading");
}
function n(e){
if(!(e.width<40||e.height<40)){
var o=e.src;
if(e.className=e.className.replace("img_loading",""),-1==e.className.indexOf("img_loadederror")){
e.className+=" img_loadederror",e.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",
window.__addIdKeyReport("28307",51);
var n=function(){
window.__addIdKeyReport("28307",66),r(e),t(e);
var n=e.__retryload;
return n=0,o=o.https2http(),e.__retryload=n,e.src=b.addParam(o,"retryload",n,!0),
!1;
};
m.on(e,"click",n);
}
}
}
function r(e){
e.className=e.className.replace("img_loading",""),e.className=e.className.replace("img_loadederror","");
}
window.webp=o,o&&window.localStorage&&window.localStorage.setItem&&window.localStorage.setItem("webp","1"),
window.logs.img={
download:{},
read:{},
load:{}
};
var a=document.getElementById("js_cover");
if(a){
var d=a.getAttribute("data-src");
d&&(d.isCDN()&&(d=d.imgChange640(),o&&(d=b.addParam(d,"tp","webp",!0)),d=b.addParam(d,"wxfrom","5",!0),
is_https_res||g?d=d.http2https():("http:"==location.protocol||-1!=navigator.userAgent.indexOf("MicroMessenger"))&&(d=d.https2http())),
setTimeout(function(){
a.onload=function(){
s(a,"height","auto","important"),s(a,"visibility","visible","important");
},a.setAttribute("src",d);
},0),window.logs.img.read[d]=!0,window.logs.img.load[d]=!0,a.removeAttribute("data-src"));
}
var p=e("biz_wap/ui/lazyload_img.js"),c=1;
window.logs.outer_pic=0;
for(var l=document.getElementsByTagName("img"),_=0,w=l.length;w>_;_++){
{
var u=l[_].getAttribute("data-src");
l[_].getAttribute("src");
}
u&&u.isGif()&&l[_].className.indexOf("__bg_gif")<0&&(l[_].className+=" __bg_gif"),
u&&t(l[_]);
}
for(var h=document.getElementsByClassName("__bg_gif"),_=0,w=h.length;w>_;++_)h[_].setAttribute("data-order",_);
new p({
attrKey:"data-src",
imgOccupied:!0,
lazyloadHeightWhenWifi:function(){
var e,o=1,t=1;
e=window.svr_time?new Date(1e3*window.svr_time):new Date;
var n=e.getHours();
return n>=20&&23>n&&(o=.5,t=0),{
bottom:o,
top:t
};
},
inImgRead:function(e){
e&&(window.logs.img.read[e]=!0);
},
changeSrc:function(e,o){
if(!o)return"";
var t=o;
if(o.isCDN()){
t=t.imgChange640();
var n,r=top.window.navigator.userAgent,a=/TBS\/([\d\.]+)/i,s=r.match(a);
s&&s[1]&&(n=parseInt(s[1]));
var d,p=/XWEB\/([\d\.]+)/i,c=r.match(p);
c&&c[1]&&(d=parseInt(c[1]));
var m=1e3,l=top.window.user_uin||0,_=0!==l&&Math.floor(l/100)%1e3<m;
_&&(n>=43305||d>=16)&&t.isGif()?(t=b.addParam(t,"tp","wxpic",!0),window.__addIdKeyReport("28307",91)):window.webp&&(t=b.addParam(t,"tp","webp",!0),
window.__addIdKeyReport("28307",84)),t=b.addParam(t,"wxfrom","5",!0),is_https_res||g?(t=t.http2https(),
window.__addIdKeyReport("28307",77)):("http:"==location.protocol||-1!=navigator.userAgent.indexOf("MicroMessenger"))&&(t=t.https2http(),
window.__addIdKeyReport("28307",70));
}else try{
var a=new RegExp("^http(s)?://((mmbiz.qpic.cn/.*)|(m.qpic.cn/.*)|(mmsns.qpic.cn/.*)|(shp.qpic.cn/.*)|(wx.qlogo.cn/.*)|(mmbiz.qlogo.cn/.*)|((a|b)[0-9]*.photo.store.qq.com/.*)|(mp.weixin.qq.com/.*)|(res.wx.qq.com/.*))");
a.test(o)||(window.__addIdKeyReport("28307",9),window.logs.outer_pic++);
}catch(w){}
var u=/^http\:\/\/(a|b)(\d)+\.photo\.store\.qq\.com/g;
t=t.replace(u,"http://m.qpic.cn"),t=b.addParam(t,"wx_lazy","1",!0);
return f&&t.isGif()&&(window.__addIdKeyReport("28307",106),t=b.addParam(t,"tp","wxpic",!0),
t=f+"hevc?url="+encodeURIComponent(t)+"&type=gif"),window.logs.img.load[t]=!0,i("[Appmsg] image_load_event_change_src. originsrc:"+o+"  ^^^ newsrc : "+t),
e.start_load_time=+new Date,t;
},
onerror:function(e,o){
var t=o?o.__retryload||0:0;
if(1==t&&n(o),e&&!(t>c)){
if(!e.isCDN()){
if(!f)return;
if(-1==e.indexOf(f))return;
}
var r=0==e.indexOf("https://")?7:0;
if(window.__addIdKeyReport("28307",72+r),window.__addIdKeyReport("28307",75+1*t+r),
e.isWxpic()?(window.__addIdKeyReport("28307",93),window.__addIdKeyReport("28307",96+1*t)):e.isWebp()&&(window.__addIdKeyReport("28307",86),
window.__addIdKeyReport("28307",89+1*t)),f&&e.indexOf(f)>-1&&window.__addIdKeyReport("28307",108),
c>t){
if(t++,o.__retryload=t,1==t&&e.indexOf("http://")>-1?(e=e.http2https(),window.__addIdKeyReport("28307",60),
window.__addIdKeyReport("28307",77)):1==t&&e.indexOf("https://")>-1&&(window.__addIdKeyReport("28307",61),
window.__addIdKeyReport("28307",77)),f&&e.indexOf(f)>-1){
var a=e.split("hevc?url=")[1];
a=a.split("&type")[0],a=decodeURIComponent(a),a=a.replace("tp=wxpic",""),e=a.https2http();
}
o.start_load_time=+new Date,o.src=b.addParam(e,"retryload",t,!0);
}
window.__has_imgfailed||(window.__has_imgfailed=!0,window.__addIdKeyReport("28307",65)),
i("[Appmsg] image_load_event_on_error. src:"+e),o.setAttribute("data-fail",1);
var s=10;
/tp\=webp/.test(e)&&(s=11);
var d=new Image;
d.src="http://mp.weixin.qq.com/mp/jsreport?key="+s+"&content="+(encodeURIComponent(e)+"["+uin+"]")+"&r="+Math.random();
}
},
onload:function(e,o){
r(o),o.gray&&!o.loadGif&&((o.width||o.naturalWidth)<120||(o.height||o.naturalHeight)<120?o.autoTap&&o.autoTap():o.span&&o.span.children&&o.span.children.item(0)&&(o.span.children.item(0).style.display=""));
var t=o?o.__retryload||0:0;
if(!(t>c)){
i("[Appmsg] image_load_event_onload_image. src:"+e+"  ^^^  retryloadtimes: "+t),
o.setAttribute("data-fail",0);
var n=0==e.indexOf("https://")?7:0;
window.__addIdKeyReport("28307",71+n),window.__addIdKeyReport("28307",73+1*t+n),
e.isWxpic()?(window.__addIdKeyReport("28307",92),window.__addIdKeyReport("28307",94+1*t)):e.isWebp()&&(window.__addIdKeyReport("28307",85),
window.__addIdKeyReport("28307",87+1*t)),f&&e.indexOf(f)>-1&&window.__addIdKeyReport("28307",107),
window.__has_imgsucceed||(window.__has_imgsucceed=!0,window.__addIdKeyReport("28307",64)),
1==t&&e.indexOf("http://")>-1&&window.__addIdKeyReport("28307",50),1==t&&e.indexOf("https://")>-1&&window.__addIdKeyReport("28307",52);
var a=Math.random(),s=+new Date-o.start_load_time;
s&&0==e.indexOf("https://")&&.5>a?(window.__addIdKeyReport("27822",121,s),window.__addIdKeyReport("27822",122)):s&&5e-4>a&&(window.__addIdKeyReport("27822",124,s),
window.__addIdKeyReport("27822",125));
}
},
detect:function(e){
if(e&&e.time&&e.loadList){
var o=e.time,t=e.loadList;
window.logs.img.download[o]=t;
}
},
container:document.getElementById("page-content")
});
});
}),e("appmsg/async.js"),!window.isSg;
var E=e("appmsg/copyright_report.js");
!function(){
var e=document.getElementById("post-user"),o=document.getElementById("copyright_info"),t=[],n=document.getElementById("post-user-headimg");
if(e){
var a="57";
"26"==window.source&&(a="95"),"28"==window.source&&(a="96"),"29"==window.source&&(a="39"),
"15"==window.source&&(a="121"),t.push({
dom:e,
username:user_name_new||user_name,
profileReportInfo:window.profileReportInfo||"",
scene:a
}),n&&t.push({
dom:n,
username:user_name_new||user_name,
profileReportInfo:window.profileReportInfo||"",
scene:a
});
}
o&&source_encode_biz&&t.push({
dom:o,
source_encode_biz:source_encode_biz,
scene:"110"
});
var s=document.getElementById("js_share_headimg");
s&&(window.new_appmsg&&window.source_encode_biz?m.on(s,"click",function(){
return location.href="/mp/profile_ext?action=home&__biz="+window.source_encode_biz+"#wechat_redirect",
!1;
}):t.push({
dom:s,
username:source_username,
scene:0
}));
var d=document.getElementById("js_share_author");
d&&(window.new_appmsg&&window.source_encode_biz?m.on(d,"click",function(){
return location.href="/mp/profile_ext?action=home&__biz="+window.source_encode_biz+"#wechat_redirect",
!1;
}):t.push({
dom:d,
username:source_username,
scene:0
}));
for(var c=0,_=t.length;_>c;c++)!function(e){
m.on(e.dom,"click",function(){
if("copyright_info"==e.dom.id&&source_encode_biz){
E.card_click_report({
scene:"0"
});
var o="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz="+e.source_encode_biz+"&scene="+e.scene+"#wechat_redirect";
-1!=navigator.userAgent.indexOf("WindowsWechat")||-1!=navigator.userAgent.indexOf("Mac OS")?location.href=o:l.invoke("openUrlWithExtraWebview",{
url:o,
openType:1
},function(e){
-1==e.err_msg.indexOf("ok")&&(location.href=o);
});
}else{
if(i("[Appmsg] profile_click_before_loadprofile: username:"+e.username+", scene:"+e.scene),
r({
url:"/mp/appmsgreport?action=name_click",
data:{
url:location.href,
title:window.msg_title||"",
msgid:window.mid||"",
itemidx:window.idx||"",
__biz:window.biz||"",
ascene:window.ascene||-1
},
type:"POST",
dataType:"json",
async:!0,
success:function(){}
}),profileReportInfo){
var t=String(profileReportInfo).split("_");
3==t.length&&r({
url:"/mp/ad_biz_info?action=report&__biz="+window.biz+"&report_type=2&aid="+t[1]+"&tid="+t[2],
type:"GET",
dataType:"json",
async:!0,
success:function(){}
});
}
l.invoke("profile",{
username:e.username,
profileReportInfo:e.profileReportInfo||"",
scene:e.scene
},function(o){
window.__addIdKeyReport("28307","1"),i("[Appmsg] profile_click_after_loadprofile: username:"+e.username+", scene:"+e.scene+", profileReportInfo:"+e.profileReportInfo+", res.err_msg:"+o.err_msg);
});
}
return!1;
}),p.isWp&&e.dom.setAttribute("href","weixin://profile/"+e.username);
}(t[c]);
}(),function(){
location.href.match(/fontScale=\d+/)&&p.isIOS&&l.on("menu:setfont",function(e){
e.fontScale<=0&&(e.fontScale=100),document.getElementsByTagName("html").item(0).style.webkitTextSizeAdjust=e.fontScale+"%",
document.getElementsByTagName("html").item(0).style.lineHeight=160/e.fontScale;
});
}();
var B=e("appmsg/outer_link.js");
if(new B({
container:document.getElementById("js_content"),
changeHref:function(e,o){
if(!e||0!=e.indexOf("http://mp.weixin.qq.com/")&&0!=e.indexOf("https://mp.weixin.qq.com/")){
if(18==ban_scene)return"/mp/ban?action=check&__biz="+biz+"&mid="+mid+"&idx="+idx+"&scene="+ban_scene+"#wechat_redirect";
if(0!=e.indexOf("http://mp.weixinbridge.com/mp/wapredirect"))return"http://mp.weixinbridge.com/mp/wapredirect?url="+encodeURIComponent(e)+"&action=appmsg_redirect&uin="+uin+"&biz="+biz+"&mid="+mid+"&idx="+idx+"&type="+o+"&scene=0";
}else{
e=e.replace(/#rd\s*$/,""),e=e.replace(/#wechat_redirect\s*$/,""),e=e.replace(/[\?&]scene=21/,"");
var t="&";
-1==e.indexOf("?")&&(t="?"),e+=t+"scene=21#wechat_redirect";
}
return e;
}
}),!j){
var k=e("appmsg/review_image.js"),S=document.getElementById("js_cover"),K=[];
S&&K.push(S),new k({
container:document.getElementById("js_content"),
is_https_res:is_https_res,
imgs:K
});
}
e("appmsg/product.js"),function(){
try{
var e=document.getElementById("js_content");
if(!e||!e.querySelectorAll)return;
for(var o=e.querySelectorAll("*"),t="js_product_err_container,js_product_loop_content,js_product_container,img_loading,list-paddingleft-2,selectTdClass,noBorderTable,ue-table-interlace-color-single,ue-table-interlace-color-double,__bg_gif,weapp_text_link,weapp_image_link".split(","),n=function(e){
if(e&&e.className){
for(var o=e.className.split(/\s+/),n=[],i=0,r=o.length;r>i;++i){
var a=o[i];
a&&-1!=t.indexOf(a)&&n.push(a);
}
e.className=n.join(" ");
}
},i=0,r=o.length;r>i;++i){
var a=o[i];
a.tagName&&"iframe"!=a.tagName.toLowerCase()&&n(a);
}
}catch(s){}
}(),window.fromWeixinCached||e("appmsg/iframe.js"),e("appmsg/qqmusic.js"),e("appmsg/voice.js"),
window.__appmsgCgiData&&1==window.__appmsgCgiData.show_msg_voice&&e("appmsg/autoread.js"),
window.__appmsgCgiData&&1==window.__appmsgCgiData.wxa_product&&e("appmsg/weproduct.js"),
e("appmsg/weapp.js"),window.new_appmsg&&e("appmsg/new_index.js"),e("appmsg/wxtopic.js"),
e("appmsg/cdn_speed_report.js"),e("appmsg/page_pos.js"),setTimeout(function(){
window.article_improve_combo_css;
},0),setTimeout(function(){
m.tap(document.getElementById("copyright_logo"),function(){
location.href="http://kf.qq.com/touch/sappfaq/150211YfyMVj150326iquI3e.html";
}),d(),c(),e("appmsg/report_and_source.js"),function(){
if(j){
n.addClass(_,"not_in_mm");
var e=document.getElementById("js_pc_qr_code_img");
if(e){
var o=10000004,t=document.referrer;
if(0==t.indexOf("http://weixin.sogou.com")?o=10000001:0==t.indexOf("https://wx.qq.com")&&(o=10000003),
window.isSg)e.setAttribute("src",sg_qr_code.htmlDecode());else{
e.setAttribute("src","/mp/qrcode?scene="+o+"&size=102&__biz="+biz+"&mid="+mid+"&idx="+idx+"&sn="+sn+"&send_time="+send_time);
var i=new Image;
i.src="/mp/report?action=pcclick&__biz="+biz+"&uin="+uin+"&scene="+o+"&r="+Math.random();
}
document.getElementById("js_pc_qr_code").style.display="block";
}
var r=document.getElementById("js_profile_qrcode"),a=document.getElementById("js_profile_arrow_wrp"),s=document.getElementById("post-user");
if(r&&s&&a){
var d=function(){
var e=10000005,o=document.referrer;
0==o.indexOf("http://weixin.sogou.com")?e=10000006:0==o.indexOf("https://wx.qq.com")&&(e=10000007);
var t=document.getElementById("js_profile_qrcode_img");
if(t)if(window.isSg)t.setAttribute("src",sg_qr_code.htmlDecode());else{
t.setAttribute("src","/mp/qrcode?scene="+e+"&size=102&__biz="+biz+"&mid="+mid+"&idx="+idx+"&sn="+sn+"&send_time="+send_time);
var n=new Image;
n.src="/mp/report?action=pcclick&__biz="+biz+"&uin="+uin+"&scene="+e+"&r="+Math.random();
}
return r.style.display="block",a.style.left=s.offsetLeft-r.offsetLeft+s.offsetWidth/2-8+"px",
!1;
};
m.on(s,"click",d),m.on(r,"click",d),m.on(document,"click",function(e){
var o=e.target||e.srcElement;
o!=s&&o!=r&&(r.style.display="none");
});
}
}else{
var p=document.getElementById("js_report_article3");
!!p&&(p.style.display="");
}
}(),function(){
var e=location.href.indexOf("scrolltodown")>-1?!0:!1,o=document.getElementById("img-content");
if(e&&o&&o.getBoundingClientRect){
var t=o.getBoundingClientRect().height;
window.scrollTo(0,t);
}
}(),e("appmsg/report.js");
for(var o=document.getElementsByTagName("map"),t=0,i=o.length;i>t;++t)o[t].parentNode.removeChild(o[t]);
if(E.card_pv_report(),Math.random()<.01)try{
var r="https://js.aq.qq.com/js/aq_common.js",a=document.createElement("script");
a.src=r;
var s=document.getElementsByTagName("head")[0];
s.appendChild(a);
}catch(p){}
var l=document.getElementById("js_close_temp");
m.on(l,"click",function(){
l.parentNode.parentNode.removeChild(l.parentNode),n.removeClass(document.getElementById("js_article"),"preview_appmsg");
});
},1e3),function(){
if(t.os.ios&&"onorientationchange"in window){
var e=[],o="onorientationchange"in window?"orientationchange":"resize",n=function(){
return 90===Math.abs(window.orientation)?1:2;
};
e.push({
ori:n(),
scroll:window.pageYOffset||document.documentElement.scrollTop,
istouchmove:!1
});
var i=(new Date).getHours();
m.on(window,o,function(){
var o=e.length-2,t=n();
if(o>=0){
var r=e[o],a=r.ori;
a!==t||e[e.length-1].istouchmove||(i>=11&&17>=i&&window.__report(63),window.scrollTo(0,r.scroll));
}
e.push({
ori:t,
scroll:window.pageYOffset||document.documentElement.scrollTop,
istouchmove:!1
});
}),m.on(window,"scroll",function(){
var o=e.length-1;
e[o].ori==n()&&(e[o].scroll=window.pageYOffset||document.documentElement.scrollTop,
e[o].istouchmove=!0);
});
}
}(),i("[Appmsg] href:"+location.href+"^^^ ua:"+window.navigator.userAgent),window.addEventListener?window.addEventListener("load",a,!1):window.attachEvent&&window.attachEvent("onload",a),
e("appmsg/fereport.js"),function(){
window.addEventListener&&document.getElementsByTagName("body")[0].addEventListener("copy",function(){
(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_18_1",
p.isIOS&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_19_1"),
p.isAndroid&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_20_1");
},!1);
}(),function(){
window.__observer&&window.__observer_data&&e("biz_wap/safe/mutation_observer_report.js");
}(),"undefined"!=typeof isSg&&e("sougou/index.js"),setTimeout(function(){
for(var e=function(){
(new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=28307_49_1&lc=1&log0=[28307_49_appmsg_fe_filter]"+encodeURIComponent(location.href);
},o=(window.appmsg_fe_filter||"").split(","),t=function(o,t){
try{
if(!o)return;
if(o.querySelectorAll){
var n=o.querySelectorAll("*["+t+"]");
if(n&&n.length>0){
e();
for(var i=0;i<n.length;++i)n[i]&&n[i].removeAttribute&&n[i].removeAttribute(t);
}
return;
}
var r=o.childNodes;
if(o.hasAttribute&&o.hasAttribute(t)&&e(),o.removeAttribute&&o.removeAttribute(t),
r&&r.length)for(var i=0;i<r.length;++i)filterContenteditable(r[i]);
}catch(a){}
},n=document.getElementById("js_content"),i=0;i<o.length;++i)o[i]&&t(n,o[i]);
},0),setTimeout(function(){
var e=999,o=636,t="http://mmbiz.qpic.cn/mmbiz_png/7lG1x2vpicdic0p5bBthpD9lsJcINicsSzd6uKQQJyoj5oTl8lFIs9K0fIibgxCzms0enDLTRxTHLpDPCLpSvIExiag/0",n=(new Date).getHours();
if(!(11>n||n>16||Math.random()<.99)){
var i=new Image;
i.onload=function(){
var t=i.naturalWidth||i.width,n=i.naturalHeight||i.height;
(t!=e||n!=o)&&window.__addIdKeyReport("28307","wifi"===window.networkType?120:123),
window.__addIdKeyReport("28307","wifi"===window.networkType?121:124);
},i.src=t;
var r=new Image;
r.onload=function(){
var t=r.naturalWidth||r.width,n=r.naturalHeight||r.height;
(t!=e||n!=o)&&window.__addIdKeyReport("28307",126),window.__addIdKeyReport("28307",127);
},r.src="https://mmbiz.qpic.cn/mmbiz_png/7lG1x2vpicdic0p5bBthpD9lsJcINicsSzd6uKQQJyoj5oTl8lFIs9K0fIibgxCzms0enDLTRxTHLpDPCLpSvIExiag/0";
}
},3e3);
}
e("biz_common/utils/string/html.js");
var t=e("biz_wap/utils/device.js"),n=e("biz_common/dom/class.js"),i=e("appmsg/log.js"),r=e("biz_wap/utils/ajax.js"),a=e("biz_common/dom/attr.js"),s=a.setProperty,d=e("appmsg/max_age.js"),p=e("biz_wap/utils/mmversion.js"),c=e("appmsg/test.js"),m=e("biz_common/dom/event.js"),l=e("biz_wap/jsapi/core.js"),p=e("biz_wap/utils/mmversion.js");
window.new_appmsg?(e("page/appmsg_new/combo.css"),e("page/appmsg_new/not_in_mm.css")):(e("page/appmsg/page_mp_article_improve_combo.css"),
e("page/appmsg/not_in_mm.css"));
var _=top.window.user_uin||0,w=Math.floor(_/100)%1e3,g=0!==_&&1001>w,u=!0,f="";
window.logs.pagetime.jsapi_ready_time=+new Date,window.logs.idkeys={},console.log("进入index.js init"),
i("[Appmsg] start run index.js init"),o();
});