<!DOCTYPE html>
<!-- saved from url=(0178)http://www.toutiao.com/i6338533626304528897/?tt_from=weixin&utm_campaign=client_share&app=news_article&utm_source=weixin&iid=4814822643&utm_medium=toutiao_android&wxshare_count=1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="http://s3.pstatp.com/">
    <link rel="dns-prefetch" href="http://s3a.pstatp.com/">
    <link rel="dns-prefetch" href="http://s3b.pstatp.com/">
    <link rel="dns-prefetch" href="http://p1.pstatp.com/">
    <link rel="dns-prefetch" href="http://p3.pstatp.com/">
    
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    
    <meta name="baidu-site-verification" content="T239HZAbh7">
    
    <!--meta name="baidu_union_verify" content="94bb8bb3fa863f70e7fd926bffecd81e"-->
    <meta name="360-site-verification" content="b96e1758dfc9156a410a4fb9520c5956">
    <meta name="360_ssp_verify" content="2ae4ad39552c45425bddb738efda3dbb">
    <meta name="google-site-verification" content="3PYTTW0s7IAfkReV8wAECfjIdKY-bQeSkVTyJNZpBKE">
    <meta name="shenma-site-verification" content="34c05607e2a9430ad4249ed48faaf7cb_1432711730">
    <meta name="baidu_union_verify" content="b88dd3920f970845bad8ad9f90d687f7">
    <meta name="domain_verify" content="pmrgi33nmfuw4ir2ej2g65lunfqw6ltdn5wselbcm52wszbchirdqyztge3tenrsgq3dknjume2tayrvmqytemlfmiydimddgu4gcnzcfqrhi2lnmvjwc5tfei5dcnbwhazdcobuhe2dqobrpu">
    
    
  <link rel="alternate" media="only screen and (max-width: 640px)" href="http://m.toutiao.com/a6327571457467826434/">

  <title>理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)</title>

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta name="keywords" content="Confirm,Cancel,Kafka,分布式,持久化,Try,一致性,幂等性,冲正,投递,TCC,重试,回滚,数据库">
  <meta name="description" content="“针对微服务下的交易业务如何保障数据一致性，本文尽量做到理论结合实践，将我们在实际产品中用到的分布式事务实现机制，和大家扒一扒，希望能帮到各位。前言这是一个开撕的话题，我经历过太多">

    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="http://s3a.pstatp.com/toutiao/resource/ntoutiao_web/static/image/favicon_8e9c9c7.ico" type="image/x-icon">
    <link rel="stylesheet" href="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/layout_a2bdebe.css">
    <!--[if lt IE 9]>
      <script src="//s3a.pstatp.com/toutiao/resource/ntoutiao_web/static/js/lib/es5-shim_110642e.js"></script>
    <![endif]-->
    <script async="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/analytics.js.下载"></script><script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/lib_45674aa.js.下载"></script>
    
  <link rel="stylesheet" href="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/article_843339b.css">
  <link rel="stylesheet" href="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/video.min.css">
  <!--[if lt IE 9]>
    <script src="http://s3a.pstatp.com/site/tt_mfsroot/v-player/video-ie8.js" charset="utf-8"></script>
  <![endif]-->

</head>

<body style="min-width: 1220px; overflow-x: hidden;"><div id="BAIDU_DUP_fp_wrapper" style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;"><iframe id="BAIDU_DUP_fp_iframe" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/o.html" style="width: 0px; height: 0px; visibility: hidden; display: none;"></iframe></div>
    <div style="display:none"><input type="hidden" name="csrfmiddlewaretoken" value="18b4c2dd50a67dabc20f982bd846f3f0"></div>

    <a href="http://www.toutiao.com/articles_news_society/" style="display:none;"></a>

    <div class="y-wrap">
        

<!-- 公共头部 -->
<div id="header">
  <div riot-tag="wtopbar" style="height: 34px; background: #222;"><div class="y-box wtopbar">  <div class="y-left y-nav-topbar" riot-tag="nav"><div class="nav"> <ul class="y-box nav-list" ga_event="mh_channel"> <li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/" ga_event="mh_channel_recommend">推荐</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_hot/" ga_event="mh_channel_hot">热点</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/video/" ga_event="mh_channel_video">视频</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_image/" ga_event="mh_channel_image">图片</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/essay_joke/" ga_event="mh_channel_essay">段子</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_society/" ga_event="mh_channel_society">社会</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_entertainment/" ga_event="mh_channel_entertainment">娱乐</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_tech/" ga_event="mh_channel_tech">科技</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_car/" ga_event="mh_channel_car">汽车</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_sports/" ga_event="mh_channel_sports">体育</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_finance/" ga_event="mh_channel_finance">财经</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_military/" ga_event="mh_channel_military">军事</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_world/" ga_event="mh_channel_world">国际</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_fashion/" ga_event="mh_channel_fashion">时尚</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/news_travel/" ga_event="mh_channel_travel">旅游</a> </li><!--riot placeholder--> <li class="y-left nav-item nav-more"> <a class="nav-link" href="javascript:;"> 更多<i class="y-icon icon-more"></i> </a> <div class="nav-layer"> <ul class="nav-more-list"> <li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_discovery/" ga_event="mh_channel_discovery">探索</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_baby/" ga_event="mh_channel_baby">育儿</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_regimen/" ga_event="mh_channel_regimen">养生</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_story/" ga_event="mh_channel_story">故事</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_essay/" ga_event="mh_channel_essay">美文</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_game/" ga_event="mh_channel_game">游戏</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_history/" ga_event="mh_channel_history">历史</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/news_food/" ga_event="mh_channel_food">美食</a> </li><!--riot placeholder--> </ul> </div> </li> </ul> </div></div> <ul class="y-right"> <li class="tb-item userbox"> <div riot-tag="wuserbox" abtype=""><div class="y-box wuserbox">   <div class="nav-login"> <a ga_event="nav_login" href="javascript:;"> <span>登录</span> </a> </div> </div></div> </li> <li class="tb-item"> <a class="tb-link" href="https://wenda.toutiao.com/" target="_blank" ga_event="mh_nav_others">问答</a> </li> <li class="tb-item"> <a class="tb-link" href="https://mp.toutiao.com/" target="_blank" ga_event="mh_nav_others">头条号</a> </li> <li class="tb-item"> <a class="tb-link" href="https://tuchong.com/" target="_blank" ga_event="mh_nav_others">图虫</a> </li> <li class="tb-item"> <a class="tb-link" href="javascript:void(0)">反馈</a> </li> <li class="tb-item more"> <a class="tb-link" href="http://www.toutiao.com/about/">更多</a> <div class="layer"> <ul> <li> <a href="http://www.toutiao.com/articles_news_society/" class="layer-item">头条简版</a> </li> <li> <a href="http://www.toutiao.com/about/" class="layer-item" rel="nofollow">关于头条</a> </li> <li> <a href="http://www.toutiao.com/join/" class="layer-item" rel="nofollow">加入头条</a> </li> <li> <a href="http://www.toutiao.com/report/" class="layer-item" rel="nofollow">媒体报道</a> </li> <li> <a href="http://www.toutiao.com/media_partners/" class="layer-item" rel="nofollow">媒体合作</a> </li> <li> <a href="http://www.toutiao.com/cooperation/" class="layer-item" rel="nofollow">产品合作</a> </li> <li> <a href="http://www.toutiao.com/media_cooperation/" class="layer-item" rel="nofollow">合作说明</a> </li> <li> <a href="https://ad.toutiao.com/e/" class="layer-item" target="_blank" rel="nofollow">广告投放</a> </li> <li> <a href="http://www.toutiao.com/contact/" class="layer-item" rel="nofollow">联系我们</a> </li> <li> <a href="http://www.toutiao.com/user_agreement/" class="layer-item" rel="nofollow">用户协议</a> </li> <li> <a href="http://www.toutiao.com/complain/" class="layer-item" rel="nofollow">投诉指引</a> </li> <li> <a href="http://www.toutiao.com/corrupt_report/" class="layer-item" rel="nofollow">廉洁举报</a> </li> </ul> </div> </li> </ul> <div riot-tag="userFeedback" class="userFeedback" style="display: none;"><div class="feedback_dialog"> <div class="dialog-header"> <h3>意见反馈</h3> </div> <div class="dialog-inner"> <div class="feedback_panel"> <form> <p class="label">联系方式（必填）</p> <div class="input-group"> <input class="email" placeholder="您的邮箱/QQ号" type="text" name="feedback-email"> </div> <p class="label">您的意见（必填）</p> <div class="input-group"> <textarea style="height:100px;" name="feedback-content" class="content" maxlength="140" placeholder="请填写您的意见，不超过140字"></textarea> </div> <div class="input-group"> <input type="submit" value="提交" class="submit-btn"> <span class="error"></span> <a class="close" href="javascript:void(0);">[关闭]</a> </div> </form> </div> </div> </div></div> </div></div>
  
  <div class="middlebar">
  <div class="y-box middlebar-inner">
    <div class="y-left logo-box">
      <a class="logo-link" href="http://www.toutiao.com/" ga_event="go_home">
        <img class="logo" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/logo_201f80d.png">
      </a>
    </div>

    
      <div class="y-left chinese-tag">
        <a href="http://www.toutiao.com/" target="_blank" ga_event="click_index">首页</a>
        /
        <a href="http://www.toutiao.com/news_tech" target="_blank" ga_event="click_channel">科技</a>
        /
        <span class="text">正文</span>
      </div>
    

    <div class="y-right">
      <div riot-tag="wsearch" style="margin-top: 9px; width: 340px;"><div name="searchBox" class="wsearch"> <form name="searchForm" action="http://www.toutiao.com/search/" method="get" target="_blank"> <div name="inputbox" class="y-box input-group"> <input class="y-left input-text" name="keyword" autocomplete="off" ga_event="mh_search" type="text" placeholder="请输入关键字" onclick=""> <div class="y-right btn-submit"> <button type="submit" href="javascript:;"> <i class="y-icon icon-search" ga_event="mh_search"></i> </button> </div> </div> </form> <div class="layer "> <div class="layer-inner"> <ul ga_event="mh_search"> <li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-1">1</i> <span class="search-txt">妈妈带十岁男孩进女澡堂</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-2">2</i> <span class="search-txt">得知女友是个男孩时</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-3">3</i> <span class="search-txt">李嘉诚的家庭饭局曝光</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-4">4</i> <span class="search-txt">范媛媛 母系社会</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-5">5</i> <span class="search-txt">吴克群 突发性失聪</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-6">6</i> <span class="search-txt">日本赠狗外交失败</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-7">7</i> <span class="search-txt">别忘了给室友掀开被子</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-8">8</i> <span class="search-txt">你喜欢的未必适合你</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-9">9</i> <span class="search-txt">王俊凯忘词</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-10">10</i> <span class="search-txt">赵丽颖不拍戏就蹲着</span> </a> </li><!--riot placeholder--> </ul> </div> </div> </div></div>
    </div>
  </div>
</div>

  
</div>

<div riot-tag="login"><div class="login-dialog hide"> <a class="btn" href="javascript:;"> <i class="icon icon-close"></i> </a> <div class="login-dialog-header"> <h3>邮箱登录</h3> </div> <div class="login-dialog-inner" data-node="inner"> <div class="login-pannel bottom-line"> <form action="http://www.toutiao.com/auth/login/" method="POST"> <ul> <li> <div class="input-group"> <div class="input"> <label>邮箱</label> <input class="name" name="name_or_email" type="text" placeholder="请使用您的注册邮箱" autocomplete="off" spellcheck="false"> </div> </div> </li> <li> <div class="input-group"> <div class="input"> <label>密码</label> <input class="password" name="password" type="password" data-node="password" placeholder="密码" autocomplete="off" spellcheck="false"> </div> </div> </li> <li class="captcha-box "> <div class="input-group"> <div class="input"> <input class="password" name="captcha" type="text" data-node="captcha" placeholder="验证码" autocomplete="off" spellcheck="false"> <img name="captchaImg"> </div> </div> </li> <li> <div class="input-group"> <input type="checkbox" name="remember_me" checked="" style="vertical-align:top"> <label for="remember_me" class="label">记住账号</label> </div> </li> <li> <div class="input-group" style="text-align: center;"> <input type="submit" class="submit-btn" value="登录"> <p class=""></p> </div> </li> </ul> </form> </div> <div class="login-dialog-header"> <h3>合作网站帐号登录</h3> </div> <div class=""> <ul class="y-box sns_login_list"> <li class="sinaweibo"> <a href="javascript:;" data-pid="sina_weibo" ga_event="login_sina_weibo"> <i class="icon"></i> 新浪微博 </a> </li> <li class="qqweibo"> <a href="javascript:;" data-pid="qq_weibo" ga_event="login_tencnet_weibo"> <i class="icon"></i> 腾讯微博 </a> </li> <li class="qzone"> <a href="javascript:;" data-pid="qzone_sns" ga_event="login_qqzone"> <i class="icon"></i> QQ空间 </a> </li> <li class="renren"> <a href="javascript:;" data-pid="renren_sns" ga_event="login_renren"> <i class="icon"></i> 人人网 </a> </li> <li class="weixin"> <a href="javascript:;" style="margin-right:0;" data-pid="weixin" ga_event="login_wechat"> <i class="icon"></i> 微信 </a> </li> </ul> </div> </div> </div> <div class="mask hide"></div></div>
<div id="toast"></div>


<div class="y-box container">
  <div class="y-left">
    <div class="y-box">
      <div class="y-left index-left">
        <div riot-tag="snsbox"><div class="snsbox snsbox-fixed" name="snsbox"> <a href="http://www.toutiao.com/i6338533626304528897/?tt_from=weixin&amp;utm_campaign=client_share&amp;app=news_article&amp;utm_source=weixin&amp;iid=4814822643&amp;utm_medium=toutiao_android&amp;wxshare_count=1#comment_area" class="share-count" ga_event="click_comment_anchor"> <i class="y-icon icon-comments"></i> <span>5</span> </a> <div class="share-hr"></div> <div class="share-box" ga_event="click_share_weibo"><i class="y-icon icon-sina"></i><span>微博</span></div> <div class="share-box" ga_event="click_share_qzone"><i class="y-icon icon-qzone"></i><span>Qzone</span></div> <div class="share-box share-weixin" ga_event="click_share_weixin"> <i class="y-icon icon-wechat"></i><span>微信</span> <div class="share-qrcode"> <div></div> </div> </div> </div></div>
      </div>
      <div class="y-left index-middle" id="J_content">
        <div id="article-main">
	

  <h1 class="article-title">理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择</h1>

  <div class="articleInfo">
	
    
    <span class="src">
    	
    		InfoQ技术沙龙
    	
    </span>
    
    <span class="time">2016-10-07 09:21</span>
</div>

  <div class="article-content"><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/f5e000d577e8d4da18a" img_width="960" img_height="640" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"><p>“</p><p>针对微服务下的交易业务如何保障数据一致性，本文尽量做到理论结合实践，将我们在实际产品中用到的分布式事务实现机制，和大家扒一扒，希望能帮到各位。</p><p><strong>前言</strong></p><p>这是一个开撕的话题，我经历过太多的关于分布式事务的需求：“有没有简单的方案，像使用数据库事务那样，解决分布式数据一致性的问题”。特别是微服务架构流行的今天，一次交易需要跨越多个“服务”、多个数据库来实现，传统的技术手段，已经无法应对和满足微服务情况下这些复杂的场景了。</p><p>谈到分布式事务，必须先把CAP拿出来说说事……，当然还有BASE……</p><p>从架构的角度来看，业务拆分（数据分区）、数据一致性、性能（可用性）永远是个平衡的艺术：</p><ul><li><p>在微服务架构下，为了获得更高的性能与灵活性，将业务应用拆分为多个，交易跨多个微服务编排，数据一致性的问题产生；</p></li><li><p>为了解决数据一致性问题，需要采用不同的事务机制来保障，这又会产生性能（可用性）问题；</p></li></ul><p>在计算机世界里，为了解决一件事情，另外的问题就会接踵而至，从另一个层面印证了IT架构永远是一种平衡的艺术。</p><p>“BASE”其核心思想是根据业务特点，采用适当的方式来使系统达到最终一致性（Eventual consistency）；<strong>在互联网领域，通常需要牺牲强一致性来换取系统的高可用性，</strong>只需要保证数据的“最终一致”，只是这个最终时间需要在用户可以接受的范围内；但在金融相关的交易领域，仍然需要采用强一致性的方式来保障交易的准确性与可靠性。</p><p>接下来为大家介绍业界常见的事务处理模式，包括两阶段提交、三阶段提交、Sagas长事务、补偿模式、可靠事件模式（本地事件表、外部事件表）、可靠事件模式（非事务消息、事务消息）、TCC等。不同的事务模型支持不同的数据一致性。如果读者对这几种分布式事务比较熟悉，可以直接参考下图并结合自身业务需求选择合适的事务模型。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c510d73eaeb0d" img_width="640" img_height="330" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p><strong>两阶段提交、三阶段提交</strong></p><p>这种分布式事务解决方案目前在各种技术平台上已经比较成熟：JavaEE架构下面的JTA事务（各应用服务器均提供了实现，Tomcat除外）。</p><p>但目前两阶段提交、三阶段提交存在如下的局限性，并不适合在微服务架构体系下使用：</p><ul><li><p>所有的操作必须是事务性资源（比如数据库、消息队列、EJB组件等），存在使用局限性（微服务架构下多数使用HTTP协议），比较适合传统的单体应用；</p></li><li><p>由于是强一致性，资源需要在事务内部等待，性能影响较大，吞吐率不高，不适合高并发与高性能的业务场景；</p></li></ul><p><strong>Sagas长事务</strong></p><p>在Sagas事务模型中，一个长事务是由一个预先定义好执行顺序的子事务集合和他们对应的补偿子事务集合组成的。典型的一个完整的交易由T1、T2、……、Tn等多个业务活动组成，每个业务活动可以是本地操作、或者是远程操作，所有的业务活动在Sagas事务下要么全部成功，要么全部回滚，不存在中间状态。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ec0000e0af89a3744e5" img_width="640" img_height="282" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>Sagas事务模型的实现机制：</p><ul><li><p>每个业务活动都是一个原子操作；</p></li><li><p>每个业务活动均提供正反操作；</p></li><li><p>任何一个业务活动发生错误，按照执行的反顺序，实时执行反操作，进行事务回滚；</p></li><li><p>回滚失败情况下，需要记录待冲正事务日志，通过重试策略进行重试；</p></li><li><p>冲正重试依然失败的场景，提供定时冲正服务器，对回滚失败的业务进行定时冲正；</p></li><li><p>定时冲正依然失败的业务，等待人工干预；</p></li></ul><p>Sagas长事务模型支持<strong>对数据一致性要求比较高的场景比较适用</strong>，由于采用了补偿的机制，每个原子操作都是先执行任务，避免了长时间的资源锁定，能做到实时释放资源，性能相对有保障。</p><p>Sagas长事务方式如果由业务去实现，复杂度与难度并存。在我们实际使用过程中，开发了一套支持Sagas事务模型的框架来支撑业务快速交付。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c510e8b4e1afb" img_width="640" img_height="338" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p><strong>开发人员：</strong>业务只需要进行交易编排，每个原子操作提供正反交易；</p><p><strong>配置人员：</strong>可以针对异常类型设定事务回滚策略（哪些异常纳入事务管理、哪些异常不纳入事务管理）；每个原子操作的流水是否持久化（为了不同性能可以支持缓存、DB、以及扩展其它持久化方式）；以及冲正选项配置（重试次数、超时时间、是否实时冲正、定时冲正等）；</p><p><strong>Sagas事务框架：</strong>提供事务保障机制，负责原子操作的流水落地，原子操作的执行顺序，提供实时冲正、定时冲正、事务拦截器等基础能力；</p><p><strong>Sagas框架的核心是IBusinessActivity、IAtomicAction。</strong>IBusinessActivity完成原子活动的enlist、delist、prepare、commit、rollback等操作；IAtomicAction主要完成对状态上下文、正反操作执行。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/f61000558dcf22485e9" img_width="640" img_height="293" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>限于文章篇幅，本文不对具体实现做详述；后面找时间可以详细介绍基于Sagas长事务模型具体的实现框架。Sagas长事务需要交易提供反操作，支持事务的强一致性，由于没有在整个事务周期内锁定资源，对性能影响较小，适合对数据要求比较高的场景中使用。</p><p><strong>补偿模式</strong></p><p>Sagas长事务模型本质上是补偿机制的复杂实现，如果实际业务场景上不需要复杂的Sagas事务框架支撑，可以在业务中实现简单的补偿模式。补偿过程往往也同样需要实现最终一致性，需要保证取消服务至少被调用一次和取消服务必须实现幂等性。补偿模式可以参见同事田向阳的技术文章《微服务架构下数据一致性保证（三）》http://dwz.cn/3TVJaB</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ec0000e0af90ed52041" img_width="640" img_height="323" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>补偿机制不推荐在复杂场景（需要多个交易的编排）下使用，优点是非常容易提供回滚，而且依赖的服务也非常少，与Sagas长事务比较来看，使用起来更简便；缺点是会造成代码量庞大，耦合性高，对应无法提供反操作的交易不适合。</p><p><strong>可靠事件模式（本地事件表、外地事件表）</strong></p><p>可靠事件模式属于事件驱动架构，当某件重要事情发生时，例如更新一个业务实体，微服务会向消息代理发布一个事件。消息代理会向订阅事件的微服务推送事件，当订阅这些事件的微服务接收此事件时，就可以完成自己的业务，也可能会引发更多的事件发布。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/f61000558dd219841bf" img_width="640" img_height="268" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>可靠事件模式在于保证可靠事件投递和避免重复消费，靠事件投递定义为:</p><ul><li><p>每个服务原子性的业务操作和发布事件;</p></li><li><p>消息代理确保事件传递至少一次；避免重复消费要求服务实现幂等性。</p></li></ul><p>基于事件模式，需要重点考虑的是事件的可靠到达，在我们产品实际支持过程中，通常有本地事件表、外部事件表两种模式：</p><p>1、本地事件表方法将事件和业务数据保存在同一个数据库中，使用一个额外的“事件恢复”服务来恢复事件，由本地事务保证更新业务和发布事件的原子性。考虑到事件恢复可能会有一定的延时，服务在完成本地事务后可立即向消息代理发布一个事件。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c5110ef22310c" img_width="640" img_height="307" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><ol><li><p>微服务在同一个本地事务中记录业务数据和事件；</p></li><li><p>微服务实时发布一个事件立即通知关联的业务服务，如果事件发布成功立即删除记录的事件；</p></li><li><p>事件恢复服务定时从事件表中恢复未发布成功的事件，重新发布，重新发布成功才删除记录的事件；</p></li></ol><p>其中第2条的操作主要是为了增加发布事件的实时性，由第三条保证事件一定被发布。本地事件表方式业务系统和事件系统耦合比较紧密，额外的事件数据库操作也会给数据库带来额外的压力，可能成为瓶颈。</p><p>2、外部事件表方法将事件持久化到外部的事件系统，事件系统需提供实时事件服务以接受微服务发布事件，同时事件系统还需要提供事件恢复服务来确认和恢复事件。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c51119c001df3" img_width="640" img_height="317" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><ol><li><p>业务服务在事务提交前，通过实时事件服务向事件系统请求发送事件，事件系统只记录事件并不真正发送；</p></li><li><p>业务服务在提交后，通过实时事件服务向事件系统确认发送，事件得到确认后，事件系统才真正发布事件到消息代理；</p></li><li><p>业务服务在业务回滚时，通过实时事件向事件系统取消事件；</p></li><li><p>如果业务服务在发送确认或取消之前停止服务了怎么办呢？事件系统的事件恢复服务会定期找到未确认发送的事件向业务服务查询状态，根据业务服务返回的状态决定事件是要发布还是取消；</p></li></ol><p>该方式将业务系统和事件系统独立解耦，都可以独立伸缩。但是这种方式需要一次额外的发送操作，并且需要发布者提供额外的查询接口。</p><p>基于可靠事件的事务保障模式可以有很多的变种实现，比如对消息可靠性不高的话，可以将本地表的方式换做缓存方式。为了提高消息投递的效率，可以将多次消息合并为投递模式。为了提供强一致性的事务保障，甚至可以将本地消息表持久化（保障发方法消息可靠落地）+远程消息表持久化（保障接收方消息可靠落地）结合的模式。</p><p>在我们的流程产品中针对业务和流程的分布式事务解决方案就采用了多次消息合并投递+本地缓存+远程消息表持久化的模式，接下来为大家介绍具体的使用方式。</p><p><strong>使用场景</strong></p><p>在实际业务项目中通常采用业务与流程分布式部署的模式，业务系统通过远程接口访问流程引擎，业务数据同流程数据存放到各自的数据库中。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ec0000e0afcf0287f62" img_width="640" img_height="294" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>在这种场景中，如果业务系统的流程操作和业务操作交叉在一起，当流程操作成功，而业务操作失败时，就会造成业务回滚，而流程在引擎端已经创建，导致业务系统和流程引擎状态不一致。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ec0000e0afd3da08c03" img_width="640" img_height="345" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>在业务应用中对一个事务中的流程操作采用本地缓存+批量投递+远程落地的模式（如果需要在客户端确保消息可靠性，可以将本地缓存换成本地表的方式）；在流程引擎端在消息投递来之后，做了消息表落地的工作，保障可靠执行。在我们流程产品中流程引擎对外提供的客户端提供了统一的分布式事务API，和使用传统本地事务一样进行操作，保证了透明性，简化开发人员的复杂度。分布式事务API支持两种协议模式：</p><ol><li><p>HTTP + 二进制序列化的模式</p></li><li><p>WebService模式</p></li></ol><p>后续我们会增加Restful风格的接口。</p><p>可靠事件模式在互联网公司中有着较大规模的应用，该方式适合的业务场景非常广泛，而且能够做到数据的最终一致性，缺点是该模式实现难度较大，依赖数据库实现可靠性，在高并发场景下可能存在性能瓶颈，需要在公司层面搭建一套标准的可靠事件框架来支撑。</p><p><strong>可靠事件模式（非事务消息、事务消息）</strong></p><p>可靠事件模式的事件通知可以采用消息的模式来实现，其实现原理和本地事件表、外部事件表一致，本文就不在详述。目前常用的消息框架ActiveMQ、RabbitMQ、Kafka、RocketMQ可以用来作为消息投递的渠道。注意：Kafka通常不适合，因为Kafka的设计存在丢消息的场景。</p><p>目前市面上支持事务的消息产品比较少，RocketMQ虽然实现了可靠的事务模式，但并没有开源出来、没有开源出来、没有开源出来，顺便说一下国内的开源有太多需要改进的空间（关键点不开源，开源后没有持续的投入）。</p><p><strong>TCC模式</strong></p><p>一个完整的TCC业务由一个主业务服务和若干个从业务服务组成，主业务服务发起并完成整个业务活动，TCC模式要求从服务提供三个接口：Try、Confirm、Cancel。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c5112db4fdb8d" img_width="640" img_height="435" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><ol><li><p>Try：完成所有业务检查</p><p>预留必须业务资源</p></li><li><p>Confirm：真正执行业务</p><p>不作任何业务检查；只使用Try阶段预留的业务资源；Confirm操作满足幂等性；</p></li><li><p>Cancel：</p><p>释放Try阶段预留的业务资源；Cancel操作满足幂等性；</p></li></ol><p>整个TCC业务分成两个阶段完成：</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/f6600080720a073822c" img_width="640" img_height="460" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>第一阶段：主业务服务分别调用所有从业务的try操作，并在活动管理器中登记所有从业务服务。当所有从业务服务的try操作都调用成功或者某个从业务服务的try操作失败，进入第二阶段。</p><p>第二阶段：活动管理器根据第一阶段的执行结果来执行confirm或cancel操作。如果第一阶段所有try操作都成功，则活动管理器调用所有从业务活动的confirm操作。否则调用所有从业务服务的cancel操作。</p><p>TCC模式的详细描述可以参见同事田向阳的技术文章《微服务架构下数据一致性保证（三）》http://dwz.cn/3TVJaB。</p><p>需要注意的是第二阶段confirm或cancel操作本身也是满足最终一致性的过程，在调用confirm或cancel的时候也可能因为某种原因（比如网络）导致调用失败，所以需要活动管理支持重试的能力，同时这也就要求confirm和cancel操作具有幂等性。</p><p><strong>总结</strong></p><p>六种分布式事务的实现模式从数据一致性、事务级别、吞吐量、实现的复杂度各有优劣，下图为大家提供选择依据。</p><p><img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ebf000c5113130d4b16" img_width="640" img_height="330" alt="理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择" onerror="javascript:errorimg.call(this);"></p><p>站在架构设计的角度，针对数据一致性需要把业务因素考虑进来，这有利于团队在技术上作出更合理的选择。根据具体业务场景，评估出业务对事务的优先级，更有利于作出架构上的取舍。我们经常接触的证券、金融、支付等行业，对数据一致性要求极高，需要严格的实时保证要求；但对于基于社交类的应用场景，可以采用局部实时一致，最终全局一致的能力。因此大家在实践过程中，一定要把技术与业务结合，选择适合自身业务的技术方案。</p><p><strong>▽</strong></p><p><strong>喜欢我们的会点赞，爱我们的会分享！</strong></p><p class="footnote">本文为头条号作者发布，不代表今日头条立场。</p></div>

  <div class="article-actions">
		
<div class="labelList">
	<i class="y-icon icon-tag"></i>
	<ul class="label-list">
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank">数据库</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=%E9%87%91%E8%9E%8D" target="_blank">金融</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=%E8%AE%BE%E8%AE%A1" target="_blank">设计</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=%E6%96%87%E7%AB%A0" target="_blank">文章</a></li>
		
	</ul>
</div>

		<div riot-tag="actionBox" class="actionBox"><div class="repin "> <i class="y-icon icon-favorite "></i><span>收藏</span> </div> <a href="javascript:;" class="areport"> <i class="y-icon icon-report"></i><span>举报</span> </a> <div id="J_articleReport"></div></div>
  </div>
</div>

        <div style="text-align:center; margin-top: 30px; height: 60px;" id="J_ad_baidu_bottom"><iframe id="iframeu2643457_0" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ecjm.html" width="640" height="60" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>

        <a id="comment_area" href="http://www.toutiao.com/i6338533626304528897/?tt_from=weixin&amp;utm_campaign=client_share&amp;app=news_article&amp;utm_source=weixin&amp;iid=4814822643&amp;utm_medium=toutiao_android&amp;wxshare_count=1#" style="display: inline-block;margin-bottom: 20px;"></a><!--评论锚点-->
        <div riot-tag="comment" id="comment"><div class="c-header"> <em>5&nbsp;</em>条评论 </div> <div riot-tag="inputBox" ismain="true" avatar="" group_id="6327571457467826434" item_id="6338533626304528897"><div class="inputBox"> <div class="y-box"> <div class="avatar-wrap avatar-wrap-center">  </div> <div class="input-wrap  "> <div class="c-textarea" ga_event="click_input_comment"> <textarea name="inputText" placeholder="写下您的评论..."></textarea> </div> <div class="c-action" ga_event="click_publish_comment"> <div class="c-submit">评论</div> </div> </div> </div> </div></div> <ul> <li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/user/5458406074/"> <img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/2b600253335364b7b79"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/user/5458406074/">刹那芳华55597876</a> <span class="c-create-time">2月前</span> </div> <p>说的很详细</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">4&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_0"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/user/3144044597/"> <img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1858423310"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/user/3144044597/">ALEX7164683</a> <span class="c-create-time">2月前</span> </div> <p>写这么多，画了这么到位的图，真心有时间。佩服！</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">1&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_1"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/user/6457718478/"> <img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/user/6457718478/">宁静不能远</a> <span class="c-create-time">2月前</span> </div> <p>写的不错！</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_2"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/user/4033813697/"> <img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1(1)"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/user/4033813697/">EndyPark</a> <span class="c-create-time">2月前</span> </div> <p>不错</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_3"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/user/6013805553/"> <img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/5070639578"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/user/6013805553/">奔月先生</a> <span class="c-create-time">2月前</span> </div> <p>不错</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_4"></div> <!--riot placeholder-->  </div> </li><!--riot placeholder--> </ul> <div class="c-load-more" ga_event="click_loadmore_comment">查看更多评论</div> <div id="J_report"></div></div>
      </div>
    </div>
    <div class="y-box" style="margin-top: 30px;">
      <div class="y-left index-left">
        <div riot-tag="relatedChannel"><div name="relatedChannel" ga_event="related_channel_click" class="relatedChannel "> <h2 class="relatedChannel-header">相关推荐</h2> <ul class="relatedChannel-list"> <li> <a href="javacript:;" class="relatedChannel-item active"> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>推荐</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>热点</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>社会</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>娱乐</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>科技</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>体育</span> </a> </li><!--riot placeholder--> </ul> </div></div>
      </div>
      <div class="y-left index-middle">
        <div class="index-cut-line" id="J_cut_line"></div>
        <div riot-tag="feedBox"></div>
      </div>
    </div>
  </div>
  <div id="J_rindex" class="y-right index-right">
    
<div class="module">
  <div class="pgcInfo">
    <div class="pgc-head">
      <a class="pgc-link" target="_blank" href="http://www.toutiao.com/m5511889632/" ga_event="click_into_pgc">
          <img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/7146712412" alt="InfoQ技术沙龙">
          <div class="pgc-username">
            <span>InfoQ技术沙龙</span>
            <div riot-tag="subscribe" class="pgc-subscribe"><div class="subscribe" ga_event="follow_pgc">  <div class="article-unsubscribe left-arrow"> <span>立即关注</span> </div> </div></div>
          </div>
      </a>
    </div>
    <p class="pgc-description">技术社区媒体：最新的技术新闻，最快的技术咨询，最有趣的技术人分享交流平台。</p>
    <ul class="pgc-content">
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://toutiao.com/i6339253162871882241/" target="_blank" class="pgc-article-link">
          免费报名！QCon 上海 2016云计算与实践相关专场
        </a>
    	</li>
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://toutiao.com/i6338881604697457153/" target="_blank" class="pgc-article-link">
          Q新闻丨JavaOne 2016：Java的近期及长远规划；携程开源数据库访问框架Ctrip DAL
        </a>
    	</li>
      
      
      
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://toutiao.com/i6338157522263736834/" target="_blank" class="pgc-article-link">
          微信开源的 Android 热补丁框架 Tinker 什么来头？
        </a>
    	</li>
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://toutiao.com/i6337748908193612290/" target="_blank" class="pgc-article-link">
          美团点评：大促活动前如何做团购系统流量预算和容量评估
        </a>
    	</li>
      
      
    </ul>
  </div>
</div>


    <div style="margin-bottom:30px;">
	<iframe src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/saved_resource.html" onload="var adWrap=this;setTimeout(function(){if(!adWrap.loaded){adWrap.src=&#39;//www.toutiao.com/api/pc/adsafe/&#39;+&#39;#group=detail_top_right&#39;;adWrap.loaded=true;}},1)" frameborder="0" width="300" height="250” scrolling=“no"></iframe>
</div>

    <div riot-tag="hotVideo" class="hotVideo module" ga_event="click_video_recommend"><div class="module-head video-head"><a href="http://www.toutiao.com/video/" target="_blank">热门视频</a></div> <ul> <li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6366039001439518978/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1208000e5547bc8543b2" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>05:03</span> </i> <p class="hot-title module-title">赎罪，双子座黄金圣斗士加隆</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6335999418097729794/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ee90008a09b48939b99" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>08:15</span> </i> <p class="hot-title module-title">吃的是珍禽异兽 即使全身落满灰 一层层坠落 也未停歇食用</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365985495872766209/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/12eb00066ee2262a4d3e" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>11:59</span> </i> <p class="hot-title module-title">主播炸了181：PDD托儿所融入青铜 笑笑天秀无敌真寂寞</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365995430534185474/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1208000de6d3ad1884ff" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>03:40</span> </i> <p class="hot-title module-title">LOL徐老师来巡山：即使在最为难的关头，装逼仍是重要的一环</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365797814299869442/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/134d0004b7524c6c7c00" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>02:29</span> </i> <p class="hot-title module-title">以这样的方式停放战甲，这果然很钢铁侠！</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6366044967945945346/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/134a0004922d82b520b7" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>17:58</span> </i> <p class="hot-title module-title">精神病测试的另类答案！揭秘正常与发疯之间的灰色地带</p> </a> </li><!--riot placeholder--> </ul></div>
    <div style="margin-bottom: 30px;" id="J_ad_baidu_top1"><iframe id="iframeu2793998_0" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ecjm(1).html" width="300" height="250" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>

    
<div class="module recpgc">
	<div class="module-head">
		相关头条号
	</div>
	<ul class="recpgc-content">
		
		
		<li class="recpgc-list">
    		<a class="recpgc-user" href="http://toutiao.com/m5858481053/" target="_blank" ga_event="click_related_pgc">
        		<img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/5158861846" alt="">
        		<span class="user-name">高可用架构</span>
    		</a>
    		<ul>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6365696813773390081/" target="_blank">2016 GIAC全球互联网架构大会圆满结束，全部PPT开放下载</a>
    				</li>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6363766994299486465/" target="_blank">陈皓、李智慧、Tim Yang同台探讨构师能力模型，只在本周GIAC大会(12.16-17)</a>
    				</li>
    			
    		</ul>
		</li>
		
		
		
		<li class="recpgc-list">
    		<a class="recpgc-user" href="http://toutiao.com/m3112953701/" target="_blank" ga_event="click_related_pgc">
        		<img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1317161285" alt="">
        		<span class="user-name">七牛云</span>
    		</a>
    		<ul>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6364352878961983746/" target="_blank">你的声音那么好，可以一直唱歌给我听吗？</a>
    				</li>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6363880011745181953/" target="_blank">视频直播早期创业团队的技术架构与选型│架构师实践日</a>
    				</li>
    			
    		</ul>
		</li>
		
		
		
		<li class="recpgc-list">
    		<a class="recpgc-user" href="http://toutiao.com/m3582741126/" target="_blank" ga_event="click_related_pgc">
        		<img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/5636763359" alt="">
        		<span class="user-name">腾讯大讲堂</span>
    		</a>
    		<ul>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6365757215697666305/" target="_blank">设计师如何看穿需求本质</a>
    				</li>
    			
    				<li class="related-article">
    					<a href="http://toutiao.com/group/6364615746916188418/" target="_blank">老板说，这是腾讯史上人数最多的股东大会</a>
    				</li>
    			
    		</ul>
		</li>
		
		
		
		
		
		
	</ul>
</div>


    <div style="margin-bottom: 30px;" id="J_ad_baidu_top2"><iframe id="iframeu2794021_0" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/ecjm(2).html" width="300" height="250" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>

    <div riot-tag="hotPicture" class="hotPicture module" ga_event="click_pictures_recommend"><div class="module-head pic-head"><a href="http://www.toutiao.com/news_image/" target="_blank">精彩图片</a></div> <ul> <li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6354252184041652481/">   <div class="pic-style style_3"> <div class="module-pic pic-middle"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/119200059af85e1102b9"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/119400062accdf52b07b"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/11950001fe49f370cd8c"></div> </div> <i class="hot-tag pic-tag"> <span>28图</span> </i> <p class="hot-title module-title">客户让我拯救他的手机  iPhone 6拆机细节</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365811777238974722/">   <div class="pic-style style_3"> <div class="module-pic pic-middle"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/13550002b98c1d9fa314"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1233000b290e305ba9a6"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1233000b2920f3d68749"></div> </div> <i class="hot-tag pic-tag"> <span>16图</span> </i> <p class="hot-title module-title">郑州雾霾又爆表！街拍郑州带口罩的美女们！</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365832115926548738/">   <div class="pic-style style_3"> <div class="module-pic pic-middle"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/13530002c2989aa0496d"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/12320010764dbdcd2e86"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/1233000b33dc9f8e1e2c"></div> </div> <i class="hot-tag pic-tag"> <span>6图</span> </i> <p class="hot-title module-title">外派韩国工作一个月的日常饮食</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6365843592078098689/">  <div class="pic-style style_2"> <div class="module-pic pic-middle"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/12da0005027aa7f1bebf"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/12d60008129b36d874bb"></div> <div class="module-pic pic-small"><img alt="" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/12d60008129deb8cb8c6"></div> </div>  <i class="hot-tag pic-tag"> <span>12图</span> </i> <p class="hot-title module-title">老照片：外蒙古人所描述的元朝历史</p> </a> </li><!--riot placeholder--> </ul></div>
    <div>
  <iframe src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/saved_resource(1).html" onload="var adWrap=this;setTimeout(function(){if(!adWrap.loaded){adWrap.src=&#39;//www.toutiao.com/api/pc/adsafe/&#39;+&#39;#group=detail_bottom_right&#39;;adWrap.loaded=true;}},1)" frameborder="0" width="300" height="250” scrolling=“no"></iframe>
</div>

    <div id="adindexhover" style="position: fixed; top: 20px; display: none;">
	<iframe src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/saved_resource(2).html" onload="var adWrap=this;setTimeout(function(){if(!adWrap.loaded){adWrap.src=&#39;//www.toutiao.com/api/pc/adsafe/&#39;+&#39;#group=detail_bottom_right_hover&#39;;adWrap.loaded=true;}},1)" frameborder="0" width="300" height="250” scrolling=“no"></iframe>
</div>

  </div>
</div>

<div class="action-feedback">
  <div riot-tag="feedback" class="feedback"><ul> <li class="tool-item" ga_event="go_top_click"> <a href="javascript:;"> <i class="y-icon icon-backtotopfeed"></i> </a> </li> </ul></div>
</div>

<!-- 公共尾部 -->
<div id="footer">
    <div>
        <span class="fitem">© 2016 今日头条 www.toutiao.com</span>
        <a class="fitem" href="http://www.12377.cn/" target="_blank">中国互联网举报中心</a>
        <a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP证140141号</a>
        <a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP备12025439号-3</a>
        <a class="fitem" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002002023" target="_blank" ga_event="click_about">
            <img src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/gongan_d0289dc.png">京公网安备 11000002002023号
        </a>
    </div>
    <div>
        <a class="fitem" href="http://www.toutiao.com/license/" target="_blank">网络文化经营许可证</a>
        <a class="fitem" href="http://www.toutiao.com/a3642705768/" target="_blank">跟帖评论自律管理承诺书</a>
        <span class="fitem">违法和不良信息举报电话：010-58341833</span>
        <span class="fitem">公司名称：北京字节跳动科技有限公司</span>
    </div>
</div>



    </div>

    <script>
        window.globals = window.globals || {};

        taAnalysis && taAnalysis.setup({
          c: 'detail_article'
        });
        taAnalysis && taAnalysis.send('pageview', {});

        window.gaqpush = function (ga_action, ga_label){
            ga('send', 'event','detail_article' , ga_action, ga_label);
        };

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        // ga('create', 'UA-28423340-5', 'auto');
        ga('create', 'UA-28423340-5', 'auto', {'sampleRate': 10});
        ga('send', 'pageview');

        utils.on(document.getElementsByTagName('body')[0], 'click', function(e) {
            var target = utils.getTarget(e),
                ga_event,
                ga_category,
                ga_label,
                ga_value;

            while(target && target.nodeName.toUpperCase() !== 'BODY') {
                ga_event = utils.getAttribute(target, 'ga_event');
                ga_category = utils.getAttribute(target, 'ga_category') || 'detail_article';
                ga_label = utils.getAttribute(target, 'ga_label');
                ga_value = utils.getAttribute(target, 'ga_value') || 1;

                ga_event && ga('send', 'event', ga_category, ga_event, ga_label, ga_value);
                ga_event && taAnalysis && taAnalysis.send('event', { ev: ga_event });
                target = target.parentNode;
            }
        });

        riot.observable(window);
    </script>
    

<script>
  // 用户信息
  var userInfo = {
      id: 0,
      name: '',
      avatarUrl: '',
      isPgc: false,
      isOwner: false
  };


  var group = {
  	id:'6327571457467826434',
  	repin:0,
  };

  var media = {
  	id:5511889632,
  	like:false
  };

  var siblingList = [{"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u5c0f\u7c73\u79f0\u8981\u63a8\u51fa4\u30015000\u7684\u624b\u673a\uff0c\u4f60\u4f1a\u4e70\u5417\uff1f","single_mode":false,"middle_mode":false,"has_video":false,"video_duration_str":null,"source_url":"http:\/\/toutiao.com\/group\/6338526412927926529\/","source":"\u5934\u6761\u95ee\u7b54","more_mode":null,"article_genre":"article","has_gallery":false,"behot_time":1482211509963,"video_play_count":null,"comments_count":0,"group_id":"6338526412927926529"},{"comments_count":5,"media_avatar_url":"http:\/\/p2.pstatp.com\/large\/6201\/179474268","is_feed_ad":false,"is_diversion_page":false,"title":"\u601d\u8def+\u6b65\u9aa4+\u65b9\u6cd5\uff0c\u4e09\u6b65\u6559\u4f60\u5982\u4f55\u5feb\u901f\u6784\u5efa\u7528\u6237\u753b\u50cf\uff1f","single_mode":true,"middle_mode":false,"has_video":false,"video_duration_str":null,"source_url":"http:\/\/toutiao.com\/group\/6338515191102554370\/","source":"\u4e92\u8054\u7f51er\u7684\u65e9\u8bfb\u8bfe","more_mode":null,"article_genre":"article","has_gallery":false,"behot_time":1482211509963,"video_play_count":null,"image_url":"http:\/\/p9.pstatp.com\/list\/204x140\/f6600081210c848ff79","group_id":"6338515191102554370","is_related":true,"media_url":"http:\/\/toutiao.com\/m3581917000\/"}];
</script>

<script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/article_6314f6e.js.下载"></script>

<script>
  riot.mount('wtopbar', {
    home: false,
    userInfo: userInfo
  });
  riot.mount('login');
  riot.mount('wsearch');
</script>

<script>
  riot.mount('snsbox',{
    share_url:"http://toutiao.com/item/6338533626304528897",
    abstract:"“针对微服务下的交易业务如何保障数据一致性，本文尽量做到理论结合实践，将我们在实际产品中用到的分布式事务实现机制，和大家扒一扒，希望能帮到各位。前言这是一个开撕的话题，我经历过太多的关于分布式事务的需求：“有没有简单的方案，像使用数据库事务那样，解决分布式数据一致性的问题”。".replace(/<br \/>/ig, ''),
    group_id:"6327571457467826434",
    comments_count: utils.numFormat('5', 1, 'en'),
    fix: true
  });
  riot.mount('hotVideo');
  riot.mount('hotPicture');
  riot.mount('feedback');
</script>

<script>
  riot.mount('comment', {
    group_id: '6327571457467826434',
    item_id: '6338533626304528897' || '6338533626304528897',
    comments_count: utils.numCutByComma('5'),
    userInfo: userInfo,
    ban_comment: 0 + 0
  });
</script>

<script>
  riot.mount('relatedChannel', {
    tag: '__all__'
  });
</script>

<script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/player.min.js.下载"></script>
<script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/video_0801e31.js.下载"></script>
<!--[if lt IE 9]>
  <script src="//s3.pstatp.com/toutiao/resource/ntoutiao_web/page/detail/article_detail/article_main/audio/audio_ie8_69f6c6f.js" charset="utf-8"></script>
<![endif]-->
<script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/audio_2324d3c.js.下载"></script>

<script type="text/javascript" src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/c.js.下载"></script>
<script>
  BAIDU_CLB_fillSlotAsync('u2793998', 'J_ad_baidu_top1');
  BAIDU_CLB_fillSlotAsync('u2794021', 'J_ad_baidu_top2');
  BAIDU_CLB_fillSlotAsync('u2643457', 'J_ad_baidu_bottom');
</script>

    <script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/z_stat.php" language="JavaScript"></script><script src="./理性撕逼！分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择 - 今日头条(www.toutiao.com)_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1259612802" target="_blank" title="站长统计">站长统计</a>


</body></html>