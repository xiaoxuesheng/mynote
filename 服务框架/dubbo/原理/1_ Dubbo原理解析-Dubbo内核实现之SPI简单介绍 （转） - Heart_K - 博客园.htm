<!DOCTYPE HTML>
<!-- saved from url=(0048)http://www.cnblogs.com/heart-king/p/5632369.html -->
<!DOCTYPE html PUBLIC "" ""><HTML lang="zh-cn"><HEAD><META content="IE=10.0000" 
http-equiv="X-UA-Compatible">
 
<META charset="utf-8"> 
<META name="viewport" content="width=device-width, initial-scale=1"> <TITLE>1. 
Dubbo原理解析-Dubbo内核实现之SPI简单介绍 （转） - Heart_K - 博客园</TITLE> <LINK href="1_%20Dubbo原理解析-Dubbo内核实现之SPI简单介绍%20（转）%20-%20Heart_K%20-%20博客园_files/blog-common.css" 
rel="stylesheet" type="text/css"> <LINK id="MainCss" href="1_%20Dubbo原理解析-Dubbo内核实现之SPI简单介绍%20（转）%20-%20Heart_K%20-%20博客园_files/bundle-LessIsMore.css" 
rel="stylesheet" type="text/css"> <LINK id="mobile-style" href="1_%20Dubbo原理解析-Dubbo内核实现之SPI简单介绍%20（转）%20-%20Heart_K%20-%20博客园_files/bundle-LessIsMore-mobile.css" 
rel="stylesheet" type="text/css" media="only screen and (max-width: 768px)"> 
<LINK title="RSS" href="http://www.cnblogs.com/heart-king/rss" rel="alternate" 
type="application/rss+xml"> <LINK title="RSD" href="http://www.cnblogs.com/heart-king/rsd.xml" 
rel="EditURI" type="application/rsd+xml"> <LINK href="http://www.cnblogs.com/heart-king/wlwmanifest.xml" 
rel="wlwmanifest" type="application/wlwmanifest+xml"> 
<SCRIPT src="1_%20Dubbo原理解析-Dubbo内核实现之SPI简单介绍%20（转）%20-%20Heart_K%20-%20博客园_files/jquery.js" type="text/javascript"></SCRIPT>
  
<SCRIPT type="text/javascript">var currentBlogApp = 'heart-king', cb_enable_mathjax=false;var isLogined=false;</SCRIPT>
 
<SCRIPT src="1_%20Dubbo原理解析-Dubbo内核实现之SPI简单介绍%20（转）%20-%20Heart_K%20-%20博客园_files/blog-common.js" type="text/javascript"></SCRIPT>
 
<META name="GENERATOR" content="MSHTML 11.00.9600.17690"></HEAD> 
<BODY><A name="top"></A> 
<DIV id="home">
<DIV id="header">
<DIV id="blogTitle"><!--done--> 
<DIV class="title"><A class="headermaintitle" id="Header1_HeaderTitle" href="http://www.cnblogs.com/heart-king/">Heart_K</A></DIV>
<DIV class="subtitle"></DIV></DIV><!--end: blogTitle 博客的标题和副标题 -->	 
<DIV id="navigator">
<UL id="navList">
  <LI id="nav_sitehome"><A class="menu" id="blog_nav_sitehome" href="http://www.cnblogs.com/">博客园</A></LI>
  <LI id="nav_myhome"><A class="menu" id="blog_nav_myhome" href="http://www.cnblogs.com/heart-king/">首页</A></LI>
  <LI id="nav_newpost"><A class="menu" id="blog_nav_newpost" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" 
  rel="nofollow">新随笔</A></LI>
  <LI id="nav_contact"><A class="menu" id="blog_nav_contact" href="https://msg.cnblogs.com/send/Heart_K" 
  rel="nofollow">联系</A></LI>
  <LI id="nav_rss"><A class="menu" id="blog_nav_rss" href="http://www.cnblogs.com/heart-king/rss">订阅</A> <!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/heart-king/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></LI>
  <LI id="nav_admin"><A class="menu" id="blog_nav_admin" href="https://i.cnblogs.com/" 
  rel="nofollow">管理</A></LI></UL>
<DIV class="blogStats">
<DIV id="blog_stats"><!--done--> 随笔-36&nbsp; 文章-0&nbsp; 评论-0&nbsp; </DIV></DIV><!--end: blogStats -->
	 </DIV><!--end: navigator 博客导航栏 --> </DIV><!--end: header 头部 --> 
<DIV id="main">
<DIV id="mainContent">
<DIV class="forFlow">
<DIV id="post_detail"><!--done--> 
<DIV id="topics">
<DIV class="post">
<H1 class="postTitle"><A class="postTitle2" id="cb_post_title_url" href="http://www.cnblogs.com/heart-king/p/5632369.html">1. 
Dubbo原理解析-Dubbo内核实现之SPI简单介绍 （转）</A>		 </H1>
<DIV class="clear"></DIV>
<DIV class="postBody">
<DIV id="cnblogs_post_body">
<P>转载自 &nbsp;<A 
href="http://blog.csdn.net/quhongwei_zhanqiu">斩秋的专栏</A>&nbsp;&nbsp;http://blog.csdn.net/quhongwei_zhanqiu/article/details/41577159</P>
<P>Dubbo采用 微内核 + 插件体系，使得设计优雅，扩展性强。那所谓的微内核+插件体系是如何实现的呢！大家是否熟悉spi(service 
providerinterface)机制，</P>
<P>即我们定义了服务接口标准，让厂商去实现（如果不了解spi的请谷歌百度下）,</P>
<P>jdk通过ServiceLoader类实现spi机制的服务查找功能。</P>
<P>&nbsp;</P>
<HR>

<P>&nbsp;</P>
<P><SPAN style="font-size: 15px;"><STRONG>JDK实现spi服务查找: 
ServiceLoader</STRONG></SPAN></P>
<P style="margin-left: 30px;">首先定义下示例接口</P>
<DIV class="cnblogs_code">
<PRE><SPAN style="font-size: 13px;"><SPAN style="color: rgb(0, 0, 255);">public</SPAN> <SPAN style="color: rgb(0, 0, 255);">interface</SPAN><SPAN style="color: rgb(0, 0, 0);"> Spi {

       booleanisSupport(String name);<BR>
       String sayHello();

}</SPAN></SPAN></PRE></DIV>
<P>　　ServiceLoader会遍历所有jar查找META-INF/services/com.example.Spi文件</P>
<P style="margin-left: 30px;"><STRONG>A厂商提供实现</STRONG></P>
<DIV class="cnblogs_code">
<PRE><SPAN style="font-size: 13px;"><SPAN style="color: rgb(0, 0, 255);">package</SPAN><SPAN style="color: rgb(0, 0, 0);"> com.b.example;

　　</SPAN><SPAN style="color: rgb(0, 0, 255);">public</SPAN> <SPAN style="color: rgb(0, 0, 255);">class</SPAN> SpiBImpl <SPAN style="color: rgb(0, 0, 255);">implements</SPAN><SPAN style="color: rgb(0, 0, 0);"> Spi {

　　public boolean isSupport(String name) {

　　　　</SPAN><SPAN style="color: rgb(0, 0, 255);">return</SPAN>"SPIB"<SPAN style="color: rgb(0, 0, 0);">.equalsIgnoreCase(name.trim()); 

　　}

　　</SPAN><SPAN style="color: rgb(0, 0, 255);">public</SPAN><SPAN style="color: rgb(0, 0, 0);"> String syaHello() {

       </SPAN><SPAN style="color: rgb(0, 0, 255);">return</SPAN><SPAN style="color: rgb(0, 0, 0);"> “hello 我是厂商B”;

　　}

}</SPAN></SPAN></PRE></DIV>
<P>&nbsp;</P>
<P 
style="margin-left: 30px;">在A厂商提供的jar包中的META-INF/services/com.example.Spi文件内容为：</P>
<P style="margin-left: 30px;">com.a.example.SpiAImpl 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #厂商A的spi实现全路径类名</P>
<P>　　<SPAN style="font-size: 14px;"><STRONG>B<SPAN 
style="font-size: 15px;">厂商提供实现</SPAN></STRONG></SPAN></P>
<DIV class="cnblogs_code">
<PRE><SPAN style="color: rgb(0, 0, 255);">package</SPAN><SPAN style="color: rgb(0, 0, 0);"> com.b.example;

　　</SPAN><SPAN style="color: rgb(0, 0, 255);">public</SPAN> <SPAN style="color: rgb(0, 0, 255);">class</SPAN> SpiBImpl <SPAN style="color: rgb(0, 0, 255);">implements</SPAN><SPAN style="color: rgb(0, 0, 0);"> Spi {

   public boolean isSupport(String name) {

   　　</SPAN><SPAN style="color: rgb(0, 0, 255);">return</SPAN>"SPIB"<SPAN style="color: rgb(0, 0, 0);">.equalsIgnoreCase(name.trim()); 

　　}

　　</SPAN><SPAN style="color: rgb(0, 0, 255);">public</SPAN><SPAN style="color: rgb(0, 0, 0);"> String syaHello() {

       </SPAN><SPAN style="color: rgb(0, 0, 255);">return</SPAN><SPAN style="color: rgb(0, 0, 0);"> “hello 我是厂商B”;

　　}

}</SPAN></PRE></DIV>
<P>在B厂商提供的jar包中的META-INF/services/com.example.Spi文件内容为：</P>
<P>com.b.example.SpiBImpl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
#厂商B的spi实现全路径类名</P>
<P>&nbsp;</P>
<P>ServiceLoader.load(Spi.class)读取厂商A、B提供jar包中的文件，ServiceLoader实现了Iterable接口，</P>
<P>可通过while for循环语句遍历出所有实现。</P>
<P>&nbsp;</P>
<P>一个接口多种实现，就如策略模式一样提供了策略的实现，但是没有提供策略的选择， 使用方可使用 isSupport 方法，</P>
<P>根据业务传入厂商名来选择具体的厂商。</P>
<DIV class="cnblogs_code">
<PRE><SPAN style="color: rgb(0, 0, 255);">public</SPAN> <SPAN style="color: rgb(0, 0, 255);">class</SPAN><SPAN style="color: rgb(0, 0, 0);"> SpiFactory {

       </SPAN><SPAN style="color: rgb(0, 128, 0);">//</SPAN><SPAN style="color: rgb(0, 128, 0);">读取配置获取所有实现</SPAN><SPAN style="color: rgb(0, 0, 0);">
       privatestatic ServiceLoader spiLoader </SPAN>= ServiceLoader.load(Spi.<SPAN style="color: rgb(0, 0, 255);">class</SPAN><SPAN style="color: rgb(0, 0, 0);">);

       </SPAN><SPAN style="color: rgb(0, 128, 0);">//</SPAN><SPAN style="color: rgb(0, 128, 0);">根据名字选取对应实现</SPAN><SPAN style="color: rgb(0, 0, 0);">
       public static Spi getSpi(String name) {
              </SPAN><SPAN style="color: rgb(0, 0, 255);">for</SPAN><SPAN style="color: rgb(0, 0, 0);">(Spi spi : spiLoader) {
                     </SPAN><SPAN style="color: rgb(0, 0, 255);">if</SPAN><SPAN style="color: rgb(0, 0, 0);">(spi.isSupport(name) ) {
                            return spi;
                     }
              }
              return null;
　　　　}

}</SPAN></PRE></DIV>
<P>&nbsp;</P></DIV>
<DIV id="MySignature"></DIV>
<DIV class="clear"></DIV>
<DIV id="blog_post_info_block">
<DIV id="BlogPostCategory"></DIV>
<DIV id="EntryTag"></DIV>
<DIV id="blog_post_info"></DIV>
<DIV class="clear"></DIV>
<DIV id="post_next_prev"></DIV></DIV></DIV>
<DIV class="postDesc">posted @ <SPAN id="post-date">2016-07-01 11:05</SPAN> <A 
href="http://www.cnblogs.com/heart-king/">Heart_K</A> 阅读(<SPAN id="post_view_count">...</SPAN>) 
评论(<SPAN id="post_comment_count">...</SPAN>)  <A href="https://i.cnblogs.com/EditPosts.aspx?postid=5632369" 
rel="nofollow">编辑</A> <A onclick="AddToWz(5632369);return false;" href="http://www.cnblogs.com/heart-king/p/5632369.html#">收藏</A></DIV></DIV>
<SCRIPT type="text/javascript">var allowComments=true,cb_blogId=192111,cb_entryId=5632369,cb_blogApp=currentBlogApp,cb_blogUserGuid='74411703-834e-e311-8d02-90b11c0b17d6',cb_entryCreatedDate='2016/7/1 11:05:00';loadViewCount(cb_entryId);</SCRIPT>
	 </DIV><!--end: topics 文章、评论容器--> </DIV><A name="!comments"></A>
<DIV id="blog-comments-placeholder"></DIV>
<SCRIPT type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</SCRIPT>
 
<DIV class="commentform" id="comment_form"><A name="commentform"></A> 
<DIV id="divCommentShow"></DIV>
<DIV id="comment_nav"><SPAN id="span_refresh_tips"></SPAN><A id="lnk_RefreshComments" 
onclick="return RefreshCommentList();" href="javascript:void(0);" clientidmode="Static" 
runat="server">刷新评论</A><A onclick="return RefreshPage();" href="http://www.cnblogs.com/heart-king/p/5632369.html#">刷新页面</A><A 
href="http://www.cnblogs.com/heart-king/p/5632369.html#top">返回顶部</A></DIV>
<DIV id="comment_form_container"></DIV>
<DIV class="ad_text_commentbox" id="ad_text_under_commentbox"></DIV>
<DIV id="ad_t2"></DIV>
<DIV id="opt_under_post"></DIV>
<DIV class="c_ad_block" id="ad_c1"></DIV>
<DIV id="under_post_news"></DIV>
<DIV class="c_ad_block" id="ad_c2"></DIV>
<DIV id="under_post_kb"></DIV>
<DIV class="c_ad_block" id="HistoryToday"></DIV>
<SCRIPT type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</SCRIPT>
 </DIV></DIV><!--end: forFlow -->	 </DIV><!--end: mainContent 主体内容容器-->	 
<DIV id="sideBar">
<DIV id="sideBarMain"><!--done--> 
<DIV class="newsItem">
<H3 class="catListTitle">公告</H3>
<DIV id="blog-news"></DIV>
<SCRIPT type="text/javascript">loadBlogNews();</SCRIPT>
 </DIV>
<DIV id="calendar">
<DIV id="blog-calendar" style="display: none;"></DIV>
<SCRIPT type="text/javascript">loadBlogDefaultCalendar();</SCRIPT>
</DIV>
<DIV id="leftcontentcontainer">
<DIV id="blog-sidecolumn"></DIV>
<SCRIPT type="text/javascript">loadBlogSideColumn();</SCRIPT>
			 </DIV></DIV><!--end: sideBarMain -->	 </DIV><!--end: sideBar 侧边栏容器 -->	 
<DIV class="clear"></DIV></DIV><!--end: main -->	 
<DIV class="clear"></DIV>
<DIV id="footer"><!--done--> Copyright ©2017 Heart_K	 </DIV><!--end: footer --> 
</DIV><!--end: home 自定义的最大容器 --> </BODY></HTML>
