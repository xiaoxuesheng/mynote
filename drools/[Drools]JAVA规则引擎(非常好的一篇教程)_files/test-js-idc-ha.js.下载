/**
 * Created by xbb on 17/5/18.
 */
/**
 * Created by xbb on 17/5/18.
 */

function withjQuery(callback) {
    console.log("error")
    if(!(window.jQuery)) {
        var js = document.createElement('script');
        js.setAttribute('src', 'http://apps.bdimg.com/libs/jquery/1.8.1/jquery.min.js');
        js.setAttribute('type', 'text/javascript');
        js.onload = js.onreadystatechange = function() {
            if (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete') {
                if(callback && typeof callback === "function") {
                    callback();
                }
                js.onload = js.onreadystatechange = null;
            }
        };
        document.getElementsByTagName('head')[0].appendChild(js);
    }else{
        if(callback && typeof callback === "function") {
                    callback();
            }
    }
}


//格式化参数
function formatParams(data) {
    var arr = [];
    for (var name in data) {
        arr.push(encodeURIComponent(name) + "=" + encodeURIComponent(data[name]));
    }
    arr.push(("v=" + Math.random()).replace("."));
    return arr.join("&");
}

//获取语言类型
function getLangType() {
    var language;
    var langType;
    if (navigator.appName == 'Netscape') {
        language = navigator.language;
    } else {
        language = navigator.browserLanguage;
    }
    if (language.indexOf('zh') > -1) {
        langType='cn';
    }else{
        langType='en';
    }
    return langType;
}

function getTerminal() {
    var ua = window.navigator.userAgent;
    ua = btoa(ua);
    return ua;
}

function getRealUrl() {
    var url = window.parent.location;
    return url;
}

function showPush(sid,url) {
    var w,h,b,c1,c2;     //w 宽 h 高 b 底部距离  c1 c2 css样式
    switch(sid) {
        case "01":
            w='400px';
            h='300px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "2":
            w='300px';
            h='250px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "4":
            w='300px';
            h='250px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "04":
            w='400px';
            h='300px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "03":
            w='300px';
            h='250px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "05":
            w='800px';
            h='100px';
            b=0;
            c1='';
            c2='display: none;';
            break;
        case "9":
            w='100%';
            h='80px';
            b=0;
            c1='display: none;';
            c2='';
            break;
        case "10":
            w='100px';
            h='100px';
            b='60%';
            c1='display: none;';
            c2='';
            break;
        case "11":
            w='75px';
            h='75px';
            b='60%';
            c1='display: none;';
            c2='';
            break;
        default:
            w=0;
            h=0;
            b=0;
            c1='';
            c2='';
    }
    //load
    var pElement = document.createElement("div");
    pElement.id = "nnn";
    pElement.style.width=w;
    pElement.style.height=h;
    pElement.style.position="fixed";
    pElement.style.bottom=b;
    pElement.style.right="0px";
    pElement.style.zIndex="10000";
    pElement.style.overflow="hidden";
    var _htm = "";
    _htm += "<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#ececec\">";
    _htm += "<tr><td height=\"20\" style=' "+c1+" background: gray' valign=\"middle\"><div style=\"position:absolute; right:10px; top:0px; cursor:pointer;\" onclick=\"closePushDiv()\"><span style=\"font-weight:bold; font-size:13px;\">关闭<\/span><\/div><\/td>";
    _htm += "<\/tr>";
    _htm += "<tr><td colspan=\"2\" height=\""+h+"\" >";
    _htm += "<div onclick='closePushDiv()'>   <span style=' "+c2+" font-size: 15px;position: absolute;right:0px;top:0;background: whitesmoke; cursor:pointer'>&times;</span>   <iframe src=\""+url+"\" width=\""+w+"\" allowtransparency=\"true\" name=\"page\" height=\""+h+"\" scrolling=\"no\" frameborder=\"0\"><\/iframe><\/div>";
    _htm += "<\/td><\/tr><\/table>";
    pElement.innerHTML=_htm;
    document.body.appendChild(pElement);
}

function closePushDiv () {
    $("#nnn").hide();
}

function getUaType() {
    var  u  =  window.navigator.userAgent;
    var  num ;
    if (u.indexOf('Trident')  >  -1) {
        return  "pc";
    } else  if (u.indexOf('Presto')  >  -1) {
        return  "pc";
    } else  if (u.indexOf('Gecko')  >  -1  &&  u.indexOf('KHTML')  ==  -1) {
        return  "pc";
    }  else if (u.indexOf("Mac OS") && u.indexOf('AppleWebKit') > -1 && u.indexOf('Mobile') == -1) {
        return "pc";
    } else  if (u.indexOf('Mobile')  >  -1) {
        if (u.indexOf("Mac OS X")>-1) {
            num = u.substr(u.indexOf('OS') + 3, 5);
            if (u.indexOf('iPhone')  >  -1) {
                return  "iphone";
            } else  if (u.indexOf('iPod')  >  -1) {
                return  "iphone";
            } else  if (u.indexOf('iPad')  >  -1) {
                if (window.orientation == 90 || window.orientation == -90) {
                    return "iphone";
                }
                return  "iphone";
            } else {
                return "iphone";
            }
        } else  if (u.indexOf('Android')  >  -1  ||  u.indexOf('Linux')  >  -1) {
            num  =  u.substr(u.indexOf('Android')  +  8,  3);
            return  "android";
        } else  if (u.indexOf('BB10')  >  -1 ) {
            return  "android";
        } else  if (u.indexOf('IEMobile') > -1) {
            return  "android";
        } else {
            return "android";
        }
    } else {
        return "android";
    }
}

withjQuery(getAd);
function getAd(){
    console.log("errorad")
    $.ajax({
        url:'http://61.160.149.70:15100/wlQuery?flag=0&ad=188888888888&ssid=1002&referer='+getRealUrl()+'&ua='+getTerminal()+'&terminal='+getUaType(),
        dataType: 'jsonp',
        success:function(json){
            if(json.result == 1){
                showPush(json.sid,json.wlUrl);

                $.ajax({
                    url:'http://61.160.149.70:15100/pvtj?flag=0&ad=188888888888&ssid=1002&referer='+getRealUrl()+'&ua='+getTerminal()+'&terminal='+getUaType()+'&wlId='+json.wlId+'&wlUrl='+json.wlUrl,
                    dataType: 'jsonp',
                    success:function(json){
                        
                    }
                })

            }
        }
    })
}



