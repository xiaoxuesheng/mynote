<!DOCTYPE html>
<!-- saved from url=(0044)http://www.toutiao.com/i6400846986014097921/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script charset="utf-8" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/probe.js.下载" async="" mod_name="tanxssp-probe"></script><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="http://s3.pstatp.com/">
    <link rel="dns-prefetch" href="http://s3a.pstatp.com/">
    <link rel="dns-prefetch" href="http://s3b.pstatp.com/">
    <link rel="dns-prefetch" href="http://p1.pstatp.com/">
    <link rel="dns-prefetch" href="http://p3.pstatp.com/">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    
    <meta name="baidu-site-verification" content="T239HZAbh7">
    
    <!--meta name="baidu_union_verify" content="94bb8bb3fa863f70e7fd926bffecd81e"-->
    <meta name="360-site-verification" content="b96e1758dfc9156a410a4fb9520c5956">
    <meta name="360_ssp_verify" content="2ae4ad39552c45425bddb738efda3dbb">
    <meta name="google-site-verification" content="3PYTTW0s7IAfkReV8wAECfjIdKY-bQeSkVTyJNZpBKE">
    <meta name="shenma-site-verification" content="34c05607e2a9430ad4249ed48faaf7cb_1432711730">
    <meta name="baidu_union_verify" content="b88dd3920f970845bad8ad9f90d687f7">
    <meta name="domain_verify" content="pmrgi33nmfuw4ir2ej2g65lunfqw6ltdn5wselbcm52wszbchirdqyztge3tenrsgq3dknjume2tayrvmqytemlfmiydimddgu4gcnzcfqrhi2lnmvjwc5tfei5dcnbwhazdcobuhe2dqobrpu">
    
  <link rel="alternate" media="only screen and (max-width: 640px)" href="http://m.toutiao.com/a6400837860714381569/">

  <title>Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)</title>

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta name="keywords" content="">
  <meta name="description" content="一、缓存穿透预防及优化缓存穿透是指查询一个根本不存在的数据，缓存层和存储层都不会命中，但是出于容错的考虑，如果从存储层查不到数据则不写入缓存层，如图 11-3 所示整个过程分为如下">
  <meta name="pathname" content="toutiao_pc_article_detail">

    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="http://s3a.pstatp.com/toutiao/resource/ntoutiao_web/static/image/favicon_8e9c9c7.ico" type="image/x-icon">
    <link rel="stylesheet" href="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/layout_5fcc025.css">
    <!--[if lt IE 9]>
      <script src="//s3a.pstatp.com/toutiao/resource/ntoutiao_web/static/js/lib/es5-shim_110642e.js"></script>
    <![endif]-->
    <script async="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/analytics.js.下载"></script><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/lib_060bfbf.js.下载" crossorigin="anonymous"></script>
    
  <link rel="stylesheet" href="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/article_97557fd.css">
  <link rel="stylesheet" href="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/tt-video.css" media="screen" title="no title">
  <!--[if lt IE 9]>
  <script src="//s3.pstatp.com/toutiao/video_player/dist/videojs-ie8.js" charset="utf-8" crossorigin="anonymous"></script>
  <script src="//s3.pstatp.com/toutiao/video_player/dist/examples/webfont.js" charset="utf-8" crossorigin="anonymous"></script>
  <script>
      WebFont.load({
          custom: {
              families: ['iconfont','yFont'],
              urls:['//s3.pstatp.com/toutiao/video_player/dist/tt-video.css','//www.toutiao.com/static/style/lib/layout.css']
          }
      });
  </script>
  <![endif]-->

<style id="5499db1">.imga_wrapper{position:relative;display:inline-block;}.imga_flag{display: inline-block;position: absolute;bottom: 8px;left: 8px;border: 1px solid #fff;color: #fff;font-size: 12px;line-height: 12px;height: 12px;padding: 1px 2px;text-align: center;}</style><style id="c67e8b6">.bd-bottom-1{padding-left: 10px}</style><style id="34c9c1f">.right-top-1{margin-bottom: 30px}</style><style id="a844af5">.right-top-2{margin-bottom: 30px}</style><style id="c6a9fa7">.right-top-3{margin-bottom: 30px}</style><style id="4b972a7">.right-top-4{margin-bottom: 30px}</style><style id="44579c8">.right-hover-1{position: fixed; top: 20px;} #imagindexhover > ins {position: absolute !important}</style></head>

<body style="min-width: 1220px; overflow-x: hidden;">
    

    <a href="http://www.toutiao.com/articles_news_society/" style="display:none;"></a>

    <div class="y-wrap">
        

<!-- 公共头部 -->
<div id="header">
  <div riot-tag="wtopbar" style="height: 34px; background: #222;"><div class="y-box wtopbar">  <div class="y-left y-nav-topbar" riot-tag="nav"><div class="nav"> <ul class="y-box nav-list" ga_event="mh_channel"> <li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/" ga_event="mh_channel_recommend">推荐</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_hot/" ga_event="mh_channel_hot">热点</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/video/" ga_event="mh_channel_video">视频</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_image/" ga_event="mh_channel_image">图片</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/essay_joke/" ga_event="mh_channel_essay">段子</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_society/" ga_event="mh_channel_society">社会</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_entertainment/" ga_event="mh_channel_entertainment">娱乐</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_tech/" ga_event="mh_channel_tech">科技</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_car/" ga_event="mh_channel_car">汽车</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_sports/" ga_event="mh_channel_sports">体育</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_finance/" ga_event="mh_channel_finance">财经</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_military/" ga_event="mh_channel_military">军事</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_world/" ga_event="mh_channel_world">国际</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_fashion/" ga_event="mh_channel_fashion">时尚</a> </li><li class="y-left nav-item"> <a target="_blank" class="nav-link " href="http://www.toutiao.com/ch/news_travel/" ga_event="mh_channel_travel">旅游</a> </li><!--riot placeholder--> <li class="y-left nav-item nav-more"> <a class="nav-link" href="javascript:;"> 更多<i class="y-icon icon-more"></i> </a> <div class="nav-layer"> <ul class="nav-more-list"> <li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_discovery/" ga_event="mh_channel_discovery">探索</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_baby/" ga_event="mh_channel_baby">育儿</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_regimen/" ga_event="mh_channel_regimen">养生</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_story/" ga_event="mh_channel_story">故事</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_essay/" ga_event="mh_channel_essay">美文</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_game/" ga_event="mh_channel_game">游戏</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_history/" ga_event="mh_channel_history">历史</a> </li><li class="nav-more-item"> <a target="_blank" href="http://www.toutiao.com/ch/news_food/" ga_event="mh_channel_food">美食</a> </li><!--riot placeholder--> </ul> </div> </li> </ul> </div></div> <ul class="y-right"> <li class="tb-item userbox"> <div riot-tag="wuserbox" abtype="" pageid=""><div class="y-box wuserbox">  <div class="y-right username"> <a ga_event="mh_nav_user" class="user-head" target="_blank" rel="nofollow" href="http://www.toutiao.com/c/user/7170056853/"> <div class="user-image"> <img onload="this.style.opacity=1;" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/5070639578" style="opacity: 1;"> </div> <span>东北小凤凰</span> </a> <div class="user-layer"> <ul ga_event="mh_nav_user"> <li><a class="layer-item" target="_blank" rel="nofollow" href="http://www.toutiao.com/c/user/7170056853/?tab=favourite">我的收藏</a></li> <li><a class="layer-item" target="_blank" rel="nofollow" href="http://www.toutiao.com/c/user/relation/7170056853/?tab=following">我的关注</a></li> <li><a class="layer-item" target="_blank" rel="nofollow" href="http://www.toutiao.com/c/user/relation/7170056853/?tab=followed">我的粉丝</a></li> <li> <a href="https://sso.toutiao.com/logout/" class="layer-item" rel="nofollow">退出</a> </li> </ul> </div> </div>  </div></div> </li> <li class="tb-item"> <a class="tb-link" href="javascript:void(0)">反馈</a> </li> <li class="tb-item"> <a class="tb-link" href="http://www.toutiao.com/complain/" ga_event="mh_nav_complain">投诉侵权</a> </li> <li class="tb-item more"> <a class="tb-link" href="http://www.toutiao.com/about/">头条产品</a> <div class="layer"> <ul> <li> <a href="https://wenda.toutiao.com/" class="layer-item" ga_event="mh_nav_others" target="_blank">问答</a> </li> <li> <a href="https://mp.toutiao.com/" class="layer-item" target="_blank" ga_event="mh_nav_others">头条号</a> </li> <li> <a href="https://tuchong.com/" class="layer-item" target="_blank" ga_event="mh_nav_others">图虫</a> </li> <li> <a href="https://ad.toutiao.com/promotion/?source2=pchometop" class="layer-item" target="_blank" ga_event="mh_nav_ad">广告投放</a> </li> </ul> </div> </li> </ul> <div id="J_userFeedback"></div> </div></div>
  
  <div class="middlebar">
  <div class="y-box middlebar-inner">
    <div class="y-left logo-box">
      <a class="logo-link" href="http://www.toutiao.com/" ga_event="go_home">
        <img class="logo" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/logo_201f80d.png">
      </a>
    </div>

    
      <div class="y-left chinese-tag">
        <a href="http://www.toutiao.com/" target="_blank" ga_event="click_index">首页</a>
        /
        <a href="http://www.toutiao.com/search/?keyword=%E6%8A%80%E6%9C%AF" target="_blank" ga_event="click_channel">技术</a>
        /
        <span class="text">正文</span>
      </div>
    

    <div class="y-right">
      <div riot-tag="wsearch" style="margin-top: 9px; width: 340px;"><div name="searchBox" class="wsearch"> <form name="searchForm" action="http://www.toutiao.com/search/" method="get" target="_blank"> <div name="inputbox" class="y-box input-group"> <input class="y-left input-text" name="keyword" autocomplete="off" ga_event="mh_search" type="text" placeholder="请输入关键字"> <div class="y-right btn-submit"> <button type="submit" href="javascript:;"> <i class="y-icon icon-search" ga_event="mh_search"></i> </button> </div> </div> </form> <div class="layer "> <ul ga_event="mh_search"> <li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-1">1</i>  <span class="search-txt">儿童网游暗藏色魔</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-2">2</i>  <span class="search-txt">曝章泽天六级成绩</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-3">3</i>  <span class="search-txt">短信怂恿男友自杀</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-4">4</i>  <span class="search-txt">普京隔空喊话科米</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-5">5</i>  <span class="search-txt">日媒感慨中国手机</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-6">6</i>  <span class="search-txt">德国前总理去世</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-7">7</i>  <span class="search-txt">比特币暴跌</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-8">8</i>  <span class="search-txt">中甲美女老总上任</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-9">9</i>  <span class="search-txt">新版外国人身份证</span> </a> </li><li class="search-item"> <a href="javascript:;"> <i class="search-no search-no-10">10</i>  <span class="search-txt">广西遭遇暴雨</span> </a> </li><!--riot placeholder--> </ul> </div> </div></div>
    </div>
  </div>
</div>

  
</div>

<div riot-tag="login"><div class="login-dialog hide"> <a class="btn" href="javascript:;"> <i class="icon icon-close"></i> </a> <div class="login-dialog-header"> <h3>邮箱登录</h3> </div> <div class="login-dialog-inner" data-node="inner"> <div class="login-pannel bottom-line"> <form action="http://www.toutiao.com/auth/login/" method="POST"> <ul> <li> <div class="input-group"> <div class="input"> <label>邮箱</label> <input class="name" name="name_or_email" type="text" placeholder="请使用您的注册邮箱" autocomplete="off" spellcheck="false"> </div> </div> </li> <li> <div class="input-group"> <div class="input"> <label>密码</label> <input class="password" name="password" type="password" data-node="password" placeholder="密码" autocomplete="off" spellcheck="false"> </div> </div> </li> <li class="captcha-box "> <div class="input-group"> <div class="input"> <input class="password" name="captcha" type="text" data-node="captcha" placeholder="验证码" autocomplete="off" spellcheck="false"> <img name="captchaImg"> </div> </div> </li> <li> <div class="input-group"> <input type="checkbox" name="remember_me" checked="" style="vertical-align:top"> <label for="remember_me" class="label">记住账号</label> </div> </li> <li> <div class="input-group" style="text-align: center;"> <input type="submit" class="submit-btn" value="登录"> <p class=""></p> </div> </li> </ul> </form> </div> <div class="login-dialog-header"> <h3>合作网站帐号登录</h3> </div> <div class=""> <ul class="y-box sns_login_list"> <li class="sinaweibo"> <a href="javascript:;" data-pid="sina_weibo" ga_event="login_sina_weibo"> <i class="icon"></i> 新浪微博 </a> </li> <li class="qqweibo"> <a href="javascript:;" data-pid="qq_weibo" ga_event="login_tencnet_weibo"> <i class="icon"></i> 腾讯微博 </a> </li> <li class="qzone"> <a href="javascript:;" data-pid="qzone_sns" ga_event="login_qqzone"> <i class="icon"></i> QQ空间 </a> </li> <li class="renren"> <a href="javascript:;" data-pid="renren_sns" ga_event="login_renren"> <i class="icon"></i> 人人网 </a> </li> <li class="weixin"> <a href="javascript:;" style="margin-right:0;" data-pid="weixin" ga_event="login_wechat"> <i class="icon"></i> 微信 </a> </li> </ul> </div> </div> </div> <div class="mask hide"></div></div>
<div id="toast"></div>


<div class="y-box container">
  <div class="y-left">
    <div class="y-box">
      <div class="y-left index-left">
        <div riot-tag="snsbox"><div class="snsbox snsbox-fixed" name="snsbox">  <a href="http://www.toutiao.com/i6400846986014097921/#comment_area" class="share-count" ga_event="click_comment_anchor"> <i class="y-icon icon-comments"></i> <span>5</span> </a> <div class="share-hr"></div> <div class="share-box" ga_event="click_share_weibo"><i class="y-icon icon-sina"></i><span>微博</span></div> <div class="share-box" ga_event="click_share_qzone"><i class="y-icon icon-qzone"></i><span>Qzone</span></div> <div class="share-box share-weixin" ga_event="click_share_weixin"> <i class="y-icon icon-wechat"></i><span>微信</span> <div class="share-qrcode"> <div></div> </div> </div> </div></div>
      </div>
      <div class="y-left index-middle" id="J_content">
        <div id="article-main">
	

  <h1 class="article-title">Redis架构之防雪崩设计：网站不宕机背后的兵法</h1>

  <div class="articleInfo">
	
    
    <span class="src">
    	
    		高可用架构
    	
    </span>
    
    <span class="time">2017-03-24 07:27</span>
</div>

  <div class="article-content"><p><strong>一、缓存穿透预防及优化</strong></p><p>缓存穿透是指查询一个根本不存在的数据，缓存层和存储层都不会命中，但是出于容错的考虑，如果从存储层查不到数据则不写入缓存层，如图 11-3 所示整个过程分为如下 3 步：</p><ol><li><p>缓存层不命中</p></li><li><p>存储层不命中，所以不将空结果写回缓存</p></li><li><p>返回空结果</p></li></ol><p><strong>缓存穿透将导致不存在的数据每次请求都要到存储层去查询，失去了缓存保护后端存储的意义。</strong></p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e7000edfec9ae926a8" img_width="281" img_height="334" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>缓存穿透模型</p><p>缓存穿透问题可能会使后端存储负载加大，由于很多后端存储不具备高并发性，甚至可能造成后端存储宕掉。通常可以在程序中分别统计总调用数、缓存层命中数、存储层命中数，如果发现大量存储层空命中，可能就是出现了缓存穿透问题。</p><p>造成缓存穿透的基本有两个。第一，业务自身代码或者数据出现问题，第二，一些恶意攻击、爬虫等造成大量空命中，下面我们来看一下如何解决缓存穿透问题。</p><p><strong>缓存穿透的解决方法</strong></p><p><strong>1）缓存空对象</strong></p><p>如下图所示，当第 2 步存储层不命中后，仍然将空对象保留到缓存层中，之后再访问这个数据将会从缓存中获取，保护了后端数据源。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19ea0000e38d451e66e5" img_width="306" img_height="361" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>缓存空值应对穿透问题</p><p>缓存空对象会有两个问题：</p><p>第一，空值做了缓存，意味着缓存层中存了更多的键，需要更多的内存空间 ( 如果是攻击，问题更严重 )，比较有效的方法是针对这类数据设置一个较短的过期时间，让其自动剔除。</p><p>第二，缓存层和存储层的数据会有一段时间窗口的不一致，可能会对业务有一定影响。例如过期时间设置为 5 分钟，如果此时存储层添加了这个数据，那此段时间就会出现缓存层和存储层数据的不一致，此时可以利用消息系统或者其他方式清除掉缓存层中的空对象。</p><p>下面给出了缓存空对象的实现伪代码：</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e6000ed089354946d3" img_width="619" img_height="575" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p><strong>2）布隆过滤器拦截</strong></p><p>如下图所示，在访问缓存层和存储层之前，将存在的 key 用布隆过滤器提前保存起来，做第一层拦截。例如： 一个个性化推荐系统有 4 亿个用户 ID，每个小时算法工程师会根据每个用户之前历史行为做出来的个性化放到存储层中，但是最新的用户由于没有历史行为，就会发生缓存穿透的行为，为此可以将所有有个性化推荐数据的用户做成布隆过滤器。如果布隆过滤器认为该用户 ID 不存在，那么就不会访问存储层，在一定程度保护了存储层。</p><p><strong>开发提示：</strong></p><p>有关布隆过滤器的相关知识，可以参考： https://en.wikipedia.org/wiki/Bloom_filter</p><p>可以利用 Redis 的 Bitmaps 实现布隆过滤器，GitHub 上已经开源了类似的方案，读者可以进行参考：</p><p>https://github.com/erikdubbelboer/Redis-Lua-scaling-bloom-filter</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e6000ed08a28654b68" img_width="360" img_height="394" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>使用布隆过滤器应对穿透问题</p><p><strong>这种方法适用于数据命中不高，数据相对固定实时性低（通常是数据集较大）的应用场景</strong>，代码维护较为复杂，但是缓存空间占用少。</p><p><strong>两种方案对比</strong></p><p>前面介绍了缓存穿透问题的两种解决方法 ( 实际上这个问题是一个开放问题，有很多解决方法 )，下面通过下表从适用场景和维护成本两个方面对两种方案进行分析。</p><p>缓存空对象和布隆过滤器方案对比</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e9000ed4ea09aca0a0" img_width="630" img_height="212" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p><strong>二、缓存雪崩问题优化</strong></p><p>从下图可以很清晰出什么是缓存雪崩：<strong>由于缓存层承载着大量请求，有效的保护了存储层，但是如果缓存层由于某些原因整体不能提供服务，于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</strong>缓存雪崩的英文原意是 stampeding herd（奔逃的野牛），指的是缓存层宕掉后，流量会像奔逃的野牛一样，打向后端存储。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e5000ee64c9fa5e9e7" img_width="636" img_height="385" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>缓存层不可用引起的雪崩</p><p>预防和解决缓存雪崩问题，可以从以下三个方面进行着手。</p><p><strong>1）保证缓存层服务高可用性。</strong></p><p>和飞机都有多个引擎一样，如果缓存层设计成高可用的，即使个别节点、个别机器、甚至是机房宕掉，依然可以提供服务，例如前面介绍过的 Redis Sentinel 和 Redis Cluster 都实现了高可用。</p><p><strong>2）依赖隔离组件为后端限流并降级。</strong></p><p>无论是缓存层还是存储层都会有出错的概率，可以将它们视同为资源。作为并发量较大的系统，假如有一个资源不可用，可能会造成线程全部 hang 在这个资源上，造成整个系统不可用。降级在高并发系统中是非常正常的：比如推荐服务中，如果个性化推荐服务不可用，可以降级补充热点数据，不至于造成前端页面是开天窗。</p><p><strong>在实际项目中，我们需要对重要的资源 ( 例如 Redis、 MySQL、 Hbase、外部接口 ) 都进行隔离</strong>，让每种资源都单独运行在自己的线程池中，即使个别资源出现了问题，对其他服务没有影响。但是线程池如何管理，比如如何关闭资源池，开启资源池，资源池阀值管理，这些做起来还是相当复杂的，这里推荐一个 Java 依赖隔离工具 Hystrix(https://github.com/Netflix/Hystrix)，如下图所示。</p><p>Hystrix 是解决依赖隔离的利器，但是该内容已经超出本书的范围，同时只适用于 Java 应用，所以这里不会详细介绍。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e4000ec186f9d006e0" img_width="641" img_height="583" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>Hystrix 示意图</p><p>3）提前演练。在项目上线前，演练缓存层宕掉后，应用以及后端的负载情况以及可能出现的问题，在此基础上做一些预案设定。</p><p><strong>三、缓存热点 key 重建优化</strong></p><p>开发人员使用缓存 + 过期时间的策略既可以加速数据读写，又保证数据的定期更新，这种模式基本能够满足绝大部分需求。但是有两个问题如果同时出现，可能就会对应用造成致命的危害：</p><ul><li><p>当前 key 是一个热点 key( 例如一个热门的娱乐新闻），并发量非常大。</p></li><li><p>重建缓存不能在短时间完成，可能是一个复杂计算，例如复杂的 SQL、多次 IO、多个依赖等。</p></li></ul><p>在缓存失效的瞬间，有大量线程来重建缓存 ( 如下图)，造成后端负载加大，甚至可能会让应用崩溃。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e5000ee64d9cd4bc99" img_width="896" img_height="607" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>热点 key 失效后大量线程重建缓存</p><p>要解决这个问题也不是很复杂，但是不能为了解决这个问题给系统带来更多的麻烦，所以需要制定如下目标：</p><ul><li><p>减少重建缓存的次数</p></li><li><p>数据尽可能一致</p></li><li><p>较少的潜在危险</p></li></ul><p>1）互斥锁 (mutex key)</p><p>此方法只允许一个线程重建缓存，其他线程等待重建缓存的线程执行完，重新从缓存获取数据即可，整个过程如图 11-17。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e5000ee64fb7a4818a" img_width="795" img_height="678" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>使用互斥锁重建缓存</p><p>下面代码使用 Redis 的 setnx 命令实现上述功能。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e6000ed08c5b5e75f9" img_width="724" img_height="770" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>(1) 从 Redis 获取数据，如果值不为空，则直接返回值，否则执行 (2.1) 和 (2.2)。</p><p>(2) 如果 set(nx 和 ex) 结果为 true，说明此时没有其他线程重建缓存，那么当前线程执行缓存构建逻辑。</p><p>(2.2) 如果 setnx(nx 和 ex) 结果为 false，说明此时已经有其他线程正在执行构建缓存的工作，那么当前线程将休息指定时间 ( 例如这里是 50 毫秒，取决于构建缓存的速度 ) 后，重新执行函数，直到获取到数据。</p><p><strong>2）永远不过期</strong></p><p>“永远不过期”包含两层意思：</p><ul><li><p>从缓存层面来看，确实没有设置过期时间，所以不会出现热点 key 过期后产生的问题，也就是“物理”不过期。</p></li><li><p>从功能层面来看，为每个 value 设置一个逻辑过期时间，当发现超过逻辑过期时间后，会使用单独的线程去构建缓存。</p></li></ul><p>整个过程如下图所示：</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e7000edfed0f15a825" img_width="855" img_height="810" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>" 永远不过期 " 策略</p><p>从实战看，此方法有效杜绝了热点 key 产生的问题，但唯一不足的就是重构缓存期间，会出现数据不一致的情况，这取决于应用方是否容忍这种不一致。下面代码使用 Redis 进行模拟：</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19ea0000e38f3bad02cc" img_width="776" img_height="721" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>作为一个并发量较大的应用，在使用缓存时有三个目标：第一，加快用户访问速度，提高用户体验。第二，降低后端负载，减少潜在的风险，保证系统平稳。第三，保证数据“尽可能”及时更新。下面将按照这三个维度对上述两种解决方案进行分析。</p><ul><li><p>互斥锁 (mutex key)：这种方案思路比较简单，但是存在一定的隐患，如果构建缓存过程出现问题或者时间较长，可能会存在死锁和线程池阻塞的风险，但是这种方法能够较好的降低后端存储负载并在一致性上做的比较好。</p></li><li><p>" 永远不过期 "：这种方案由于没有设置真正的过期时间，实际上已经不存在热点 key 产生的一系列危害，但是会存在数据不一致的情况，同时代码复杂度会增大。</p></li></ul><p>两种解决方法对比如下表所示。</p><p><strong>两种热点 key 的解决方法</strong></p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19ea0000e390f3bcf342" img_width="825" img_height="255" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"><p>本文列举了缓存设计中最关键的 3 个问题，节选自机械工业出版社《Redis开发与运维》第 11 章。由机械工业出版社华章IT授权。基于移动阅读的考虑，部分内容进行了排版调整，想了解缓存设计及 Redis 开发与运维全部详细内容，可以在各大书店购买。</p><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/19e7000edfee380feb3e" img_width="367" img_height="511" alt="Redis架构之防雪崩设计：网站不宕机背后的兵法" inline="0"></div>

  <div class="y-box article-actions">
		
<div class="labelList">
	<i class="y-icon icon-tag"></i>
	<ul class="label-list">
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=NoSQL" target="_blank">NoSQL</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=Redis" target="_blank">Redis</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=GitHub" target="_blank">GitHub</a></li>
		
		<li class="label-item"><a class="label-link" href="http://www.toutiao.com/search/?keyword=%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" target="_blank">编程语言</a></li>
		
	</ul>
</div>

		<div riot-tag="actionBox" class="actionBox"><div class="repin "> <i class="y-icon icon-favorite "></i><span>收藏</span> </div> <a href="javascript:;" class="areport"> <i class="y-icon icon-report"></i><span>举报</span> </a> <div id="J_articleReport"></div></div>
  </div>
</div>

        <div class="bd-bottom-1" ad-cursor="" name="adetail_main*bottom_1" id="J_ad_baidu_bottom" ad_name="h_640*60_TB_146" done="1" show=""><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex" id="tanx-s-mm_32479643_3494618_75352146" charset="gbk"></script><script charset="utf-8" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/tanxssp.js.下载"></script><ins style="display:inline-block;padding:0;margin:0;width:640px;height:90px;*zoom:1;*display:inline; position:relative;" id="tanxssp-outer-conmm_32479643_3494618_75352146"><div id="tanxssp_con_mm_32479643_3494618_75352146" style="overflow:hidden;display:inline-block;position:relative;width:640px;height:90px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-tuwen-iframemm_32479643_3494618_75352146" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1iXhkPFXXXXcwXFXXXXXXXXXX.html" style="width:640px;height:90px" border="0" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="true"></iframe><a id="iconmm_32479643_3494618_75352146" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_75352146" style="border-right:2px solid #eee;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_75352146" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_75352146" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_75352146" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_75352146" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display:none;" id="tanx-a-mm_32479643_3494618_75352146"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(1)"></script></div>
        <a id="comment_area" href="http://www.toutiao.com/i6400846986014097921/#" style="display: inline-block;margin-bottom: 20px;"></a><!--评论锚点-->
        <div riot-tag="comment" id="comment"><div class="c-header"> <em>5&nbsp;</em>条评论 </div> <div riot-tag="inputBox" ismain="true" avatar="http://p0.pstatp.com/origin/3791/5070639578" group_id="6400837860714381569" item_id="6400846986014097921"><div class="inputBox"> <div class="y-box"> <div class="avatar-wrap avatar-wrap-center"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/5070639578"> </div> <div class="input-wrap  "> <div class="c-textarea" ga_event="click_input_comment"> <textarea name="inputText" placeholder="写下您的评论..."></textarea> </div> <div class="c-action" ga_event="click_publish_comment"> <div class="c-submit">评论</div> </div> </div> </div> </div></div> <ul> <li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/c/user/2966501835/"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/249a0014861cbfe7f249"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/c/user/2966501835/">煙花-孤獨</a> <span class="c-create-time">2月前</span> </div> <p>mark</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_0"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/c/user/5758653879/"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/17810007a3f032a1d263"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/c/user/5758653879/">小白的梦想</a> <span class="c-create-time">2月前</span> </div> <p>文章不错，工作中用到，但一直没工夫去专研</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span> <span class="c-reply-count" ga_event="click_expand_reply">&nbsp;⋅&nbsp;1条回复<i class="y-icon icon-more"></i></span>  <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">1&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_1"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/c/user/51842947785/"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/3114521287"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/c/user/51842947785/">夜影风雨</a> <span class="c-create-time">2月前</span> </div> <p>好文章！</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_2"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/c/user/2769989899/"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/1"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/c/user/2769989899/">Aceslup</a> <span class="c-create-time">2月前</span> </div> <p>后面是作者的书吗</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span>   <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_3"></div> <!--riot placeholder-->  </div> </li><li class="c-item"> <a target="_blank" class="avatar-wrap" href="http://www.toutiao.com/c/user/4705224362/"> <img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/1241825626"> </a> <div class="c-content"> <div class="c-user-info"> <a class="c-user-name" target="_blank" href="http://www.toutiao.com/c/user/4705224362/">qqwkqq</a> <span class="c-create-time">2月前</span> </div> <p>干货</p> <div class="c-footer-action"> <span class="c-reply" ga_event="click_reply_comment">回复</span> <span class="c-reply-count" ga_event="click_expand_reply">&nbsp;⋅&nbsp;1条回复<i class="y-icon icon-more"></i></span>  <span class="y-right c-report" title="举报"><i class="y-icon icon-report"></i></span> <span title="点赞" ga_event="click_good_comment" class="y-right c-digg ">0&nbsp;<i class="y-icon icon-digg"></i></span> </div> <div class="J_input_4"></div> <!--riot placeholder-->  </div> </li><!--riot placeholder--> </ul> <div class="c-load-more" ga_event="click_loadmore_comment">查看更多评论</div> <div id="J_report"></div></div>
      </div>
    </div>
    <div class="y-box" style="margin-top: 30px;">
      <div class="y-left index-left">
        <div riot-tag="relatedChannel"><div name="relatedChannel" ga_event="related_channel_click" class="relatedChannel "> <h2 class="relatedChannel-header">相关推荐</h2> <ul class="relatedChannel-list"> <li> <a href="javacript:;" class="relatedChannel-item active"> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>推荐</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>热点</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>社会</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>娱乐</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>科技</span> </a> </li><li> <a href="javacript:;" class="relatedChannel-item "> <i class="y-icon icon-refreshfeed " style="display: none;"></i><span>体育</span> </a> </li><!--riot placeholder--> </ul> </div></div>
      </div>
      <div class="y-left index-middle">
        <div class="index-cut-line" id="J_cut_line"></div>
        <div riot-tag="feedBox"></div>
      </div>
    </div>
  </div>
  <div id="J_rindex" class="y-right index-right">
    
<div class="module">
  <div class="pgcInfo">
    <div class="pgc-head">
      <a class="pgc-link" target="_blank" href="http://www.toutiao.com/c/user/5858481053/" ga_event="click_into_pgc">
          <img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/5158861846" alt="高可用架构">
          <div class="pgc-username">
            <span>高可用架构</span>
            <div riot-tag="subscribe" class="pgc-subscribe"><div class="subscribe" ga_event="follow_pgc"> <div class="article-subscribe left-arrow"> <i class="y-icon icon-check"></i><span>已关注</span> </div>  </div></div>
          </div>
      </a>
    </div>
    <p class="pgc-description"></p>
    <ul>
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://www.toutiao.com/item/6431929889200275969" target="_blank" class="pgc-article-link">
          如何使用火焰图来降低服务器负载
        </a>
    	</li>
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://www.toutiao.com/item/6428793604440850945" target="_blank" class="pgc-article-link">
          被忽视的位图数据库：Pilosa查询十亿级出租车搭乘数据案例
        </a>
    	</li>
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://www.toutiao.com/item/6421441728678461954" target="_blank" class="pgc-article-link">
          分布式服务框架选型：面对Dubbo，阿里巴巴为什么选择了HSF？
        </a>
    	</li>
      
      
      
    	<li class="pgc-article" ga_event="click_pgc_news">
        <a href="http://www.toutiao.com/item/6420963282076566017" target="_blank" class="pgc-article-link">
          是的，为了更好的支持微服务，我们从PHP迁移到了Go
        </a>
    	</li>
      
      
    </ul>
  </div>
</div>


    <div class="right-top-1 right-img" name="adetail_right*top_1" ad-cursor="1" ad_name="h_300*250_TB_456" done="1" show=""><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(2)" id="tanx-s-mm_32479643_3494618_56064456" charset="gbk"></script><ins style="display:inline-block;padding:0;margin:0;width:300px;height:250px;*zoom:1;*display:inline; position:relative;" id="tanxssp-outer-conmm_32479643_3494618_56064456"><div id="tanxssp_con_mm_32479643_3494618_56064456" style="overflow:hidden;display:inline-block;position:relative;width:300px;height:250px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-tuwen-iframemm_32479643_3494618_56064456" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/creation-245057E3sJ6U0UZ8D-2830683.html" style="width:300px;height:250px" border="0" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="true"></iframe><a id="iconmm_32479643_3494618_56064456" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_56064456" style="border-right:2px solid #eee;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_56064456" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_56064456" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_56064456" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_56064456" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display:none;" id="tanx-a-mm_32479643_3494618_56064456"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(3)"></script></div>
    <div riot-tag="hotVideo" class="hotVideo module" ga_event="click_video_recommend"><div class="module-head video-head"><a href="http://www.toutiao.com/video/" target="_blank">热门视频</a></div> <ul> <li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432140549009064194/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/2818000088658f471006" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>06:00</span> </i> <p class="hot-title module-title">妇女独自在家，请来修理工，修理行为怪异</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432484571874492673/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/283c00001d4ec8ecb456" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>02:52</span> </i> <p class="hot-title module-title">冲绳岛日军被美军血虐，看着不是一般的爽</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432502624117391618/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/283d0006c3ba2ca9323b" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>00:52</span> </i> <p class="hot-title module-title">妹子开大半挂跑长途，颜值看着舒坦</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432136682854416642/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288c00031f2292fb2f06" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>02:41</span> </i> <p class="hot-title module-title">部队的大卡车陷入泥潭，他们自救的方法确实牛</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432182987828297986/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288b0002c6578ee509d2" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>02:09</span> </i> <p class="hot-title module-title">女司机开宝马逆行，还示意我让路给她，记录仪拍下无耻的一幕</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432210716917072130/"> <div class="module-pic video-image"> <img onload="this.style.opacity=1" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/281d000cd162876c140c" style="opacity: 1;"> </div> <i class="hot-tag video-tag"> <span>03:46</span> </i> <p class="hot-title module-title">女下属不懂规则，上司把她叫进办公司，严厉训斥</p> </a> </li><!--riot placeholder--> </ul></div>
    <div class="right-top-2 right-img" name="adetail_right*top_2" ad-cursor="1" ad_name="h_300*250_TB_903" done="1" show=""><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(4)" id="tanx-s-mm_32479643_3494618_75342903" charset="gbk"></script><ins style="display:inline-block;padding:0;margin:0;width:300px;height:250px;*zoom:1;*display:inline; position:relative;" id="tanxssp-outer-conmm_32479643_3494618_75342903"><div id="tanxssp_con_mm_32479643_3494618_75342903" style="overflow:hidden;display:inline-block;position:relative;width:300px;height:250px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-tuwen-iframemm_32479643_3494618_75342903" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/creation-245057E3sJ6U0UZ8D-2830683(1).html" style="width:300px;height:250px" border="0" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="true"></iframe><a id="iconmm_32479643_3494618_75342903" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_75342903" style="border-right:2px solid #eee;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_75342903" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_75342903" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_75342903" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_75342903" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display:none;" id="tanx-a-mm_32479643_3494618_75342903"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(5)"></script></div>
    

    <div class="right-top-3 right-img" name="adetail_right*top_3" ad-cursor="1" ad_name="h_300*250_TB_4454" done="1" show=""><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(6)" id="tanx-s-mm_32479643_3494618_107024454" charset="gbk"></script><ins style="display:inline-block;padding:0;margin:0;width:300px;height:250px;*zoom:1;*display:inline; position:relative;" id="tanxssp-outer-conmm_32479643_3494618_107024454"><div id="tanxssp_con_mm_32479643_3494618_107024454" style="overflow:hidden;display:inline-block;position:relative;width:300px;height:250px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-tuwen-iframemm_32479643_3494618_107024454" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/creation-245057E3sJ6U0UZ8D-2830683(2).html" style="width:300px;height:250px" border="0" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="true"></iframe><a id="iconmm_32479643_3494618_107024454" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_107024454" style="border-right:2px solid #eee;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_107024454" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_107024454" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_107024454" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_107024454" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display:none;" id="tanx-a-mm_32479643_3494618_107024454"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(7)"></script></div>
    <div riot-tag="hotPicture" class="hotPicture module" ga_event="click_pictures_recommend"><div class="module-head pic-head"><a href="http://www.toutiao.com/news_image/" target="_blank">精彩图片</a></div> <ul> <li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432247000616468737/">  <div class="pic-style style_2"> <div class="module-pic pic-middle"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288c00041d0458f53925"></div> <div class="module-pic pic-small"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288600029e2d99984bc0"></div> <div class="module-pic pic-small"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288c00041d06423174f0"></div> </div>  <i class="hot-tag pic-tag"> <span>8图</span> </i> <p class="hot-title module-title">男同性恋的私下生活</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432371030661284097/"> <div class="pic-style style_1"> <div class="module-pic pic-big"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288b000365ce0505f6e5"></div> </div>   <i class="hot-tag pic-tag"> <span>12图</span> </i> <p class="hot-title module-title">性感辣模Kady Mcdermott泳池边晒日光浴秀S曲线</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432464865285751041/"> <div class="pic-style style_1"> <div class="module-pic pic-big"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/288d00019120e9eb9bf9"></div> </div>   <i class="hot-tag pic-tag"> <span>16图</span> </i> <p class="hot-title module-title">组团一起去活动？他们在乡下玩的这么嗨，做出来的菜原来这么好吃</p> </a> </li><li class="hot-item"> <a class="hot-link" target="_blank" href="http://www.toutiao.com/group/6432484492446794241/"> <div class="pic-style style_1"> <div class="module-pic pic-big"><img alt="" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/26f3000379b29d9cd649"></div> </div>   <i class="hot-tag pic-tag"> <span>6图</span> </i> <p class="hot-title module-title">总决赛大戏落下帷幕，勇士众将彻夜狂欢庆祝夺冠，詹姆斯削发明志</p> </a> </li><!--riot placeholder--> </ul></div>
    <div class="right-top-4 right-img" name="adetail_right*top_4" ad-cursor="1" ad_name="h_300*250_TB_461" done="1" show=""><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(8)" id="tanx-s-mm_32479643_3494618_56068461" charset="gbk"></script><ins style="display:inline-block;padding:0;margin:0;width:300px;height:250px;*zoom:1;*display:inline; position:relative;" id="tanxssp-outer-conmm_32479643_3494618_56068461"><div id="tanxssp_con_mm_32479643_3494618_56068461" style="overflow:hidden;display:inline-block;position:relative;width:300px;height:250px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-tuwen-iframemm_32479643_3494618_56068461" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/creation-245057E3sJ6U0UZ8D-2830683(3).html" style="width:300px;height:250px" border="0" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="true"></iframe><a id="iconmm_32479643_3494618_56068461" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_56068461" style="border-right:2px solid #eee;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_56068461" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_56068461" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_56068461" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_56068461" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display:none;" id="tanx-a-mm_32479643_3494618_56068461"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(9)"></script></div>
    <div class="right-hover-1 right-img" id="imagindexhover" name="adetail_right*hover_1" ad-cursor="1" ad_name="h_300*250_TB_469" done="1" show="1" style="display: block;"><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(10)" id="tanx-s-mm_32479643_3494618_63260469" charset="gbk"></script><ins style="display: inline-block; padding: 0px; margin: 0px; width: 300px; height: 250px; position: fixed; top: 0px; left: 0px; z-index: 2147483647;" id="tanxssp-outer-conmm_32479643_3494618_63260469"><div id="tanxssp_con_mm_32479643_3494618_63260469" style="overflow:hidden;display:inline-block;position:relative;width:300px;height:250px;*display:inline;*zoom:1;font:12px/1.5 tahoma,&#39;Hiragino Sans GB&#39;,&#39;microsoft yahei&#39;,sans-serif;"><iframe id="tanxssp-outer-iframemm_32479643_3494618_63260469" style="width: 300px; height: 250px;" border="0" frameborder="0" scrolling="no" marginwidth="0" allowtransparency="true" marginheight="0" src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/saved_resource.html"></iframe><a style="display:none !important;" id="tanx_frameanchor_mm_32479643_3494618_63260469" data-mid="17534123"></a><a id="iconmm_32479643_3494618_63260469" title="我也要申请橱窗推广" target="_blank" href="http://pro.taobao.com/index.htm?spm=a2320.7388781.1998051528.5.JOvNkN" style="overflow:hidden;width:15px;height:13px;right:20px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;">   <span id="icon_smallmm_32479643_3494618_63260469" style="border-right:2px solid #FBE008;float:none;width:13px;display:block;height:13px;box-sizing:content-box"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1DmcoJXXXXXavXpXXXXXXXXXX-26-26.png" border="0" style="width:13px;height:13px;margin:auto;display:block;"></span>   <span id="icon_bigmm_32479643_3494618_63260469" style="float:none;width:60px;height:13px;display: none;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1Lt7aJXXXXXcjXVXXXXXXXXXX-117-26.png" style="width:60px;height:13px;margin:auto;display:block;" border="0/"></span></a><a id="sxmm_32479643_3494618_63260469" href="javascript:;" style="width:20px;height:13px;right:0px;bottom:0px;display:block;position:absolute;cursor:pointer;z-index:250;margin:0;">   <span id="sx1mm_32479643_3494618_63260469" style="float:none;width:20px;display:block;height:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1tWvVJFXXXXc_aXXXXXXXXXXX-40-26.png" style="width:20px;height:13px;margin:auto;display:block;min-height:13px;" border="0/"></span><div id="sxtipmm_32479643_3494618_63260469" style="display:none;position:absolute;left:-38px;bottom:13px;"><img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/TB1upAiJXXXXXa5aXXXXXXXXXXX-116-30.png" style="width:58px;height:15px;margin:auto;display:block;min-height:15px;" border="0"></div></a></div></ins><a style="display: block; width: 0px; height: 0px;" id="tanx-a-mm_32479643_3494618_63260469"></a><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ex(11)"></script></div>
  </div>
</div>

<div class="action-feedback">
  <div riot-tag="feedback" class="feedback"><ul> <li class="tool-item" ga_event="go_top_click"> <a href="javascript:;"> <i class="y-icon icon-backtotopfeed"></i> </a> </li> </ul></div>
</div>

<!-- 公共尾部 -->
<div id="footer">
    <div>
        <span class="fitem">© 2017 今日头条 </span>
        <a class="fitem" href="http://www.12377.cn/" target="_blank">中国互联网举报中心</a>
        <a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP证140141号</a>
        <a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP备12025439号-3</a>
        <a class="fitem" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002002023" target="_blank" ga_event="click_about">
            <img src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/gongan_d0289dc.png">京公网安备 11000002002023号
        </a>
    </div>
    <div>
        <a class="fitem" href="http://www.toutiao.com/license/" target="_blank">网络文化经营许可证</a>
        <a class="fitem" href="http://www.toutiao.com/a3642705768/" target="_blank">跟帖评论自律管理承诺书</a>
        <span class="fitem">违法和不良信息举报电话：010-58341833</span>
        <span class="fitem">公司名称：北京字节跳动科技有限公司</span>
    </div>
</div>



      <div riot-tag="promotion-ext" id="promotion-ext"></div>
    </div>

    <script>

        if (window.Raven) {
          if (1||Math.floor(Math.random()*2)) {
            Raven.config('http://key@m.toutiao.com/log/sentry/v2/51', {
              whitelistUrls: [/pstatp\.com/]
            }).install();
          }
        }

        window.globals = window.globals || {};

        taAnalysis && taAnalysis.setup({
          c: 'detail_article'
        });
        taAnalysis && taAnalysis.send('pageview', {});

        var antiPVHandler = utils.on(window, 'scroll', function(e) {
          taAnalysis && taAnalysis.send('antipageview', {});
          utils.off(window, 'scroll', antiPVHandler);
        });

        window.gaqpush = function (ga_action, ga_label){
            ga('send', 'event','detail_article' , ga_action, ga_label);
        };

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        // ga('create', 'UA-28423340-5', 'auto');
        ga('create', 'UA-28423340-5', 'auto', {'sampleRate': 10});
        ga('send', 'pageview');

        utils.on(document.getElementsByTagName('body')[0], 'click', function(e) {
            var target = utils.getTarget(e),
                ga_event,
                ga_category,
                ga_label,
                ga_value;

            while(target && target.nodeName.toUpperCase() !== 'BODY') {
                ga_event = utils.getAttribute(target, 'ga_event');
                ga_category = utils.getAttribute(target, 'ga_category') || 'detail_article';
                ga_label = utils.getAttribute(target, 'ga_label');
                ga_value = utils.getAttribute(target, 'ga_value') || 1;

                ga_event && ga('send', 'event', ga_category, ga_event, ga_label, ga_value);
                ga_event && taAnalysis && taAnalysis.send('event', { ev: ga_event });
                target = target.parentNode;
            }
        });

        riot.observable(window);
    </script>
    <script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/toutiao.web.toutiao_pc-pc-fe_switch.js.下载"></script>
    <script>
      var PAGE_SWITCH = window['toutiao.web.toutiao_pc/pc/fe_switch'] || {};
    </script>
    

<script>
  // 用户信息
  var userInfo = {
      id: 7170056853,
      name: '东北小凤凰',
      avatarUrl: 'http://p0.pstatp.com/origin/3791/5070639578',
      isPgc: false,
      isOwner: false
  };


  var group = {
  	id: '6400837860714381569',
    item_id: '6400846986014097921',
  	repin:0,
  };

  var media = {
    user_id: 5858481053,
  	id:5858481053,
  	like:true
  };

  var siblingList = [{"comments_count":30710,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u8fd9\u662f\u53f2\u4e0a\u6700\u9738\u6c14\u7684\u6b66\u4fa0\u6b4c\uff0c\u81f3\u4eca\u65e0\u4eba\u6562\u7ffb\u5531\uff0c\u5468\u534e\u5065\u90fd\u6ca1\u6562\u5531\u7b2c\u4e8c\u904d","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"04:39","source_url":"\/group\/6301896049099276802\/","source":"\u679c\u9171\u97f3\u4e50","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":3718529,"image_url":"http:\/\/p9.pstatp.com\/list\/190x124\/91200121a73f2d17596","group_id":"6301896049099276802","media_url":"\/c\/user\/5361077151\/"},{"comments_count":4030,"media_avatar_url":"http:\/\/p1.pstatp.com\/large\/41200090a851ec72824","is_feed_ad":false,"is_diversion_page":false,"title":"\u4ee4\u4eba\u6f78\u7136\u6cea\u4e0b\u7684\u6bdb\u4e3b\u5e2d\u665a\u5e74\u73cd\u8d35\u89c6\u9891\u7247\u6bb5\uff01","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"15:51","source_url":"\/group\/6285565183569953282\/","source":"\u8bfb\u53f2\u5de5\u4f5c\u5ba4","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":1608496,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/587000e7e0607a56350","group_id":"6285565183569953282","is_related":true,"media_url":"\/c\/user\/6379015356\/"},{"comments_count":3022,"media_avatar_url":"http:\/\/p3.pstatp.com\/large\/16aa00080aeb1ad82e8e","is_feed_ad":false,"is_diversion_page":false,"title":"\u5468\u661f\u9a70\u5e26\u9648\u767e\u7965\u6284\u9ccc\u62dc\u7684\u5bb6\uff01\u8fd9\u4e00\u6bb5\u6211\u770b\u4e8610\u904d\uff0c\u6c38\u8fdc\u4e0d\u4f1a\u89c9\u5f97\u817b","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"03:23","source_url":"\/group\/6419898683222917634\/","source":"\u5317\u57ce\u6545\u4e8b","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":4532056,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/1f8e00049f3cae36ef02","group_id":"6419898683222917634","is_related":true,"media_url":"\/c\/user\/55757148500\/"},{"comments_count":9752,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u611f\u52a8\u4e0a\u4ebf\u4eba\u7684\u89c6\u9891","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"02:45","source_url":"\/group\/6278575020214632705\/","source":"\u7279\u4e8b\u513f","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":2053298,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/52e0007380789757f88","group_id":"6278575020214632705","media_url":"\/c\/user\/6172603992\/"},{"comments_count":17060,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u89c6\u9891\uff5c\u9996\u98de\u5706\u6ee1\u6210\u529f\uff01C919\u5b89\u5168\u8fd4\u822a\u7740\u9646\uff01","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"00:31","source_url":"\/group\/6416547664435822850\/","source":"\u6211\u5728\u73b0\u573a","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":4688086,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/1f7b000585cf25a5674e","group_id":"6416547664435822850","media_url":"\/c\/user\/5768104188\/"},{"comments_count":18985,"media_avatar_url":"http:\/\/p3.pstatp.com\/large\/97d0009ab4a8573a78c","is_feed_ad":false,"is_diversion_page":false,"title":"\u53ea\u6709\u8fd9\u4e00\u4e2a\u56fd\u5bb6\u7684\u4eba\uff0c\u603b\u662f\u770b\u4e0d\u8d77\u4e2d\u56fd\u4eba","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"03:48","source_url":"\/group\/6310427020909461762\/","source":"\u5b66\u59d0\u8bb2\u7b11\u8bdd","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":4033479,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/b0a000165e4960b9098","group_id":"6310427020909461762","is_related":true,"media_url":"\/c\/user\/6103330032\/"},{"comments_count":5492,"media_avatar_url":"http:\/\/p1.pstatp.com\/large\/e580012acf921174e09","is_feed_ad":false,"is_diversion_page":false,"title":"\u5973\u9500\u552e\u5e26\u5ba2\u6237\u8bd5\u9a7e\u5b9d\u9a6cM4\uff0c\u6253\u5f00\u540e\u5907\u7bb1\u624d\u77e5\u9053\u8fd9\u8f86\u8f66\u6709\u591a\u9738\u6c14","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"02:44","source_url":"\/group\/6417381897692774914\/","source":"\u6c7d\u8f66\u5947\u8469\u8bf4","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":7773630,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/1f800002c2e910836b41","group_id":"6417381897692774914","is_related":true,"media_url":"\/c\/user\/6908066048\/"},{"comments_count":5845,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u8361\u6c14\u56de\u80a0\u2014\u2014\u6731\u9555\u57fa\u8b66\u544a\u53f0\u6e7e\uff0c\u9738\u6c14\u5916\u9732\uff0c\u9707\u64bc\u89c6\u9891","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"05:36","source_url":"\/group\/6287386255973941761\/","source":"\u6885\u6c0f\u7f51","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":2574820,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/58700119cf78a31f7ad","group_id":"6287386255973941761","media_url":"\/c\/user\/6118756777\/"},{"comments_count":4455,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u5927\u56fd\u603b\u7406\u98ce\u91c7\uff0c\u6731\u9555\u57fa\u667a\u8005\u98ce\u8303\uff01\u9738\u6c14\u593a\u56de\u4e86\u6cf1\u6cf1\u5927\u56fd\u5e94\u6709\u7684\u5730\u4f4d\uff01","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"05:32","source_url":"\/group\/6293820981433598465\/","source":"\u519b\u9012","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":5415956,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/71b000b0a2ceaa7f34a","group_id":"6293820981433598465","media_url":"\/c\/user\/5715302584\/"},{"comments_count":15295,"media_avatar_url":"http:\/\/p3.pstatp.com\/large\/78f0012156f131df6ea","is_feed_ad":false,"is_diversion_page":false,"title":"\u6b66\u5f53\u5c71\u4e0a\u89c1\u9ad8\u4eba\uff1a\u4e0d\u8981\u5f55\u4e86\uff0c\u4e0d\u8981\u9f13\u638c\uff0c\u8ba9\u6211\u5e08\u7236\u77e5\u9053\u4e86\u8981\u9a82\u6211","single_mode":true,"gallary_image_count":1,"middle_mode":true,"has_video":true,"video_duration_str":"00:28","source_url":"\/group\/6315168461911753218\/","source":"\u4e2d\u534e\u4eba\u624d\u7f51","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":3078489,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/ba200069237fb745eb5","group_id":"6315168461911753218","is_related":true,"media_url":"\/c\/user\/6637306187\/"},{"comments_count":12615,"media_avatar_url":"http:\/\/p9.pstatp.com\/large\/412000fd84239b05896","is_feed_ad":false,"is_diversion_page":false,"title":"\u4e2d\u56fd\u518d\u4e00\u6b21\u8fd0\u8f93\u51e0\u5343\u5428\u8d85\u5927\u578b\u7269\u4ef6\uff0c\u4ee4\u4eba\u4e0d\u5f97\u4e0d\u670d\uff01","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"07:50","source_url":"\/group\/6297380257179632129\/","source":"\u79d1\u6280\u98de\u8dc3","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":4436507,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/71b00145ae8515153cf","group_id":"6297380257179632129","is_related":true,"media_url":"\/c\/user\/6343888899\/"},{"comments_count":54177,"media_avatar_url":"http:\/\/p3.pstatp.com\/large\/78f000884cf40203ac4","is_feed_ad":false,"is_diversion_page":false,"title":"\u4e2d\u56fd\u4eba\u662f\u4e0d\u53ef\u6218\u80dc\u7684","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"04:48","source_url":"\/group\/6300007771311964674\/","source":"\u4fe1\u4ef0\u7684\u5c0a\u8d35","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":4186283,"image_url":"http:\/\/p3.pstatp.com\/list\/190x124\/90e0009ce8d0c4c8945","group_id":"6300007771311964674","is_related":true,"media_url":"\/c\/user\/3607688975\/"},{"comments_count":5867,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u6e38\u5ba2\u83ab\u65af\u79d1\u5927\u8857\u9047\u4e2d\u56fd\u519b\u961f\uff0c\u6025\u5fd9\u62cd\u4e0b\u4e86\u8ba9\u56fd\u4eba\u81ea\u8c6a\u7684\u4e00\u5e55","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"00:26","source_url":"\/group\/6297085055915262465\/","source":"\u73af\u7403\u77ad\u671b","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":2732835,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/71b0013c8d109f0675d","group_id":"6297085055915262465","media_url":"\/c\/user\/6168745171\/"},{"comments_count":8472,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u5386\u6b21\u6700\u7ecf\u5178\u7684\u9605\u5175\u5288\u67aa\u526a\u8f91\uff0c\u5c31\u662f\u8fd9\u4e48\u5e05!","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"05:09","source_url":"\/group\/6297133759103762945\/","source":"\u8d81\u5e74\u8f7b\u53bb\u65c5\u6e38","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":2066581,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/7fc00040d3c2a0b0518","group_id":"6297133759103762945","media_url":"\/c\/user\/5968864396\/"},{"comments_count":14982,"media_avatar_url":"http:\/\/p3.pstatp.com\/large\/412001cab64ab5336ff","is_feed_ad":false,"is_diversion_page":false,"title":"\u4e00\u770b\u5c31\u77e5\u9053\u662f\u6709\u6545\u4e8b\u7684\u5973\u4eba","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"00:34","source_url":"\/group\/6297671902143971842\/","source":"\u7f8e\u7f8e\u7433\u8fbe","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":5024512,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/91100011c200a512586","group_id":"6297671902143971842","is_related":true,"media_url":"\/c\/user\/6639868274\/"},{"comments_count":19425,"is_related":true,"is_feed_ad":false,"is_diversion_page":false,"title":"\u7a7a\u519b\u4e0a\u6821\u6234\u65ed\uff1a\u7f8e\u56fd\u82e5\u51fa\u5175\u9493\u9c7c\u5c9b\uff0c\u4e2d\u56fd\u5c31\u80fd\u5c06\u5176\u6253\u6210\u7638\u5b50\uff01","single_mode":true,"gallary_image_count":0,"middle_mode":true,"has_video":true,"video_duration_str":"04:36","source_url":"\/group\/6303895854969258497\/","source":"\u795e\u7ecf\u75c5\u601d\u7ef4","more_mode":null,"article_genre":"video","has_gallery":false,"video_play_count":7677931,"image_url":"http:\/\/p1.pstatp.com\/list\/190x124\/9aa000579a600df1755","group_id":"6303895854969258497","media_url":"\/c\/user\/4706687481\/"}];
</script>

<script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/article_07b03ea.js.下载"></script>

<script>
  riot.mount('wtopbar', {
    home: false,
    userInfo: userInfo
  });
  riot.mount('login');
  riot.mount('wsearch');
</script>

<script>
  riot.mount('snsbox',{
    share_url:"http://www.toutiao.com/item/6400846986014097921/",
    abstract:"一、缓存穿透预防及优化缓存穿透是指查询一个根本不存在的数据，缓存层和存储层都不会命中，但是出于容错的考虑，如果从存储层查不到数据则不写入缓存层，如图 11-3 所示整个过程分为如下 3 步：缓存层不命中存储层不命中，所以不将空结果写回缓存返回空结果缓存穿透将导致不存在的数据每次请".replace(/<br \/>/ig, ''),
    group_id:"6400837860714381569",
    comments_count: utils.numFormat('5', 1, 'en'),
    fix: true
  });
  riot.mount('hotVideo');
  riot.mount('hotPicture');
  riot.mount('feedback');
</script>

<script>
  riot.mount('comment', {
    group_id: '6400837860714381569',
    item_id: '6400846986014097921' || '',
    comments_count: utils.numCutByComma('5'),
    userInfo: userInfo,
    ban_comment: 0 + 0
  });
</script>

<script>
  riot.mount('relatedChannel', {
    tag: '__all__'
  });
</script>
<script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/tt-video.js.下载" charset="utf-8" crossorigin="anonymous"></script>
<script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/video_a99722f.js.下载" crossorigin="anonymous"></script>
<!--[if lt IE 9]>
  <script src="//s3.pstatp.com/toutiao/resource/ntoutiao_web/page/detail/article_detail/article_main/audio/audio_ie8_8f6ccc5.js" charset="utf-8"></script>
<![endif]-->
<script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/audio_a4dce16.js.下载" crossorigin="anonymous"></script>
<script type="text/javascript">
window.jsblock=function(){
  setTimeout(function () {
    window._czc && _czc.push(['_trackEvent', 'jsblock', 'article', 'block', 1, ''])
  }, 1500);
}
</script>
<script>
  ;(function(win) {
    var picVersion = win.PAGE_SWITCH && win.PAGE_SWITCH.picVersion;
    if (!picVersion) {
      var d = new Date();
      picVersion = d.getFullYear() + '' + (d.getMonth() + 1) + '' + d.getDate() + '_01';
    }
    var url = '//s3a.pstatp.com/toutiao/gallery_img/dist/img.min.js?ver=' + picVersion;
    window.utils && window.utils.loadScript(url, function() {
      setTimeout(function() {
        window.trigger('ad_put');
      });
    }, function() {
      return window.jsblock();
    });
  })(window);
</script><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/img.min.js.下载" crossorigin="anonymous"></script>
<script>
  var TT_PERF_CONFIG = {
      metrics: true,
      percent: 20
  };
</script>
<script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/ta.js.下载"></script>

    <script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/z_stat.php" language="JavaScript"></script><script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1259612802" target="_blank" title="站长统计">站长统计</a>
    <script src="./Redis架构之防雪崩设计：网站不宕机背后的兵法 - 今日头条(www.toutiao.com)_files/promotion_c49e139.js.下载"></script>
    <script>
      var is360 = window.uaCheck && window.uaCheck.is360se();
      var isShowed = window.localStorage && window.localStorage.getItem('is_ext_pop_showed');
      var isInstalled = window.sessionStorage && window.sessionStorage.getItem('is_ext_installed');
      if (is360 && isShowed !== '1' && isInstalled !== '1') {
        window.riot && riot.mount('#promotion-ext', 'promotion');
      }
    </script>


</body></html>