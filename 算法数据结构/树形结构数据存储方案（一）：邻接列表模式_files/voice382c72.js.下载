define("pages/report.js",["biz_wap/utils/ajax.js","pages/version4video.js"],function(e){
"use strict";
function i(e){
var i=["/mp/pagereport?type=","undefined"==typeof e.type?1:e.type,"&comment_id=",e.comment_id||"","&voiceid=",e.voiceid||"","&action=",e.action,"&__biz=",top.window.biz||"","&mid=",top.window.mid||"","&idx=",top.window.idx||"","&uin=",top.window.uin||"","&key=",top.window.key||"","&pass_ticket=",top.window.pass_ticket||"","&t=",Math.random(),"#wechat_redirect"].join(""),t=new Image;
t.src=i;
}
function t(e){
_({
type:"POST",
url:"/mp/videoreport?#wechat_redirect",
timeout:2e4,
async:!1,
data:e.data
});
}
function o(e){
var i=JSON.parse(JSON.stringify(e.data));
i.musicid=i.musicid.join(";"),i.hasended=i.hasended.join(";"),i.commentid=i.commentid.join(";"),
i.mtitle=i.mtitle.join(";#"),i.detail_click=i.detail_click.join(";"),i.duration=i.duration.join(";"),
i.errorcode=i.errorcode.join(";"),i.play_duration=i.play_duration.join(";"),_({
type:"POST",
url:"/mp/musicreport?#wechat_redirect",
timeout:2e4,
async:!1,
data:i
});
}
function n(e){
document.domain="qq.com";
var i=window.cgiData&&window.cgiData.txvideo_openid?window.cgiData.txvideo_openid:"",t=encodeURIComponent(top.window.location.href.replace(/(\?|&)(key|uin)=([\S\s]*?)(&|$)/g,"$1").replace(/&$/,"")),o=["http://btrace.qq.com/kvcollect?BossId=2973&Pwd=1557019983&step=1009&vid=","undefined"!=typeof e.vid?e.vid:"","&platform=",a(),"&val=","undefined"!=typeof e.val?e.val:"","&val1=","undefined"!=typeof e.val1?e.val1:"","&vurl=",encodeURIComponent(e.vurl),"&t=",Math.random(),"&url=",t,"&wx_openid=",i].join(""),n=new Image;
n.src=o.substr(0,1024);
}
function d(e){
if(3==e.step||6==e.step||1999==e.step){
document.domain="qq.com";
var i=window.cgiData&&window.cgiData.txvideo_openid?window.cgiData.txvideo_openid:"",t=encodeURIComponent(top.window.location.href.replace(/(\?|&)(key|uin)=([\S\s]*?)(&|$)/g,"$1").replace(/&$/,"")),o=["http://btrace.qq.com/kvcollect?BossId=2973&Pwd=1557019983&step=",e.step,"&vid=","undefined"!=typeof e.vid?e.vid:"","&platform=",a(),"&loadwait=","undefined"!=typeof e.loadwait?e.loadwait:"","&val=","undefined"!=typeof e.val?e.val:"","&t=",Math.random(),"&url=",t,"undefined"!=typeof e.vt&&""!==e.vt&&6==e.step?"&vt="+e.vt:"","&wx_openid=",i].join(""),n=new Image;
n.src=o.substr(0,1024);
}
}
function a(){
var e=s.device;
return e.ipad?60101:e.is_android_phone?60301:e.iphone?60401:e.is_android_tablet?60501:"";
}
function r(){
var e=s.device;
return e.ipad?"v4010":e.is_android_phone&&s.isUseProxy()?"v5060":e.is_android_phone?"v5060":e.iphone&&s.isUseProxy()?"v3060":e.iphone?"v3060":e.is_android_tablet?"v6010":"";
}
function p(e){
var i={
mid:window.mid||"",
__biz:window.biz||"",
idx:window.idx||"",
musicid:[],
hasended:[],
commentid:[],
scene_type:e.type||0,
mtitle:[],
detail_click:[],
app_btn_kv:0,
app_btn_click:0,
app_btn_type:0,
duration:[],
play_duration:[],
errorcode:[]
};
return i;
}
function c(){
var e={
videoerror:0,
like_kv_vid:"",
like_click_vid:"",
like_kv_alginfo:"",
like_click_alginfo:"",
tad:"",
page:0,
like_click_type:0,
iplat:2,
ptype:1,
rtype:"",
getvinfo_ret:-1,
getvinfo_time:0,
v_err_code:0,
loadwait:0,
hasended:0,
last_ms:0,
duration_ms:0,
app_btn_kv:0,
app_btn_click:0,
app_btn_type:0,
mid:"",
__biz:"",
idx:"",
detail_click:0,
vtitle:"",
vid:"",
commentid:"",
scene_type:"",
replay:0,
full_screen:0,
quick_play:0,
ad_play_time:-1,
video_play_time:-1,
click_play_button:0,
traceid:"",
webviewid:"",
orderid:0,
play_time:0,
client_time_when_play:0,
drag_times:"",
pause_num:0,
h5_profile:0,
to_article:0,
desc_more_click:0,
desc_more_show:0,
fromid:0,
openid:window.cgiData&&window.cgiData.txvideo_openid?window.cgiData.txvideo_openid:"",
file_size:0,
rate:0,
resolution:0,
format:"",
vt:"",
video_ext:"unknown"
};
return e;
}
function l(e,i,t){
var o=0,n=[],d={};
if(i&&"[object String]"==Object.prototype.toString.call(i))o=1,"img"==t&&(i=encodeURIComponent(i)),
n.push("log0="+i),d.log0=i;else if(i&&"[object Array]"==Object.prototype.toString.call(i)){
o=i.length;
for(var a=0;o>a;a++){
var r="img"==t?encodeURIComponent(i[a]):i[a];
n.push("log"+a+"="+r),d["log"+a]=r;
}
}
if("img"==t){
var p=new Image,c="//mp.weixin.qq.com/mp/jsmonitor?idkey="+e;
o>0&&(c+="&lc="+o+"&"+n.join("&")),c+="&t="+Math.random(),p.src=c;
}else{
var l={};
o>0&&(l=d),l.idkey=e,l.lc=o,cgi.post({
url:"//mp.weixin.qq.com/mp/jsmonitor?",
data:l,
dataType:"json"
});
}
}
var _=e("biz_wap/utils/ajax.js"),s=e("pages/version4video.js");
return{
report:i,
videoreport:t,
getPlatformType:a,
getsdtfrom:r,
getinfoReport:n,
qqvideo_common_report:d,
musicreport:o,
getMusicReportData:p,
getVideoReportData:c,
logReport:l
};
});define("pages/music_player.js",["biz_wap/utils/mmversion.js","pages/report.js","biz_common/dom/event.js","biz_wap/jsapi/core.js","pages/version4video.js","biz_common/utils/monitor.js"],function(t){
"use strict";
function e(t){
this._o={
wxIndex:0,
type:0,
src:"",
jsapi2Src:"",
mid:"",
songId:"",
autoPlay:!1,
duration:0,
needVioceMutex:!0,
title:"",
allowPause:!1,
singer:"",
epname:"",
coverImgUrl:"",
webUrl:"",
fileSize:0,
onStatusChange:function(){},
onTimeupdate:function(){},
onError:function(){},
onUpdateSeekRange:function(){}
},this._extend(t),this._status=-1,this._g={
mutexKey:"",
jsapiSrcId:"",
hasCheckPlay:!1,
playTimeoutId:null,
stateChangeCallback:{},
hasInitH5Event:!1,
h5Event:{}
},this._fixAndroidSizeLimit(),0!==j.surportType&&(this._initData(),this._synPlayStatus());
}
function o(t){
w.invoke("musicPlay",{
app_id:"a",
title:"微信公众平台",
singer:"微信公众平台",
epname:"微信公众平台",
coverImgUrl:"http://res.wx.qq.com/mpres/htmledition/images/favicon.ico",
dataUrl:j.ev,
lowbandUrl:j.ev,
webUrl:"http://mp.weixin.qq.com/s?"
},function(e){
"function"==typeof t&&t(e);
});
}
function i(t){
a({
cur:t,
stopCur:!1
});
}
function a(t){
function e(){
if(j.mutexCount==s&&(s=0,j.mutexCount=0,"function"==typeof n)){
var t=0;
1==j.surportType?t=2e3:3==j.surportType&&(t=0),setTimeout(function(){
n();
},t);
}
}
if(0!=j.mutexCount)return void setTimeout(function(){
a(t);
},200);
var o=t.cur,i=t.stopCur===!0?!0:!1,n=t.callback,s=0;
for(var r in j.mutexPlayers)for(var u=0,p=j.mutexPlayers[r].length;p>u;u++)s++;
for(var r in j.mutexPlayers)for(var u=0,p=j.mutexPlayers[r].length;p>u;u++){
var _=j.mutexPlayers[r][u];
if(_&&_!==o){
var c=_.getSurportType(),d="";
2!=c||1!=_._status&&4!=_._status?1!=c&&3!=c||1!=_._status&&2!=_._status&&4!=_._status||(d="stop"):d=_._o.allowPause?"pause":"stop",
d&&"function"==typeof _[d]?_[d](i,function(){
j.mutexCount++,e();
}):(j.mutexCount++,e());
}else j.mutexCount++,e();
}
}
function n(){
return j.surportType;
}
function s(t){
return new e(t);
}
function r(){
j.surportType>0&&j.isAndroidLow&&window.addEventListener("canplay",function(t){
t.target&&"function"==typeof t.target.play&&t.target.play();
},!0);
}
function u(){
j.jsapiGlobalEvent={
error:c,
pause:h,
stop:d,
play:l,
preempted:d,
waiting:y
};
}
function p(t){
return"&"+j.wxtag+"="+t;
}
function _(){
w.on("onBackgroundAudioStateChange",function(t){
if(!!j.debug&&console.log("onBackgroundAudioStateChange log:"+JSON.stringify(t||{})),
t.src&&t.state){
var e=S(j.wxtag,t.src)||"";
e&&(e=p(e));
var o=j.mutexPlayers[t.src]||j.mutexPlayers2[t.src]||j.mutexPlayers[e];
if(o){
var i;
if(t.srcId)for(var a=0,n=o.length;n>a;a++)o[a]._g.jsapiSrcId==t.srcId&&(i=o[a]);else if(1==o.length)i=o[0];else for(var a=0,n=o.length;n>a;a++)if(-1!=o[a]._status&&0!=o[a]._status&&3!=o[a]._status){
i=o[a];
break;
}
if(i&&i._g.stateChangeCallback){
var s=t.state;
"ended"==s&&(s="stop"),"wait"==s&&(s="waiting");
var r=!1;
if("error"==s)for(var u in i._g.stateChangeCallback)i._g.stateChangeCallback.hasOwnProperty(u)&&"function"==typeof i._g.stateChangeCallback[u]&&(r=!0,
i._g.stateChangeCallback[u](-1,t.errMsg||""),i._g.stateChangeCallback[u]=null);else"function"==typeof i._g.stateChangeCallback[s]&&(j.debug&&console.log("excute stateChangeCallback :"+s),
r=!0,i._g.stateChangeCallback[s](0),i._g.stateChangeCallback[s]=null);
r||"function"!=typeof j.jsapiGlobalEvent[s]||j.jsapiGlobalEvent[s](t,i);
}
}
}
});
}
function c(t,e){
if(e.stop(!1),v(e._o.type,"wx_err_2",1),e._o.jsapi2Src&&e._o.jsapi2Src!=e._o.src){
var o="acc_ing_error;type:#type#;uin:"+(top.window.uin||"");
j.isAndroid?(A.logReport("",o.replace("#type#","android"),"img"),v(-1,"android_aac_err_2",1)):(A.logReport("",o.replace("#type#","ios"),"img"),
v(-1,"ios_aac_err_2",1));
}
}
function d(t,e){
e.stop(!1);
}
function h(t,e){
e.pause(!1,null,!0);
}
function l(t,e){
1!=e._status&&e.resume(!1,null,!0);
}
function y(t,e){
e.onload();
}
function f(){
for(var t=j.reportId.split(";"),e=0,o=t.length;o>e;e++)for(var i=t[e],a=j.keyConf[e],n=0,s=0,r=a.length;r>s;s++){
var u=a[s]||"";
u?/^offset_/.test(u)?n+=1*u.replace(/^offset_/,""):(j.reportData[u]={
id:i,
key:n,
count:0
},n++):n++;
}
}
function g(){
for(var t in j.mutexPlayers)if(j.mutexPlayers.hasOwnProperty(t))for(var e=0,o=j.mutexPlayers[t].length;o>e;e++){
var i=j.mutexPlayers[t][e];
if(i&&1==i._status&&(1==i._surportType||3==i._surportType)){
v(i._o.type,"unload_wx_pv",1);
break;
}
}
m();
}
function m(){
for(var t in j.reportData){
var e=j.reportData[t];
e.count>0&&b.setSum(e.id,e.key,e.count);
}
b.send(),f();
}
function v(t,e,o){
0==t||1==t?e="m_"+e:(2==t||3==t||4==t)&&(e="v_"+e),j.reportData[e]&&(o=o||1,j.reportData[e].count+=o,
j.debug&&console.log("addpv:"+e+" count:"+j.reportData[e].count));
}
function S(t){
var e=arguments[1]||window.location.search,o=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=e.substr(e.indexOf("?")+1).match(o);
return null!=i?i[2]:"";
}
function T(t,e,o){
function i(t,e){
for(;j.synPlayStatusArr.length>0;){
var o=j.synPlayStatusArr.shift();
o&&"function"==typeof o[t]&&o[t](e);
}
}
j.synPlayStatusArr.push({
_t:t,
onSuccess:e,
onError:o
}),j.synPlayStatusId&&clearTimeout(j.synPlayStatusId),j.synPlayStatusId=setTimeout(function(){
t._jsapi_getMusicPlayerState({
onSuccess:function(t){
i("onSuccess",t);
},
onError:function(t){
i("onError",t);
}
});
},0);
}
document.domain="qq.com";
var P=t("biz_wap/utils/mmversion.js"),A=t("pages/report.js"),x=t("biz_common/dom/event.js"),w=t("biz_wap/jsapi/core.js"),k=t("pages/version4video.js"),b=t("biz_common/utils/monitor.js"),j={
synPlayStatusId:null,
synPlayStatusArr:[],
inWechat:!k.device.inWechat||k.device.inWindowWechat||k.device.inMacWechat?!1:!0,
mutexCount:0,
ev:0!=window._empty_v.indexOf(window.location.protocol)?"http:"+window._empty_v:window._empty_v,
debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1?!0:!1,
_playtype:1*S("_playtype")||0,
isAndroidLow:/android\s2\.3/i.test(navigator.userAgent),
isAndroid:P.isAndroid,
surportType:"addEventListener"in window?2:0,
mutexPlayers:{},
mutexPlayers2:{},
reportId:"28306",
wxtag:"__wxtag__",
keyConf:[["m_pv","m_wx_pv","m_h5_pv","m_unload_wx_pv","v_pv","v_wx_pv","v_h5_pv","v_unload_wx_pv","offset_22","force_h5","m_h5_err_total","m_h5_err_1","m_h5_err_2","m_h5_err_3","m_h5_err_4","m_h5_err_5","v_h5_err_total","v_h5_err_1","v_h5_err_2","v_h5_err_3","v_h5_err_4","v_h5_err_5","m_wx_pv_2","v_wx_pv_2","offset_5","m_wx_pv_1","offset_4","v_wx_pv_1","offset_2","m_wx_err_1","m_wx_err_2","v_wx_err_1","v_wx_err_2","offset_42","aac_pv","offset_1","ios_aac_err_1","offset_1","ios_aac_err_2","offset_1","android_aac_err_1","offset_1","android_aac_err_2","offset_1","v_seek_err"]],
reportData:{}
};
return f(),u(),_(),x.on(window,"unload",g),r(),e.prototype._synPlayStatus=function(){
function t(t){
if(n&&clearTimeout(n),a.hasCheckPlay!==!0&&(a.hasCheckPlay=!0,o._surportType=3,j.surportType=3,
!!j.debug&&console.log("_synPlayStatus mutexKey:"+a.mutexKey),t.src&&(i.src==t.src||t.src.indexOf(a.mutexKey)>=0))){
if(t.srcId){
if(t.srcId!=a.jsapiSrcId)return;
}else if(j.mutexPlayers[a.mutexKey].length>1&&j.mutexPlayers[a.mutexKey][0]!==o)return;
o._initJsapiData({
curTime:t.currentTime,
bufferedPercent:t.bufferedPercent,
starTime:+new Date-1e3*t.currentTime
}),v(i.type,"pv",1),v(i.type,"wx_pv",1),v(i.type,"wx_pv_2",1);
var e=o.jsApiData;
t.paused?(e.pauseTime=e.starTime+1e3*e.curTime,o._onPause(),o._onTimeupdate(null,e.curTime)):(o._onPlay(),
o._analogUpdateTime()),o._getMusicPlayerState();
}
}
function e(){
n&&clearTimeout(n),a.hasCheckPlay!==!0&&(a.hasCheckPlay=!0,o._o.autoPlay&&o.play());
}
var o=this,i=this._o,a=this._g;
if(!j.inWechat||1*j._playtype>0)return a.hasCheckPlay=!0,void(o._o.autoPlay&&o.play());
var n;
T(o,t,e),n=setTimeout(function(){
e();
},5e3);
},e.prototype._fixAndroidSizeLimit=function(){
if(!(1*j._playtype>0)&&j.isAndroid){
var t=this._o;
!t.fileSize||t.fileSize>300||P.gtVersion("6.3.28",!0)||(v(-1,"force_h5",1),this._g._playtype=2);
}
},e.prototype._createAutoAndPlay=function(){
function t(){
v(e._o.type,"pv",1),v(e._o.type,"h5_pv",1),e._h5Audio=document.createElement("audio"),
e._initH5Data(!0),e._H5bindEvent(!0),e._h5Audio.setAttribute("style","height:0;width:0;display:none"),
e._h5Audio.setAttribute("autoplay",""),e._status=0,e._onLoading(),j.isAndroidLow?(e._h5Audio.src=e._o.src,
document.body.appendChild(e._h5Audio),e._h5Audio.load()):(document.body.appendChild(e._h5Audio),
setTimeout(function(){
e._h5Audio.src=e._o.src,e._h5Audio.play();
},0)),e._surportType=2;
}
var e=this;
j.inWechat?this._stopJsapiPlay(!0,function(){
t();
}):t();
},e.prototype._destoryH5Audio=function(){
this._h5Audio&&(-1!=this._status&&"function"==typeof this._h5Audio.pause&&this._h5Audio.pause(),
document.body.removeChild(this._h5Audio),this._h5Audio=null,this._status=-1);
},e.prototype._onLoading=function(t){
this._status=4;
try{
i(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status);
},e.prototype._onPlay=function(t){
this._status=1;
try{
i(this);
}catch(t){}
"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status);
},e.prototype._onPause=function(t){
this._status=2,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status);
},e.prototype._onEnd=function(t){
this._status=3,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status);
},e.prototype._onLoadedmetadata=function(t){
"function"==typeof this._o.onLoadedmetadata&&this._o.onLoadedmetadata.call(this,t||{});
},e.prototype._onUpdateSeekRange=function(t){
this.surportSeekRange()&&(t=Math.max(t,0),t=Math.min(t,100),"function"==typeof this._o.onUpdateSeekRange&&this._o.onUpdateSeekRange.call(this,t));
},e.prototype._onTimeupdate=function(t,e){
"function"==typeof this._o.onTimeupdate&&this._o.onTimeupdate.call(this,t||{},e);
},e.prototype._onError=function(t,e){
this._status=-1,"function"==typeof this._o.onError&&this._o.onError.call(this,t||{},e);
},e.prototype._initH5Event=function(){
var t=this,e=this._o,o=this._g;
if(!t._g.hasInitH5Event){
t._g.hasInitH5Event=!0;
var i=o.h5Event;
i.canplaythrough=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 canplaythrough"),t._h5Data.firstCanplaythrough=!0,
t._onPlay(e),t._onUpdateSeekRange(t._h5Data.downloadDuration||0));
},i.play=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 "+e.type),t._h5Data.firstCanplaythrough===!0&&(t._onPlay(e),
t._onUpdateSeekRange(t._h5Data.downloadDuration||0)));
},i.ended=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 ended"),t._onUpdateSeekRange(t._h5Data.downloadDuration),
t._onEnd(e));
},i.pause=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 pause"),t._o.allowPause!==!0||0==t._h5Audio.currentTime?t._onEnd(e):t._onPause(e));
},i.waiting=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 "+e.type),(1==t._status||2==t._status||4==t._status)&&t._onLoading(e));
},i.seeked=function(e){
t._h5Audio&&(!!j.debug&&console.log("h5 seeked"),(1==t._status||2==t._status||4==t._status)&&(t._onPlay(e),
t._h5Audio.play()));
},i.error=function(o){
var i=1*o.target.error.code||5;
(1>i||i>5)&&(i=5),v(e.type,"h5_err_total",1),v(e.type,"h5_err_"+i,1),t._onError(o,{
type:1,
code:i
}),t._destoryH5Audio();
},i.timeupdate=function(o){
t._h5Audio&&((1==t._status||4==t._status)&&t._onUpdateSeekRange(t._getH5DownloadDuration()),
1==t._status&&t._onTimeupdate(o,t._h5Audio.currentTime),"undefined"!=typeof e.duration&&1*e.duration>0&&t._h5Audio.currentTime>=e.duration&&t._h5Stop());
},i.loadedmetadata=function(e){
t._h5Audio&&t._onLoadedmetadata(e);
};
}
},e.prototype._H5bindEvent=function(t){
var e=(this._o,this._g),o={
canplaythrough:"canplaythrough",
play:"play",
playing:"play",
ended:"ended",
pause:"pause",
seeking:"waiting",
waiting:"waiting",
seeked:"seeked",
error:"error"
};
try{
for(var i in o)o.hasOwnProperty(i)&&this._h5Audio.removeEventListener(i,e.h5Event[o[i]]);
this._h5Audio.removeEventListener("timeupdate",e.h5Event.timeupdate),this._h5Audio.removeEventListener("loadedmetadata",e.h5Event.loadedmetadata);
}catch(a){}
if(t){
for(var i in o)o.hasOwnProperty(i)&&this._h5Audio.addEventListener(i,e.h5Event[o[i]],!1);
"function"==typeof this._o.onTimeupdate&&this._h5Audio.addEventListener("timeupdate",e.h5Event.timeupdate,!1),
"function"==typeof this._o.onLoadedmetadata&&this._h5Audio.addEventListener("loadedmetadata",e.h5Event.loadedmetadata,!1);
}
},e.prototype._initData=function(){
var t=this._o;
this._createMutexKey(),j.mutexPlayers[this._g.mutexKey]?j.mutexPlayers[this._g.mutexKey].push(this):j.mutexPlayers[this._g.mutexKey]=[this],
t.jsapi2Src&&t.jsapi2Src!=t.src&&(j.mutexPlayers2[t.jsapi2Src]?j.mutexPlayers2[t.jsapi2Src].push(this):j.mutexPlayers2[t.jsapi2Src]=[this]),
this._initH5Event();
},e.prototype._createMutexKey=function(){
var t=this._o.mid||"";
this._o.src?(this._g.mutexKey=this._o.src,this._g.jsapiSrcId=j.wxtag+"_"+this._o.wxIndex):(this._g.mutexKey=p(t),
this._g.jsapiSrcId=this._g.mutexKey+"_"+this._o.wxIndex);
},e.prototype._extend=function(t){
for(var e in t)this._o[e]=t[e];
},e.prototype._initH5Data=function(t){
this._h5Data={
firstCanplaythrough:t===!0?!1:!0,
downloadDuration:0
};
},e.prototype._initJsapiData=function(t){
t=t||{},this.jsApiData&&(this.jsApiData.updateTimeoutId&&clearTimeout(this.jsApiData.updateTimeoutId),
this.jsApiData.getStatusId&&clearTimeout(this.jsApiData.getStatusId)),this.jsApiData={
getStatusId:null,
getStatusTime:t.getStatusTime||2500,
updateTimeoutId:null,
seeking:!1,
starTime:t.starTime||+new Date,
curTime:t.curTime||0,
pauseTime:t.pauseTime||0,
bufferedPercent:t.bufferedPercent||0,
duration:this._o.duration||void 0
};
},e.prototype._getMusicPlayerState=function(){
var t=this,e=t._o,o=t.jsApiData;
o&&o.getStatusId&&clearTimeout(o.getStatusId),t._jsapi_getMusicPlayerState({
onSuccess:function(i){
i.src==e.src&&(o.curTime=i.currentTime,o.starTime=+new Date-1e3*i.currentTime,o.bufferedPercent=i.bufferedPercent,
(1==t._status||2==t._status)&&(o.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},o.getStatusTime)),t._onUpdateSeekRange(o.bufferedPercent),1==i.paused&&1==t._status?(j.debug&&console.log("_getMusicPlayerState force syn"),
t._pauseJsapiPlay(!1)):0==i.paused&&2==t._status&&(j.debug&&console.log("_getMusicPlayerState force syn"),
t._resumeJsapiPlay(!1)));
},
onError:function(){
o.getStatusId=setTimeout(function(){
t._getMusicPlayerState();
},o.getStatusTime);
}
});
},e.prototype._analogUpdateTime=function(){
var t=this,e=t.jsApiData;
if(e&&e.updateTimeoutId&&clearTimeout(e.updateTimeoutId),1==t._status){
if(e.curTime=1*((+new Date-e.starTime)/1e3).toFixed(2),e.curTime>=e.duration)return t._stopJsapiPlay(!1),
!0;
t._onTimeupdate(null,e.curTime);
}
return e.updateTimeoutId=setTimeout(function(){
t._analogUpdateTime();
},1e3),!1;
},e.prototype._jsapi_getMusicPlayerState=function(t){
var e=this._o;
w.invoke("getBackgroundAudioState",{},function(o){
if(!!j.debug&&console.log("getBackgroundAudioState log:"+JSON.stringify(o||{})),
/:ok$/.test(o.err_msg)){
if(o.paused=1*o.paused,o.currentTime=o.currentTime?(1*o.currentTime).toFixed(2):0,
o.buffered){
var i=Math.floor(o.buffered/e.duration*100);
i=Math.max(i,0),i=Math.min(i,100),o.bufferedPercent=i;
}else o.bufferedPercent=0;
"function"==typeof t.onSuccess&&t.onSuccess(o);
}else"function"==typeof t.onError&&t.onError(o);
});
},e.prototype._jsapi_musicPlay=function(t){
if(this._h5Audio&&this._destoryH5Audio(),2==j._playtype)return void("function"==typeof t.onError&&t.onError({}));
var e=this,o=this._o;
w.invoke("musicPlay",{
app_id:"a",
title:o.title,
singer:o.singer,
epname:o.epname,
coverImgUrl:o.coverImgUrl,
dataUrl:o.src,
lowbandUrl:o.src,
webUrl:o.webUrl
},function(i){
!!j.debug&&console.log("playlog:"+JSON.stringify(i||{})),i.err_msg.indexOf("ok")>=0?(v(o.type,"pv",1),
v(o.type,"wx_pv",1),v(o.type,"wx_pv_1",1),e._surportType=1,j.surportType=1,e._initJsapiData(),
e._onPlay(),"undefined"!=typeof o.duration&&1*o.duration>0&&e._analogUpdateTime(),
e._onUpdateSeekRange(0),"function"==typeof t.onSuccess&&t.onSuccess(i)):"function"==typeof t.onError&&t.onError(i);
});
},e.prototype._jsapi_setBackgroundAudioState=function(t){
if(this._h5Audio&&this._destoryH5Audio(),1*j._playtype>0){
if("function"==typeof t.onError){
var e={};
e.err_code=1,t.onError(e);
}
}else{
var o=this,i=this._o,a=o._g;
w.invoke("setBackgroundAudioState",{
src:i.jsapi2Src||i.src,
lowbandUrl:i.jsapi2Src||i.src,
title:i.title,
epname:i.epname,
singer:i.singer,
srcId:a.jsapiSrcId,
coverImgUrl:i.coverImgUrl,
webUrl:i.webUrl
},function(e){
!!j.debug&&console.log("setBackgroundAudioState log:"+JSON.stringify(e||{})),e.err_msg.indexOf("ok")>=0?("function"==typeof t.onSuccess&&t.onSuccess("waiting"),
a.stateChangeCallback.play=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("play"):0!=e&&"function"==typeof t.onError&&t.onError({
err_code:2,
err_msg:o||""
});
}):"function"==typeof t.onError&&(e=e||{},e.err_code=1,t.onError(e));
});
}
},e.prototype._jsapi_operateBackgroundAudio=function(t){
var e=this,o=(this._o,e._g),i=1*t.position||0;
w.invoke("operateBackgroundAudio",{
operationType:t.type,
currentTime:i
},function(e){
if(!!j.debug&&console.log("operateBackgroundAudio "+t.type+",position:"+i+", log:"+JSON.stringify(e||{})),
e.err_msg.indexOf("ok")>=0){
var a=t.type;
"seek"==a?(o.stateChangeCallback.seeking=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeking"):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
},o.stateChangeCallback.seeked=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeked"):0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
}):o.stateChangeCallback[a]=function(e,o){
0==e&&"function"==typeof t.onSuccess?t.onSuccess():0!=e&&"function"==typeof t.onError&&t.onError({
err_msg:o||""
});
};
}else"function"==typeof t.onError&&t.onError(e);
});
},e.prototype._jsapiPlay=function(){
var t=this,e=this._o;
1==j.surportType?this._jsapi_musicPlay({
onError:function(){
t._h5Play();
}
}):this._jsapi_setBackgroundAudioState({
onSuccess:function(o){
"waiting"===o?(v(e.type,"pv",1),v(e.type,"wx_pv",1),v(e.type,"wx_pv_2",1),e.jsapi2Src&&e.jsapi2Src!=e.src&&v(-1,"aac_pv",1),
t._initJsapiData(),t._surportType=3,j.surportType=3,t._onLoading()):"play"===o&&(t._initJsapiData(),
t._onPlay(),"undefined"!=typeof e.duration&&1*e.duration>0&&(t._analogUpdateTime(),
t._getMusicPlayerState()));
},
onError:function(o){
if(o&&1==o.err_code)t._jsapi_musicPlay({
onError:function(){
t._h5Play();
}
});else if(t._h5Play(),v(e.type,"wx_err_1",1),e.jsapi2Src&&e.jsapi2Src!=e.src){
v(-1,"aac_pv",1);
var i="acc_start_error;type:#type#;uin:"+(top.window.uin||"");
j.isAndroid?(A.logReport("",i.replace("#type#","android"),"img"),v(-1,"android_aac_err_1",1)):(A.logReport("",i.replace("#type#","ios"),"img"),
v(-1,"ios_aac_err_1",1));
}
}
});
},e.prototype._getJsapiDownloadSec=function(){
this._getMusicPlayerState();
var t=Math.floor(this._o.duration*this.jsApiData.bufferedPercent/100);
return!!j.debug&&console.log("downloadSec:"+t),t;
},e.prototype._jsapiSeek=function(t){
function e(){
n.seeking=!1,o._onPlay(),n.starTime=+new Date-1e3*s,o._analogUpdateTime(),o._getMusicPlayerState();
}
var o=this,i=this._g,a=this._o,n=this.jsApiData,s=parseInt(t,10);
s>=this._o.duration&&(s=this._o.duration-1),n.getStatusId&&clearTimeout(n.getStatusId),
n.updateTimeoutId&&clearTimeout(n.updateTimeoutId),n.seekWaitId&&clearTimeout(n.seekWaitId),
n.seeking=!0;
var r;
this._jsapi_operateBackgroundAudio({
type:"seek",
position:s,
onError:function(){
v(a.type,"seek_err",1),!!j.debug&&console.log("seek callback fail"),n.seeking=!1,
o._analogUpdateTime(),o._getMusicPlayerState();
},
onSuccess:function(t){
"seeking"==t?(!!j.debug&&console.log("seeking callback success"),n.seeking=!0,o._onLoading(),
i.stateChangeCallback.play=function(){
!!j.debug&&console.log("seeked to play"),r&&clearTimeout(r),e();
}):"seeked"==t&&(!!j.debug&&console.log("seeked callback success"),(2==o._status||4==o._status)&&(r=setTimeout(function(){
!!j.debug&&console.log("setTimeout to play"),i.stateChangeCallback.play=null,o._resumeJsapiPlay(!0);
},1e3)));
}
}),o._getMusicPlayerState();
},e.prototype._resumeJsapiPlay=function(t,e){
function o(t){
var e=i.jsApiData;
e.starTime+=+new Date-e.pauseTime,e.pauseTime=0,i._onPlay(),i._analogUpdateTime(),
i._getMusicPlayerState(),"function"==typeof t&&t();
}
var i=this;
1==this._surportType?this._jsapiPlay():3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"play",
onError:function(){
i._stopJsapiPlay(!1,function(){
i.play();
});
},
onSuccess:function(){
o(e);
}
}):o(e));
},e.prototype._pauseJsapiPlay=function(t,e,o){
function i(t){
var e=a.jsApiData;
1==a._status&&(e.pauseTime=+new Date,a._onPause()),a._analogUpdateTime(),a._getMusicPlayerState(),
e&&e.updateTimeoutId&&clearTimeout(e.updateTimeoutId),e.updateTimeoutId=null,t===!0&&e&&e.getStatusId&&clearTimeout(e.getStatusId);
}
var a=this;
return 2==a._status?(i(e),void("function"==typeof o&&o())):void(1==this._surportType?this._stopJsapiPlay(t,o):3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({
type:"pause",
onSuccess:function(){
i(e),"function"==typeof o&&o();
},
onError:function(){
a._stopJsapiPlay(!0,o);
}
}):(i(e),"function"==typeof o&&o())));
},e.prototype._stopJsapiPlay=function(t,e){
function i(t){
a._initJsapiData(),a._onTimeupdate(null,0),a._onUpdateSeekRange(0),a._onEnd(),"function"==typeof t&&t();
}
{
var a=this;
a.jsApiData;
}
t?1==a._surportType?o(function(){
i(e);
}):a._jsapi_operateBackgroundAudio({
type:"stop",
onSuccess:function(){
i(e);
},
onError:function(){
i(e);
}
}):i(e);
},e.prototype._getH5DownloadSec=function(){
var t=Math.floor(this._o.duration*this._getH5DownloadDuration()/100);
return!!j.debug&&console.log("h5 downloadSec:"+t),t;
},e.prototype._getH5DownloadDuration=function(){
if(!this._h5Audio)return 0;
if(this._h5Data.downloadDuration>=100)return 100;
var t=this._h5Audio.buffered,e=t.end(t.length-1);
return this._h5Data.downloadDuration=parseInt(e/this._o.duration*100,10),this._h5Data.downloadDuration;
},e.prototype._h5Play=function(){
0!==j.surportType&&(this._h5Audio?(this._h5Audio.ended||this._h5Audio.paused)&&(v(this._o.type,"pv",1),
v(this._o.type,"h5_pv",1),this._initH5Data(),this._h5Audio.currentTime=0,this._H5bindEvent(!0),
this._h5Audio.play()):this._createAutoAndPlay());
},e.prototype._h5Resume=function(){
this._h5Audio&&this._h5Audio.play();
},e.prototype._h5Stop=function(){
this._h5Audio&&(this._initH5Data(),this._onUpdateSeekRange(0),this._onEnd(),this._H5bindEvent(!1),
this._h5Audio.currentTime=0,this._h5Audio.pause());
},e.prototype._h5Seek=function(t){
if(this._h5Audio){
var e=(this._h5Data,parseInt(t,10));
e=Math.min(e,this._o.duration),!!j.debug&&console.log("h5 seek position:"+e),this._h5Audio.currentTime=e;
}
},e.prototype._delMutexPlayers=function(){
var t=this._o,e=this._g.mutexKey,o=j.mutexPlayers[e];
if(o){
for(var i=0,a=o.length;a>i;i++)if(o[i]===this){
o.splice(i,1);
break;
}
if(0==o.length)try{
delete j.mutexPlayers[e];
}catch(n){}
}
if(t.jsapi2Src&&j.mutexPlayers2[t.jsapi2Src]){
for(var s=j.mutexPlayers2[t.jsapi2Src],i=0,a=s.length;a>i;i++)if(s[i]===this){
s.splice(i,1);
break;
}
if(0==s.length)try{
delete j.mutexPlayers2[t.jsapi2Src];
}catch(n){}
}
},e.prototype.surportSeekRange=function(){
return 1==j._playtype?!1:2==this._surportType||3==this._surportType?!0:!1;
},e.prototype.setSrc=function(t){
-1==t.indexOf("?")&&(t+="?"),t+=p(this._o.mid),this._o.src=t,this._delMutexPlayers(),
this._g.mutexKey=this._o.src,j.mutexPlayers[this._g.mutexKey]?j.mutexPlayers[this._g.mutexKey].push(this):j.mutexPlayers[this._g.mutexKey]=[this];
},e.prototype.getSrc=function(){
return this._o.src||"";
},e.prototype.setDuration=function(t){
this._o.duration=t||0;
},e.prototype.getSurportType=function(){
return this._surportType||0;
},e.prototype.getPlayStatus=function(){
return this._status;
},e.prototype.getCurTime=function(){
return 1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio?this._h5Audio.currentTime:0:this.jsApiData.curTime||0;
},e.prototype.getDuration=function(){
return this._o.duration||void 0;
},e.prototype.pause=function(t,e,o){
return o===!0||this._o.allowPause?void(1==this._surportType||3==this._surportType?this._pauseJsapiPlay(t===!1?!1:!0,!1,function(){
"function"==typeof e&&e();
},function(){
"function"==typeof e&&e();
}):2==this._surportType&&this._h5Audio&&"function"==typeof this._h5Audio.pause&&(this._h5Audio.pause(),
"function"==typeof e&&e())):void this.stop(t,e);
},e.prototype.stop=function(t,e){
return 1==this._surportType||3==this._surportType?void this._stopJsapiPlay(t===!1?!1:!0,e):(2==this._surportType&&this._h5Audio&&this._h5Stop(),
void("function"==typeof e&&e()));
},e.prototype.destory=function(){
this.stop(),this._h5Audio&&(document.body.removeChild(this._h5Audio),this._h5Audio=null),
this._delMutexPlayers();
},e.prototype.resume=function(t,e,o){
(o===!0||2==this._status&&this._o.allowPause)&&(2==this._surportType&&this._h5Audio?this._h5Resume():j.inWechat&&this._resumeJsapiPlay(t===!1?!1:!0));
},e.prototype.onload=function(){
this._onLoading();
},e.prototype.play=function(){
var t=this,e=this._g;
if(t._o.src)return 2==t._status&&t._o.allowPause?void t.resume():(e.playTimeoutId&&clearTimeout(e.playTimeoutId),
e.hasCheckPlay?void(j.inWechat?this._jsapiPlay():0!=j.surportType&&this._h5Play()):void(e.playTimeoutId=setTimeout(function(){
t.play();
},1e3)));
},e.prototype.seek=function(t){
{
var e=this;
this._g;
}
if(1==e._status||2==e._status)return 3==this._surportType?void this._jsapiSeek(t):2==this._surportType&&this._h5Audio?void this._h5Seek(t):void 0;
},e.prototype.monitor=function(t,e){
v(-1,t,e);
},{
init:s,
getSurportType:n,
getQuery:S
};
});define("pages/voice_tpl.html.js",[],function(){
return'<span class="js_audio_frame db">\n    <#if(show_not_support===true){#>\n    <span class="db">当前浏览器不支持播放音乐或语音，请在微信或其他浏览器中播放</span>\n    <#}#>\n    <span aria-labelledby="语音" id="voice_main_<#=voiceid#>_<#=posIndex#>" class="share_audio_context flex_context pages_reset" <#if(!musicSupport){#>style="display:none;"<#}#>>\n        <span id="voice_play_<#=voiceid#>_<#=posIndex#>" aria-labelledby="播放开关" class="db share_audio_switch"><em class="icon_share_audio_switch" role="button"></em></span>\n        <span id="voice_detail_<#=voiceid#>_<#=posIndex#>" class="share_audio_info flex_bd db">\n            <strong id="voice_title_<#=voiceid#>_<#=posIndex#>" class="share_audio_title" aria-describedby="语音标题" role="link"><#=title#></strong>\n            <#if(!!nickname){#>\n            <span id="voice_author_<#=voiceid#>_<#=posIndex#>" class="share_audio_tips db">来自<#=nickname#></span>\n            <#}#>\n            <span id="voice_seekRange_<#=voiceid#>_<#=posIndex#>" class="db share_audio_progress_wrp">\n                <span class="db share_audio_progress">\n                    <span id="voice_progress_<#=voiceid#>_<#=posIndex#>" style="width:0%" class="share_audio_progress_inner"></span>\n                    <span id="voice_buffer_<#=voiceid#>_<#=posIndex#>" class="share_audio_progress_buffer" style="width:0%;"></span>\n                    <span id="voice_loading_<#=voiceid#>_<#=posIndex#>" class="share_audio_progress_loading" style="display:none;">\n                        <span class="share_audio_progress_loading_inner"></span>\n                    </span>\n                </span>\n                <span id="voice_playdot_<#=voiceid#>_<#=posIndex#>" class="share_audio_progress_handle" style="display:none;left:0%;"></span>\n            </span>\n            <span class="share_audio_desc db" aria-labelledby="时长">\n                <em id="voice_playtime_<#=voiceid#>_<#=posIndex#>" class="share_audio_length_current" aria-hidden="true">00:00</em>\n                <em id="voice_duration_<#=voiceid#>_<#=posIndex#>" class="share_audio_length_total"><#=duration_str#></em>\n            </span>\n        </span>\n    </span>\n</span>\n';
});define("pages/voice_component.js",["biz_common/dom/event.js","biz_common/tmpl.js","pages/loadscript.js","pages/music_player.js","biz_common/dom/class.js","pages/report.js","biz_common/utils/monitor.js"],function(e,t,o,r){
"use strict";
function a(e){
this._o={
wxIndex:0,
type:0,
comment_id:"",
src:"",
jsapi2Src:"",
mid:"",
songId:"",
autoPlay:!1,
duration:0,
needVioceMutex:!0,
appPlay:!0,
title:"",
allowPause:!1,
singer:"",
epname:"",
coverImgUrl:"",
webUrl:[location.protocol,"//mp.weixin.qq.com/s?referFrom=#referFrom#&songid=#songId#&__biz=",window.biz,"&mid=",window.mid,"&idx=",window.idx,"&sn=",window.sn,"#wechat_redirect"].join(""),
playingCss:"",
playCssDom:"",
playArea:"",
progress:"",
detailUrl:"",
detailArea:"",
fileSize:0,
playtimeDom:"",
loadingDom:"",
bufferDom:"",
playdotDom:"",
seekRange:"",
seekContainer:""
},this._init(e);
}
function i(e,t,o,r){
w.num++,t.musicSupport=w.musicSupport,t.show_not_support=!1,w.musicSupport||1!=w.num||(t.show_not_support=!0);
var a=document.createElement("div"),i="";
if(i=_.tmpl(e,t),a.innerHTML=i,r===!0)o.appendChild(a.children[0]);else{
var n=o.parentNode;
if(!n)return;
n.lastChild===o?n.appendChild(a.children[0]):n.insertBefore(a.children[0],o.nextSibling);
}
}
function n(){
"undefined"==typeof window.reportVoiceid&&(window.reportVoiceid=[]),"undefined"==typeof window.reportMid&&(window.reportMid=[]);
}
function p(){
y.on(window,"unload",s);
}
function s(){
function e(e,t){
for(var o=0,r=e.length;r>o;o++)e[o]=t;
return e;
}
for(var t in w.reportData)v.musicreport({
data:w.reportData[t]
}),w.reportData[t].hasended=e(w.reportData[t].hasended,0),w.reportData[t].detail_click=e(w.reportData[t].detail_click,0),
w.reportData[t].errorcode=e(w.reportData[t].errorcode,0),w.reportData[t].play_duration=e(w.reportData[t].play_duration,0);
}
function c(e){
k.setSum(w.reportId,18,1),k.send();
var t=+new Date,o="//open.music.qq.com/fcgi-bin/fcg_music_get_song_info_weixin.fcg?song_id=#songid#&mid=#mid#&format=json&app_id=1034002693&app_key=cjjDaueOyPYRJFeTqG&device_id=weixin&file_type=mp3&qqmusic_fromtag=50&callback=get_song_info_back";
o=o.replace("#mid#",e.mid).replace("#songid#",e.id),h({
url:o,
timeout:3e4,
callbackName:"get_song_info_back",
callback:function(o){
var r=+new Date-t;
if(!o||"undefined"==typeof o.ret){
var a=1;
return d({
type:"error",
time:r,
code:a
}),void("function"==typeof e.onError&&e.onError({
errcode:a
}));
}
var i;
i=0==o.ret?o.play_url?0:6:1001==o.ret?1:1002==o.ret?2:1003==o.ret?3:1004==o.ret?4:5,
d({
type:"success",
time:r,
code:i
}),e.onSuc({
status:i,
play_url:o.play_url,
duration:o.song_play_time||0
});
},
onerror:function(o){
var r=+new Date-t,a=4;
switch(1*o){
case 400:
a=2;
break;

case 500:
a=3;
break;

default:
a=4;
}
d({
type:"error",
time:r,
code:a
}),"function"==typeof e.onError&&e.onError({
errcode:a
});
}
});
}
function d(e){
var t=Math.max(e.time,0);
if(t=Math.min(t,6e4),e.time>=0&&e.time<200?k.setSum(w.reportId,24,1):e.time>=200&&e.time<500?k.setSum(w.reportId,25,1):e.time>=500&&e.time<1e3?k.setSum(w.reportId,26,1):e.time>=1e3&&e.time<2e3?k.setSum(w.reportId,27,1):e.time>=2e3&&e.time<1e4?k.setSum(w.reportId,28,1):e.time>=1e4&&k.setSum(w.reportId,29,1),
k.setAvg(w.reportId,23,t),"error"==e.type){
switch(1*e.code){
case 1:
k.setSum(w.reportId,9,1);
break;

case 2:
k.setSum(w.reportId,10,1);
break;

case 3:
k.setSum(w.reportId,11,1);
break;

case 4:
k.setSum(w.reportId,12,1);
}
k.setSum(w.reportId,19,1);
}else if("success"==e.type){
switch(1*e.code){
case 1:
k.setSum(w.reportId,8,1);
break;

case 0:
k.setSum(w.reportId,17,1);
break;

case 2:
k.setSum(w.reportId,13,1);
break;

case 3:
k.setSum(w.reportId,14,1);
break;

case 4:
k.setSum(w.reportId,15,1);
break;

case 5:
k.setSum(w.reportId,16,1);
break;

case 6:
k.setSum(w.reportId,47,1);
}
k.setSum(w.reportId,20,1);
}
k.send();
}
function u(e){
return new a(e);
}
function l(e){
if(isNaN(e))return"00:00";
e=Math.ceil(e);
var t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),r=e-3600*t-60*o;
return 0!=t?(10>t&&(t="0"+t),t+=":"):t="",10>o&&(o="0"+o),10>r&&(r="0"+r),t+o+":"+r;
}
function m(e){
return e=(e||"").replace(/&#96;/g,"`").replace(/&#61;/g,"=").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");
}
function g(e){
return e=(e||"").replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/=/g,"&#61;").replace(/`/g,"&#96;");
}
var y=e("biz_common/dom/event.js"),_=e("biz_common/tmpl.js"),h=e("pages/loadscript.js"),f=e("pages/music_player.js"),D=e("biz_common/dom/class.js"),v=e("pages/report.js"),k=e("biz_common/utils/monitor.js"),w={
reportId:"28306",
musicSupport:f.getSurportType(),
debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1?!0:!1,
reportData:{},
posIndex:{},
qqMusiceSongId:"http://thirdparty.gtimg.com/#songId#.m4a?fromtag=38&songid=#songId#",
qqMusiceMid:"http://thirdparty.gtimg.com/C100#mid#.m4a?fromtag=38&songid=#songId#",
num:0
};
return n(),p(),a.prototype._init=function(e){
this._extend(e),this._g={
copyright:-1,
check_copyright:!1,
canDragBar:!1,
barDraging:!1,
canGoDetail:!0
},this._initData(),this._initQQmusicLyric(),this._initReportData(),this._initPlayer(),
this._playEvent();
},a.prototype._initData=function(){
var e=this._o;
if(e.jsapi2Src&&e.jsapi2Src!=e.src&&(2==e.type||3==e.type||4==e.type)){
var t=f.getQuery("mediaid",e.jsapi2Src);
if("function"==typeof window.atob){
var o=(window.atob(t)||"").split("_")[0];
w.debug||o&&1*o%100==1||(this._o.jsapi2Src=this._o.src);
}
}
},a.prototype._initQQmusicLyric=function(){
var e=this._o;
e.webUrl=0==e.type||1==e.type?e.webUrl.replace("#songId#",e.songId||"").replace("#referFrom#","music.qq.com"):e.webUrl.replace("#songId#","").replace("#referFrom#","");
},a.prototype._initReportData=function(){
var e=this._o;
2==e.type||3==e.type||4==e.type?window.reportVoiceid.push(e.songId):(0==e.type||1==e.type)&&window.reportMid.push(e.songId),
"undefined"==typeof w.reportData[e.type]&&(w.reportData[e.type]=v.getMusicReportData(e),
w.posIndex[e.type]=0),this._g.posIndex=w.posIndex[e.type]++;
var t=w.reportData[e.type];
t.musicid.push(e.songId),t.commentid.push(e.comment_id),t.hasended.push(0),t.mtitle.push(e.title),
t.detail_click.push(0),t.duration.push(parseInt(1e3*e.duration)),t.errorcode.push(0),
t.play_duration.push(0);
},a.prototype._initPlayer=function(){
w.musicSupport&&(this._o.onStatusChange=this._statusChangeCallBack(),this._o.onTimeupdate=this._timeupdateCallBack(),
this._o.onError=this._errorCallBack(),this._o.onUpdateSeekRange=this._onUpdateSeekRange(),
this.player=new f.init(this._o));
},a.prototype.isInSeekrang=function(e){
var t=this._o.seekRange;
if(!t)return!1;
if(t===e)return!0;
for(var o=t.getElementsByTagName("*"),r=0,a=o.length;a>r;r++)if(o[r]===e)return!0;
return!1;
},a.prototype._playEvent=function(){
var e=this,t=this._o,o=this._g;
if(t.detailUrl&&t.detailArea&&y.on(t.detailArea,"click",function(r){
if(!o.barDraging&&o.canGoDetail){
var a=r.target||r.srcElement;
a&&e.isInSeekrang(a)||(2==t.type||3==t.type||4==t.type?(w.reportData[t.type].detail_click[o.posIndex]=1,
window.location.href=t.detailUrl):(0==t.type||1==t.type)&&e._checkCopyright(function(){
w.reportData[t.type].detail_click[o.posIndex]=1,window.location.href=t.detailUrl;
}));
}
}),w.musicSupport){
var r=0,a=4,i=5;
2==t.type?r=3:3==t.type?r=6:4==t.type?r=7:(0==t.type||1==t.type)&&(r=1),y.tap(t.playArea,function(){
return D.hasClass(t.playCssDom,t.playingCss)?(t.allowPause?e.player.pause():e.player.stop(),
v.report({
type:r,
comment_id:t.comment_id,
voiceid:t.songId,
action:i
})):1==r?e._checkCopyright(function(){
e.player.setSrc(o.play_url),o.duration&&e.player.setDuration(o.duration),e._playMusic(r,a);
}):e._playMusic(r,a),!1;
}),e._dragEvent();
}
},a.prototype._getCategory=function(){
var e=this._o.type;
return 2==e||3==e||4==e?2:0==e||1==e?1:-1;
},a.prototype._dragEvent=function(){
var e=this,t=this._o,o=this._g,r=t.seekRange;
if(r){
var a=0,i=r,n=!1,p=window.__zoom||1;
for(1!=p&&(n=!0);i&&i!=document.body;)a+=n?i.offsetLeft*p:i.offsetLeft,"page-content"==i.id&&(n=!1),
i=i.offsetParent;
var s=e.player.getDuration();
o.seekData={
zoom:p,
offsetLeft:a,
duration:s,
rangeWidth:r.offsetWidth,
startTime:0,
dragTime:0,
downX:0,
moveX:0
},y.on(r,"mousedown",function(t){
o.canDragBar&&(e._pointerDownHandler({
x:t.pageX||t.clientX
}),t.preventDefault());
}),y.on(t.seekContainer,"mousemove",function(t){
o.canDragBar&&o.barDraging&&(e._pointerMoveHandler({
x:t.pageX||t.clientX
}),t.preventDefault(),t.stopPropagation());
}),y.on(document.body,"mouseup",function(t){
return o.canDragBar&&o.barDraging?(e._pointerUpHandler({
x:t.pageX||t.clientX
}),t.preventDefault(),t.stopPropagation(),!1):void 0;
}),y.on(r,"touchstart",function(t){
o.canDragBar&&(e._pointerDownHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault());
}),y.on(r,"touchmove",function(t){
o.canDragBar&&o.barDraging&&(e._pointerMoveHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault(),t.stopPropagation());
}),y.on(r,"touchend",function(t){
return o.canDragBar&&o.barDraging?(e._pointerUpHandler({
x:t.changedTouches[0].clientX
}),t.preventDefault(),t.stopPropagation(),!1):void 0;
});
}
},a.prototype._pointerDownHandler=function(e){
var t=this._g;
t.barDraging=!0,t.canGoDetail=!1,t.seekData.downX=e.x,t.seekData.startTime=this.player.getCurTime();
},a.prototype._pointerMoveHandler=function(e){
var t=this._g,o=t.seekData;
o.moveX=e.x;
var r=(o.moveX-o.offsetLeft)/o.zoom/o.rangeWidth;
r=Math.min(r,1),r=Math.max(r,0),o.dragTime=r*o.duration,o.dragTime!=o.startTime&&this._updateProgressBar(o.dragTime);
},a.prototype._pointerUpHandler=function(e){
var t=this._g,o=t.seekData;
o.dragTime||this._pointerMoveHandler({
x:e.x
}),t.barDraging=!1,this.player.seek(o.dragTime),t.seekData.startTime=0,t.seekData.dragTime=0,
t.seekData.downX=0,t.seekData.moveX=0,setTimeout(function(){
t.canGoDetail=!0;
},1e3);
},a.prototype._checkCopyright=function(e){
var t=this,o=this._o,r=this._g;
return r.play_url&&this._musicCopyrightWarnning(!1)===!1?void("function"==typeof e&&e()):void(r.check_copyright||(r.check_copyright=!0,
c({
id:o.songId,
mid:o.mid,
onSuc:function(o){
r.check_copyright=!1,r.copyright=1*o.status,t._musicCopyrightWarnning(!0)===!1&&"function"==typeof e&&(r.play_url=o.play_url,
r.duration=o.duration||0,e({
play_url:o.play_url,
duration:r.duration
}));
},
onError:function(){
r.check_copyright=!1;
}
})));
},a.prototype._musicCopyrightWarnning=function(e){
var t=this._g,o=!0,a="";
switch(1*t.copyright){
case 0:
o=!1;
break;

case 1:
o=!0,a="该歌曲版权已过期，无法播放。";
break;

case 2:
o=!0,a="抱歉，应版权方要求，当前国家或地区暂不提供此歌曲服务。";
break;

case 3:
o=!0,a="该歌曲版权已过期，无法播放。";
break;

case 4:
o=!0,a="抱歉，歌曲信息不正确。";
break;

case 5:
o=!0,a="系统错误，请稍后再试。";
break;

case 6:
o=!0,a="系统错误，请稍后再试。";
break;

default:
o=!0,a="系统错误，请稍后再试。";
}
return o===!0&&e===!0&&(a+="错误码："+t.copyright,setTimeout(function(){
r(a);
},0)),o;
},a.prototype._playMusic=function(e,t){
var o=this._o,r=this._g;
this.player.play(),w.reportData[o.type].hasended[r.posIndex]=1,v.report({
type:e,
comment_id:o.comment_id,
voiceid:o.songId,
action:t
});
},a.prototype._extend=function(e){
for(var t in e)this._o[t]=e[t];
},a.prototype._onUpdateSeekRange=function(){
var e=this,t=e._o,o=e._g;
return function(e){
this.surportSeekRange()&&t.bufferDom&&t.playdotDom?(o.canDragBar=!0,t.playdotDom.style.display="block",
t.bufferDom.style.width=1*e+"%"):(o.canDragBar=!1,t.playdotDom&&(t.playdotDom.style.display="none"));
};
},a.prototype._statusChangeCallBack=function(){
var e=this;
return function(t,o){
e._updatePlayerCss(this,o);
};
},a.prototype._timeupdateCallBack=function(){
var e=this,t=this._o,o=this._g;
return function(r,a){
e._updateProgress(a),0!=a&&(w.reportData[t.type].play_duration[o.posIndex]=parseInt(1e3*a));
};
},a.prototype._errorCallBack=function(){
var e=this,t=this._o,o=this._g;
return function(r,a){
w.reportData[t.type].errorcode[o.posIndex]=a.code,e._updatePlayerCss(this,3),e._reportH5Error(a);
};
},a.prototype._reportH5Error=function(e){
if("mp.weixin.qq.com"==location.host&&1==e.type||w.debug){
var t=["code:",e.code,";type:",this._o.type,";url:",window.location.href];
this.player&&t.push(";src:"+this.player.getSrc());
var o=new Image;
o.src=["https://badjs.weixinbridge.com/badjs?level=4&id=112&msg=",encodeURIComponent(t.join("")),"&uin=",window.uin||"","&from=",this._o.type].join("");
}
},a.prototype._updatePlayerCss=function(e,t){
!!w.debug&&console.log("status:"+t);
{
var o=this._o,r=o.playCssDom;
o.progress;
}
2==t?(D.removeClass(r,o.playingCss),o.playdotDom&&(e.surportSeekRange()?(o.playdotDom.style.display="block",
this._g.canDragBar=!0):(o.playdotDom.style.display="none",this._g.canDragBar=!1))):3==t?(D.removeClass(r,o.playingCss),
o.playdotDom&&(o.playdotDom.style.display="none",this._g.canDragBar=!1),this._updateProgress(0)):(1==t||4==t)&&(D.addClass(r,o.playingCss),
o.playdotDom&&(e.surportSeekRange()?(o.playdotDom.style.display="block",this._g.canDragBar=!0):(o.playdotDom.style.display="none",
this._g.canDragBar=!1))),o.loadingDom&&(o.loadingDom.style.display=4==t?"block":"none");
},a.prototype._updateProgress=function(e){
this._g.barDraging||this._updateProgressBar(e);
},a.prototype._updateProgressBar=function(e){
var t=this._o,o=this.player,r=o.getDuration();
if(r){
var a=this._countProgress(r,e);
t.progress&&(t.progress.style.width=a),t.playtimeDom&&(t.playtimeDom.innerHTML=l(e)),
t.playdotDom&&(t.playdotDom.style.left=a);
}
},a.prototype._countProgress=function(e,t){
return Math.min(t/e*100,100)+"%";
},a.prototype.destory=function(){
this.player&&this.player.destory();
},{
init:u,
renderPlayer:i,
formatTime:l,
decodeStr:m,
encodeStr:g
};
});define("appmsg/voice.js",["biz_common/utils/string/html.js","pages/voice_tpl.html.js","appmsg/log.js","pages/voice_component.js"],function(e){
"use strict";
function i(){
var e=a("js_content");
return e?(p._oElements=e.getElementsByTagName("mpvoice")||[],p._oElements.length<=0?!1:!0):!1;
}
function o(){
p.musicLen=p._oElements.length;
}
function n(){
for(var e=0,i=0;i<p.musicLen;i++){
var o=p._oElements[i],n={},c=o.getAttribute("voice_encode_fileid")||"";
try{
c=decodeURIComponent(c);
}catch(a){}
n.voiceid=r.encodeStr(c),n.voiceid=n.voiceid.replace(/&#61;/g,"=").replace(/^\s/,"").replace(/\s$/,""),
n.isaac=1*o.getAttribute("isaac2")||0,n.src=p.srcRoot.replace("#meidaid#",n.voiceid),
1===n.isaac&&(n.jsapi2Src=n.src+"&voice_type=1"),n.voiceid&&"undefined"!=n.voiceid&&(t(o,n,e),
e++);
}
}
function t(e,i,o){
i.duration=parseInt((1*e.getAttribute("play_length")||0)/1e3,10),i.duration_str=r.formatTime(i.duration),
i.posIndex=o;
var n=e.getAttribute("name")||"";
try{
n=decodeURIComponent(n);
}catch(t){}
i.title=r.encodeStr(n).replace(/^\s/,"").replace(/\s$/,""),i.fileSize=1*e.getAttribute("high_size")||0,
i.nickname=window.nickname,r.renderPlayer(d,i,e),c(i),p.musicList[i.voiceid+"_"+i.posIndex]=i;
}
function c(e){
var i=e.voiceid+"_"+e.posIndex,o="";
if(window.voice_in_appmsg&&window.voice_in_appmsg[e.voiceid]){
var n=window.voice_in_appmsg[e.voiceid],t=window.biz||"",c=window.mid||"",d=window.idx||"";
n.bizuin&&n.appmsgid&&n.idx&&(t=n.bizuin,c=n.appmsgid,d=n.idx);
var p=window.location.protocol||"https:";
o=p+"//mp.weixin.qq.com/mp/audio?_wxindex_=#_wxindex_#&scene=104&__biz=#biz#&mid=#mid#&idx=#idx#&voice_id=#voice_id#&sn=#sn##wechat_redirect".replace("#_wxindex_#",e.posIndex).replace("#biz#",t).replace("#mid#",c).replace("#idx#",d).replace("#voice_id#",e.voiceid).replace("#sn#",n.sn||"");
}
s("[Voice] init"+o);
var m=r.decodeStr(e.title);
e.player=r.init({
wxIndex:e.posIndex,
type:2,
songId:e.voiceid,
comment_id:"",
src:e.src,
jsapi2Src:e.jsapi2Src,
allowPause:!0,
duration:e.duration,
title:m,
singer:window.nickname?window.nickname+"的语音":"公众号语音",
epname:"来自文章",
coverImgUrl:window.__appmsgCgiData.hd_head_img,
playingCss:"share_audio_playing",
playCssDom:a("voice_main_"+i),
playArea:a("voice_play_"+i),
progress:a("voice_progress_"+i),
fileSize:e.fileSize,
playtimeDom:a("voice_playtime_"+i),
bufferDom:a("voice_buffer_"+i),
playdotDom:a("voice_playdot_"+i),
seekRange:a("voice_seekRange_"+i),
seekContainer:a("voice_main_"+i),
loadingDom:a("voice_loading_"+i),
detailArea:o?a("voice_detail_"+i):"",
detailUrl:o,
webUrl:o
});
}
function a(e){
return document.getElementById(e);
}
e("biz_common/utils/string/html.js");
var d=e("pages/voice_tpl.html.js"),s=e("appmsg/log.js"),r=e("pages/voice_component.js"),p={
musicList:{},
musicLen:0,
srcRoot:location.protocol+"//res.wx.qq.com/voice/getvoice?mediaid=#meidaid#"
};
return i()?(o(),n(),p.musicList):void 0;
});